"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[4629],{77010:(e,t,i)=>{i.d(t,{KHR_lights:()=>m});var n=i(79923),s=i(26041),o=i(52046),r=i(75524),a=i(79259),h=i(4870),f=i(64704),l=i(83316),d=i(56552);h.b.AddNodeConstructor("Light_Type_0",(e,t)=>()=>new c(e,n.Pq.Zero(),t));class c extends l.p{get shadowAngle(){return this._shadowAngle}set shadowAngle(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(e){const t=this.needCube();if(this._direction=e,this.needCube()!==t&&this._shadowGenerators){const e=this._shadowGenerators.values();for(let t=e.next();!0!==t.done;t=e.next()){t.value.recreateShadowMap()}}}constructor(e,t,i){super(e,i),this._shadowAngle=Math.PI/2,this.position=t}getClassName(){return"PointLight"}getTypeID(){return f.v.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(e){if(this.direction)return super.getShadowDirection(e);switch(e){case 0:return new n.Pq(1,0,0);case 1:return new n.Pq(-1,0,0);case 2:return new n.Pq(0,-1,0);case 3:return new n.Pq(0,1,0);case 4:return new n.Pq(0,0,1);case 5:return new n.Pq(0,0,-1)}return n.Pq.Zero()}_setDefaultShadowProjectionMatrix(e,t,i){const s=this.getScene().activeCamera;if(!s)return;const o=void 0!==this.shadowMinZ?this.shadowMinZ:s.minZ,r=void 0!==this.shadowMaxZ?this.shadowMaxZ:s.maxZ,a=this.getScene().getEngine().useReverseDepthBuffer;n.uq.PerspectiveFovLHToRef(this.shadowAngle,1,a?r:o,a?o:r,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,a)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x-this._scene.floatingOriginOffset.x,this.transformedPosition.y-this._scene.floatingOriginOffset.y,this.transformedPosition.z-this._scene.floatingOriginOffset.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x-this._scene.floatingOriginOffset.x,this.position.y-this._scene.floatingOriginOffset.y,this.position.z-this._scene.floatingOriginOffset.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this}transferToNodeMaterialEffect(e,t){return this.computeTransformedInformation()?e.setFloat3(t,this.transformedPosition.x-this._scene.floatingOriginOffset.x,this.transformedPosition.y-this._scene.floatingOriginOffset.y,this.transformedPosition.z-this._scene.floatingOriginOffset.z):e.setFloat3(t,this.position.x-this._scene.floatingOriginOffset.x,this.position.y-this._scene.floatingOriginOffset.y,this.position.z-this._scene.floatingOriginOffset.z),this}prepareLightSpecificDefines(e,t){e["POINTLIGHT"+t]=!0}}(0,r.Cg)([(0,a.lK)()],c.prototype,"shadowAngle",null),(0,d.Y5)("BABYLON.PointLight",c);var g=i(40136),u=i(98556),_=i(37812);const p="KHR_lights_punctual";class m{constructor(e){this.name=p,this._loader=e,this.enabled=this._loader.isExtensionUsed(p)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights,u.l2.Assign(this._lights)}}loadNodeAsync(e,t,i){return u.BT.LoadExtensionAsync(e,t,this.name,async(r,a)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(e,t,e=>{let t;const h=u.l2.Get(r,this._lights,a.light),l=h.name||e.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,h.type){case"directional":{const e=new o.Z(l,n.Pq.Backward(),this._loader.babylonScene);e.position.setAll(0),t=e;break}case"point":t=new c(l,n.Pq.Zero(),this._loader.babylonScene);break;case"spot":{const e=new g.n(l,n.Pq.Zero(),n.Pq.Backward(),0,1,this._loader.babylonScene);e.angle=2*(h.spot&&h.spot.outerConeAngle||Math.PI/4),e.innerAngle=2*(h.spot&&h.spot.innerConeAngle||0),t=e;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${r}: Invalid light type (${h.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,h._babylonLight=t,t.falloffType=f.v.FALLOFF_GLTF,t.diffuse=h.color?s.v9.FromArray(h.color):s.v9.White(),t.intensity=null==h.intensity?1:h.intensity,t.range=null==h.range?Number.MAX_VALUE:h.range,t.parent=e,this._loader._babylonLights.push(t),u.BT.AddPointerMetadata(t,r),i(e)})))}}(0,_.Hg)(p),(0,_.Ye)(p,!0,e=>new m(e))}}]);