"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[2305],{47841:(t,e,n)=>{n.d(e,{L:()=>r});var i=n(99848),o=n(51137),s=n(32206),a=n(18790);s.$.AudioEngineFactory=(t,e,n)=>new r(t,e,n);class r{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(t=null,e=null,n=null){if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new i.cP,this.onAudioLockedObservable=new i.cP,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,a.BA)())return;void 0!==window.AudioContext&&(this.canUseWebAudio=!0);const o=document.createElement("audio");this._hostElement=t,this._audioContext=e,this._audioDestination=n;try{o&&o.canPlayType&&(o.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||o.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(t){}try{o&&o.canPlayType&&o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(t){}}lock(){this._triggerSuspendedState()}unlock(){if("running"===this._audioContext?.state)return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?this._audioContext?.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){this._audioContext?.addEventListener("statechange",(()=>{this.unlocked&&"running"!==this._audioContext?.state&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){return this._audioContext?.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(t){this.canUseWebAudio=!1,o.V.Error("Web Audio: "+t.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const t=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",e=document.createElement("style");e.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(e),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(t){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=t)}connectToAnalyser(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=t,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},85777:(t,e,n)=>{n.d(e,{MSFT_audio_emitter:()=>h});var i=n(79923),o=n(998),s=n(35238),a=n(23938),r=n(69645),u=n(45316),l=n(37812);n(69440);const d="MSFT_audio_emitter";class h{constructor(t){this.name=d,this._loader=t,this.enabled=this._loader.isExtensionUsed(d)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const t=this._loader.gltf.extensions;if(t&&t[this.name]){const e=t[this.name];this._clips=e.clips,this._emitters=e.emitters,u.l2.Assign(this._clips),u.l2.Assign(this._emitters)}}loadSceneAsync(t,e){return u.BT.LoadExtensionAsync(t,e,this.name,((n,i)=>{const o=new Array;o.push(this._loader.loadSceneAsync(t,e));for(const t of i.emitters){const e=u.l2.Get(`${n}/emitters`,this._emitters,t);if(null!=e.refDistance||null!=e.maxDistance||null!=e.rolloffFactor||null!=e.distanceModel||null!=e.innerAngle||null!=e.outerAngle)throw new Error(`${n}: Direction or Distance properties are not allowed on emitters attached to a scene`);o.push(this._loadEmitterAsync(`${n}/emitters/${e.index}`,e))}return Promise.all(o).then((()=>{}))}))}loadNodeAsync(t,e,n){return u.BT.LoadExtensionAsync(t,e,this.name,((t,s)=>{const a=new Array;return this._loader.loadNodeAsync(t,e,(e=>{for(const n of s.emitters){const s=u.l2.Get(`${t}/emitters`,this._emitters,n);a.push(this._loadEmitterAsync(`${t}/emitters/${s.index}`,s).then((()=>{for(const t of s._babylonSounds)t.attachToMesh(e),null==s.innerAngle&&null==s.outerAngle||(t.setLocalDirectionToMesh(i.Pq.Forward()),t.setDirectionalCone(2*o.S0.ToDegrees(null==s.innerAngle?Math.PI:s.innerAngle),2*o.S0.ToDegrees(null==s.outerAngle?Math.PI:s.outerAngle),0))})))}n(e)})).then((t=>Promise.all(a).then((()=>t))))}))}loadAnimationAsync(t,e){return u.BT.LoadExtensionAsync(t,e,this.name,((n,i)=>this._loader.loadAnimationAsync(t,e).then((o=>{const s=new Array;u.l2.Assign(i.events);for(const a of i.events)s.push(this._loadAnimationEventAsync(`${n}/events/${a.index}`,t,e,a,o));return Promise.all(s).then((()=>o))}))))}_loadClipAsync(t,e){if(e._objectURL)return e._objectURL;let n;if(e.uri)n=this._loader.loadUriAsync(t,e,e.uri);else{const i=u.l2.Get(`${t}/bufferView`,this._loader.gltf.bufferViews,e.bufferView);n=this._loader.loadBufferViewAsync(`/bufferViews/${i.index}`,i)}return e._objectURL=n.then((t=>URL.createObjectURL(new Blob([t],{type:e.mimeType})))),e._objectURL}_loadEmitterAsync(t,e){if(e._babylonSounds=e._babylonSounds||[],!e._babylonData){const t=new Array,n=e.name||`emitter${e.index}`,i={loop:!1,autoplay:!1,volume:null==e.volume?1:e.volume};for(let o=0;o<e.clips.length;o++){const s=`/extensions/${this.name}/clips`,r=u.l2.Get(s,this._clips,e.clips[o].clip);t.push(this._loadClipAsync(`${s}/${e.clips[o].clip}`,r).then((t=>{const s=e._babylonSounds[o]=new a.A(n,t,this._loader.babylonScene,null,i);s.refDistance=e.refDistance||1,s.maxDistance=e.maxDistance||256,s.rolloffFactor=e.rolloffFactor||1,s.distanceModel=e.distanceModel||"exponential"})))}const s=Promise.all(t).then((()=>{const t=e.clips.map((t=>t.weight||1)),n=new r.r(e.loop||!1,e._babylonSounds,t);e.innerAngle&&(n.directionalConeInnerAngle=2*o.S0.ToDegrees(e.innerAngle)),e.outerAngle&&(n.directionalConeOuterAngle=2*o.S0.ToDegrees(e.outerAngle)),e.volume&&(n.volume=e.volume),e._babylonData.sound=n}));e._babylonData={loaded:s}}return e._babylonData.loaded}_getEventAction(t,e,n,i,o){switch(n){case"play":return t=>{const n=(o||0)+(t-i);e.play(n)};case"stop":return()=>{e.stop()};case"pause":return()=>{e.pause()};default:throw new Error(`${t}: Unsupported action ${n}`)}}_loadAnimationEventAsync(t,e,n,i,o){if(0==o.targetedAnimations.length)return Promise.resolve();const a=o.targetedAnimations[0],r=i.emitter,l=u.l2.Get(`/extensions/${this.name}/emitters`,this._emitters,r);return this._loadEmitterAsync(t,l).then((()=>{const e=l._babylonData.sound;if(e){const n=new s.p(i.time,this._getEventAction(t,e,i.action,i.time,i.startOffset));a.animation.addEvent(n),o.onAnimationGroupEndObservable.add((()=>{e.stop()})),o.onAnimationGroupPauseObservable.add((()=>{e.pause()}))}}))}}(0,l.Hg)(d),(0,l.Ye)(d,!0,(t=>new h(t)))}}]);