"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[9807],{29807:(t,e,i)=>{i.d(e,{MSFT_audio_emitter:()=>P});var n=i(14037),o=i(998);class s{constructor(t,e,i){this.frame=t,this.action=e,this.onlyOnce=i,this.isDone=!1}_clone(){return new s(this.frame,this.action,this.onlyOnce)}}var a=i(99848),r=i(51137),u=i(45503),d=i(6315),h=i(56552),l=i(59931),c=i(2940);class _{get loop(){return this._loop}set loop(t){t!==this._loop&&(this._loop=t,this.updateOptions({loop:t}))}get currentTime(){if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(l.$.audioEngine?.audioContext&&(this.isPlaying||this.isPaused)){const t=this.isPaused?0:l.$.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+t}return 0}get spatialSound(){return this._spatialSound}set spatialSound(t){if(t==this._spatialSound)return;const e=this.isPlaying;this.pause(),t?(this._spatialSound=t,this._updateSpatialParameters()):this._disableSpatialSound(),e&&this.play()}constructor(t,e,i,s=null,u){if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new a.cP,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=n.Pq.Zero(),this._localDirection=new n.Pq(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,i=i||d.q.LastCreatedScene)if(this._scene=i,_._SceneComponentInitialization(i),this._readyToPlayCallback=s,this._customAttenuationFunction=(t,e,i,n,o)=>e<i?t*(1-e/i):0,u&&(this.autoplay=u.autoplay||!1,this._loop=u.loop||!1,void 0!==u.volume&&(this._volume=u.volume),this._spatialSound=u.spatialSound??!1,this.maxDistance=u.maxDistance??100,this.useCustomAttenuation=u.useCustomAttenuation??!1,this.rolloffFactor=u.rolloffFactor||1,this.refDistance=u.refDistance||1,this.distanceModel=u.distanceModel||"linear",this._playbackRate=u.playbackRate||1,this._streaming=u.streaming??!1,this._length=u.length,this._offset=u.offset),l.$.audioEngine?.canUseWebAudio&&l.$.audioEngine.audioContext){this._soundGain=l.$.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let t=!0;if(e)try{"string"==typeof e?(this._urlType="String",this._url=e):e instanceof ArrayBuffer?this._urlType="ArrayBuffer":e instanceof HTMLMediaElement?this._urlType="MediaElement":e instanceof MediaStream?this._urlType="MediaStream":e instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(e)&&(this._urlType="Array");let i=[],n=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=l.$.audioEngine.audioContext.createMediaElementSource(e),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=l.$.audioEngine.audioContext.createMediaStreamSource(e),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":e.byteLength>0&&(n=!0,this._soundLoaded(e));break;case"AudioBuffer":this._audioBufferLoaded(e);break;case"String":i.push(e);case"Array":0===i.length&&(i=e);for(let t=0;t<i.length;t++){const e=i[t];if(n=u&&u.skipCodecCheck||-1!==e.indexOf(".mp3",e.length-4)&&l.$.audioEngine.isMP3supported||-1!==e.indexOf(".ogg",e.length-4)&&l.$.audioEngine.isOGGsupported||-1!==e.indexOf(".wav",e.length-4)||-1!==e.indexOf(".m4a",e.length-4)||-1!==e.indexOf(".mp4",e.length-4)||-1!==e.indexOf("blob:"),n){this._streaming?(this._htmlAudioElement=new Audio(e),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,o.S0.SetCorsBehavior(e,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()},{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(e,t=>{this._soundLoaded(t)},void 0,!0,!0,t=>{t&&r.V.Error("XHR "+t.status+" error on: "+e+"."),r.V.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)});break}}break;default:t=!1}t?n||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout(()=>{this._readyToPlayCallback&&this._readyToPlayCallback()},1e3)):r.V.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(t){r.V.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),l.$.audioEngine&&!l.$.audioEngine.WarnedWebAudioUnsupported&&(r.V.Error("Web Audio is not supported by your browser."),l.$.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout(()=>{this._readyToPlayCallback&&this._readyToPlayCallback()},1e3)}dispose(){l.$.audioEngine?.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(t){l.$.audioEngine?.audioContext&&(this._audioBuffer=t,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(t){l.$.audioEngine?.audioContext&&l.$.audioEngine.audioContext.decodeAudioData(t,t=>{this._audioBufferLoaded(t)},t=>{r.V.Error("Error while decoding audio data for: "+this.name+" / Error: "+t)})}setAudioBuffer(t){l.$.audioEngine?.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)}updateOptions(t){t&&(this.loop=t.loop??this.loop,this.maxDistance=t.maxDistance??this.maxDistance,this.useCustomAttenuation=t.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=t.rolloffFactor??this.rolloffFactor,this.refDistance=t.refDistance??this.refDistance,this.distanceModel=t.distanceModel??this.distanceModel,this._playbackRate=t.playbackRate??this._playbackRate,this._length=t.length??void 0,this.spatialSound=t.spatialSound??this._spatialSound,this._setOffset(t.offset??void 0),this.setVolume(t.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){l.$.audioEngine?.canUseWebAudio&&l.$.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??l.$.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){this._spatialSound&&(this._inputAudioNode=this._soundGain,this._soundPanner?.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){l.$.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(t){l.$.audioEngine?.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(t),this._isOutputConnected=!0)}setDirectionalCone(t,e,i){e<t?r.V.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=t,this._coneOuterAngle=e,this._coneOuterGain=i,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(t){if(t!=this._coneInnerAngle){if(this._coneOuterAngle<t)return void r.V.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t,l.$.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(t){if(t!=this._coneOuterAngle){if(t<this._coneInnerAngle)return void r.V.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t,l.$.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(t){t.equals(this._position)||(this._position.copyFrom(t),l.$.audioEngine?.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(t){this._localDirection=t,l.$.audioEngine?.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const t=this._connectedTransformNode.getWorldMatrix(),e=n.Pq.TransformNormal(this._localDirection,t);e.normalize(),this._soundPanner.orientationX.value=e.x,this._soundPanner.orientationY.value=e.y,this._soundPanner.orientationZ.value=e.z}updateDistanceFromListener(){if(l.$.audioEngine?.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const t=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.subtract(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(t){this._customAttenuationFunction=t}play(t,e,i){if(this._isReadyToPlay&&this._scene.audioEnabled&&l.$.audioEngine?.audioContext)try{this._clearTimeoutsAndObservers();let n=t?l.$.audioEngine?.audioContext.currentTime+t:l.$.audioEngine?.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=l.$.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const t=()=>{if(l.$.audioEngine?.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=e??0;const i=this._htmlAudioElement.play();void 0!==i&&i.catch(()=>{l.$.audioEngine?.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=l.$.audioEngine?.onAudioUnlockedObservable.addOnce(()=>{t()}))})}else(this.loop||this.autoplay)&&(this._audioUnlockedObserver=l.$.audioEngine?.onAudioUnlockedObservable.addOnce(()=>{t()}))};t()}}else{const o=()=>{if(l.$.audioEngine?.audioContext){if(i=i||this._length,void 0!==e&&this._setOffset(e),this._soundSource){const t=this._soundSource;t.onended=()=>{t.disconnect()}}if(this._soundSource=l.$.audioEngine?.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==e&&(this._soundSource.loopStart=e),void 0!==i&&(this._soundSource.loopEnd=(0|e)+i),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},n=t?l.$.audioEngine?.audioContext.currentTime+t:l.$.audioEngine.audioContext.currentTime;const o=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(n,o,this.loop?void 0:i)}}};"suspended"===l.$.audioEngine?.audioContext.state?this._tryToPlayTimeout=setTimeout(()=>{"suspended"===l.$.audioEngine?.audioContext.state?(l.$.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=l.$.audioEngine.onAudioUnlockedObservable.addOnce(()=>{o()}))):o()},500):o()}this._startTime=n,this.isPlaying=!0,this.isPaused=!1}catch(t){r.V.Error("Error while trying to play audio: "+this.name+", "+t.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(t){if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource?.disconnect(),this.isPlaying=!1;else if(l.$.audioEngine?.audioContext&&this._soundSource){const e=t?l.$.audioEngine.audioContext.currentTime+t:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(e)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){this.isPlaying&&(this._clearTimeoutsAndObservers(),this._streaming?(this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource?.disconnect(),this.isPlaying=!1,this.isPaused=!0):l.$.audioEngine?.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=l.$.audioEngine.audioContext.currentTime-this._startTime))}setVolume(t,e){l.$.audioEngine?.canUseWebAudio&&this._soundGain&&(e&&l.$.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(l.$.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,l.$.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,l.$.audioEngine.audioContext.currentTime+e)):this._soundGain.gain.value=t),this._volume=t}setPlaybackRate(t){this._playbackRate=t,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(t){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=t,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=t=>this._onRegisterAfterWorldMatrixUpdate(t),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(t){if(t.getBoundingInfo){const e=t.getBoundingInfo();this.setPosition(e.boundingSphere.centerWorld)}else this.setPosition(t.absolutePosition);l.$.audioEngine?.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const t=()=>{(0,c.B)(()=>this._isReadyToPlay,()=>{i._audioBuffer=this.getAudioBuffer(),i._isReadyToPlay=!0,i.autoplay&&i.play(0,this._offset,this._length)},void 0,300)},e={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},i=new _(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,e);return this.useCustomAttenuation&&i.setAttenuationFunction(this._customAttenuationFunction),i.setPosition(this._position),i.setPlaybackRate(this._playbackRate),t(),i}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const t={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(t.connectedMeshId=this._connectedTransformNode.id),t.position=this._position.asArray(),t.refDistance=this.refDistance,t.distanceModel=this.distanceModel,t.isDirectional=this._isDirectional,t.localDirectionToMesh=this._localDirection.asArray(),t.coneInnerAngle=this._coneInnerAngle,t.coneOuterAngle=this._coneOuterAngle,t.coneOuterGain=this._coneOuterGain),t}static Parse(t,e,i,o){const s=t.name;let a;a=t.url?i+t.url:i+s;const r={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};let u;if(o){const t=()=>{(0,c.B)(()=>o._isReadyToPlay,()=>{u._audioBuffer=o.getAudioBuffer(),u._isReadyToPlay=!0,u.autoplay&&u.play(0,u._offset,u._length)},void 0,300)};u=new _(s,new ArrayBuffer(0),e,null,r),t()}else u=new _(s,a,e,()=>{e.removePendingData(u)},r),e.addPendingData(u);if(t.position){const e=n.Pq.FromArray(t.position);u.setPosition(e)}if(t.isDirectional&&(u.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){const e=n.Pq.FromArray(t.localDirectionToMesh);u.setLocalDirectionToMesh(e)}if(t.connectedMeshId){const i=e.getMeshById(t.connectedMeshId);i&&u.attachToMesh(i)}return t.metadata&&(u.metadata=t.metadata),u}_setOffset(t){this._offset!==t&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=t)}_clearTimeoutsAndObservers(){this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver&&(l.$.audioEngine?.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}_._SceneComponentInitialization=t=>{throw(0,u.n)("AudioSceneComponent")},(0,h.Y5)("BABYLON.Sound",_);class m{constructor(t,e,i){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],e.length!==i.length)throw new Error("Sounds length does not equal weights length");this.loop=t,this._weights=i;let n=0;for(const t of i)n+=t;const o=n>0?1/n:0;for(let t=0;t<this._weights.length;t++)this._weights[t]*=o;this._sounds=e;for(const t of this._sounds)t.onEndedObservable.add(()=>{this._onended()})}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(t){if(t!==this._coneInnerAngle){if(this._coneOuterAngle<t)return void r.V.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t;for(const e of this._sounds)e.directionalConeInnerAngle=t}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(t){if(t!==this._coneOuterAngle){if(t<this._coneInnerAngle)return void r.V.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t;for(const e of this._sounds)e.directionalConeOuterAngle=t}}get volume(){return this._volume}set volume(t){if(t!==this._volume)for(const e of this._sounds)e.setVolume(t)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(t){if(!this.isPaused){this.stop();const t=Math.random();let e=0;for(let i=0;i<this._weights.length;i++)if(e+=this._weights[i],t<=e){this._currentIndex=i;break}}const e=this._sounds[this._currentIndex??0];e.isReady()?e.play(0,this.isPaused?void 0:t):e.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}var p=i(98556),g=i(37812);class f{constructor(t,e={}){this.id=-1,this._isInitialized=!1,(t=t||d.q.LastCreatedScene)&&(this._scene=t,this.soundCollection=[],this._options=e,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){l.$.audioEngine?.canUseWebAudio&&l.$.audioEngine.audioContext&&(this._outputAudioNode=l.$.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(l.$.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(l.$.audioEngine&&l.$.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(t){this._isInitialized||this._initializeSoundTrackAudioGraph(),l.$.audioEngine?.canUseWebAudio&&this._outputAudioNode&&t.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.removeSound(t):this._scene.soundTracks&&this._scene.soundTracks[t.soundTrackId].removeSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id}removeSound(t){const e=this.soundCollection.indexOf(t);-1!==e&&this.soundCollection.splice(e,1)}setVolume(t){l.$.audioEngine?.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=t)}switchPanningModelToHRTF(){if(l.$.audioEngine?.canUseWebAudio)for(let t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){if(l.$.audioEngine?.canUseWebAudio)for(let t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()}connectToAnalyser(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,l.$.audioEngine?.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,l.$.audioEngine.masterGain))}}var A=i(16945),y=i(29794),T=(i(47841),i(76237));(0,i(93084).ji)(A.v.NAME_AUDIO,(t,e,i,n)=>{let o,s=[];if(i.sounds=i.sounds||[],void 0!==t.sounds&&null!==t.sounds)for(let a=0,r=t.sounds.length;a<r;a++){const r=t.sounds[a];l.$.audioEngine?.canUseWebAudio?(r.url||(r.url=r.name),s[r.url]?i.sounds.push(_.Parse(r,e,n,s[r.url])):(o=_.Parse(r,e,n),s[r.url]=o,i.sounds.push(o))):i.sounds.push(new _(r.name,null,e))}s=[]}),Object.defineProperty(y.Z.prototype,"mainSoundTrack",{get:function(){let t=this._getComponent(A.v.NAME_AUDIO);return t||(t=new b(this),this._addComponent(t)),this._mainSoundTrack||(this._mainSoundTrack=new f(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),y.Z.prototype.getSoundByName=function(t){let e;for(e=0;e<this.mainSoundTrack.soundCollection.length;e++)if(this.mainSoundTrack.soundCollection[e].name===t)return this.mainSoundTrack.soundCollection[e];if(this.soundTracks)for(let i=0;i<this.soundTracks.length;i++)for(e=0;e<this.soundTracks[i].soundCollection.length;e++)if(this.soundTracks[i].soundCollection[e].name===t)return this.soundTracks[i].soundCollection[e];return null},Object.defineProperty(y.Z.prototype,"audioEnabled",{get:function(){let t=this._getComponent(A.v.NAME_AUDIO);return t||(t=new b(this),this._addComponent(t)),t.audioEnabled},set:function(t){let e=this._getComponent(A.v.NAME_AUDIO);e||(e=new b(this),this._addComponent(e)),t?e.enableAudio():e.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(y.Z.prototype,"headphone",{get:function(){let t=this._getComponent(A.v.NAME_AUDIO);return t||(t=new b(this),this._addComponent(t)),t.headphone},set:function(t){let e=this._getComponent(A.v.NAME_AUDIO);e||(e=new b(this),this._addComponent(e)),t?e.switchAudioModeForHeadphones():e.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(y.Z.prototype,"audioListenerPositionProvider",{get:function(){let t=this._getComponent(A.v.NAME_AUDIO);return t||(t=new b(this),this._addComponent(t)),t.audioListenerPositionProvider},set:function(t){let e=this._getComponent(A.v.NAME_AUDIO);if(e||(e=new b(this),this._addComponent(e)),t&&"function"!=typeof t)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");e.audioListenerPositionProvider=t},enumerable:!0,configurable:!0}),Object.defineProperty(y.Z.prototype,"audioListenerRotationProvider",{get:function(){let t=this._getComponent(A.v.NAME_AUDIO);return t||(t=new b(this),this._addComponent(t)),t.audioListenerRotationProvider},set:function(t){let e=this._getComponent(A.v.NAME_AUDIO);if(e||(e=new b(this),this._addComponent(e)),t&&"function"!=typeof t)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");e.audioListenerRotationProvider=t},enumerable:!0,configurable:!0}),Object.defineProperty(y.Z.prototype,"audioPositioningRefreshRate",{get:function(){let t=this._getComponent(A.v.NAME_AUDIO);return t||(t=new b(this),this._addComponent(t)),t.audioPositioningRefreshRate},set:function(t){let e=this._getComponent(A.v.NAME_AUDIO);e||(e=new b(this),this._addComponent(e)),e.audioPositioningRefreshRate=t},enumerable:!0,configurable:!0});class b{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(t){this.name=A.v.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new n.Pq,this._cachedCameraPosition=new n.Pq,this._lastCheck=0,this._invertMatrixTemp=new n.uq,this._cameraDirectionTemp=new n.Pq,(t=t||d.q.LastCreatedScene)&&(this.scene=t,t.soundTracks=[],t.sounds=[])}register(){this.scene._afterRenderStage.registerStep(A.v.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(t){if(t.sounds=[],this.scene.soundTracks)for(let e=0;e<this.scene.soundTracks.length;e++){const i=this.scene.soundTracks[e];for(let e=0;e<i.soundCollection.length;e++)t.sounds.push(i.soundCollection[e].serialize())}}addFromContainer(t){if(t.sounds)for(const e of t.sounds)e.play(),e.autoplay=!0,this.scene.mainSoundTrack.addSound(e)}removeFromContainer(t,e=!1){if(t.sounds)for(const i of t.sounds)i.stop(),i.autoplay=!1,this.scene.mainSoundTrack.removeSound(i),e&&i.dispose()}dispose(){const t=this.scene;if(t._mainSoundTrack&&t.mainSoundTrack.dispose(),t.soundTracks)for(let e=0;e<t.soundTracks.length;e++)t.soundTracks[e].dispose()}disableAudio(){const t=this.scene;let e;for(this._audioEnabled=!1,l.$.audioEngine&&l.$.audioEngine.audioContext&&l.$.audioEngine.audioContext.suspend(),e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[e].pause();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(let i=0;i<t.soundTracks[e].soundCollection.length;i++)t.soundTracks[e].soundCollection[i].pause()}enableAudio(){const t=this.scene;let e;for(this._audioEnabled=!0,l.$.audioEngine&&l.$.audioEngine.audioContext&&l.$.audioEngine.audioContext.resume(),e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[e].isPaused&&t.mainSoundTrack.soundCollection[e].play();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(let i=0;i<t.soundTracks[e].soundCollection.length;i++)t.soundTracks[e].soundCollection[i].isPaused&&t.soundTracks[e].soundCollection[i].play()}switchAudioModeForHeadphones(){const t=this.scene;if(this._headphone=!0,t.mainSoundTrack.switchPanningModelToHRTF(),t.soundTracks)for(let e=0;e<t.soundTracks.length;e++)t.soundTracks[e].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const t=this.scene;if(this._headphone=!1,t.mainSoundTrack.switchPanningModelToEqualPower(),t.soundTracks)for(let e=0;e<t.soundTracks.length;e++)t.soundTracks[e].switchPanningModelToEqualPower()}_afterRender(){const t=T.j.Now;if(this._lastCheck&&t-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=t;const e=this.scene;if(!this._audioEnabled||!e._mainSoundTrack||!e.soundTracks||0===e._mainSoundTrack.soundCollection.length&&1===e.soundTracks.length)return;const i=l.$.audioEngine;if(i&&i.audioContext){let t,o=e.activeCamera;if(e.activeCameras&&e.activeCameras.length>0&&(o=e.activeCameras[0]),this.audioListenerPositionProvider){const t=this.audioListenerPositionProvider();i.audioContext.listener.setPosition(t.x||0,t.y||0,t.z||0)}else o?this._cachedCameraPosition.equals(o.globalPosition)||(this._cachedCameraPosition.copyFrom(o.globalPosition),i.audioContext.listener.setPosition(o.globalPosition.x,o.globalPosition.y,o.globalPosition.z)):i.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const t=this.audioListenerRotationProvider();i.audioContext.listener.setOrientation(t.x||0,t.y||0,t.z||0,0,1,0)}else o?(o.rigCameras&&o.rigCameras.length>0&&(o=o.rigCameras[0]),o.getViewMatrix().invertToRef(this._invertMatrixTemp),n.Pq.TransformNormalToRef(b._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.copyFrom(this._cameraDirectionTemp),i.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):i.audioContext.listener.setOrientation(0,0,0,0,1,0);for(t=0;t<e.mainSoundTrack.soundCollection.length;t++){const i=e.mainSoundTrack.soundCollection[t];i.useCustomAttenuation&&i.updateDistanceFromListener()}if(e.soundTracks)for(t=0;t<e.soundTracks.length;t++)for(let i=0;i<e.soundTracks[t].soundCollection.length;i++){const n=e.soundTracks[t].soundCollection[i];n.useCustomAttenuation&&n.updateDistanceFromListener()}}}}b._CameraDirection=new n.Pq(0,0,-1),_._SceneComponentInitialization=t=>{let e=t._getComponent(A.v.NAME_AUDIO);e||(e=new b(t),t._addComponent(e))};const C="MSFT_audio_emitter";class P{constructor(t){this.name=C,this._loader=t,this.enabled=this._loader.isExtensionUsed(C)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const t=this._loader.gltf.extensions;if(t&&t[this.name]){const e=t[this.name];this._clips=e.clips,this._emitters=e.emitters,p.l2.Assign(this._clips),p.l2.Assign(this._emitters)}}loadSceneAsync(t,e){return p.BT.LoadExtensionAsync(t,e,this.name,async(i,n)=>{const o=new Array;o.push(this._loader.loadSceneAsync(t,e));for(const t of n.emitters){const e=p.l2.Get(`${i}/emitters`,this._emitters,t);if(null!=e.refDistance||null!=e.maxDistance||null!=e.rolloffFactor||null!=e.distanceModel||null!=e.innerAngle||null!=e.outerAngle)throw new Error(`${i}: Direction or Distance properties are not allowed on emitters attached to a scene`);o.push(this._loadEmitterAsync(`${i}/emitters/${e.index}`,e))}await Promise.all(o)})}loadNodeAsync(t,e,i){return p.BT.LoadExtensionAsync(t,e,this.name,async(t,s)=>{const a=new Array,r=await this._loader.loadNodeAsync(t,e,e=>{for(const i of s.emitters){const s=p.l2.Get(`${t}/emitters`,this._emitters,i);a.push(this._loadEmitterAsync(`${t}/emitters/${s.index}`,s).then(()=>{for(const t of s._babylonSounds)t.attachToMesh(e),null==s.innerAngle&&null==s.outerAngle||(t.setLocalDirectionToMesh(n.Pq.Forward()),t.setDirectionalCone(2*o.S0.ToDegrees(null==s.innerAngle?Math.PI:s.innerAngle),2*o.S0.ToDegrees(null==s.outerAngle?Math.PI:s.outerAngle),0))}))}i(e)});return await Promise.all(a),r})}loadAnimationAsync(t,e){return p.BT.LoadExtensionAsync(t,e,this.name,async(i,n)=>{const o=await this._loader.loadAnimationAsync(t,e),s=new Array;p.l2.Assign(n.events);for(const a of n.events)s.push(this._loadAnimationEventAsync(`${i}/events/${a.index}`,t,e,a,o));return await Promise.all(s),o})}_loadClipAsync(t,e){if(e._objectURL)return e._objectURL;let i;if(e.uri)i=this._loader.loadUriAsync(t,e,e.uri);else{const n=p.l2.Get(`${t}/bufferView`,this._loader.gltf.bufferViews,e.bufferView);i=this._loader.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}return e._objectURL=i.then(t=>URL.createObjectURL(new Blob([t],{type:e.mimeType}))),e._objectURL}_loadEmitterAsync(t,e){if(e._babylonSounds=e._babylonSounds||[],!e._babylonData){const t=new Array,i=e.name||`emitter${e.index}`,n={loop:!1,autoplay:!1,volume:null==e.volume?1:e.volume};for(let o=0;o<e.clips.length;o++){const s=`/extensions/${this.name}/clips`,a=p.l2.Get(s,this._clips,e.clips[o].clip);t.push(this._loadClipAsync(`${s}/${e.clips[o].clip}`,a).then(t=>{const s=e._babylonSounds[o]=new _(i,t,this._loader.babylonScene,null,n);s.refDistance=e.refDistance||1,s.maxDistance=e.maxDistance||256,s.rolloffFactor=e.rolloffFactor||1,s.distanceModel=e.distanceModel||"exponential"}))}const s=Promise.all(t).then(()=>{const t=e.clips.map(t=>t.weight||1),i=new m(e.loop||!1,e._babylonSounds,t);e.innerAngle&&(i.directionalConeInnerAngle=2*o.S0.ToDegrees(e.innerAngle)),e.outerAngle&&(i.directionalConeOuterAngle=2*o.S0.ToDegrees(e.outerAngle)),e.volume&&(i.volume=e.volume),e._babylonData.sound=i});e._babylonData={loaded:s}}return e._babylonData.loaded}_getEventAction(t,e,i,n,o){switch(i){case"play":return t=>{const i=(o||0)+(t-n);e.play(i)};case"stop":return()=>{e.stop()};case"pause":return()=>{e.pause()};default:throw new Error(`${t}: Unsupported action ${i}`)}}_loadAnimationEventAsync(t,e,i,n,o){if(0==o.targetedAnimations.length)return Promise.resolve();const a=o.targetedAnimations[0],r=n.emitter,u=p.l2.Get(`/extensions/${this.name}/emitters`,this._emitters,r);return this._loadEmitterAsync(t,u).then(()=>{const e=u._babylonData.sound;if(e){const i=new s(n.time,this._getEventAction(t,e,n.action,n.time,n.startOffset));a.animation.addEvent(i),o.onAnimationGroupEndObservable.add(()=>{e.stop()}),o.onAnimationGroupPauseObservable.add(()=>{e.pause()})}})}}(0,g.Hg)(C),(0,g.Ye)(C,!0,t=>new P(t))},47841:(t,e,i)=>{var n=i(99848),o=i(51137),s=i(59931),a=i(18790);s.$.AudioEngineFactory=(t,e,i)=>new r(t,e,i);class r{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(t=null,e=null,i=null){if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new n.cP,this.onAudioLockedObservable=new n.cP,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,a.BA)())return;void 0!==window.AudioContext&&(this.canUseWebAudio=!0);const o=document.createElement("audio");this._hostElement=t,this._audioContext=e,this._audioDestination=i;try{o&&o.canPlayType&&(o.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||o.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(t){}try{o&&o.canPlayType&&o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(t){}}lock(){this._triggerSuspendedState()}unlock(){if("running"===this._audioContext?.state)return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?this._audioContext?.suspend().then(()=>{this._tryToRun=!1,this._triggerRunningStateAsync()},()=>{o.V.Error("Failed to suspend audio context.")}):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){this._audioContext?.addEventListener("statechange",()=>{this.unlocked&&"running"!==this._audioContext?.state&&this._resumeAudioContextAsync()},{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){return this._audioContext?.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(t){this.canUseWebAudio=!1,o.V.Error("Web Audio: "+t.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(t){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const t=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",e=document.createElement("style");e.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(e),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",()=>{this._triggerRunningStateAsync()},!0),this._muteButton.addEventListener("click",()=>{this.unlock()},!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),this._audioContext?.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(t){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=t)}connectToAnalyser(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=t,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},93084:(t,e,i)=>{i.d(e,{ji:()=>o});const n={};function o(t,e){n[t]=e}}}]);