"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[6804],{6804:(e,a,r)=>{r.d(a,{KHR_materials_clearcoat:()=>l});var o=r(98556),t=r(37812),n=r(26041);const s="KHR_materials_clearcoat";class l{constructor(e){this.name=s,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(s)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,a,r){return o.BT.LoadExtensionAsync(e,a,this.name,async(o,t)=>{const n=new Array;n.push(this._loader.loadMaterialPropertiesAsync(e,a,r)),n.push(this._loadClearCoatPropertiesAsync(o,t,r));const s=this._loader._getOrCreateMaterialAdapter(r);if(t.extensions&&t.extensions.KHR_materials_clearcoat_darkening){const e=t.extensions.KHR_materials_clearcoat_darkening;n.push(this._loadClearCoatDarkeningPropertiesAsync(o,e,r))}if(t.extensions&&t.extensions.KHR_materials_clearcoat_ior){const e=t.extensions.KHR_materials_clearcoat_ior;let a=1.5;void 0!==e.clearcoatIor&&(a=e.clearcoatIor),s.coatIor=a}if(t.extensions&&t.extensions.KHR_materials_clearcoat_anisotropy){const e=t.extensions.KHR_materials_clearcoat_anisotropy;n.push(this._loadClearCoatAnisotropyPropertiesAsync(o,e,r))}if(t.extensions&&t.extensions.KHR_materials_clearcoat_color){const e=t.extensions.KHR_materials_clearcoat_color;n.push(this._loadClearCoatColorPropertiesAsync(o,e,r))}await Promise.all(n)})}_loadClearCoatPropertiesAsync(e,a,r){const o=this._loader._getOrCreateMaterialAdapter(r),t=new Array;return o.configureCoat(),o.coatWeight=void 0!==a.clearcoatFactor?a.clearcoatFactor:0,o.coatRoughness=void 0!==a.clearcoatRoughnessFactor?a.clearcoatRoughnessFactor:0,a.clearcoatTexture&&t.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatTexture`,a.clearcoatTexture,e=>{e.name=`${r.name} (ClearCoat)`,o.coatWeightTexture=e})),a.clearcoatRoughnessTexture&&(a.clearcoatRoughnessTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatRoughnessTexture`,a.clearcoatRoughnessTexture,e=>{e.name=`${r.name} (ClearCoat Roughness)`,o.coatRoughnessTexture=e}))),a.clearcoatNormalTexture&&(a.clearcoatNormalTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatNormalTexture`,a.clearcoatNormalTexture,e=>{e.name=`${r.name} (ClearCoat Normal)`,o.geometryCoatNormalTexture=e,null!=a.clearcoatNormalTexture?.scale&&(o.geometryCoatNormalTextureScale=a.clearcoatNormalTexture.scale)})),o.setNormalMapInversions(!r.getScene().useRightHandedSystem,r.getScene().useRightHandedSystem)),Promise.all(t).then(()=>{})}_loadClearCoatDarkeningPropertiesAsync(e,a,r){const o=this._loader._getOrCreateMaterialAdapter(r),t=new Array;return o.coatDarkening=void 0!==a.clearcoatDarkeningFactor?a.clearcoatDarkeningFactor:1,a.clearcoatDarkeningTexture&&(a.clearcoatDarkeningTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatDarkeningTexture`,a.clearcoatDarkeningTexture,e=>{e.name=`${r.name} (ClearCoat Darkening)`,o.coatDarkeningTexture=e}))),Promise.all(t).then(()=>{})}_loadClearCoatColorPropertiesAsync(e,a,r){const o=this._loader._getOrCreateMaterialAdapter(r),t=new Array,s=n.v9.White();return void 0!==a.clearcoatColorFactor&&s.fromArray(a.clearcoatColorFactor),o.coatColor=s,a.clearcoatColorTexture&&t.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatColorTexture`,a.clearcoatColorTexture,e=>{e.name=`${r.name} (ClearCoat Color)`,o.coatColorTexture=e})),Promise.all(t).then(()=>{})}_loadClearCoatAnisotropyPropertiesAsync(e,a,r){const o=this._loader._getOrCreateMaterialAdapter(r),t=new Array,n=a.clearcoatAnisotropyStrength??0,s=a.clearcoatAnisotropyRotation??0;o.coatRoughnessAnisotropy=n,o.geometryCoatTangentAngle=s;const l=a.extensions??{};return l.EXT_materials_anisotropy_openpbr&&l.EXT_materials_anisotropy_openpbr.openPbrAnisotropyEnabled||o.configureGltfStyleAnisotropy(!0),a.clearcoatAnisotropyTexture&&(a.clearcoatAnisotropyTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatAnisotropyTexture`,a.clearcoatAnisotropyTexture,e=>{e.name=`${r.name} (Clearcoat Anisotropy)`,o.geometryCoatTangentTexture=e}))),Promise.all(t).then(()=>{})}}(0,t.Hg)(s),(0,t.Ye)(s,!0,e=>new l(e))}}]);