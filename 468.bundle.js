"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[468],{4329:(e,t,s)=>{s.d(t,{GIFView:()=>o});var n=s(81094),i=s(39443),a=s(91625),r=s(42109),d=s(15287);class o extends d.P{constructor(e){super(e,"gif"),this._currentCanvas=null,this._frameIndex=0,this._frames=[],this._gifReader=null,this._listenerKeyNav=null}_buildActions(){return new i.e([new n.$({text:"Image",onClick:()=>{this.nodeView.querySelector(".content-frames").style.display="none";this.nodeView.querySelector(".content-image").style.display=""}}),new n.$({text:"Frames",classes:"selected",onClick:()=>{this.nodeView.querySelector(".content-frames").style.display="";this.nodeView.querySelector(".content-image").style.display="none"}})]).render()}async _buildImage(){const e=new Image;e.onerror=e=>{console.error("[GIFView._buildImage]",e)},e.src=await this.parser.getBase64();const t=r.UI.build('<div class="content-image"></div>');return t.style.display="none",t.append(e),t}_buildSlideshow(){const e=this._gifReader.numFrames(),t=r.UI.build(`\n\t\t\t<div class="content-frames">\n\t\t\t\t<div class="frame-container"></div>\n\t\t\t\t<div class="actions">\n\t\t\t\t\t<input type="range" min="1" max="${e}" value="1" />\n\t\t\t\t\t<div class="line"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`),s=new n.$({classes:"frame-prev",icon:a.F.arrow_prev}),i=new n.$({classes:"frame-next",icon:a.F.arrow_next});t.querySelector(".line").append(s.render(),r.UI.build('<span class="counter"></span>'),i.render()),this._frameIndex=0,this._generateFrames();const d=t.querySelector('input[type="range"]');return d.addEventListener("input",e=>{this._frameIndex=e.target.valueAsNumber-1,this.showFrame(this._frameIndex)}),s.on("click",e=>{this.showFrame(--this._frameIndex),d.value=this._frameIndex+1}),i.on("click",e=>{this.showFrame(++this._frameIndex),d.value=this._frameIndex+1}),this._listenerKeyNav=e=>{const t=document.activeElement;t&&"range"===t.type||("ArrowLeft"===e.key?(this.showFrame(--this._frameIndex),d.value=this._frameIndex+1):"ArrowRight"===e.key&&(this.showFrame(++this._frameIndex),d.value=this._frameIndex+1))},document.body.addEventListener("keyup",this._listenerKeyNav),this._counter=t.querySelector(".counter"),t}_generateFrame(e){const t=this._gifReader.width,s=this._gifReader.height,n=document.createElement("canvas");n.width=t,n.height=s,n.style.width=t+"px",n.style.height=s+"px";const i=n.getContext("2d");if(0===e){const a=new ImageData(t,s);return this._lastNonDisposedImgData=a,this._gifReader.decodeAndBlitFrameRGBA(e,a.data),i.putImageData(a,0,0),n}const a=this._gifReader.frameInfo(e-1);let r=null;if(a.disposal<=1||3===a.disposal){const e=Uint8ClampedArray.from(this._lastNonDisposedImgData.data);r=new ImageData(e,t,s)}else r=new ImageData(t,s);this._gifReader.decodeAndBlitFrameRGBA(e,r.data);return this._gifReader.frameInfo(e).disposal<=1&&(this._lastNonDisposedImgData=r),i.putImageData(r,0,0),n}_generateFrames(){const e=this._gifReader.numFrames();for(let t=0;t<e;t++){const e=this._generateFrame(t);this._frames.push(e)}}destroy(){super.destroy(),document.body.removeEventListener("keyup",this._listenerKeyNav)}async load(){const e=await this.parser.parse();this._gifReader=e,this.mdAdd("Dimensions",e.width+"Ã—"+e.height+" px"),this.mdAdd("Frames",e.numFrames()),this.buildMetaNode(),this.nodeView.append(this._buildActions(),await this._buildImage(),this._buildSlideshow()),this.showFrame(this._frameIndex),this._openWindow()}showFrame(e){const t=this._gifReader.numFrames();e>=t?e=0:e<0&&(e=t-1),this._currentCanvas&&this._currentCanvas.remove(),this._frameIndex=e,this._currentCanvas=this._frames[e];this.nodeView.querySelector(".frame-container").append(this._currentCanvas),this._counter.textContent=e+1+"/"+t}}},39443:(e,t,s)=>{s.d(t,{e:()=>a});var n=s(19108),i=(s(81094),s(42109));class a extends n.u{constructor(e){super(),this._buttons=e}_toggle(e){this._buttons.forEach(e=>e._node.classList.remove("selected")),e._node.classList.add("selected")}render(){super.render(),this._node=i.UI.build('<div class="button-group"></div>');for(let e=0;e<this._buttons.length;e++){const t=this._buttons[e];t.on("click",()=>this._toggle(t)),this._node.append(t.render())}return this._node}}}}]);