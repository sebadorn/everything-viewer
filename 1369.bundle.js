"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[1369],{39443:(e,t,n)=>{n.d(t,{e:()=>s});var i=n(19108),a=(n(81094),n(42109));class s extends i.u{constructor(e){super(),this._buttons=e}_toggle(e){this._buttons.forEach(e=>e._node.classList.remove("selected")),e._node.classList.add("selected")}render(){super.render(),this._node=a.UI.build('<div class="button-group"></div>');for(let e=0;e<this._buttons.length;e++){const t=this._buttons[e];t.on("click",()=>this._toggle(t)),this._node.append(t.render())}return this._node}}},83617:(e,t,n)=>{n.d(t,{CFBView:()=>r});var i=n(38518),a=n(81094),s=n(39443),o=n(91625),d=n(42109),l=n(15287);class r extends l.P{constructor(e){super(e,"cfb")}_addMetaInfo(e){if(e.senderEmail||e.senderName){let t=null;e.senderName?(t=e.senderName,e.senderEmail&&(t+=` <${e.senderEmail}>`)):t=`<${e.senderEmail}>`,this.mdAdd("Sender",t)}Array.isArray(e.recipients)&&e.recipients.forEach(e=>{let t="Recipient";e.recipType&&(t+=" "+String(e.recipType).toUpperCase());let n=null;e.name?(n=e.name,e.email&&(n+=` <${e.email}>`)):n=`<${e.email}>`,this.mdAdd(t,n)}),Array.isArray(e.attachments)&&this.mdAdd("Attachments",e.attachments.length),e.creationTime&&this.mdAdd("Creation time",e.creationTime),e.lastModificationTime&&this.mdAdd("Last modification",e.lastModificationTime),e.messageDeliveryTime&&this.mdAdd("Delivery time",e.messageDeliveryTime)}_buildActions(){return new s.e([new a.$({text:"Content",classes:"selected",onClick:()=>{this.nodeView.querySelector(".content-body").style.display="";this.nodeView.querySelector(".content-attachments").style.display="none"}}),new a.$({text:"Attachments",onClick:()=>{this.nodeView.querySelector(".content-body").style.display="none";this.nodeView.querySelector(".content-attachments").style.display=""}})]).render()}_buildAttachmentItem(e,t){const n=d.UI.build(`\n\t\t\t<li class="attachment" data-id="${e.dataId}">\n\t\t\t\t<div class="image"></div>\n\t\t\t\t<table class="info"></table>\n\t\t\t</li>\n\t\t`),i=this.parser.getObjectURL(e),a=d.UI.escapeHTML(e.fileName||e.name),s=t?"":` download="${e.fileNameShort||e.fileName}"`,o=n.querySelector(".info");if(o.append(d.UI.buildTableRow({valueAsHTML:!0},"Filename:",`<a href="${i}" target="_blank"${s}>${a}</a>`),d.UI.buildTableRow(null,"Filesize:",d.UI.formatSize(e.contentLength||0))),"string"==typeof e.attachMimeTag&&o.append(d.UI.buildTableRow(null,"Type:",e.attachMimeTag)),t)d.UI.onImageComplete(t,()=>{const e=`${t.naturalWidth}Ã—${t.naturalHeight} px`;o.append(d.UI.buildTableRow(null,"Dimensions:",e)),t.width=t.naturalWidth,t.height=t.naturalHeight}),n.querySelector(".image").append(t);else{const t=n.querySelector(".image");t.classList.add("symbol");const i=this._getAttachmentIcon(e);t.append(d.UI.build(`<span class="icon">${i}</span>`))}return n}_buildContent(e){const t=e.getFileData();let n="";if("string"==typeof t.bodyHtml)n=i.D.buildDocument(t.bodyHtml);else if("string"==typeof t.body){let e=i.D.decodeContent(t.body);n=i.D.buildDocument(`<pre style="white-space: pre-wrap; word-break: break-word;">${e}</pre>`)}const a=d.UI.build('\n\t\t\t<div class="content-body">\n\t\t\t\t<iframe class="content-no-res" sandbox></iframe>\n\t\t\t</div>\n\t\t\t<div class="content-attachments" style="display: none;">\n\t\t\t\t<ol class="list"></ol>\n\t\t\t</div>\n\t\t');if(t.subject){const e=d.UI.build(`<div class="subject">${d.UI.escapeHTML(t.subject)}</div>`);a.querySelector(".content-body").prepend(e)}a.querySelector(".content-body iframe").setAttribute("srcdoc",n.documentElement.outerHTML);const s=a.querySelector(".content-attachments .list");(t.attachments||[]).forEach(e=>{if("attachment"!==e.dataType)return;const t=this.parser.getImage(e),n=this._buildAttachmentItem(e,t);s.append(n)}),this.nodeView.append(this._buildActions(),a)}_getAttachmentIcon(e){let t=o.F.attachment;return".zip"===e.extension&&(t=o.F.format_zip),t}async load(){const e=await this.parser.parse();console.log("[CFBView.load] MsgReader:",e),this._addMetaInfo(e.getFileData()),this.buildMetaNode(),this._buildContent(e),this._openWindow({height:800,width:Math.min(1e3,window.innerWidth)})}}}}]);