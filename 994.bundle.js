"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[994,6464],{36464:(e,t,r)=>{r.d(t,{DDSTools:()=>A});var a=r(84867),o=r(51137),n=r(36755),s=r(42683);r(69195);const l=131072,i=131072;function f(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const u=f("DXT1"),c=f("DXT3"),p=f("DXT5"),d=f("DX10");class A{static GetDDSInfo(e){const t=new Int32Array(e.buffer,e.byteOffset,31),r=new Int32Array(e.buffer,e.byteOffset,35);let a=1;t[2]&l&&(a=Math.max(1,t[7]));const o=t[21],n=o===d?r[32]:0;let s=0;switch(o){case 113:s=2;break;case 116:s=1;break;case d:if(10===n){s=2;break}if(2===n){s=1;break}}return{width:t[4],height:t[3],mipmapCount:a,isFourCC:!(4&~t[20]),isRGB:!(64&~t[20]),isLuminance:(t[20]&i)===i,isCube:!(512&~t[28]),isCompressed:o===u||o===c||o===p,dxgiFormat:n,textureType:s}}static _GetHalfFloatAsFloatRGBAArrayBuffer(e,t,r,a,o,n){const l=new Float32Array(a),i=new Uint16Array(o,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);l[f]=(0,s.SX)(i[a]),l[f+1]=(0,s.SX)(i[a+1]),l[f+2]=(0,s.SX)(i[a+2]),A.StoreLODInAlphaChannel?l[f+3]=n:l[f+3]=(0,s.SX)(i[a+3]),f+=4}return l}static _GetHalfFloatRGBAArrayBuffer(e,t,r,a,o,n){if(A.StoreLODInAlphaChannel){const l=new Uint16Array(a),i=new Uint16Array(o,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);l[f]=i[a],l[f+1]=i[a+1],l[f+2]=i[a+2],l[f+3]=(0,s.LZ)(n),f+=4}return l}return new Uint16Array(o,r,a)}static _GetFloatRGBAArrayBuffer(e,t,r,a,o,n){if(A.StoreLODInAlphaChannel){const s=new Float32Array(a),l=new Float32Array(o,r);let i=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);s[i]=l[a],s[i+1]=l[a+1],s[i+2]=l[a+2],s[i+3]=n,i+=4}return s}return new Float32Array(o,r,a)}static _GetFloatAsHalfFloatRGBAArrayBuffer(e,t,r,a,o,n){const l=new Uint16Array(a),i=new Float32Array(o,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++)l[f]=(0,s.LZ)(i[f]),l[f+1]=(0,s.LZ)(i[f+1]),l[f+2]=(0,s.LZ)(i[f+2]),A.StoreLODInAlphaChannel?l[f+3]=(0,s.LZ)(n):l[f+3]=(0,s.LZ)(i[f+3]),f+=4;return l}static _GetFloatAsUIntRGBAArrayBuffer(e,t,r,o,n,s){const l=new Uint8Array(o),i=new Float32Array(n,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const o=4*(t+r*e);l[f]=255*(0,a.Clamp)(i[o]),l[f+1]=255*(0,a.Clamp)(i[o+1]),l[f+2]=255*(0,a.Clamp)(i[o+2]),A.StoreLODInAlphaChannel?l[f+3]=s:l[f+3]=255*(0,a.Clamp)(i[o+3]),f+=4}return l}static _GetHalfFloatAsUIntRGBAArrayBuffer(e,t,r,o,n,l){const i=new Uint8Array(o),f=new Uint16Array(n,r);let u=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const o=4*(t+r*e);i[u]=255*(0,a.Clamp)((0,s.SX)(f[o])),i[u+1]=255*(0,a.Clamp)((0,s.SX)(f[o+1])),i[u+2]=255*(0,a.Clamp)((0,s.SX)(f[o+2])),A.StoreLODInAlphaChannel?i[u+3]=l:i[u+3]=255*(0,a.Clamp)((0,s.SX)(f[o+3])),u+=4}return i}static _GetRGBAArrayBuffer(e,t,r,a,o,n,s,l,i){const f=new Uint8Array(a),u=new Uint8Array(o,r);let c=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);f[c]=u[a+n],f[c+1]=u[a+s],f[c+2]=u[a+l],f[c+3]=u[a+i],c+=4}return f}static _ExtractLongWordOrder(e){return 0===e||255===e||-16777216===e?0:1+A._ExtractLongWordOrder(e>>8)}static _GetRGBArrayBuffer(e,t,r,a,o,n,s,l){const i=new Uint8Array(a),f=new Uint8Array(o,r);let u=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=3*(t+r*e);i[u]=f[a+n],i[u+1]=f[a+s],i[u+2]=f[a+l],u+=3}return i}static _GetLuminanceArrayBuffer(e,t,r,a,o){const n=new Uint8Array(a),s=new Uint8Array(o,r);let l=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=t+r*e;n[l]=s[a],l++}return n}static UploadDDSLevels(e,t,r,a,s,i,f=-1,h,y=!0){let C=null;a.sphericalPolynomial&&(C=[]);const m=!!e.getCaps().s3tc;t.generateMipMaps=s;const _=new Int32Array(r.buffer,r.byteOffset,31);let b,G,B,F,D,g,w,L=0,x=0,S=1;if(542327876!==_[0])return void o.V.Error("Invalid magic number in DDS header");if(!a.isFourCC&&!a.isRGB&&!a.isLuminance)return void o.V.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(a.isCompressed&&!m)return void o.V.Error("Compressed textures are not supported on this platform.");let R=_[22];F=_[1]+4;let T=!1;if(a.isFourCC)switch(b=_[21],b){case u:S=8,x=33777;break;case c:S=16,x=33778;break;case p:S=16,x=33779;break;case 113:T=!0,R=64;break;case 116:T=!0,R=128;break;case d:{F+=20;let e=!1;switch(a.dxgiFormat){case 10:T=!0,R=64,e=!0;break;case 2:T=!0,R=128,e=!0;break;case 88:a.isRGB=!0,a.isFourCC=!1,R=32,e=!0}if(e)break}default:return void o.V.Error(["Unsupported FourCC code:",(U=b,String.fromCharCode(255&U,U>>8&255,U>>16&255,U>>24&255))])}var U;const v=A._ExtractLongWordOrder(_[23]),O=A._ExtractLongWordOrder(_[24]),k=A._ExtractLongWordOrder(_[25]),I=A._ExtractLongWordOrder(_[26]);T&&(x=e._getRGBABufferInternalSizedFormat(a.textureType)),g=1,_[2]&l&&!1!==s&&(g=Math.max(1,_[7]));const M=h||0,H=e.getCaps();for(let o=M;o<i;o++){for(G=_[4],B=_[3],w=0;w<g;++w){if(-1===f||f===w){const n=-1===f?w:0;if(!a.isCompressed&&a.isFourCC){t.format=5,L=G*B*4;let a=null;if(e._badOS||e._badDesktopOS||!H.textureHalfFloat&&!H.textureFloat)128===R?(a=A._GetFloatAsUIntRGBAArrayBuffer(G,B,r.byteOffset+F,L,r.buffer,n),C&&0==n&&C.push(A._GetFloatRGBAArrayBuffer(G,B,r.byteOffset+F,L,r.buffer,n))):64===R&&(a=A._GetHalfFloatAsUIntRGBAArrayBuffer(G,B,r.byteOffset+F,L,r.buffer,n),C&&0==n&&C.push(A._GetHalfFloatAsFloatRGBAArrayBuffer(G,B,r.byteOffset+F,L,r.buffer,n))),t.type=0;else{const e=H.textureFloat&&(y&&H.textureFloatLinearFiltering||!y),o=H.textureHalfFloat&&(y&&H.textureHalfFloatLinearFiltering||!y),s=(128===R||64===R&&!o)&&e?1:(64===R||128===R&&!e)&&o?2:0;let l,i=null;if(128===R)switch(s){case 1:l=A._GetFloatRGBAArrayBuffer,i=null;break;case 2:l=A._GetFloatAsHalfFloatRGBAArrayBuffer,i=A._GetFloatRGBAArrayBuffer;break;case 0:l=A._GetFloatAsUIntRGBAArrayBuffer,i=A._GetFloatRGBAArrayBuffer}else switch(s){case 1:l=A._GetHalfFloatAsFloatRGBAArrayBuffer,i=null;break;case 2:l=A._GetHalfFloatRGBAArrayBuffer,i=A._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:l=A._GetHalfFloatAsUIntRGBAArrayBuffer,i=A._GetHalfFloatAsFloatRGBAArrayBuffer}t.type=s,a=l(G,B,r.byteOffset+F,L,r.buffer,n),C&&0==n&&C.push(i?i(G,B,r.byteOffset+F,L,r.buffer,n):a)}a&&e._uploadDataToTextureDirectly(t,a,o,n)}else if(a.isRGB)t.type=0,24===R?(t.format=4,L=G*B*3,D=A._GetRGBArrayBuffer(G,B,r.byteOffset+F,L,r.buffer,v,O,k),e._uploadDataToTextureDirectly(t,D,o,n)):(t.format=5,L=G*B*4,D=A._GetRGBAArrayBuffer(G,B,r.byteOffset+F,L,r.buffer,v,O,k,I),e._uploadDataToTextureDirectly(t,D,o,n));else if(a.isLuminance){const a=e._getUnpackAlignement(),s=G;L=Math.floor((G+a-1)/a)*a*(B-1)+s,D=A._GetLuminanceArrayBuffer(G,B,r.byteOffset+F,L,r.buffer),t.format=1,t.type=0,e._uploadDataToTextureDirectly(t,D,o,n)}else L=Math.max(4,G)/4*Math.max(4,B)/4*S,D=new Uint8Array(r.buffer,r.byteOffset+F,L),t.type=0,e._uploadCompressedDataToTextureDirectly(t,x,G,B,D,o,n)}F+=R?G*B*(R/8):L,G*=.5,B*=.5,G=Math.max(1,G),B=Math.max(1,B)}if(void 0!==h)break}C&&C.length>0?a.sphericalPolynomial=n.d.ConvertCubeMapToSphericalPolynomial({size:_[4],right:C[0],left:C[1],up:C[2],down:C[3],front:C[4],back:C[5],format:5,type:1,gammaSpace:!1}):a.sphericalPolynomial=void 0}}A.StoreLODInAlphaChannel=!1},50994:(e,t,r)=>{r.d(t,{_DDSTextureLoader:()=>n});var a=r(77517),o=r(36464);class n{constructor(){this.supportCascades=!0}loadCubeData(e,t,r,n){const s=t.getEngine();let l,i=!1,f=1e3;if(Array.isArray(e))for(let r=0;r<e.length;r++){const a=e[r];l=o.DDSTools.GetDDSInfo(a),t.width=l.width,t.height=l.height,i=(l.isRGB||l.isLuminance||l.mipmapCount>1)&&t.generateMipMaps,s._unpackFlipY(l.isCompressed),o.DDSTools.UploadDDSLevels(s,t,a,l,i,6,-1,r),l.isFourCC||1!==l.mipmapCount?f=l.mipmapCount-1:s.generateMipMapsForCubemap(t)}else{const n=e;l=o.DDSTools.GetDDSInfo(n),t.width=l.width,t.height=l.height,r&&(l.sphericalPolynomial=new a.Q),i=(l.isRGB||l.isLuminance||l.mipmapCount>1)&&t.generateMipMaps,s._unpackFlipY(l.isCompressed),o.DDSTools.UploadDDSLevels(s,t,n,l,i,6),l.isFourCC||1!==l.mipmapCount?f=l.mipmapCount-1:s.generateMipMapsForCubemap(t,!1)}s._setCubeMapTextureParams(t,i,f),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),n&&n({isDDS:!0,width:t.width,info:l,data:e,texture:t})}loadData(e,t,r){const a=o.DDSTools.GetDDSInfo(e),n=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&t.generateMipMaps&&Math.max(a.width,a.height)>>a.mipmapCount-1==1;r(a.width,a.height,n,a.isFourCC,()=>{o.DDSTools.UploadDDSLevels(t.getEngine(),t,e,a,n,1)})}}},69195:(e,t,r)=>{var a=r(90854),o=r(51137),n=r(90655),s=r(38688),l=r(79323),i=r(18454),f=r(96789);l.$.prototype._partialLoadFile=function(e,t,r,a,o=null){this._loadFile(e,e=>{r[t]=e,r._internalCount++,6===r._internalCount&&a(r)},void 0,void 0,!0,(e,t)=>{o&&e&&o(e.status+" "+e.statusText,t)})},l.$.prototype._cascadeLoadFiles=function(e,t,r,a=null){const o=[];o._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(r[e],e,o,t,a)},l.$.prototype._cascadeLoadImgs=function(e,t,r,a,o=null,n){const s=[];s._internalCount=0;for(let l=0;l<6;l++)this._partialLoadImg(a[l],l,s,e,t,r,o,n)},l.$.prototype._partialLoadImg=function(e,t,r,a,o,l,i=null,f){const u=(0,s.z)();(0,n.W$)(e,e=>{r[t]=e,r._internalCount++,a&&a.removePendingData(u),6===r._internalCount&&l&&l(o,r)},(e,t)=>{a&&a.removePendingData(u),i&&i(e,t)},a?a.offlineProvider:null,f),a&&a.addPendingData(u)},l.$.prototype.createCubeTextureBase=function(e,t,r,n,s=null,l=null,u,c=null,p=!1,d=0,A=0,h=null,y=null,C=null,m=!1,_=null){const b=h||new a.h(this,7);b.isCube=!0,b.url=e,b.generateMipMaps=!n,b._lodGenerationScale=d,b._lodGenerationOffset=A,b._useSRGBBuffer=!!m&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!n),b!==h&&(b.label=e.substring(0,60)),this._doNotHandleContextLost||(b._extension=c,b._files=r,b._buffer=_);const G=e;this._transformTextureUrl&&!h&&(e=this._transformTextureUrl(e));const B=c??(0,f.r)(e),F=(0,i.gT)(B),D=(e,t)=>{b.dispose(),l?l(e,t):e&&o.V.Warn(e)},g=(a,l)=>{e===G?a&&D(a.status+" "+a.statusText,l):(o.V.Warn(`Failed to load ${e}, falling back to the ${G}`),this.createCubeTextureBase(G,t,r,!!n,s,D,u,c,p,d,A,b,y,C,m,_))};if(F)F.then(a=>{const o=e=>{y&&y(b,e),a.loadCubeData(e,b,p,s,(e,t)=>{D(e,t)})};_?o(_):r&&6===r.length?a.supportCascades?this._cascadeLoadFiles(t,e=>o(e.map(e=>new Uint8Array(e))),r,D):D("Textures type does not support cascades."):this._loadFile(e,e=>o(new Uint8Array(e)),void 0,t?t.offlineProvider||null:void 0,!0,g)});else{if(!r||0===r.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,b,(e,t)=>{C&&C(e,t)},r,D)}return this._internalTexturesCache.push(b),b}}}]);