"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[615],{20615:(e,t,r)=>{r.r(t);var n=r(90854),s=r(51137),a=r(40768);a.WebGPUEngine.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t=!1,r){r&&r(),this._endCurrentRenderPass(),t||this.generateMipMapsMultiFramebuffer(e),this._currentRenderTarget=null,this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)},a.WebGPUEngine.prototype.createMultipleRenderTarget=function(e,t,r){let a=!1,i=!0,u=!1,p=!1,l=15,h=1,o=1;let c=[],f=[],g=[],d=[],m=[],x=[],_=[],M=[],T=[],b=[],y=!1;const R=this._createHardwareRenderTargetWrapper(!0,!1,e);void 0!==t&&(a=t.generateMipMaps??!1,i=t.generateDepthBuffer??!0,u=t.generateStencilBuffer??!1,p=t.generateDepthTexture??!1,h=t.textureCount??1,l=t.depthTextureFormat??15,c=t.types||c,f=t.samplingModes||f,g=t.useSRGBBuffers||g,d=t.formats||d,m=t.targetTypes||m,x=t.faceIndex||x,_=t.layerIndex||_,M=t.layerCounts||M,T=t.labels||T,b=t.creationFlags||b,o=t.samples??o,y=t.dontCreateTextures??!1);const A=e.width??e,S=e.height??e,P=[],F=[],W=[];R.label=t?.label??"MultiRenderTargetWrapper",R._generateDepthBuffer=i,R._generateStencilBuffer=u,R._attachments=F,R._defaultAttachments=W;let E=null;(i||u||p)&&!y&&(p||(l=i&&u?13:i?14:19),E=R.createDepthStencilTexture(0,!1,u,1,l,R.label+"-DepthStencil"));const G=void 0!==t&&"object"==typeof t&&t.createMipMaps&&!a;for(let e=0;e<h;e++){let t=f[e]||3,i=c[e]||0;const u=d[e]||5,p=!!g[e]&&this._caps.supportSRGBBuffers,l=m[e]||3553,h=M[e]??1,o=b[e];if((1!==i||this._caps.textureFloatLinearFiltering)&&(2!==i||this._caps.textureHalfFloatLinearFiltering)||(t=1),1!==i||this._caps.textureFloat||(i=0,s.V.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),F.push(e+1),W.push(r?e+1:0===e?1:0),-1===l||y)continue;const x=new n.h(this,6);switch(P[e]=x,l){case 34067:x.isCube=!0;break;case 32879:x.is3D=!0,x.baseDepth=x.depth=h;break;case 35866:x.is2DArray=!0,x.baseDepth=x.depth=h}x.baseWidth=A,x.baseHeight=S,x.width=A,x.height=S,x.isReady=!0,x.samples=1,x.generateMipMaps=a,x.samplingMode=t,x.type=i,x._cachedWrapU=0,x._cachedWrapV=0,x._useSRGBBuffer=p,x.format=u,x.label=T[e]??R.label+"-Texture"+e,this._internalTexturesCache.push(x),G&&(x.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(x,void 0,void 0,void 0,o,!0),G&&(x.generateMipMaps=!1)}return E&&(E.incrementReferences(),P[h]=E,this._internalTexturesCache.push(E)),R.setTextures(P),R.setLayerAndFaceIndices(_,x),y?R._samples=o:this.updateMultipleRenderTargetTextureSampleCount(R,o),R},a.WebGPUEngine.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t){if(!e||!e.textures||0===e.textures.length||e.textures[0].samples===t)return t;const r=e.textures.length;if(0===r)return 1;t=Math.min(t,this.getCaps().maxMSAASamples);for(let t=0;t<r;++t){const r=e.textures[t]._hardwareTexture;r?.releaseMSAATexture(e.getBaseArrayLayer(t))}const n=e._depthStencilTexture===e.textures[r-1];for(let n=0;n<r;++n){const r=e.textures[n];this._textureHelper.createMSAATexture(r,t,!1,e.getBaseArrayLayer(n)),r.samples=t}return e._depthStencilTexture&&!n&&(this._textureHelper.createMSAATexture(e._depthStencilTexture,t),e._depthStencilTexture.samples=t),e._samples=t,t},a.WebGPUEngine.prototype.generateMipMapsMultiFramebuffer=function(e){const t=e;if(!t.isMulti)return;const r=t._attachments.length;for(let e=0;e<r;e++){const r=t.textures[e];!r.generateMipMaps||r.isCube||r.is3D||this._generateMipmaps(r)}},a.WebGPUEngine.prototype.resolveMultiFramebuffer=function(e){throw new Error("resolveMultiFramebuffer is not yet implemented in WebGPU!")},a.WebGPUEngine.prototype.bindAttachments=function(e){0!==e.length&&this._currentRenderTarget&&(this._mrtAttachments=e,this._currentRenderPass&&this._cacheRenderPipeline.setMRTAttachments(e))},a.WebGPUEngine.prototype.buildTextureLayout=function(e,t=!1){const r=[];if(t)r.push(1);else for(let t=0;t<e.length;t++)e[t]?r.push(t+1):r.push(0);return r},a.WebGPUEngine.prototype.restoreSingleAttachment=function(){},a.WebGPUEngine.prototype.restoreSingleAttachmentForRenderTarget=function(){}}}]);