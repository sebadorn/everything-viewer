"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[4294],{34294:(e,t,i)=>{i.d(t,{CubeTexture:()=>_});var s=i(75524),n=i(79259),o=i(998),r=i(79923),a=i(82667),l=i(82781),u=i(56552),d=i(99848),h=i(26877);i(69195);class _ extends a.t{set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(r.uq.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(e,t,i){let s="";for(const t of e)s+=t;return new _(s,t,null,i,e)}static CreateFromPrefilteredData(e,t,i=null,s=!0){const n=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;const o=new _(e,t,null,!1,null,null,null,void 0,!0,i,s);return t.useDelayedTextureLoading=n,o}constructor(e,t,i=null,s=!1,n=null,o=null,a=null,u=5,h=!1,_=null,f=!1,x=.8,c=0,p,g){super(t),this.onLoadObservable=new d.cP,this.boundingBoxPosition=r.Pq.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new r.uq,this._buffer=null,this.name=e,this.url=e,this._noMipmap=s,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=r.uq.Identity(),this.coordinatesMode=l.g.CUBIC_MODE;let m=null,b=null;null===i||Array.isArray(i)?(this._noMipmap=s,this._format=u,this._createPolynomials=f,m=i,this._loaderOptions=p,this._useSRGBBuffer=g,this._lodScale=x,this._lodOffset=c):(m=i.extensions??null,this._noMipmap=i.noMipmap??!1,n=i.files??null,b=i.buffer??null,this._format=i.format??5,h=i.prefiltered??!1,_=i.forcedExtension??null,this._createPolynomials=i.createPolynomials??!1,this._lodScale=i.lodScale??.8,this._lodOffset=i.lodOffset??0,this._loaderOptions=i.loaderOptions,this._useSRGBBuffer=i.useSRGBBuffer,o=i.onLoad??null,a=i.onError??null),(e||n)&&this.updateURL(e,_,o,h,a,m,this.getScene()?.useDelayedTextureLoading,n,b)}getClassName(){return"CubeTexture"}updateURL(e,t=null,i=null,s=!1,n=null,o=null,r=!1,a=null,l=null){this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,t&&(this._forcedExtension=t);const u=e.lastIndexOf("."),d=t||(u>-1?e.substring(u).toLowerCase():""),h=0===d.indexOf(".dds"),_=0===d.indexOf(".env"),f=0===d.indexOf(".basis");if(_?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=s,s&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),a)this._files=a;else if(f||_||h||o||(o=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,o){for(let t=0;t<o.length;t++)this._files.push(e+o[t]);this._extensions=o}this._buffer=l,r?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=n):this._loadTexture(i,n)}delayLoad(e){4===this.delayLoadState&&(e&&(this._forcedExtension=e),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(e){if(e.updateFlag===this._textureMatrix.updateFlag)return;if(e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene()?.markAllMaterialsAsDirty(1,e=>-1!==e.getActiveTextures().indexOf(this)),this._textureMatrix=e,!this.getScene()?.useRightHandedSystem)return;const t=r.AA.Vector3[0],i=r.AA.Quaternion[0],s=r.AA.Vector3[1];this._textureMatrix.decompose(t,i,s),i.z*=-1,i.w*=-1,r.uq.ComposeToRef(t,i,s,this._textureMatrixRefraction)}getRefractionTextureMatrix(){return this.getScene()?.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(e=null,t=null){const i=this.getScene(),s=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const n=()=>{this.onLoadObservable.notifyObservers(this),s&&(s.dispose(),this.getScene()?.markAllMaterialsAsDirty(1)),e&&e()},r=(e,i)=>{this._loadingError=!0,this._errorObject={message:e,exception:i},t&&t(e,i),l.g.OnTextureLoadErrorObservable.notifyObservers(this)};this._texture?this._texture.isReady?o.S0.SetImmediate(()=>n()):this._texture.onLoadedObservable.add(()=>n()):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,i,this._lodScale,this._lodOffset,e,r,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,e,r,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),this._texture?.onLoadedObservable.add(()=>this.onLoadObservable.notifyObservers(this)))}static Parse(e,t,i){const s=h.p.Parse(()=>{let s=!1;return e.prefiltered&&(s=e.prefiltered),new _(i+(e.url??e.name),t,e.extensions,!1,e.files||null,null,null,void 0,s,e.forcedExtension)},e,t);if(e.boundingBoxPosition&&(s.boundingBoxPosition=r.Pq.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(s.boundingBoxSize=r.Pq.FromArray(e.boundingBoxSize)),e.animations)for(let t=0;t<e.animations.length;t++){const i=e.animations[t],n=(0,u.n9)("BABYLON.Animation");n&&s.animations.push(n.Parse(i))}return s}clone(){let e=0;const t=h.p.Clone(()=>{const t=new _(this.url,this.getScene()||this._getEngine(),this._extensions,this._noMipmap,this._files);return e=t.uniqueId,t},this);return t.uniqueId=e,t}}(0,s.Cg)([(0,n.lK)()],_.prototype,"url",void 0),(0,s.Cg)([(0,n.P_)()],_.prototype,"boundingBoxPosition",void 0),(0,s.Cg)([(0,n.P_)()],_.prototype,"boundingBoxSize",null),(0,s.Cg)([(0,n.lK)("rotationY")],_.prototype,"rotationY",null),(0,s.Cg)([(0,n.lK)("files")],_.prototype,"_files",void 0),(0,s.Cg)([(0,n.lK)("forcedExtension")],_.prototype,"_forcedExtension",void 0),(0,s.Cg)([(0,n.lK)("extensions")],_.prototype,"_extensions",void 0),(0,s.Cg)([(0,n.GG)("textureMatrix")],_.prototype,"_textureMatrix",void 0),(0,s.Cg)([(0,n.GG)("textureMatrixRefraction")],_.prototype,"_textureMatrixRefraction",void 0),l.g._CubeTextureParser=_.Parse,(0,u.Y5)("BABYLON.CubeTexture",_)},69195:(e,t,i)=>{var s=i(90854),n=i(51137),o=i(90655),r=i(38688),a=i(79323),l=i(18454),u=i(96789);a.$.prototype._partialLoadFile=function(e,t,i,s,n=null){this._loadFile(e,e=>{i[t]=e,i._internalCount++,6===i._internalCount&&s(i)},void 0,void 0,!0,(e,t)=>{n&&e&&n(e.status+" "+e.statusText,t)})},a.$.prototype._cascadeLoadFiles=function(e,t,i,s=null){const n=[];n._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(i[e],e,n,t,s)},a.$.prototype._cascadeLoadImgs=function(e,t,i,s,n=null,o){const r=[];r._internalCount=0;for(let a=0;a<6;a++)this._partialLoadImg(s[a],a,r,e,t,i,n,o)},a.$.prototype._partialLoadImg=function(e,t,i,s,n,a,l=null,u){const d=(0,r.z)();(0,o.W$)(e,e=>{i[t]=e,i._internalCount++,s&&s.removePendingData(d),6===i._internalCount&&a&&a(n,i)},(e,t)=>{s&&s.removePendingData(d),l&&l(e,t)},s?s.offlineProvider:null,u),s&&s.addPendingData(d)},a.$.prototype.createCubeTextureBase=function(e,t,i,o,r=null,a=null,d,h=null,_=!1,f=0,x=0,c=null,p=null,g=null,m=!1,b=null){const y=c||new s.h(this,7);y.isCube=!0,y.url=e,y.generateMipMaps=!o,y._lodGenerationScale=f,y._lodGenerationOffset=x,y._useSRGBBuffer=!!m&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!o),y!==c&&(y.label=e.substring(0,60)),this._doNotHandleContextLost||(y._extension=h,y._files=i,y._buffer=b);const C=e;this._transformTextureUrl&&!c&&(e=this._transformTextureUrl(e));const S=h??(0,u.r)(e),v=(0,l.gT)(S),B=(e,t)=>{y.dispose(),a?a(e,t):e&&n.V.Warn(e)},M=(s,a)=>{e===C?s&&B(s.status+" "+s.statusText,a):(n.V.Warn(`Failed to load ${e}, falling back to the ${C}`),this.createCubeTextureBase(C,t,i,!!o,r,B,d,h,_,f,x,y,p,g,m,b))};if(v)v.then(s=>{const n=e=>{p&&p(y,e),s.loadCubeData(e,y,_,r,(e,t)=>{B(e,t)})};b?n(b):i&&6===i.length?s.supportCascades?this._cascadeLoadFiles(t,e=>n(e.map(e=>new Uint8Array(e))),i,B):B("Textures type does not support cascades."):this._loadFile(e,e=>n(new Uint8Array(e)),void 0,t?t.offlineProvider||null:void 0,!0,M)});else{if(!i||0===i.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,y,(e,t)=>{g&&g(e,t)},i,B)}return this._internalTexturesCache.push(y),y}}}]);