"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[6919],{48086:(t,e,i)=>{i.d(e,{AU:()=>m,DY:()=>_,Gz:()=>y,KI:()=>k,Oj:()=>q,R0:()=>u,Rl:()=>l,S:()=>x,TR:()=>M,m9:()=>A,mc:()=>P,oZ:()=>R,uW:()=>T,ui:()=>f});var n=i(65559),r=i(79923),o=i(27309),s=i(77103),a=i(30311),c=i(6315),h=i(65877);const u={internalPickerForMesh:void 0};class l{constructor(t,e,i=Number.MAX_VALUE,r=n.bH){this.origin=t,this.direction=e,this.length=i,this.epsilon=r}clone(){return new l(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(t,e,i=0){const n=l._TmpVector3[0].copyFromFloats(t.x-i,t.y-i,t.z-i),r=l._TmpVector3[1].copyFromFloats(e.x+i,e.y+i,e.z+i);let o,s,a,c,h=0,u=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<n.x||this.origin.x>r.x)return!1}else if(o=1/this.direction.x,s=(n.x-this.origin.x)*o,a=(r.x-this.origin.x)*o,a===-1/0&&(a=1/0),s>a&&(c=s,s=a,a=c),h=Math.max(s,h),u=Math.min(a,u),h>u)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<n.y||this.origin.y>r.y)return!1}else if(o=1/this.direction.y,s=(n.y-this.origin.y)*o,a=(r.y-this.origin.y)*o,a===-1/0&&(a=1/0),s>a&&(c=s,s=a,a=c),h=Math.max(s,h),u=Math.min(a,u),h>u)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<n.z||this.origin.z>r.z)return!1}else if(o=1/this.direction.z,s=(n.z-this.origin.z)*o,a=(r.z-this.origin.z)*o,a===-1/0&&(a=1/0),s>a&&(c=s,s=a,a=c),h=Math.max(s,h),u=Math.min(a,u),h>u)return!1;return!0}intersectsBox(t,e=0){return this.intersectsBoxMinMax(t.minimum,t.maximum,e)}intersectsSphere(t,e=0){const i=t.center.x-this.origin.x,n=t.center.y-this.origin.y,r=t.center.z-this.origin.z,o=i*i+n*n+r*r,s=t.radius+e,a=s*s;if(o<=a)return!0;const c=i*this.direction.x+n*this.direction.y+r*this.direction.z;if(c<0)return!1;return o-c*c<=a}intersectsTriangle(t,e,i){const n=l._TmpVector3[0],o=l._TmpVector3[1],a=l._TmpVector3[2],c=l._TmpVector3[3],h=l._TmpVector3[4];e.subtractToRef(t,n),i.subtractToRef(t,o),r.Pq.CrossToRef(this.direction,o,a);const u=r.Pq.Dot(n,a);if(0===u)return null;const f=1/u;this.origin.subtractToRef(t,c);const y=r.Pq.Dot(c,a)*f;if(y<-this.epsilon||y>1+this.epsilon)return null;r.Pq.CrossToRef(c,n,h);const m=r.Pq.Dot(this.direction,h)*f;if(m<-this.epsilon||y+m>1+this.epsilon)return null;const R=r.Pq.Dot(o,h)*f;return R>this.length?null:new s.w(1-y-m,y,R)}intersectsPlane(t){let e;const i=r.Pq.Dot(t.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;{const n=r.Pq.Dot(t.normal,this.origin);return e=(-t.d-n)/i,e<0?e<-9.99999997475243e-7?null:0:e}}intersectsAxis(t,e=0){switch(t){case"y":{const t=(this.origin.y-e)/this.direction.y;return t>0?null:new r.Pq(this.origin.x+this.direction.x*-t,e,this.origin.z+this.direction.z*-t)}case"x":{const t=(this.origin.x-e)/this.direction.x;return t>0?null:new r.Pq(e,this.origin.y+this.direction.y*-t,this.origin.z+this.direction.z*-t)}case"z":{const t=(this.origin.z-e)/this.direction.z;return t>0?null:new r.Pq(this.origin.x+this.direction.x*-t,this.origin.y+this.direction.y*-t,e)}default:return null}}intersectsMesh(t,e,i,n=!1,o,s=!1){const a=r.AA.Matrix[0];return t.getWorldMatrix().invertToRef(a),this._tmpRay?l.TransformToRef(this,a,this._tmpRay):this._tmpRay=l.Transform(this,a),t.intersects(this._tmpRay,e,i,n,o,s)}intersectsMeshes(t,e,i){i?i.length=0:i=[];for(let n=0;n<t.length;n++){const r=this.intersectsMesh(t[n],e);r.hit&&i.push(r)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:0}intersectionSegment(t,e,i){const n=this.origin,o=r.AA.Vector3[0],s=r.AA.Vector3[1],a=r.AA.Vector3[2],c=r.AA.Vector3[3];e.subtractToRef(t,o),this.direction.scaleToRef(l._Rayl,a),n.addToRef(a,s),t.subtractToRef(n,c);const h=r.Pq.Dot(o,o),u=r.Pq.Dot(o,a),f=r.Pq.Dot(a,a),y=r.Pq.Dot(o,c),m=r.Pq.Dot(a,c),R=h*f-u*u;let d,g,p=R,T=R;R<l._Smallnum?(d=0,p=1,g=m,T=f):(d=u*m-f*y,g=h*m-u*y,d<0?(d=0,g=m,T=f):d>p&&(d=p,g=m+u,T=f)),g<0?(g=0,-y<0?d=0:-y>h?d=p:(d=-y,p=h)):g>T&&(g=T,-y+u<0?d=0:-y+u>h?d=p:(d=-y+u,p=h));const P=Math.abs(d)<l._Smallnum?0:d/p,x=Math.abs(g)<l._Smallnum?0:g/T,_=r.AA.Vector3[4];a.scaleToRef(x,_);const M=r.AA.Vector3[5];o.scaleToRef(P,M),M.addInPlace(c);const k=r.AA.Vector3[6];M.subtractToRef(_,k);return x>0&&x<=this.length&&k.lengthSquared()<i*i?M.length():-1}update(t,e,i,n,o,s,a,c=!1){if(c){l._RayDistant||(l._RayDistant=l.Zero()),l._RayDistant.unprojectRayToRef(t,e,i,n,r.uq.IdentityReadOnly,s,a);const c=r.AA.Matrix[0];o.invertToRef(c),l.TransformToRef(l._RayDistant,c,this)}else this.unprojectRayToRef(t,e,i,n,o,s,a);return this}static Zero(){return new l(r.Pq.Zero(),r.Pq.Zero())}static CreateNew(t,e,i,n,r,o,s){return l.Zero().update(t,e,i,n,r,o,s)}static CreateNewFromTo(t,e,i=r.uq.IdentityReadOnly){const n=new l(new r.Pq(0,0,0),new r.Pq(0,0,0));return l.CreateFromToToRef(t,e,n,i)}static CreateFromToToRef(t,e,i,n=r.uq.IdentityReadOnly){i.origin.copyFrom(t);const o=e.subtractToRef(t,i.direction),s=Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z);return i.length=s,i.direction.normalize(),l.TransformToRef(i,n,i)}static Transform(t,e){const i=new l(new r.Pq(0,0,0),new r.Pq(0,0,0));return l.TransformToRef(t,e,i),i}static TransformToRef(t,e,i){r.Pq.TransformCoordinatesToRef(t.origin,e,i.origin),r.Pq.TransformNormalToRef(t.direction,e,i.direction),i.length=t.length,i.epsilon=t.epsilon;const n=i.direction,o=n.length();if(0!==o&&1!==o){const t=1/o;n.x*=t,n.y*=t,n.z*=t,i.length*=o}return i}unprojectRayToRef(t,e,i,n,o,s,a){const h=r.AA.Matrix[0];o.multiplyToRef(s,h),h.multiplyToRef(a,h),h.invert();const u=c.q.LastCreatedEngine,l=r.AA.Vector3[0];l.x=t/i*2-1,l.y=-(e/n*2-1),l.z=u?.useReverseDepthBuffer?1:u?.isNDCHalfZRange?0:-1;const f=r.AA.Vector3[1].copyFromFloats(l.x,l.y,1-1e-8),y=r.AA.Vector3[2],m=r.AA.Vector3[3];r.Pq._UnprojectFromInvertedMatrixToRef(l,h,y),r.Pq._UnprojectFromInvertedMatrixToRef(f,h,m),this.origin.copyFrom(y),m.subtractToRef(y,this.direction),this.direction.normalize()}}function f(t,e,i,n,r,o=!1){const s=l.Zero();return y(t,e,i,n,s,r,o),s}function y(t,e,i,n,o,s,a=!1,c=!1){const h=t.getEngine();if(!s&&!(s=t.activeCamera))return t;const u=s.viewport,l=h.getRenderHeight(),{x:f,y,width:m,height:R}=u.toGlobal(h.getRenderWidth(),l),d=1/h.getHardwareScalingLevel();return e=e*d-f,i=i*d-(l-y-R),o.update(e,i,m,R,n||r.uq.IdentityReadOnly,a?r.uq.IdentityReadOnly:s.getViewMatrix(),s.getProjectionMatrix(),c),t}function m(t,e,i,n){const r=l.Zero();return R(t,e,i,r,n),r}function R(t,e,i,n,o){if(!a.G)return t;const s=t.getEngine();if(!o&&!(o=t.activeCamera))throw new Error("Active camera not set");const c=o.viewport,h=s.getRenderHeight(),{x:u,y:l,width:f,height:y}=c.toGlobal(s.getRenderWidth(),h),m=r.uq.Identity(),R=1/s.getHardwareScalingLevel();return e=e*R-u,i=i*R-(h-l-y),n.update(e,i,f,y,m,m,o.getProjectionMatrix()),t}function d(t,e,i,n,r,o,s,a){const c=e(n,i.enableDistantPicking),h=i.intersects(c,r,s,o,n,a);return h&&h.hit?!r&&null!=t&&h.distance>=t.distance?null:h:null}function g(t,e,i,n,o,s){let c=null;const h=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),l=t.cameraToUseForPointers||t.activeCamera,f=u.internalPickerForMesh||d;for(let a=0;a<t.meshes.length;a++){const u=t.meshes[a];if(i){if(!i(u,-1))continue}else if(!u.isEnabled()||!u.isVisible||!u.isPickable)continue;const y=h&&u.isWorldMatrixCameraDependent(),m=u.computeWorldMatrix(y,l);if(u.hasThinInstances&&u.thinInstanceEnablePicking){const t=f(c,e,u,m,!0,!0,s);if(t){if(o)return t;const a=r.AA.Matrix[1],h=u.thinInstanceGetWorldMatrices();for(let t=0;t<h.length;t++){if(i&&!i(u,t))continue;h[t].multiplyToRef(m,a);const r=f(c,e,u,a,n,o,s,!0);if(r&&(c=r,c.thinInstanceIndex=t,n))return c}}}else{const t=f(c,e,u,m,n,o,s);if(t&&(c=t,n))return c}}return c||new a.G}function p(t,e,i,n){if(!a.G)return null;const o=[],s=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),c=t.cameraToUseForPointers||t.activeCamera,h=u.internalPickerForMesh||d;for(let a=0;a<t.meshes.length;a++){const u=t.meshes[a];if(i){if(!i(u,-1))continue}else if(!u.isEnabled()||!u.isVisible||!u.isPickable)continue;const l=s&&u.isWorldMatrixCameraDependent(),f=u.computeWorldMatrix(l,c);if(u.hasThinInstances&&u.thinInstanceEnablePicking){if(h(null,e,u,f,!0,!0,n)){const t=r.AA.Matrix[1],s=u.thinInstanceGetWorldMatrices();for(let r=0;r<s.length;r++){if(i&&!i(u,r))continue;s[r].multiplyToRef(f,t);const a=h(null,e,u,t,!1,!1,n,!0);a&&(a.thinInstanceIndex=r,o.push(a))}}}else{const t=h(null,e,u,f,!1,!1,n);t&&o.push(t)}}return o}function T(t,e,i,n,o,s){if(!a.G)return null;const c=g(t,(n=>(t._tempPickingRay||(t._tempPickingRay=l.Zero()),y(t,e,i,n,t._tempPickingRay,s||null),t._tempPickingRay)),n,o,!0);return c&&(c.ray=f(t,e,i,r.uq.Identity(),s||null)),c}function P(t,e,i,n,o,s,a,c=!1){const h=g(t,((n,r)=>(t._tempPickingRay||(t._tempPickingRay=l.Zero()),y(t,e,i,n,t._tempPickingRay,s||null,!1,r),t._tempPickingRay)),n,o,!1,a);return h&&(h.ray=f(t,e,i,r.uq.Identity(),s||null)),h}function x(t,e,i,n,o){const s=g(t,(i=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=r.uq.Identity()),i.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=l.Zero()),l.TransformToRef(e,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform)),i,n,!1,o);return s&&(s.ray=e),s}function _(t,e,i,n,r,o){return p(t,(n=>f(t,e,i,n,r||null)),n,o)}function M(t,e,i,n){return p(t,(i=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=r.uq.Identity()),i.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=l.Zero()),l.TransformToRef(e,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform)),i,n)}function k(t,e=100,i,n){return A(t,new l(r.Pq.Zero(),r.Pq.Zero(),e),e,i,n)}function A(t,e,i=100,n,o){n||(n=t.getWorldMatrix()),e.length=i,o?e.origin.copyFrom(o):e.origin.copyFrom(t.position);const s=r.AA.Vector3[2];s.set(0,0,t._scene.useRightHandedSystem?-1:1);const a=r.AA.Vector3[3];return r.Pq.TransformNormalToRef(s,n,a),r.Pq.NormalizeToRef(a,e.direction),e}function q(t,e){e&&(e.prototype.getForwardRay=function(t=100,e,i){return A(this,new l(r.Pq.Zero(),r.Pq.Zero(),t),t,e,i)},e.prototype.getForwardRayToRef=function(t,e=100,i,n){return A(this,t,e,i,n)}),t&&(h.h._IsPickingAvailable=!0,t.prototype.createPickingRay=function(t,e,i,n,r=!1){return f(this,t,e,i,n,r)})}l._TmpVector3=(0,o.mI)(6,r.Pq.Zero),l._RayDistant=l.Zero(),l._Smallnum=1e-8,l._Rayl=1e9},86919:(t,e,i)=>{i.r(e),i.d(e,{AddRayExtensions:()=>o.Oj,CreatePickingRay:()=>o.ui,CreatePickingRayInCameraSpace:()=>o.AU,CreatePickingRayInCameraSpaceToRef:()=>o.oZ,CreatePickingRayToRef:()=>o.Gz,GetForwardRay:()=>o.KI,GetForwardRayToRef:()=>o.m9,MultiPick:()=>o.DY,MultiPickWithRay:()=>o.TR,Pick:()=>o.mc,PickWithBoundingInfo:()=>o.uW,PickWithRay:()=>o.S,PickingCustomization:()=>o.R0,Ray:()=>o.Rl});var n=i(87491),r=i(30388),o=i(48086);(0,o.Oj)(n.Z,r.i),n.Z.prototype.createPickingRayToRef=function(t,e,i,n,r,s=!1,a=!1){return(0,o.Gz)(this,t,e,i,n,r,s,a)},n.Z.prototype.createPickingRayInCameraSpace=function(t,e,i){return(0,o.AU)(this,t,e,i)},n.Z.prototype.createPickingRayInCameraSpaceToRef=function(t,e,i,n){return(0,o.oZ)(this,t,e,i,n)},n.Z.prototype.pickWithBoundingInfo=function(t,e,i,n,r){return(0,o.uW)(this,t,e,i,n,r)},n.Z.prototype.pick=function(t,e,i,n,r,s,a=!1){return(0,o.mc)(this,t,e,i,n,r,s,a)},n.Z.prototype.pickWithRay=function(t,e,i,n){return(0,o.S)(this,t,e,i,n)},n.Z.prototype.multiPick=function(t,e,i,n,r){return(0,o.DY)(this,t,e,i,n,r)},n.Z.prototype.multiPickWithRay=function(t,e,i){return(0,o.TR)(this,t,e,i)}}}]);