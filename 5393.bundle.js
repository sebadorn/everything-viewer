"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[5393,6041],{5305:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(75524),n=s(79259),r=s(22002),o=s(66240),a=s(79923),h=s(998);class l{constructor(e=!1){this.allowMouse=e,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=h.S0.IsSafari()}attachControl(e){e=h.S0.BackCompatCameraNoPreventDefault(arguments);let t=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=s=>{const i=s.event,n="mouse"===i.pointerType||this._isSafari&&void 0===i.pointerType;if(this.allowMouse||!n)if(s.type===o.Zp.POINTERDOWN){if(e||i.preventDefault(),this._pointerPressed.push(i.pointerId),1!==this._pointerPressed.length)return;t={x:i.clientX,y:i.clientY}}else if(s.type===o.Zp.POINTERUP){e||i.preventDefault();const s=this._pointerPressed.indexOf(i.pointerId);if(-1===s)return;if(this._pointerPressed.splice(s,1),0!=s)return;t=null,this._offsetX=null,this._offsetY=null}else if(s.type===o.Zp.POINTERMOVE){if(e||i.preventDefault(),!t)return;if(0!=this._pointerPressed.indexOf(i.pointerId))return;this._offsetX=i.clientX-t.x,this._offsetY=-(i.clientY-t.y)}}),this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,o.Zp.POINTERDOWN|o.Zp.POINTERUP|o.Zp.POINTERMOVE),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.addEventListener("blur",this._onLostFocus)}}detachControl(){if(this._pointerInput){if(this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const e=this.camera,t=e._calculateHandednessMultiplier();e.cameraRotation.y=t*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)e.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const t=e._computeLocalCameraSpeed(),s=new a.Pq(0,0,0!==this.touchMoveSensibility?t*this._offsetY/this.touchMoveSensibility:0);a.uq.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(a.Pq.TransformCoordinates(s,e._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,i.Cg)([(0,n.lK)()],l.prototype,"touchAngularSensibility",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"touchMoveSensibility",void 0),r.H.FreeCameraTouchInput=l},11710:(e,t,s)=>{s.d(t,{S:()=>c});var i=s(75524),n=s(79259),r=s(79923),o=s(12333),a=s(67100),h=s(998),l=s(56552),u=s(32206);class c extends o.F{get angularSensibility(){const e=this.inputs.attached.mouse;return e?e.angularSensibility:0}set angularSensibility(e){const t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}get keysUpward(){const e=this.inputs.attached.keyboard;return e?e.keysUpward:[]}set keysUpward(e){const t=this.inputs.attached.keyboard;t&&(t.keysUpward=e)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}get keysDownward(){const e=this.inputs.attached.keyboard;return e?e.keysDownward:[]}set keysDownward(e){const t=this.inputs.attached.keyboard;t&&(t.keysDownward=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}set keysLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set keysRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}get keysRotateLeft(){const e=this.inputs.attached.keyboard;return e?e.keysRotateLeft:[]}set keysRotateLeft(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateLeft=e)}get keysRotateRight(){const e=this.inputs.attached.keyboard;return e?e.keysRotateRight:[]}set keysRotateRight(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateRight=e)}get keysRotateUp(){const e=this.inputs.attached.keyboard;return e?e.keysRotateUp:[]}set keysRotateUp(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateUp=e)}get keysRotateDown(){const e=this.inputs.attached.keyboard;return e?e.keysRotateDown:[]}set keysRotateDown(e){const t=this.inputs.attached.keyboard;t&&(t.keysRotateDown=e)}constructor(e,t,s,i=!0){super(e,t,s,i),this.ellipsoid=new r.Pq(.5,1,.5),this.ellipsoidOffset=new r.Pq(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=r.Pq.Zero(),this._diffPosition=r.Pq.Zero(),this._newPosition=r.Pq.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=(e,t,s=null)=>{this._newPosition.copyFrom(t),this._newPosition.subtractToRef(this._oldPosition,this._diffPosition),this._diffPosition.length()>u.$.CollisionsEpsilon&&(this.position.addToRef(this._diffPosition,this._deferredPositionUpdate),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate),this.onCollide&&s&&this.onCollide(s))},this.inputs=new a.s(this),this.inputs.addKeyboard().addMouse()}attachControl(e,t){t=h.S0.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(t)}detachControl(){this.inputs.detachElement(),this.cameraDirection=new r.Pq(0,0,0),this.cameraRotation=new r.I9(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(e){this._collisionMask=isNaN(e)?-1:e}_collideWithWorld(e){let t;t=this.parent?r.Pq.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const s=this.getScene().collisionCoordinator;this._collider||(this._collider=s.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let i=e;this.applyGravity&&(i=e.add(this.getScene().gravity)),s.getNewPosition(this._oldPosition,i,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=r.Pq.Zero(),this._transformedDirection=r.Pq.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(e){this._needMoveForGravity=e}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"FreeCamera"}}(0,i.Cg)([(0,n.P_)()],c.prototype,"ellipsoid",void 0),(0,i.Cg)([(0,n.P_)()],c.prototype,"ellipsoidOffset",void 0),(0,i.Cg)([(0,n.lK)()],c.prototype,"checkCollisions",void 0),(0,i.Cg)([(0,n.lK)()],c.prototype,"applyGravity",void 0),(0,l.Y5)("BABYLON.FreeCamera",c)},11984:(e,t,s)=>{s.d(t,{m:()=>l});var i,n=s(75524),r=s(79259),o=s(22002),a=s(54973),h=s(79923);!function(e){e[e.MoveRelative=0]="MoveRelative",e[e.RotateRelative=1]="RotateRelative",e[e.MoveScene=2]="MoveScene"}(i||(i={}));class l extends a.l{constructor(){super(...arguments),this._moveRelative=h.Pq.Zero(),this._rotateRelative=h.Pq.Zero(),this._moveScene=h.Pq.Zero(),this._wheelXAction=i.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=i.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(e){null===e&&this._wheelXAction!==i.MoveRelative||(this._wheelXAction=i.MoveRelative,this._wheelXActionCoordinate=e)}get wheelXMoveRelative(){return this._wheelXAction!==i.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(e){null===e&&this._wheelYAction!==i.MoveRelative||(this._wheelYAction=i.MoveRelative,this._wheelYActionCoordinate=e)}get wheelYMoveRelative(){return this._wheelYAction!==i.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(e){null===e&&this._wheelZAction!==i.MoveRelative||(this._wheelZAction=i.MoveRelative,this._wheelZActionCoordinate=e)}get wheelZMoveRelative(){return this._wheelZAction!==i.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(e){null===e&&this._wheelXAction!==i.RotateRelative||(this._wheelXAction=i.RotateRelative,this._wheelXActionCoordinate=e)}get wheelXRotateRelative(){return this._wheelXAction!==i.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(e){null===e&&this._wheelYAction!==i.RotateRelative||(this._wheelYAction=i.RotateRelative,this._wheelYActionCoordinate=e)}get wheelYRotateRelative(){return this._wheelYAction!==i.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(e){null===e&&this._wheelZAction!==i.RotateRelative||(this._wheelZAction=i.RotateRelative,this._wheelZActionCoordinate=e)}get wheelZRotateRelative(){return this._wheelZAction!==i.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(e){null===e&&this._wheelXAction!==i.MoveScene||(this._wheelXAction=i.MoveScene,this._wheelXActionCoordinate=e)}get wheelXMoveScene(){return this._wheelXAction!==i.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(e){null===e&&this._wheelYAction!==i.MoveScene||(this._wheelYAction=i.MoveScene,this._wheelYActionCoordinate=e)}get wheelYMoveScene(){return this._wheelYAction!==i.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(e){null===e&&this._wheelZAction!==i.MoveScene||(this._wheelZAction=i.MoveScene,this._wheelZActionCoordinate=e)}get wheelZMoveScene(){return this._wheelZAction!==i.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);const e=h.uq.Zero();this.camera.getViewMatrix().invertToRef(e);const t=h.Pq.Zero();h.Pq.TransformNormalToRef(this._moveRelative,e,t),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(t),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(e,t,s){if(0===e)return;if(null===t||null===s)return;let n=null;switch(t){case i.MoveRelative:n=this._moveRelative;break;case i.RotateRelative:n=this._rotateRelative;break;case i.MoveScene:n=this._moveScene}switch(s){case 0:n.set(e,0,0);break;case 1:n.set(0,e,0);break;case 2:n.set(0,0,e)}}}(0,n.Cg)([(0,r.lK)()],l.prototype,"wheelXMoveRelative",null),(0,n.Cg)([(0,r.lK)()],l.prototype,"wheelYMoveRelative",null),(0,n.Cg)([(0,r.lK)()],l.prototype,"wheelZMoveRelative",null),(0,n.Cg)([(0,r.lK)()],l.prototype,"wheelXRotateRelative",null),(0,n.Cg)([(0,r.lK)()],l.prototype,"wheelYRotateRelative",null),(0,n.Cg)([(0,r.lK)()],l.prototype,"wheelZRotateRelative",null),(0,n.Cg)([(0,r.lK)()],l.prototype,"wheelXMoveScene",null),(0,n.Cg)([(0,r.lK)()],l.prototype,"wheelYMoveScene",null),(0,n.Cg)([(0,r.lK)()],l.prototype,"wheelZMoveScene",null),o.H.FreeCameraMouseWheelInput=l},12462:(e,t,s)=>{s.d(t,{L:()=>n});var i=s(7481);class n extends i.g{get depth(){return this._depth}constructor(e,t,s,n,r,o,a=!0,h=!1,l=i.g.TRILINEAR_SAMPLINGMODE,u=0,c){super(null,o,!a,h),this.format=r,this._texture=o.getEngine().createRawTexture2DArray(e,t,s,n,r,a,h,l,null,u,c),this._depth=n,this.is2DArray=!0}update(e){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(e,t,s,i,r,o=!0,a=!1,h=3,l=0){return new n(e,t,s,i,5,r,o,a,h,l)}}},12901:(e,t,s)=>{s.d(t,{h:()=>l});var i=s(75524),n=s(99848),r=s(79259),o=s(22002),a=s(66240),h=s(998);class l{constructor(e=!0){this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new n.cP,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(e){e=h.S0.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),s=t.getInputElement();this._pointerInput||(this._pointerInput=i=>{const n=i.event,r="touch"===n.pointerType;if(!this.touchEnabled&&r)return;if(i.type!==a.Zp.POINTERMOVE&&-1===this.buttons.indexOf(n.button))return;const o=n.target;if(i.type===a.Zp.POINTERDOWN){if(r&&-1!==this._activePointerId||!r&&-1!==this._currentActiveButton)return;this._activePointerId=n.pointerId;try{o?.setPointerCapture(n.pointerId)}catch(e){}-1===this._currentActiveButton&&(this._currentActiveButton=n.button),this._previousPosition={x:n.clientX,y:n.clientY},e||(n.preventDefault(),s&&s.focus()),t.isPointerLock&&this._onMouseMove&&this._onMouseMove(i.event)}else if(i.type===a.Zp.POINTERUP){if(r&&this._activePointerId!==n.pointerId||!r&&this._currentActiveButton!==n.button)return;try{o?.releasePointerCapture(n.pointerId)}catch(e){}this._currentActiveButton=-1,this._previousPosition=null,e||n.preventDefault(),this._activePointerId=-1}else if(i.type===a.Zp.POINTERMOVE&&(this._activePointerId===n.pointerId||!r))if(t.isPointerLock&&this._onMouseMove)this._onMouseMove(i.event);else if(this._previousPosition){const t=this.camera._calculateHandednessMultiplier(),s=(n.clientX-this._previousPosition.x)*t,i=n.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=s/this.angularSensibility,this.camera.cameraRotation.x+=i/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:s,offsetY:i}),this._previousPosition={x:n.clientX,y:n.clientY},e||n.preventDefault()}}),this._onMouseMove=s=>{if(!t.isPointerLock)return;const i=this.camera._calculateHandednessMultiplier(),n=s.movementX*i;this.camera.cameraRotation.y+=n/this.angularSensibility;const r=s.movementY;this.camera.cameraRotation.x+=r/this.angularSensibility,this._previousPosition=null,e||s.preventDefault()},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,a.Zp.POINTERDOWN|a.Zp.POINTERUP|a.Zp.POINTERMOVE),s&&(this._contextMenuBind=e=>this.onContextMenu(e),s.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(e){e.preventDefault()}detachControl(){if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,i.Cg)([(0,r.lK)()],l.prototype,"buttons",void 0),(0,i.Cg)([(0,r.lK)()],l.prototype,"angularSensibility",void 0),o.H.FreeCameraMouseInput=l},15397:(e,t,s)=>{s.d(t,{E:()=>_});var i=s(36504),n=s(99848),r=s(79923),o=s(96041),a=s(7540),h=s(56227),l=s(6315),u=s(51137),c=s(74609);class _{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(e){this._useTextureToStoreBoneMatrices=e,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(e,t,s){this.name=e,this.id=t,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=r.uq.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new n.cP,this.bones=[],this._scene=s||l.q.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const i=this._scene.getEngine().getCaps();this._canUseTextureForBones=i.textureFloat&&i.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((e=>!e.getParent()))}getTransformMatrices(e){if(this.needInitialSkinMatrix){if(!e)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return e._bonesTransformMatrices||this.prepare(!0),e._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(e){return this.needInitialSkinMatrix&&e._transformMatrixTexture?e._transformMatrixTexture:this._transformMatrixTexture}getScene(){return this._scene}toString(e){let t=`Name: ${this.name}, nBones: ${this.bones.length}`;if(t+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,e){t+=", Ranges: {";let e=!0;for(const s in this._ranges)e&&(t+=", ",e=!1),t+=s;t+="}"}return t}getBoneIndexByName(e){for(let t=0,s=this.bones.length;t<s;t++)if(this.bones[t].name===e)return t;return-1}createAnimationRange(e,t,s){if(!this._ranges[e]){this._ranges[e]=new h.K(e,t,s);for(let i=0,n=this.bones.length;i<n;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].createRange(e,t,s)}}deleteAnimationRange(e,t=!0){for(let s=0,i=this.bones.length;s<i;s++)this.bones[s].animations[0]&&this.bones[s].animations[0].deleteRange(e,t);this._ranges[e]=null}getAnimationRange(e){return this._ranges[e]||null}getAnimationRanges(){const e=[];let t;for(t in this._ranges)e.push(this._ranges[t]);return e}copyAnimationRange(e,t,s=!1){if(this._ranges[t]||!e.getAnimationRange(t))return!1;let i=!0;const n=this._getHighestAnimationFrame()+1,r={},o=e.bones;let a,l;for(l=0,a=o.length;l<a;l++)r[o[l].name]=o[l];this.bones.length!==o.length&&(u.V.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${o.length}`),i=!1);const c=s&&this.dimensionsAtRest&&e.dimensionsAtRest?this.dimensionsAtRest.divide(e.dimensionsAtRest):null;for(l=0,a=this.bones.length;l<a;l++){const e=this.bones[l].name,o=r[e];o?i=i&&this.bones[l].copyAnimationRange(o,t,n,s,c):(u.V.Warn("copyAnimationRange: not same rig, missing source bone "+e),i=!1)}const _=e.getAnimationRange(t);return _&&(this._ranges[t]=new h.K(t,_.from+n,_.to+n)),i}returnToRest(){for(const e of this.bones)-1!==e._index&&e.returnToRest()}_getHighestAnimationFrame(){let e=0;for(let t=0,s=this.bones.length;t<s;t++)if(this.bones[t].animations[0]){const s=this.bones[t].animations[0].getHighestFrame();e<s&&(e=s)}return e}beginAnimation(e,t,s,i){const n=this.getAnimationRange(e);return n?this._scene.beginAnimation(this,n.from,n.to,t,s,i):null}static MakeAnimationAdditive(e,t=0,s){const i=e.getAnimationRange(s);if(!i)return null;const n=e._scene.getAllAnimatablesByTarget(e);let r=null;for(let e=0;e<n.length;e++){const t=n[e];if(t.fromFrame===i?.from&&t.toFrame===i?.to){r=t;break}}const o=e.getAnimatables();for(let e=0;e<o.length;e++){const i=o[e].animations;if(i)for(let e=0;e<i.length;e++)a.X5.MakeAnimationAdditive(i[e],t,s)}return r&&(r.isAdditive=!0),e}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(e){this._meshesWithPoseMatrix.push(e)}_unregisterMeshWithPoseMatrix(e){const t=this._meshesWithPoseMatrix.indexOf(e);t>-1&&this._meshesWithPoseMatrix.splice(t,1)}_computeTransformMatrices(e,t){this.onBeforeComputeObservable.notifyObservers(this);for(let s=0;s<this.bones.length;s++){const i=this.bones[s];i._childUpdateId++;const n=i.getParent();if(n?i.getLocalMatrix().multiplyToRef(n.getFinalMatrix(),i.getFinalMatrix()):t?i.getLocalMatrix().multiplyToRef(t,i.getFinalMatrix()):i.getFinalMatrix().copyFrom(i.getLocalMatrix()),-1!==i._index){const t=null===i._index?s:i._index;i.getAbsoluteInverseBindMatrix().multiplyToArray(i.getFinalMatrix(),e,16*t)}}this._identity.copyToArray(e,16*this.bones.length)}prepare(e=!1){if(!e){const e=this.getScene().getRenderId();if(this._currentRenderId===e)return;this._currentRenderId=e}if(this._numBonesWithLinkedTransformNode>0)for(const e of this.bones)if(e._linkedTransformNode){const t=e._linkedTransformNode;e.position=t.position,t.rotationQuaternion?e.rotationQuaternion=t.rotationQuaternion:e.rotation=t.rotation,e.scaling=t.scaling}if(this.needInitialSkinMatrix)for(const e of this._meshesWithPoseMatrix){const t=e.getPoseMatrix();let s=this._isDirty;if(e._bonesTransformMatrices&&e._bonesTransformMatrices.length===16*(this.bones.length+1)||(e._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),s=!0),s){if(this._synchronizedWithMesh!==e){this._synchronizedWithMesh=e;for(const e of this.bones)if(!e.getParent()){e.getBindMatrix().multiplyToRef(t,r.AA.Matrix[1]),e._updateAbsoluteBindMatrices(r.AA.Matrix[1])}if(this.isUsingTextureForMatrices){const t=4*(this.bones.length+1);e._transformMatrixTexture&&e._transformMatrixTexture.getSize().width===t||(e._transformMatrixTexture&&e._transformMatrixTexture.dispose(),e._transformMatrixTexture=o.I.CreateRGBATexture(e._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(e._bonesTransformMatrices,t),this.isUsingTextureForMatrices&&e._transformMatrixTexture&&e._transformMatrixTexture.update(e._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=o.I.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables}clone(e,t){const s=new _(e,t||e,this._scene);s.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let e=0;e<this.bones.length;e++){const t=this.bones[e];let n=null;const r=t.getParent();if(r){const e=this.bones.indexOf(r);n=s.bones[e]}const o=new i.$(t.name,s,n,t.getBindMatrix().clone(),t.getRestMatrix().clone());o._index=t._index,t._linkedTransformNode&&o.linkTransformNode(t._linkedTransformNode),c.r.DeepCopy(t.animations,o.animations)}if(this._ranges){s._ranges={};for(const e in this._ranges){const t=this._ranges[e];t&&(s._ranges[e]=t.clone())}}return this._isDirty=!0,s.prepare(!0),s}enableBlending(e=.01){this.bones.forEach((t=>{t.animations.forEach((t=>{t.enableBlending=!0,t.blendingSpeed=e}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._parentContainer){const e=this._parentContainer.skeletons.indexOf(this);e>-1&&this._parentContainer.skeletons.splice(e,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const e={};e.name=this.name,e.id=this.id,this.dimensionsAtRest&&(e.dimensionsAtRest=this.dimensionsAtRest.asArray()),e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let t=0;t<this.bones.length;t++){const s=this.bones[t],i=s.getParent(),n={parentBoneIndex:i?this.bones.indexOf(i):-1,index:s.getIndex(),name:s.name,id:s.id,matrix:s.getBindMatrix().asArray(),rest:s.getRestMatrix().asArray(),linkedTransformNodeId:s.getTransformNode()?.id};e.bones.push(n),s.length&&(n.length=s.length),s.metadata&&(n.metadata=s.metadata),s.animations&&s.animations.length>0&&(n.animation=s.animations[0].serialize()),e.ranges=[];for(const t in this._ranges){const s=this._ranges[t];if(!s)continue;const i={};i.name=t,i.from=s.from,i.to=s.to,e.ranges.push(i)}}return e}static Parse(e,t){const s=new _(e.name,e.id,t);let n;for(e.dimensionsAtRest&&(s.dimensionsAtRest=r.Pq.FromArray(e.dimensionsAtRest)),s.needInitialSkinMatrix=e.needInitialSkinMatrix,n=0;n<e.bones.length;n++){const t=e.bones[n],o=e.bones[n].index;let h=null;t.parentBoneIndex>-1&&(h=s.bones[t.parentBoneIndex]);const l=t.rest?r.uq.FromArray(t.rest):null,u=new i.$(t.name,s,h,r.uq.FromArray(t.matrix),l,null,o);void 0!==t.id&&null!==t.id&&(u.id=t.id),t.length&&(u.length=t.length),t.metadata&&(u.metadata=t.metadata),t.animation&&u.animations.push(a.X5.Parse(t.animation)),void 0!==t.linkedTransformNodeId&&null!==t.linkedTransformNodeId&&(s._hasWaitingData=!0,u._waitingTransformNodeId=t.linkedTransformNodeId)}if(e.ranges)for(n=0;n<e.ranges.length;n++){const t=e.ranges[n];s.createAnimationRange(t.name,t.from,t.to)}return s}computeAbsoluteMatrices(e=!1){(this._absoluteTransformIsDirty||e)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(e=!1){this.computeAbsoluteMatrices(e)}getPoseMatrix(){let e=null;return this._meshesWithPoseMatrix.length>0&&(e=this._meshesWithPoseMatrix[0].getPoseMatrix()),e}sortBones(){const e=[],t=new Array(this.bones.length);for(let s=0;s<this.bones.length;s++)this._sortBones(s,e,t);this.bones=e}_sortBones(e,t,s){if(s[e])return;s[e]=!0;const i=this.bones[e];if(!i)return;void 0===i._index&&(i._index=e);const n=i.getParent();n&&this._sortBones(this.bones.indexOf(n),t,s),t.push(i)}setCurrentPoseAsRest(){this.bones.forEach((e=>{e.setCurrentPoseAsRest()}))}}},23102:(e,t,s)=>{s.d(t,{i:()=>l});var i=s(75524),n=s(79259),r=s(22002),o=s(24146),a=s(79923),h=s(998);class l{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(e){e=h.S0.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const s=t.event;if(!s.metaKey)if(t.type===o.TB.KEYDOWN){if(-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysUpward.indexOf(s.keyCode)||-1!==this.keysDownward.indexOf(s.keyCode)||-1!==this.keysRotateLeft.indexOf(s.keyCode)||-1!==this.keysRotateRight.indexOf(s.keyCode)||-1!==this.keysRotateUp.indexOf(s.keyCode)||-1!==this.keysRotateDown.indexOf(s.keyCode)){-1===this._keys.indexOf(s.keyCode)&&this._keys.push(s.keyCode),e||s.preventDefault()}}else if(-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysUpward.indexOf(s.keyCode)||-1!==this.keysDownward.indexOf(s.keyCode)||-1!==this.keysRotateLeft.indexOf(s.keyCode)||-1!==this.keysRotateRight.indexOf(s.keyCode)||-1!==this.keysRotateUp.indexOf(s.keyCode)||-1!==this.keysRotateDown.indexOf(s.keyCode)){const t=this._keys.indexOf(s.keyCode);t>=0&&this._keys.splice(t,1),e||s.preventDefault()}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let t=0;t<this._keys.length;t++){const s=this._keys[t],i=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(s)?e._localDirection.copyFromFloats(-i,0,0):-1!==this.keysUp.indexOf(s)?e._localDirection.copyFromFloats(0,0,i):-1!==this.keysRight.indexOf(s)?e._localDirection.copyFromFloats(i,0,0):-1!==this.keysDown.indexOf(s)?e._localDirection.copyFromFloats(0,0,-i):-1!==this.keysUpward.indexOf(s)?e._localDirection.copyFromFloats(0,i,0):-1!==this.keysDownward.indexOf(s)?e._localDirection.copyFromFloats(0,-i,0):-1!==this.keysRotateLeft.indexOf(s)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(s)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(s)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(s)&&(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x+=this._getLocalRotation()),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),a.Pq.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const e=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*e}}(0,i.Cg)([(0,n.lK)()],l.prototype,"keysUp",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"keysUpward",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"keysDown",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"keysDownward",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"keysLeft",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"keysRight",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"rotationSpeed",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"keysRotateLeft",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"keysRotateRight",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"keysRotateUp",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"keysRotateDown",void 0),r.H.FreeCameraKeyboardMoveInput=l},54973:(e,t,s)=>{s.d(t,{l:()=>l});var i=s(75524),n=s(79259),r=s(99848),o=s(66240),a=s(38123),h=s(998);class l{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new r.cP,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(e){e=h.S0.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==o.Zp.POINTERWHEEL)return;const s=t.event,i=s.deltaMode===a.s.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*i*s.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*i*s.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*i*s.deltaZ/this._normalize,s.preventDefault&&(e||s.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,o.Zp.POINTERWHEEL)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,i.Cg)([(0,n.lK)()],l.prototype,"wheelPrecisionX",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"wheelPrecisionY",void 0),(0,i.Cg)([(0,n.lK)()],l.prototype,"wheelPrecisionZ",void 0)},67100:(e,t,s)=>{s.d(t,{s:()=>h});var i=s(22002),n=s(23102),r=s(12901),o=s(11984),a=s(5305);class h extends i._{constructor(e){super(e),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new n.i),this}addMouse(e=!0){return this._mouseInput||(this._mouseInput=new r.h(e),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new o.m,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new a.Z),this}clear(){super.clear(),this._mouseInput=null}}},80706:(e,t,s)=>{s.d(t,{M:()=>u});var i=s(75524),n=s(99848),r=s(6315),o=s(95616),a=s(79259),h=s(26877),l=s(56552);class u{get influence(){return this._influence}set influence(e){if(this._influence===e)return;const t=this._influence;this._influence=e,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===t||0===e)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}constructor(e,t=0,s=null){this.name=e,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new n.cP,this._onDataLayoutChanged=new n.cP,this._animationPropertiesOverride=null,this.id=e,this._scene=s||r.q.LastCreatedScene,this.influence=t,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(e){const t=this.hasPositions;this._positions=e,t!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(e){const t=this.hasNormals;this._normals=e,t!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(e){const t=this.hasTangents;this._tangents=e,t!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(e){const t=this.hasUVs;this._uvs=e,t!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(e){const t=this.hasUV2s;this._uv2s=e,t!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(e){const t=this.hasColors;this._colors=e,t!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const e=h.p.Clone((()=>new u(this.name,this.influence,this._scene)),this);return e._positions=this._positions,e._normals=this._normals,e._tangents=this._tangents,e._uvs=this._uvs,e._uv2s=this._uv2s,e._colors=this._colors,e}serialize(){const e={};return e.name=this.name,e.influence=this.influence,e.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(e.id=this.id),this.hasNormals&&(e.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(e.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(e.uvs=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(e.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(e.colors=Array.prototype.slice.call(this.getColors())),h.p.AppendSerializedAnimations(this,e),e}getClassName(){return"MorphTarget"}static Parse(e,t){const s=new u(e.name,e.influence);if(s.setPositions(e.positions),null!=e.id&&(s.id=e.id),e.normals&&s.setNormals(e.normals),e.tangents&&s.setTangents(e.tangents),e.uvs&&s.setUVs(e.uvs),e.uv2s&&s.setUV2s(e.uv2s),e.colors&&s.setColors(e.colors),e.animations){for(let t=0;t<e.animations.length;t++){const i=e.animations[t],n=(0,l.n9)("BABYLON.Animation");n&&s.animations.push(n.Parse(i))}e.autoAnimate&&t&&t.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1)}return s}static FromMesh(e,t,s){t||(t=e.name);const i=new u(t,s,e.getScene());return i.setPositions(e.getVerticesData(o.R.PositionKind)),e.isVerticesDataPresent(o.R.NormalKind)&&i.setNormals(e.getVerticesData(o.R.NormalKind)),e.isVerticesDataPresent(o.R.TangentKind)&&i.setTangents(e.getVerticesData(o.R.TangentKind)),e.isVerticesDataPresent(o.R.UVKind)&&i.setUVs(e.getVerticesData(o.R.UVKind)),e.isVerticesDataPresent(o.R.UV2Kind)&&i.setUV2s(e.getVerticesData(o.R.UV2Kind)),e.isVerticesDataPresent(o.R.ColorKind)&&i.setColors(e.getVerticesData(o.R.ColorKind)),i}}(0,i.Cg)([(0,a.lK)()],u.prototype,"id",void 0)},96041:(e,t,s)=>{s.d(t,{I:()=>n});var i=s(7481);class n extends i.g{constructor(e,t,s,n,r,o=!0,a=!1,h=3,l=0,u,c,_){super(null,r,!o,a,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,u),this.format=n,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==l||(h=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==l||(h=1),this._texture=this._engine.createRawTexture(e,t,s,n,o,a,h,null,l,u??0,c??!1),this.wrapU=i.g.CLAMP_ADDRESSMODE,this.wrapV=i.g.CLAMP_ADDRESSMODE,this._waitingForData=!!_&&!e)}update(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const e=new n(null,this.getSize().width,this.getSize().height,this.format,this.getScene(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return e._texture=this._texture,this._texture.incrementReferences(),e}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(e,t,s,i,r=!0,o=!1,a=3){return new n(e,t,s,1,i,r,o,a)}static CreateLuminanceAlphaTexture(e,t,s,i,r=!0,o=!1,a=3){return new n(e,t,s,2,i,r,o,a)}static CreateAlphaTexture(e,t,s,i,r=!0,o=!1,a=3){return new n(e,t,s,0,i,r,o,a)}static CreateRGBTexture(e,t,s,i,r=!0,o=!1,a=3,h=0,l=0,u=!1){return new n(e,t,s,4,i,r,o,a,h,l,u)}static CreateRGBATexture(e,t,s,i,r=!0,o=!1,a=3,h=0,l=0,u=!1,c=!1){return new n(e,t,s,5,i,r,o,a,h,l,u,c)}static CreateRGBAStorageTexture(e,t,s,i,r=!0,o=!1,a=3,h=0,l=!1){return new n(e,t,s,5,i,r,o,a,h,1,l)}static CreateRTexture(e,t,s,r,o=!0,a=!1,h=i.g.TRILINEAR_SAMPLINGMODE,l=1){return new n(e,t,s,6,r,o,a,h,l)}static CreateRStorageTexture(e,t,s,r,o=!0,a=!1,h=i.g.TRILINEAR_SAMPLINGMODE,l=1){return new n(e,t,s,6,r,o,a,h,l,1)}}},97974:(e,t,s)=>{s.d(t,{s:()=>n});var i=s(36181);class n{constructor(e){this.byteOffset=0,this.buffer=e}loadAsync(e){return this.buffer.readAsync(this.byteOffset,e).then((e=>{this._dataView=new DataView(e.buffer,e.byteOffset,e.byteLength),this._dataByteOffset=0}))}readUint32(){const e=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,e}readUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,e);return this._dataByteOffset+=e,this.byteOffset+=e,t}readString(e){return(0,i.Tq)(this.readUint8Array(e))}skipBytes(e){this._dataByteOffset+=e,this.byteOffset+=e}}},98639:(e,t,s)=>{s.d(t,{j:()=>h});var i=s(17931),n=s(51137),r=s(6315),o=s(80706),a=s(12462);class h{set areUpdatesFrozen(e){e?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(e=null){if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new i.L(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,e||(e=r.q.LastCreatedScene),this._scene=e,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const e=this._scene.getEngine().getCaps();this._canUseTextureForTargets=e.canUseGLVertexID&&e.textureFloat&&e.maxVertexTextureImageUnits>0&&e.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(e){this._numMaxInfluencers!==e&&(this._numMaxInfluencers=e,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(e){this._useTextureToStoreTargets!==e&&(this._useTextureToStoreTargets=e,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){return h.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!this._scene?.getEngine().getCaps().disableMorphTargetTexture}getActiveTarget(e){return this._activeTargets.data[e]}getTarget(e){return this._targets[e]}getTargetByName(e){for(const t of this._targets)if(t.name===e)return t;return null}addTarget(e){this._targets.push(e),this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add((e=>{this.areUpdatesFrozen&&e&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(e)}))),this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(e){const t=this._targets.indexOf(e);t>=0&&(this._targets.splice(t,1),e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(t,1)[0]),e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(t,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(e)}_bind(e){e.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),e.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),e.setTexture("morphTargets",this._targetStoreTexture),e.setInt("morphTargetCount",this.numInfluencers)}clone(){const e=new h(this._scene);for(const t of this._targets)e.addTarget(t.clone());return e.enablePositionMorphing=this.enablePositionMorphing,e.enableNormalMorphing=this.enableNormalMorphing,e.enableTangentMorphing=this.enableTangentMorphing,e.enableUVMorphing=this.enableUVMorphing,e.enableUV2Morphing=this.enableUV2Morphing,e.enableColorMorphing=this.enableColorMorphing,e}serialize(){const e={};e.id=this.uniqueId,e.targets=[];for(const t of this._targets)e.targets.push(t.serialize());return e}_syncActiveTargets(e=!1){if(this.areUpdatesFrozen)return;const t=!!this._targetStoreTexture,s=this.isUsingTextureForTargets;(this._mustSynchronize||t!==s)&&(this._mustSynchronize=!1,this.synchronize());let i=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let n=-1;for(const e of this._targets)if(n++,0!==e.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=h.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(e),this._morphTargetTextureIndices[i]=n,this._tempInfluences[i++]=e.influence}this._morphTargetTextureIndices.length!==i&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,i)),this._influences&&this._influences.length===i||(this._influences=new Float32Array(i));for(let e=0;e<i;e++)this._influences[e]=this._tempInfluences[e];if(e&&this._scene)for(const e of this._scene.meshes)e.morphTargetManager===this&&(s?e._markSubMeshesAsAttributesDirty():e._syncGeometryWithMorphTargetManager())}synchronize(){if(!this._scene||this.areUpdatesFrozen)return;const e=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,this._targetStoreTexture?.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>e.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const e of this._targets){this._supportsPositions=this._supportsPositions&&e.hasPositions,this._supportsNormals=this._supportsNormals&&e.hasNormals,this._supportsTangents=this._supportsTangents&&e.hasTangents,this._supportsUVs=this._supportsUVs&&e.hasUVs,this._supportsUV2s=this._supportsUV2s&&e.hasUV2s,this._supportsColors=this._supportsColors&&e.hasColors;const t=e.vertexCount;if(0===this._vertexCount)this._vertexCount=t;else if(this._vertexCount!==t)return void n.V.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${e.name}": ${t}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const t=e.getCaps().maxTextureSize;this._textureWidth>t&&(this._textureHeight=Math.ceil(this._textureWidth/t),this._textureWidth=t);const s=this._targets.length,i=new Float32Array(s*this._textureWidth*this._textureHeight*4);let n=0;for(let e=0;e<s;e++){const t=this._targets[e],s=t.getPositions(),r=t.getNormals(),o=t.getUVs(),a=t.getTangents(),h=t.getUV2s(),l=t.getColors();n=e*this._textureWidth*this._textureHeight*4;for(let e=0;e<this._vertexCount;e++)this._supportsPositions&&s&&(i[n]=s[3*e],i[n+1]=s[3*e+1],i[n+2]=s[3*e+2],n+=4),this._supportsNormals&&r&&(i[n]=r[3*e],i[n+1]=r[3*e+1],i[n+2]=r[3*e+2],n+=4),this._supportsUVs&&o&&(i[n]=o[2*e],i[n+1]=o[2*e+1],n+=4),this._supportsTangents&&a&&(i[n]=a[3*e],i[n+1]=a[3*e+1],i[n+2]=a[3*e+2],n+=4),this._supportsUV2s&&h&&(i[n]=h[2*e],i[n+1]=h[2*e+1],n+=4),this._supportsColors&&l&&(i[n]=l[4*e],i[n+1]=l[4*e+1],i[n+2]=l[4*e+2],i[n+3]=l[4*e+3],n+=4)}this._targetStoreTexture=a.L.CreateRGBATexture(i,this._textureWidth,this._textureHeight,s,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const e of this._scene.meshes)e.morphTargetManager===this&&e._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const e=this._parentContainer.morphTargetManagers.indexOf(this);e>-1&&this._parentContainer.morphTargetManagers.splice(e,1),this._parentContainer=null}for(const e of this._targets)this._scene.stopAnimation(e)}}static Parse(e,t){const s=new h(t);for(const i of e.targets)s.addTarget(o.M.Parse(i,t));return s}}h.EnableTextureStorage=!0,h.MaxActiveMorphTargetsInVertexAttributeMode=8}}]);