"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[53],{6455:(e,t,n)=>{n.d(t,{ICalParser:()=>r});var a=n(42109),o=n(62845);class r extends o.V{constructor(e){super(e)}_buildHTMLComponent(e){const t=document.createElement("div");t.className="container";const n=document.createElement("table"),o=e.summary||"(no summary)",r=document.createElement("h2");r.className="summary",r.textContent=o,e.color&&(r.style.backgroundColor=e.color);const l=this._getParameterValue(e,"status");if(l){const e=document.createElement("span");e.className="state",e.textContent=l,r.append(e)}const i=this._getParameterValue(e,"class");if(i){const e=document.createElement("span");e.className="state",e.textContent=i,r.append(e)}if(t.append(r),e.description){const n=document.createElement("div");n.className="description",n.innerHTML=e.description.replaceAll(/\n/g,"<br>"),t.append(n)}if(e.startDate){const t=this._buildHTMLTableRowTime("Start",e.startDate);if(n.append(t),e.endDate){const t=this._buildHTMLTableRowTime("End",e.endDate);n.append(t)}if(e.duration){const t=1e3*e.duration.toSeconds(),o=a.UI.buildTableRow(null,"Duration",a.UI.formatDuration(t));n.append(o)}}const s=e.component.jCal[1].filter(e=>"freebusy"===e[0]);s.length>0&&s.forEach(e=>{const t=e[3],o=this.ICAL.Time.fromDateTimeString(t[0]),r=this._buildTimeSelect(o);let l=null,i="";if(t[1].length>=16){const e=this.ICAL.Time.fromDateTimeString(t[1]);l=this._buildTimeSelect(e),i=" â€“ "}else l=t[1],i=" / ";const s=a.UI.buildTableRow(null,"Period",""),c=s.querySelector("td");c.innerHTML="",c.append(r,i,l),n.append(s)});const c=this._getParameterValue(e,"due");if(c){const e=this.ICAL.Time.fromDateTimeString(c),t=this._buildHTMLTableRowTime("Due",e);n.append(t)}if(e.location){const t=a.UI.buildTableRow(null,"Location",e.location);t.className="location",n.append(t)}if(e.organizer){const t=e.component.jCal[1].find(e=>"organizer"===e[0]);let o=t?.[1]?.cn||e.organizer.replace(/^mailto:/,"");const r=a.UI.buildTableRow(null,"Organizer",o);if(r.className="organizer",e.organizer.startsWith("mailto:")){const t=document.createElement("a");t.href=e.organizer,t.textContent=o;const n=r.querySelector("td");n.innerHTML="",n.append(t)}n.append(r)}if(Array.isArray(e.attendees)&&e.attendees.length>0){const t=a.UI.buildTableRow(null,"Attendees","");t.className="attendees";const o=document.createElement("ul");e.attendees.forEach(e=>{const t=document.createElement("a");t.href=e.getFirstValue(),t.textContent=e.getParameter("cn")||t.href.replace(/^mailto:/,"");const n=document.createElement("li");if(n.append(t),e.getParameter("partstat")){const t=document.createElement("span");t.className="state",t.textContent=e.getParameter("partstat"),n.append(t)}o.append(n)});t.querySelector("td").append(o),n.append(t)}const d=this._getParameterValue(e,"comment");if(d){const e=a.UI.buildTableRow(null,"Comment",d);n.append(e)}const u=this._getParameterValue(e,"url");if(u){const e=a.UI.buildTableRow(null,"URL",u),t=document.createElement("a");t.href=u,t.textContent=u;const o=e.querySelector("td");o.innerHTML="",o.append(t),n.append(e)}t.append(n);const m=this._buildHTMLVAlarms(e);return m&&t.append(m),t}_buildHTMLTableRowTime(e,t){const n=this._buildTimeSelect(t),o=a.UI.buildTableRow(null,e,"");return o.className=e.toLowerCase(),o.querySelector("td").append(n),o}_buildHTMLVAlarm(e){if(!Array.isArray(e))return null;const t=document.createElement("div");t.className="valarm";const n=e.find(e=>"description"===e[0]);if(n&&n[3]){const e=document.createElement("div");e.className="alarm-description",e.textContent=n[3],t.append(e)}const o=document.createElement("table"),r=e.find(e=>"trigger"===e[0]);if(r&&r[3]){const e=a.UI.buildTableRow(null,"Trigger",r[3]);o.append(e)}const l=e.find(e=>"duration"===e[0]);if(l&&l[3]){const e=a.UI.buildTableRow(null,"Duration",l[3]);o.append(e)}const i=e.find(e=>"repeat"===e[0]);if(i&&i[3]){const e=a.UI.buildTableRow(null,"Repeat",i[3]);o.append(e)}const s=e.find(e=>"action"===e[0]);if(s&&s[3]){const e=a.UI.buildTableRow(null,"Action",s[3]);o.append(e)}const c=e.find(e=>"attach"===e[0]);if(c&&c[3]){const e=a.UI.buildTableRow(null,"Attach",c[3]);o.append(e)}return t.append(o),t}_buildHTMLVAlarms(e){const t=e.component.jCal[2];if(!Array.isArray(t))return null;const n=t.filter(e=>"valarm"===e[0]);if(0===n.length)return null;const a=document.createElement("div");return a.className="valarms",n.forEach(e=>{const t=this._buildHTMLVAlarm(e[1]);t&&a.append(t)}),a}_buildTimeSelect(e){const t={ICAL:e.toString(),UTC:a.UI.formatDateTime(e.toJSDate()),Unix:e.toUnixTime()};e.zone?.tzid&&(t.ICAL+=` (${e.zone.tzid})`);const n=document.createElement("select");for(const e in t){let a=String(t[e]);a=a.replace("T"," "),a=a.replace(/(:[0-9]{2})Z/,"$1"),a=a.replace(/( [0-9]{2}:[0-9]{2}):00/,"$1"),"ICAL"!==e&&(a+=` [${e}]`);const o=document.createElement("option");o.value=e,o.textContent=a,n.append(o)}return n}_getParameterValue(e,t){const n=e.component.jCal;if(!Array.isArray(n)||!Array.isArray(n[1]))return null;const a=n[1].find(e=>e[0]===t);return Array.isArray(a)?a[3]:null}build(e){const t=document.createElement("div");t.className="ical";const n=new this.ICAL.Component(e),a=n.getAllSubcomponents("vevent"),o=n.getAllSubcomponents("vtodo"),r=n.getAllSubcomponents("vjournal"),l=n.getAllSubcomponents("vfreebusy");return a.concat(o).concat(r).concat(l).forEach(e=>{const n=new this.ICAL.Event(e),a=this._buildHTMLComponent(n);a.className+=" "+e.jCal[0],t.append(a)}),t}async getHTML(){const e=await this.getText(),t=await this.parse(e);return this.build(t)}async parse(e){return this.ICAL=(await n.e(2859).then(n.bind(n,68202))).default,this.ICAL.parse(e)}}}}]);