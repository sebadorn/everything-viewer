"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[6996],{6996:(s,t,e)=>{e.d(t,{OBJFileLoader:()=>b});var i=e(79923),o=e(998),r=e(15909),n=e(97762),a=e(22412),l=e(26041),h=e(82781),_=e(2093);class p{constructor(){this.materials=[]}parseMTL(s,t,e,i){if(t instanceof ArrayBuffer)return;const o=t.split("\n"),r=/\s+/;let n,a=null;for(let t=0;t<o.length;t++){const h=o[t].trim();if(0===h.length||"#"===h.charAt(0))continue;const m=h.indexOf(" ");let d=m>=0?h.substring(0,m):h;d=d.toLowerCase();const c=m>=0?h.substring(m+1).trim():"";if("newmtl"===d)a&&this.materials.push(a),s._blockEntityCollection=!!i,a=new _.F(c,s),a._parentContainer=i,s._blockEntityCollection=!1;else if("kd"===d&&a)n=c.split(r,3).map(parseFloat),a.diffuseColor=l.v9.FromArray(n);else if("ka"===d&&a)n=c.split(r,3).map(parseFloat),a.ambientColor=l.v9.FromArray(n);else if("ks"===d&&a)n=c.split(r,3).map(parseFloat),a.specularColor=l.v9.FromArray(n);else if("ke"===d&&a)n=c.split(r,3).map(parseFloat),a.emissiveColor=l.v9.FromArray(n);else if("ns"===d&&a)a.specularPower=parseFloat(c);else if("d"===d&&a)a.alpha=parseFloat(c);else if("map_ka"===d&&a)a.ambientTexture=p._GetTexture(e,c,s);else if("map_kd"===d&&a)a.diffuseTexture=p._GetTexture(e,c,s);else if("map_ks"===d&&a)a.specularTexture=p._GetTexture(e,c,s);else if("map_ns"===d);else if("map_bump"===d&&a){const t=c.split(r),i=t.indexOf("-bm");let o=null;i>=0&&(o=t[i+1],t.splice(i,2)),a.bumpTexture=p._GetTexture(e,t.join(" "),s),a.bumpTexture&&null!==o&&(a.bumpTexture.level=parseFloat(o))}else"map_d"===d&&a&&(a.opacityTexture=p._GetTexture(e,c,s))}a&&this.materials.push(a)}static _GetTexture(s,t,e){if(!t)return null;let i=s;if("file:"===s){let s=t.lastIndexOf("\\");-1===s&&(s=t.lastIndexOf("/")),i+=s>-1?t.substring(s+1):t}else i+=t;return new h.g(i,e,!1,p.INVERT_TEXTURE_Y)}}p.INVERT_TEXTURE_Y=!0;var m=e(95616),d=e(27050),c=e(85530),u=e(36803),F=e(51137);class g{constructor(s,t,e){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._extColors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new l.ov(.5,.5,.5,1),this._hasLineData=!1,this._materialToUse=s,this._babylonMeshesArray=t,this._loadingOptions=e}_isInArray(s,t){s[t[0]]||(s[t[0]]={normals:[],idx:[]});const e=s[t[0]].normals.indexOf(t[1]);return-1===e?-1:s[t[0]].idx[e]}_isInArrayUV(s,t){s[t[0]]||(s[t[0]]={normals:[],idx:[],uv:[]});const e=s[t[0]].normals.indexOf(t[1]);return 1!=e&&t[2]===s[t[0]].uv[e]?s[t[0]].idx[e]:-1}_setData(s){let t;s.indiceUvsFromObj??(s.indiceUvsFromObj=-1),s.indiceNormalFromObj??(s.indiceNormalFromObj=-1),t=this._loadingOptions.optimizeWithUV?this._isInArrayUV(this._tuplePosNorm,[s.indicePositionFromObj,s.indiceNormalFromObj,s.indiceUvsFromObj]):this._isInArray(this._tuplePosNorm,[s.indicePositionFromObj,s.indiceNormalFromObj]),-1===t?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(s.positionVectorFromOBJ),void 0!==s.textureVectorFromOBJ&&this._wrappedUvsForBabylon.push(s.textureVectorFromOBJ),void 0!==s.normalsVectorFromOBJ&&this._wrappedNormalsForBabylon.push(s.normalsVectorFromOBJ),void 0!==s.positionColorsFromOBJ&&this._wrappedColorsForBabylon.push(s.positionColorsFromOBJ),this._tuplePosNorm[s.indicePositionFromObj].normals.push(s.indiceNormalFromObj),this._tuplePosNorm[s.indicePositionFromObj].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[s.indicePositionFromObj].uv.push(s.indiceUvsFromObj)):this._indicesForBabylon.push(t)}_unwrapData(){try{for(let s=0;s<this._wrappedPositionForBabylon.length;s++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[s].x*this._handednessSign,this._wrappedPositionForBabylon[s].y,this._wrappedPositionForBabylon[s].z),this._wrappedNormalsForBabylon.length&&this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[s].x*this._handednessSign,this._wrappedNormalsForBabylon[s].y,this._wrappedNormalsForBabylon[s].z),this._wrappedUvsForBabylon.length&&this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[s].x,this._wrappedUvsForBabylon[s].y),this._unwrappedColorsForBabylon.length&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[s].r,this._wrappedColorsForBabylon[s].g,this._wrappedColorsForBabylon[s].b,this._wrappedColorsForBabylon[s].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0}catch(s){throw new Error("Unable to unwrap data while parsing OBJ data.")}}_getTriangles(s,t){for(let e=t;e<s.length-1;e++)this._pushTriangle(s,e)}_getColor(s){return this._loadingOptions.importVertexColors?this._extColors[s]??this._colors[s]:void 0}_setDataForCurrentFaceWithPattern1(s,t){this._getTriangles(s,t);for(let s=0;s<this._triangles.length;s++){const t=parseInt(this._triangles[s])-1;this._setData({indicePositionFromObj:t,positionVectorFromOBJ:this._positions[t],positionColorsFromOBJ:this._getColor(t)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern2(s,t){this._getTriangles(s,t);for(let s=0;s<this._triangles.length;s++){const t=this._triangles[s].split("/"),e=parseInt(t[0])-1,i=parseInt(t[1])-1;this._setData({indicePositionFromObj:e,indiceUvsFromObj:i,positionVectorFromOBJ:this._positions[e],textureVectorFromOBJ:this._uvs[i],positionColorsFromOBJ:this._getColor(e)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern3(s,t){this._getTriangles(s,t);for(let s=0;s<this._triangles.length;s++){const t=this._triangles[s].split("/"),e=parseInt(t[0])-1,i=parseInt(t[1])-1,o=parseInt(t[2])-1;this._setData({indicePositionFromObj:e,indiceUvsFromObj:i,indiceNormalFromObj:o,positionVectorFromOBJ:this._positions[e],textureVectorFromOBJ:this._uvs[i],normalsVectorFromOBJ:this._normals[o]})}this._triangles.length=0}_setDataForCurrentFaceWithPattern4(s,t){this._getTriangles(s,t);for(let s=0;s<this._triangles.length;s++){const t=this._triangles[s].split("//"),e=parseInt(t[0])-1,i=parseInt(t[1])-1;this._setData({indicePositionFromObj:e,indiceNormalFromObj:i,positionVectorFromOBJ:this._positions[e],normalsVectorFromOBJ:this._normals[i],positionColorsFromOBJ:this._getColor(e)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern5(s,t){this._getTriangles(s,t);for(let s=0;s<this._triangles.length;s++){const t=this._triangles[s].split("/"),e=this._positions.length+parseInt(t[0]),i=this._uvs.length+parseInt(t[1]),o=this._normals.length+parseInt(t[2]);this._setData({indicePositionFromObj:e,indiceUvsFromObj:i,indiceNormalFromObj:o,positionVectorFromOBJ:this._positions[e],textureVectorFromOBJ:this._uvs[i],normalsVectorFromOBJ:this._normals[o],positionColorsFromOBJ:this._getColor(e)})}this._triangles.length=0}_addPreviousObjMesh(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._unwrappedNormalsForBabylon.length&&(this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice()),this._unwrappedUVForBabylon.length&&(this._handledMesh.uvs=this._unwrappedUVForBabylon.slice()),this._unwrappedColorsForBabylon.length&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._handledMesh.hasLines=this._hasLineData,this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0,this._hasLineData=!1)}_optimizeNormals(s){const t=s.getVerticesData(m.R.PositionKind),e=s.getVerticesData(m.R.NormalKind),o={};if(!t||!e)return;for(let s=0;s<t.length/3;s++){const e=t[3*s+0]+"_"+t[3*s+1]+"_"+t[3*s+2];let i=o[e];i||(i=[],o[e]=i),i.push(s)}const r=new i.Pq;for(const s in o){const t=o[s];if(t.length<2)continue;const i=t[0];for(let s=1;s<t.length;++s){const o=t[s];e[3*i+0]+=e[3*o+0],e[3*i+1]+=e[3*o+1],e[3*i+2]+=e[3*o+2]}r.copyFromFloats(e[3*i+0],e[3*i+1],e[3*i+2]),r.normalize();for(let s=0;s<t.length;++s){const i=t[s];e[3*i+0]=r.x,e[3*i+1]=r.y,e[3*i+2]=r.z}}s.setVerticesData(m.R.NormalKind,e)}static _IsLineElement(s){return s.startsWith("l")}static _IsObjectElement(s){return s.startsWith("o")}static _IsGroupElement(s){return s.startsWith("g")}static _GetZbrushMRGB(s,t){if(!s.startsWith("mrgb"))return null;if(s=s.replace("mrgb","").trim(),t)return[];const e=s.match(/[a-z0-9]/g);if(!e||e.length%8!=0)return[];const i=[];for(let s=0;s<e.length/8;s++){const t=e[8*s+2]+e[8*s+3],o=e[8*s+4]+e[8*s+5],r=e[8*s+6]+e[8*s+7];i.push(new l.ov(parseInt(t,16)/255,parseInt(o,16)/255,parseInt(r,16)/255,1))}return i}parse(s,t,e,o,r){t=(t=t.replace(/#MRGB/g,"mrgb")).replace(/#.*$/gm,"").trim(),this._loadingOptions.useLegacyBehavior?(this._pushTriangle=(s,t)=>this._triangles.push(s[0],s[t],s[t+1]),this._handednessSign=1):e.useRightHandedSystem?(this._pushTriangle=(s,t)=>this._triangles.push(s[0],s[t+1],s[t]),this._handednessSign=1):(this._pushTriangle=(s,t)=>this._triangles.push(s[0],s[t],s[t+1]),this._handednessSign=-1);const n=t.split("\n"),a=[];let h=[];a.push(h);for(let s=0;s<n.length;s++){const t=n[s].trim().replace(/\s\s/g," ");if(0!==t.length&&"#"!==t.charAt(0))if((g._IsGroupElement(t)||g._IsObjectElement(t))&&(h=[],a.push(h)),g._IsLineElement(t)){const s=t.split(" ");for(let t=1;t<s.length-1;t++)h.push(`l ${s[t]} ${s[t+1]}`)}else h.push(t)}const p=a.flat();for(let s=0;s<p.length;s++){const t=p[s].trim().replace(/\s\s/g," ");let e;if(0!==t.length&&"#"!==t.charAt(0))if(g.VertexPattern.test(t)){if(e=t.match(/[^ ]+/g),this._positions.push(new i.Pq(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))),this._loadingOptions.importVertexColors)if(e.length>=7){const s=parseFloat(e[4]),t=parseFloat(e[5]),i=parseFloat(e[6]);this._colors.push(new l.ov(s>1?s/255:s,t>1?t/255:t,i>1?i/255:i,7===e.length||void 0===e[7]?1:parseFloat(e[7])))}else this._colors.push(this._grayColor)}else if(null!==(e=g.NormalPattern.exec(t)))this._normals.push(new i.Pq(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])));else if(null!==(e=g.UVPattern.exec(t)))this._uvs.push(new i.I9(parseFloat(e[1])*this._loadingOptions.UVScaling.x,parseFloat(e[2])*this._loadingOptions.UVScaling.y));else if(null!==(e=g.FacePattern3.exec(t)))this._setDataForCurrentFaceWithPattern3(e[1].trim().split(" "),1);else if(null!==(e=g.FacePattern4.exec(t)))this._setDataForCurrentFaceWithPattern4(e[1].trim().split(" "),1);else if(null!==(e=g.FacePattern5.exec(t)))this._setDataForCurrentFaceWithPattern5(e[1].trim().split(" "),1);else if(null!==(e=g.FacePattern2.exec(t)))this._setDataForCurrentFaceWithPattern2(e[1].trim().split(" "),1);else if(null!==(e=g.FacePattern1.exec(t)))this._setDataForCurrentFaceWithPattern1(e[1].trim().split(" "),1);else if(null!==(e=g.LinePattern1.exec(t)))this._setDataForCurrentFaceWithPattern1(e[1].trim().split(" "),0),this._hasLineData=!0;else if(null!==(e=g.LinePattern2.exec(t)))this._setDataForCurrentFaceWithPattern2(e[1].trim().split(" "),0),this._hasLineData=!0;else if(e=g._GetZbrushMRGB(t,!this._loadingOptions.importVertexColors))for(const s of e)this._extColors.push(s);else if(null!==(e=g.LinePattern3.exec(t)))this._setDataForCurrentFaceWithPattern3(e[1].trim().split(" "),0),this._hasLineData=!0;else if(g.GroupDescriptor.test(t)||g.ObjectDescriptor.test(t)){const s={name:t.substring(2).trim(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:g.ObjectDescriptor.test(t)};this._addPreviousObjMesh(),this._meshesFromObj.push(s),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(g.UseMtlDescriptor.test(t)){if(this._materialNameFromObj=t.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();const s={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:!1};this._increment++,this._meshesFromObj.push(s),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else g.MtlLibGroupDescriptor.test(t)?r(t.substring(7).trim()):g.SmoothDescriptor.test(t)||F.V.Log("Unhandled expression at line : "+t)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._unwrappedNormalsForBabylon.length&&(this._handledMesh.normals=this._unwrappedNormalsForBabylon),this._unwrappedUVForBabylon.length&&(this._handledMesh.uvs=this._unwrappedUVForBabylon),this._unwrappedColorsForBabylon.length&&(this._handledMesh.colors=this._unwrappedColorsForBabylon),this._handledMesh.hasLines=this._hasLineData),!this._hasMeshes){let s=null;if(this._indicesForBabylon.length)this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData();else{for(const s of this._positions)this._unwrappedPositionsForBabylon.push(s.x,s.y,s.z);if(this._normals.length)for(const s of this._normals)this._unwrappedNormalsForBabylon.push(s.x,s.y,s.z);if(this._uvs.length)for(const s of this._uvs)this._unwrappedUVForBabylon.push(s.x,s.y);if(this._extColors.length)for(const s of this._extColors)this._unwrappedColorsForBabylon.push(s.r,s.g,s.b,s.a);else if(this._colors.length)for(const s of this._colors)this._unwrappedColorsForBabylon.push(s.r,s.g,s.b,s.a);this._materialNameFromObj||(s=new _.F(d.V.RandomId(),e),s.pointsCloud=!0,this._materialNameFromObj=s.name,this._normals.length||(s.disableLighting=!0,s.emissiveColor=l.v9.White()))}this._meshesFromObj.push({name:d.V.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:s,isObject:!0,hasLines:this._hasLineData})}for(let t=0;t<this._meshesFromObj.length;t++){if(s&&this._meshesFromObj[t].name)if(s instanceof Array){if(-1===s.indexOf(this._meshesFromObj[t].name))continue}else if(this._meshesFromObj[t].name!==s)continue;this._handledMesh=this._meshesFromObj[t],e._blockEntityCollection=!!o;const i=new c.e(this._meshesFromObj[t].name,e);if(i._parentContainer=o,e._blockEntityCollection=!1,this._handledMesh._babylonMesh=i,!this._handledMesh.isObject)for(let s=t-1;s>=0;--s)if(this._meshesFromObj[s].isObject&&this._meshesFromObj[s]._babylonMesh){i.parent=this._meshesFromObj[s]._babylonMesh;break}if(this._materialToUse.push(this._meshesFromObj[t].materialName),this._handledMesh.hasLines&&(i._internalMetadata??(i._internalMetadata={}),i._internalMetadata._isLine=!0),0===this._handledMesh.positions?.length){this._babylonMeshesArray.push(i);continue}const r=new u.P;if(r.indices=this._handledMesh.indices,r.positions=this._handledMesh.positions,this._loadingOptions.computeNormals||!this._handledMesh.normals){const s=new Array;u.P.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,s),r.normals=s}else r.normals=this._handledMesh.normals;this._handledMesh.uvs&&(r.uvs=this._handledMesh.uvs),this._handledMesh.colors&&(r.colors=this._handledMesh.colors),r.applyToMesh(i),this._loadingOptions.invertY&&(i.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(i),this._babylonMeshesArray.push(i),this._handledMesh.directMaterial&&(i.material=this._handledMesh.directMaterial)}}}g.ObjectDescriptor=/^o/,g.GroupDescriptor=/^g/,g.MtlLibGroupDescriptor=/^mtllib /,g.UseMtlDescriptor=/^usemtl /,g.SmoothDescriptor=/^s /,g.VertexPattern=/^v(\s+[\d|.|+|\-|e|E]+){3,7}/,g.NormalPattern=/^vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,g.UVPattern=/^vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,g.FacePattern1=/^f\s+(([\d]{1,}[\s]?){3,})+/,g.FacePattern2=/^f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,g.FacePattern3=/^f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,g.FacePattern4=/^f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,g.FacePattern5=/^f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,g.LinePattern1=/^l\s+(([\d]{1,}[\s]?){2,})+/,g.LinePattern2=/^l\s+((([\d]{1,}\/[\d]{1,}[\s]?){2,})+)/,g.LinePattern3=/^l\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){2,})+)/;class b{static get INVERT_TEXTURE_Y(){return p.INVERT_TEXTURE_Y}static set INVERT_TEXTURE_Y(s){p.INVERT_TEXTURE_Y=s}constructor(s){this.name=a.M.name,this.extensions=a.M.extensions,this._assetContainer=null,this._loadingOptions={...b._DefaultLoadingOptions,...s??{}}}static get _DefaultLoadingOptions(){return{computeNormals:b.COMPUTE_NORMALS,optimizeNormals:b.OPTIMIZE_NORMALS,importVertexColors:b.IMPORT_VERTEX_COLORS,invertY:b.INVERT_Y,invertTextureY:b.INVERT_TEXTURE_Y,UVScaling:b.UV_SCALING,materialLoadingFailsSilently:b.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:b.OPTIMIZE_WITH_UV,skipMaterials:b.SKIP_MATERIALS,useLegacyBehavior:b.USE_LEGACY_BEHAVIOR}}_loadMTL(s,t,e,i){const r=t+s;o.S0.LoadFile(r,e,void 0,void 0,!1,(s,t)=>{i(r,t)})}createPlugin(s){return new b(s[a.M.name])}canDirectLoad(){return!1}importMeshAsync(s,t,e,i){return this._parseSolidAsync(s,t,e,i).then(s=>({meshes:s,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}))}loadAsync(s,t,e){return this.importMeshAsync(null,s,t,e).then(()=>{})}loadAssetContainerAsync(s,t,e){const i=new n.WZ(s);return this._assetContainer=i,this.importMeshAsync(null,s,t,e).then(s=>(s.meshes.forEach(s=>i.meshes.push(s)),s.meshes.forEach(s=>{const t=s.material;if(t&&-1==i.materials.indexOf(t)){i.materials.push(t);t.getActiveTextures().forEach(s=>{-1==i.textures.indexOf(s)&&i.textures.push(s)})}}),this._assetContainer=null,i)).catch(s=>{throw this._assetContainer=null,s})}_parseSolidAsync(s,t,e,i){let r="";const n=new p,a=[],l=[];e=e.replace(/#.*$/gm,"").trim();new g(a,l,this._loadingOptions).parse(s,e,t,this._assetContainer,s=>{r=s});const h=[];return""===r||this._loadingOptions.skipMaterials||h.push(new Promise((s,e)=>{this._loadMTL(r,i,h=>{try{n.parseMTL(t,h,i,this._assetContainer);for(let s=0;s<n.materials.length;s++){let t=0;const e=[];let i;for(;(i=a.indexOf(n.materials[s].name,t))>-1;)e.push(i),t=i+1;if(-1===i&&0===e.length)n.materials[s].dispose();else for(let t=0;t<e.length;t++){const i=l[e[t]],o=n.materials[s];i.material=o,i.getTotalIndices()||(o.pointsCloud=!0)}}s()}catch(t){o.S0.Warn(`Error processing MTL file: '${r}'`),this._loadingOptions.materialLoadingFailsSilently?s():e(t)}},(t,i)=>{o.S0.Warn(`Error downloading MTL file: '${r}'`),this._loadingOptions.materialLoadingFailsSilently?s():e(i)})})),Promise.all(h).then(()=>{const s=s=>Boolean(s._internalMetadata?._isLine??!1);return l.forEach(e=>{if(s(e)){let i=e.material??new _.F(e.name+"_line",t);i.getBindedMeshes().filter(t=>!s(t)).length>0&&(i=i.clone(i.name+"_line")??i),i.wireframe=!0,e.material=i,e._internalMetadata&&(e._internalMetadata._isLine=void 0)}}),l})}}b.OPTIMIZE_WITH_UV=!0,b.INVERT_Y=!1,b.IMPORT_VERTEX_COLORS=!1,b.COMPUTE_NORMALS=!1,b.OPTIMIZE_NORMALS=!1,b.UV_SCALING=new i.I9(1,1),b.SKIP_MATERIALS=!1,b.MATERIAL_LOADING_FAILS_SILENTLY=!0,b.USE_LEGACY_BEHAVIOR=!1,(0,r.qS)(new b)}}]);