"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[139],{73794:(e,t,n)=>{n.d(t,{VCFView:()=>r});var i=n(42109),a=n(15287);class r extends a.P{constructor(e){super(e,"vcf")}_buildItemDateTime(e,t,n,i){return this._buildItemText(e,t,n,i)}_buildItemImage(e,t,n,a){const r=this._getName(e,t),s=i.UI.buildTableRow(null,r,a);if("b"===t.encoding){const e=String(t.type).toLowerCase();s.querySelector("td").innerHTML=`<img src="data:image/${e};base64,${a}" />`}if(a.includes("://")){s.querySelector("td").innerHTML=`<a href="${a}">${a}</a>`}return s}_buildItemPhone(e,t,n,i){return this._buildItemText(e,t,n,i)}_buildItemText(e,t,n,a){const r=this._getName(e,t),s={};if(Array.isArray(a)){const t=a.filter(e=>e&&e.length>0);if("adr"===e){let e=a[0]||"",t=a[1]||"",n=a[2]||"",i=a[3]||"",r=a[4]||"",s=a[5]||"",l=a[6]||"";a="",e.length>0&&(a+=e+"\n"),t.length>0&&(a+=t+"\n"),n.length>0&&(a+=n+"\n"),i.length>0&&(r.length>0?(a+=`${i}, ${r}`,s.length>0&&(a+=" "+s),a+="\n"):a+=i+"\n"),i.length<1&&r.length>0&&(a+=r+"\n"),i.length<1&&s.length>0&&(a+=s+"\n"),l.length>0&&(a+=l+"\n"),a.endsWith("\n")&&(a=a.substring(0,a.length-1))}else if("n"===e){let e=a[3]||"",t=a[4]||"",n=a[1]||"",i=a[2]||"",r=a[0]||"";a="",e.length>0&&(a+=e+" "),n.length>0&&(a+=n+" "),i.length>0&&(a+=i+" "),r.length>0&&(a+=r+" "),t.length>0&&(a.length>0&&(a+=", "),a+=t+" "),a=a.trim()}else a=t.join(" ")}a=String(a),"uri"===n&&a.includes("://")?(a=`<a href="${a=i.UI.escapeHTML(a.trim())}">${a}</a>`,s.valueAsHTML=!0):a.includes("\n")?(a=(a=i.UI.escapeHTML(a)).replaceAll("\n","<br>"),s.valueAsHTML=!0):"email"===e&&a.includes("@")&&(a=`<a href="mailto:${a=i.UI.escapeHTML(a.trim())}">${a}</a>`,s.valueAsHTML=!0);return i.UI.buildTableRow(s,r,a)}_getAttributesToIgnore(e){return["rev","version"]}_getName(e,t){const n={adr:{HOME:"Address (Home)",WORK:"Address (Work)",default:"Address"},anniversary:"Anniversary",bday:"Birthday",categories:"Categories",email:{HOME:"Email (Home)",WORK:"Email (Work)",default:"Email"},fn:"Display Name",gender:"Gender",geo:"Geo.",impp:"Instant Messaging",key:"Key",label:{HOME:"Label (Home)",WORK:"Label (Work)",default:"Label"},lang:"Language",logo:"Logo",member:"Member",n:"Name",nickname:"Nickname",note:"Note",org:"Organization",photo:"Photo",prodid:"Created with",related:"Relation",rev:"Last updated",role:"Role",sound:"Sound",tel:{HOME:"Phone (Home)",WORK:"Phone (Work)",default:"Phone"},title:"Title",tz:"Time zone",url:"URL",version:"Version"}[e];if(!n)return e;if("string"==typeof n)return n;let i=t?.type;if(Array.isArray(i))for(let e=0;e<i.length;e++){const t=i[e];if(n[t]){i=t;break}}return"string"==typeof i&&(i=i.toUpperCase()),n[i]||n.default||e}build(e){const t=document.createElement("div");t.className="vcard";let n=null,i=null;for(let a=0;a<e.length;a++){const s=e[a];if(!Array.isArray(s))continue;const l=this._getAttributesToIgnore(s),o=document.createElement("table");let d=!1;for(let e=0;e<s.length;e++){const t=s[e];if(!Array.isArray(t)||t.length<4)continue;const a=t[0],u=t[1]||{},g=String(t[2]).toLowerCase(),c=t[3];if("version"===a?n=c:"rev"===a&&(i=c),l.includes(a))continue;let h=null;switch(g){case"binary":h=r.isImageType(u.type)?this._buildItemImage(a,u,g,c):this._buildItemText(a,u,g,c);break;case"date":case"date-and-or-time":case"date-time":case"time":case"timestamp":h=this._buildItemDateTime(a,u,g,c);break;case"phone-number":h=this._buildItemPhone(a,u,g,c);break;default:h=this._buildItemText(a,u,g,c)}h&&(d=!0,o.append(h))}d&&t.append(o)}return{version:n,node:t,lastUpdated:i}}static isImageType(e){const t=(e=String(e).toLowerCase()).split("/");return e=t[t.length-1],["bmp","gif","jpeg","jpg","png"].includes(e)}async load(){const e=await this.parser.getText(),t=document.createElement("div");t.className="container";const n=await this.parser.parse(e);let i=null,a=null;if(Array.isArray(n)&&n.length>0)if("vcard"===n[0]){const e=this.build(n);i=e.version,a=e.lastUpdated,t.append(e.node)}else n.forEach(e=>{const n=this.build(e);i=n.version,a=n.lastUpdated,t.append(n.node)});i&&this.mdAdd("Version",i),a&&this.mdAdd("Last updated",a),this.buildMetaNode(),this.nodeView.append(t),this._openWindow()}}}}]);