"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[4294,6400],{34294:(e,t,i)=>{i.d(t,{CubeTexture:()=>_});var n=i(75524),s=i(79259),r=i(998),o=i(79923),a=i(56526),l=i(7481),u=i(56552),h=i(99848),d=i(26877);i(69195);class _ extends a.t{set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(o.uq.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(e,t,i){let n="";return e.forEach((e=>n+=e)),new _(n,t,null,i,e)}static CreateFromPrefilteredData(e,t,i=null,n=!0){const s=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;const r=new _(e,t,null,!1,null,null,null,void 0,!0,i,n);return t.useDelayedTextureLoading=s,r}constructor(e,t,i=null,n=!1,s=null,r=null,a=null,u=5,d=!1,_=null,c=!1,f=.8,g=0,p,x){super(t),this.onLoadObservable=new h.cP,this.boundingBoxPosition=o.Pq.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new o.uq,this._buffer=null,this.name=e,this.url=e,this._noMipmap=n,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=o.uq.Identity(),this.coordinatesMode=l.g.CUBIC_MODE;let m=null,y=null;null===i||Array.isArray(i)?(this._noMipmap=n,this._format=u,this._createPolynomials=c,m=i,this._loaderOptions=p,this._useSRGBBuffer=x,this._lodScale=f,this._lodOffset=g):(m=i.extensions??null,this._noMipmap=i.noMipmap??!1,s=i.files??null,y=i.buffer??null,this._format=i.format??5,d=i.prefiltered??!1,_=i.forcedExtension??null,this._createPolynomials=i.createPolynomials??!1,this._lodScale=i.lodScale??.8,this._lodOffset=i.lodOffset??0,this._loaderOptions=i.loaderOptions,this._useSRGBBuffer=i.useSRGBBuffer,r=i.onLoad??null,a=i.onError??null),(e||s)&&this.updateURL(e,_,r,d,a,m,this.getScene()?.useDelayedTextureLoading,s,y)}getClassName(){return"CubeTexture"}updateURL(e,t=null,i=null,n=!1,s=null,r=null,o=!1,a=null,l=null){this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,t&&(this._forcedExtension=t);const u=e.lastIndexOf("."),h=t||(u>-1?e.substring(u).toLowerCase():""),d=0===h.indexOf(".dds"),_=0===h.indexOf(".env"),c=0===h.indexOf(".basis");if(_?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=n,n&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),a)this._files=a;else if(c||_||d||r||(r=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,r){for(let t=0;t<r.length;t++)this._files.push(e+r[t]);this._extensions=r}this._buffer=l,o?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=s):this._loadTexture(i,s)}delayLoad(e){4===this.delayLoadState&&(e&&(this._forcedExtension=e),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(e){if(e.updateFlag===this._textureMatrix.updateFlag)return;if(e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene()?.markAllMaterialsAsDirty(1,(e=>-1!==e.getActiveTextures().indexOf(this))),this._textureMatrix=e,!this.getScene()?.useRightHandedSystem)return;const t=o.AA.Vector3[0],i=o.AA.Quaternion[0],n=o.AA.Vector3[1];this._textureMatrix.decompose(t,i,n),i.z*=-1,i.w*=-1,o.uq.ComposeToRef(t,i,n,this._textureMatrixRefraction)}getRefractionTextureMatrix(){return this.getScene()?.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(e=null,t=null){const i=this.getScene(),n=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const s=()=>{this.onLoadObservable.notifyObservers(this),n&&(n.dispose(),this.getScene()?.markAllMaterialsAsDirty(1)),e&&e()},o=(e,i)=>{this._loadingError=!0,this._errorObject={message:e,exception:i},t&&t(e,i),l.g.OnTextureLoadErrorObservable.notifyObservers(this)};this._texture?this._texture.isReady?r.S0.SetImmediate((()=>s())):this._texture.onLoadedObservable.add((()=>s())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,i,this._lodScale,this._lodOffset,e,o,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,e,o,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),this._texture?.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(e,t,i){const n=d.p.Parse((()=>{let n=!1;return e.prefiltered&&(n=e.prefiltered),new _(i+(e.url??e.name),t,e.extensions,!1,e.files||null,null,null,void 0,n,e.forcedExtension)}),e,t);if(e.boundingBoxPosition&&(n.boundingBoxPosition=o.Pq.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(n.boundingBoxSize=o.Pq.FromArray(e.boundingBoxSize)),e.animations)for(let t=0;t<e.animations.length;t++){const i=e.animations[t],s=(0,u.n9)("BABYLON.Animation");s&&n.animations.push(s.Parse(i))}return n}clone(){let e=0;const t=d.p.Clone((()=>{const t=new _(this.url,this.getScene()||this._getEngine(),this._extensions,this._noMipmap,this._files);return e=t.uniqueId,t}),this);return t.uniqueId=e,t}}(0,n.Cg)([(0,s.lK)()],_.prototype,"url",void 0),(0,n.Cg)([(0,s.P_)()],_.prototype,"boundingBoxPosition",void 0),(0,n.Cg)([(0,s.P_)()],_.prototype,"boundingBoxSize",null),(0,n.Cg)([(0,s.lK)("rotationY")],_.prototype,"rotationY",null),(0,n.Cg)([(0,s.lK)("files")],_.prototype,"_files",void 0),(0,n.Cg)([(0,s.lK)("forcedExtension")],_.prototype,"_forcedExtension",void 0),(0,n.Cg)([(0,s.lK)("extensions")],_.prototype,"_extensions",void 0),(0,n.Cg)([(0,s.GG)("textureMatrix")],_.prototype,"_textureMatrix",void 0),(0,n.Cg)([(0,s.GG)("textureMatrixRefraction")],_.prototype,"_textureMatrixRefraction",void 0),l.g._CubeTextureParser=_.Parse,(0,u.Y5)("BABYLON.CubeTexture",_)},56400:(e,t,i)=>{i.d(t,{EXT_lights_image_based:()=>u});var n=i(77517),s=i(79923),r=i(61094),o=i(45316),a=i(37812);const l="EXT_lights_image_based";class u{constructor(e){this.name=l,this._loader=e,this.enabled=this._loader.isExtensionUsed(l)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights}}loadSceneAsync(e,t){return o.BT.LoadExtensionAsync(e,t,this.name,((i,n)=>{this._loader._allMaterialsDirtyRequired=!0;const s=new Array;s.push(this._loader.loadSceneAsync(e,t)),this._loader.logOpen(`${i}`);const r=o.l2.Get(`${i}/light`,this._lights,n.light);return s.push(this._loadLightAsync(`/extensions/${this.name}/lights/${n.light}`,r).then((e=>{this._loader.babylonScene.environmentTexture=e}))),this._loader.logClose(),Promise.all(s).then((()=>{}))}))}_loadLightAsync(e,t){if(!t._loaded){const i=new Array;this._loader.logOpen(`${e}`);const a=new Array(t.specularImages.length);for(let n=0;n<t.specularImages.length;n++){const s=t.specularImages[n];a[n]=new Array(s.length);for(let t=0;t<s.length;t++){const r=`${e}/specularImages/${n}/${t}`;this._loader.logOpen(`${r}`);const l=s[t],u=o.l2.Get(r,this._loader.gltf.images,l);i.push(this._loader.loadImageAsync(`/images/${l}`,u).then((e=>{a[n][t]=e}))),this._loader.logClose()}}this._loader.logClose(),t._loaded=Promise.all(i).then((()=>{const i=new r.p(this._loader.babylonScene,null,t.specularImageSize);if(i.name=t.name||"environment",t._babylonTexture=i,null!=t.intensity&&(i.level=t.intensity),t.rotation){let e=s.PT.FromArray(t.rotation);this._loader.babylonScene.useRightHandedSystem||(e=s.PT.Inverse(e)),s.uq.FromQuaternionToRef(e,i.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw new Error(`${e}: Irradiance coefficients are missing`);const o=n.O.FromArray(t.irradianceCoefficients);o.scaleInPlace(t.intensity),o.convertIrradianceToLambertianRadiance();const l=n.Q.FromHarmonics(o),u=(a.length-1)/Math.log2(t.specularImageSize);return i.updateRGBDAsync(a,l,u)}))}return t._loaded.then((()=>t._babylonTexture))}}(0,a.Hg)(l),(0,a.Ye)(l,!0,(e=>new u(e)))},61094:(e,t,i)=>{i.d(t,{p:()=>o});var n=i(26877),s=i(55234),r=i(34294);class o extends r.CubeTexture{constructor(e,t,i,n=5,s=0,r=!1,o=!1,a=3,l=null){super("",e),this._texture=e.getEngine().createRawCubeTexture(t,i,n,s,r,o,a,l)}update(e,t,i,n,s=null){this._texture.getEngine().updateRawCubeTexture(this._texture,e,t,i,n,s)}updateRGBDAsync(e,t=null,i=.8,n=0){return(0,s.gW)(this._texture,e,t,i,n).then((()=>{}))}clone(){return n.p.Clone((()=>{const e=this.getScene(),t=this._texture,i=new o(e,t._bufferViewArray,t.width,t.format,t.type,t.generateMipMaps,t.invertY,t.samplingMode,t._compression);return 13===t.source&&i.updateRGBDAsync(t._bufferViewArrayArray,t._sphericalPolynomial,t._lodGenerationScale,t._lodGenerationOffset),i}),this)}}},69195:(e,t,i)=>{var n=i(81194),s=i(51137),r=i(8532),o=i(38688),a=i(32206),l=i(18454),u=i(96789);a.$.prototype._partialLoadFile=function(e,t,i,n,s=null){this._loadFile(e,(e=>{i[t]=e,i._internalCount++,6===i._internalCount&&n(i)}),void 0,void 0,!0,((e,t)=>{s&&e&&s(e.status+" "+e.statusText,t)}))},a.$.prototype._cascadeLoadFiles=function(e,t,i,n=null){const s=[];s._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(i[e],e,s,t,n)},a.$.prototype._cascadeLoadImgs=function(e,t,i,n,s=null,r){const o=[];o._internalCount=0;for(let a=0;a<6;a++)this._partialLoadImg(n[a],a,o,e,t,i,s,r)},a.$.prototype._partialLoadImg=function(e,t,i,n,s,a,l=null,u){const h=(0,o.z)();(0,r.W$)(e,(e=>{i[t]=e,i._internalCount++,n&&n.removePendingData(h),6===i._internalCount&&a&&a(s,i)}),((e,t)=>{n&&n.removePendingData(h),l&&l(e,t)}),n?n.offlineProvider:null,u),n&&n.addPendingData(h)},a.$.prototype.createCubeTextureBase=function(e,t,i,r,o=null,a=null,h,d=null,_=!1,c=0,f=0,g=null,p=null,x=null,m=!1,y=null){const b=g||new n.h(this,7);b.isCube=!0,b.url=e,b.generateMipMaps=!r,b._lodGenerationScale=c,b._lodGenerationOffset=f,b._useSRGBBuffer=!!m&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!r),b!==g&&(b.label=e.substring(0,60)),this._doNotHandleContextLost||(b._extension=d,b._files=i,b._buffer=y);const C=e;this._transformTextureUrl&&!g&&(e=this._transformTextureUrl(e));const S=d??(0,u.r)(e),v=(0,l.gT)(S),T=(n,l)=>{e===C?a&&n&&a(n.status+" "+n.statusText,l):(s.V.Warn(`Failed to load ${e}, falling back to the ${C}`),this.createCubeTextureBase(C,t,i,!!r,o,a,h,d,_,c,f,b,p,x,m,y))};if(v)v.then((n=>{const r=e=>{p&&p(b,e),n.loadCubeData(e,b,_,o,a)};y?r(y):i&&6===i.length?n.supportCascades?this._cascadeLoadFiles(t,(e=>r(e.map((e=>new Uint8Array(e))))),i,a):a?a("Textures type does not support cascades."):s.V.Warn("Texture loader does not support cascades."):this._loadFile(e,(e=>r(new Uint8Array(e))),void 0,void 0,!0,T)}));else{if(!i||0===i.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,b,((e,t)=>{x&&x(e,t)}),i,a)}return this._internalTexturesCache.push(b),b}}}]);