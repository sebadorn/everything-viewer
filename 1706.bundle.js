"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[1706],{62987:(e,t,s)=>{s.d(t,{EMLParser:()=>n});var r=s(38518),a=s(62845);class n extends a.V{constructor(e){super(e),this._lastParsed=null}buildHeadersHTML(e){const t=document.createElement("table");e.forEach(e=>{const s=document.createElement("th");s.className="header-name",s.textContent=e.name;const r=document.createElement("td");r.className="header-value",r.textContent=e.value;const a=document.createElement("tr");a.append(s,r),t.append(a)});const s=document.createElement("div");return s.className="headers",s.append(t),s}async getBodyDOM(e){if(e||(e={}),"boolean"!=typeof e.remove_external&&(e.remove_external=!0),this._lastParsed){let t=r.D.decodeContent(this._lastParsed.body),s=null,a=this.getHeader(this._lastParsed.headers,"content-type")||"";a=a.toLowerCase();let n="plaintext";return a.startsWith("text/html")?(s=r.D.buildDocument(t),n="html"):s=r.D.buildDocument(`<pre>${t}</pre>`),s&&e.remove_external&&r.D.removeExternalResources(s),{type:n,dom:s}}const t=await this.getText();if(this.parse(t),!this._lastParsed)throw new Error("Failed to parse");return this.getBodyDOM(e)}getHeader(e,t){e=e||{};for(const s of e)if(s.name.toLowerCase()===t)return s.value;return null}async getHeadersHTML(){if(this._lastParsed)return this.buildHeadersHTML(this._lastParsed.headers);const e=await this.getText(),t=this.parse(e);return this.buildHeadersHTML(t.headers)}parse(e){this._lastParsed=null;let t=(e=e.trimStart()).split("\r\n\r\n");if(2!==t.length&&(t=e.split("\n\n")),t.length<2)return null;const s=t.splice(0,1)[0].trim(),r={headers:[],body:t.join("\n\n")};let a=null,n=null,l=!0,i=s.split("\r\n");1===i.length&&(i=s.split("\n"));for(const e of i)if(e.startsWith(" ")||e.startsWith("\t")?(n+=e.trimStart(),l=!1):a&&(r.headers.push({name:a,value:n}),l=!0),l){const t=e.split(": ");a=t[0],n=t.slice(1).join(": ")}return a&&r.headers.push({name:a,value:n}),this._lastParsed=r,r}}}}]);