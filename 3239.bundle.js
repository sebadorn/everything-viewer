"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[3239],{63239:(e,t,n)=>{n.d(t,{STLFileLoader:()=>c});var s=n(998),r=n(95616),i=n(85530),a=n(15909),o=n(97762),l=n(71452);n(2093);class c{constructor(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.name=l.W.name,this.extensions=l.W.extensions}importMesh(e,t,n,r,a){let o;if("string"!=typeof n){if(this._isBinary(n)){const e=new i.e("stlmesh",t);return this._parseBinary(e,n),a&&a.push(e),!0}n=(new TextDecoder).decode(new Uint8Array(n))}for(;o=this.solidPattern.exec(n);){let n=o[1];const r=o[3];if(r&&n!=r)return s.S0.Error("Error in STL, solid name != endsolid name"),!1;if(e&&n)if(e instanceof Array){if(!e.indexOf(n))continue}else if(n!==e)continue;n=n||"stlmesh";const l=new i.e(n,t);this._parseASCII(l,o[2]),a&&a.push(l)}return!0}load(e,t,n){return this.importMesh(null,e,t,n,null)}loadAssetContainer(e,t,n){const s=new o.WZ(e);return e._blockEntityCollection=!0,this.importMesh(null,e,t,n,s.meshes),e._blockEntityCollection=!1,s}_isBinary(e){const t=new DataView(e);if(t.byteLength<=80)return!1;if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;const n=[115,111,108,105,100];for(let e=0;e<5;e++)if(t.getUint8(e)!==n[e])return!0;return!1}_parseBinary(e,t){const n=new DataView(t),s=n.getUint32(80,!0);let i=0;const a=new Float32Array(3*s*3),o=new Float32Array(3*s*3),l=new Uint32Array(3*s);let h=0;for(let e=0;e<s;e++){const t=84+50*e,s=n.getFloat32(t,!0),r=n.getFloat32(t+4,!0),u=n.getFloat32(t+8,!0);for(let e=1;e<=3;e++){const l=t+12*e;a[i]=n.getFloat32(l,!0),o[i]=s,c.DO_NOT_ALTER_FILE_COORDINATES?(a[i+1]=n.getFloat32(l+4,!0),a[i+2]=n.getFloat32(l+8,!0),o[i+1]=r,o[i+2]=u):(a[i+2]=n.getFloat32(l+4,!0),a[i+1]=n.getFloat32(l+8,!0),o[i+2]=r,o[i+1]=u),i+=3}c.DO_NOT_ALTER_FILE_COORDINATES?(l[h]=h,l[h+1]=h+2,l[h+2]=h+1,h+=3):(l[h]=h++,l[h]=h++,l[h]=h++)}e.setVerticesData(r.R.PositionKind,a),e.setVerticesData(r.R.NormalKind,o),e.setIndices(l),e.computeWorldMatrix(!0)}_parseASCII(e,t){const n=[],s=[],i=[];let a,o=0;for(;a=this.facetsPattern.exec(t);){const e=a[1],t=this.normalPattern.exec(e);if(this.normalPattern.lastIndex=0,!t)continue;const r=[Number(t[1]),Number(t[5]),Number(t[3])];let l;for(;l=this.vertexPattern.exec(e);)c.DO_NOT_ALTER_FILE_COORDINATES?(n.push(Number(l[1]),Number(l[3]),Number(l[5])),s.push(r[0],r[2],r[1])):(n.push(Number(l[1]),Number(l[5]),Number(l[3])),s.push(r[0],r[1],r[2]));c.DO_NOT_ALTER_FILE_COORDINATES?(i.push(o,o+2,o+1),o+=3):i.push(o++,o++,o++),this.vertexPattern.lastIndex=0}this.facetsPattern.lastIndex=0,e.setVerticesData(r.R.PositionKind,n),e.setVerticesData(r.R.NormalKind,s),e.setIndices(i),e.computeWorldMatrix(!0)}}c.DO_NOT_ALTER_FILE_COORDINATES=!1,(0,a.qS)(new c)}}]);