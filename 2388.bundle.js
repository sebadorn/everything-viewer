"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[2388],{8038:(e,t,r)=>{r.r(t),r.d(t,{cancelLoadAll:()=>v,cancelLoadImage:()=>w,cancelLoadImages:()=>S,createAndCacheDerivedImage:()=>T,createAndCacheDerivedImages:()=>R,createAndCacheDerivedLabelmapImage:()=>L,createAndCacheDerivedLabelmapImages:()=>b,createAndCacheLocalImage:()=>P,loadAndCacheImage:()=>I,loadAndCacheImages:()=>y,loadImage:()=>E,registerImageLoader:()=>N,registerUnknownImageLoader:()=>C,unregisterAllImageLoaders:()=>O});var n=r(95816),a=r(29845),o=r(5186),i=r(50893),s=r(71230),c=r(45630),l=r(62523),u=r(95254),d=r(40497),m=r(74374),g=r(21458);const A={};let f;function h(e,t){const r=n.Ay.getImageLoadObject(e);if(r)return p(r.promise,e),r;const a=e.split(":")[0],o=A[a]||f;if(!o)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${a}'`);const i=o(e,t);return p(i.promise,e),i}function p(e,t){Promise.resolve(e).then(e=>{!function(e){if(!e.voxelManager){const{width:t,height:r,numberOfComponents:n}=e,a=u.A.createImageVoxelManager({scalarData:e.getPixelData(),width:t,height:r,numberOfComponents:n});e.voxelManager=a,e.getPixelData=()=>a.getScalarData(),delete e.imageFrame.pixelData}}(e),(0,c.A)(o.A,a.A.IMAGE_LOADED,{image:e})}).catch(e=>{const r={imageId:t,error:e};(0,c.A)(o.A,a.A.IMAGE_LOAD_FAILED,r)})}function E(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");return h(e,t).promise}function I(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const r=h(e,t);return n.Ay.getImageLoadObject(e)||n.Ay.putImageLoadObject(e,r),r.promise}function y(e,t={priority:0,requestType:"prefetch"}){if(!e||0===e.length)throw new Error("loadAndCacheImages: parameter imageIds must be list of image Ids");return e.map(e=>I(e,t))}function T(e,t={}){if(void 0===e)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");void 0===t.imageId&&(t.imageId=`derived:${(0,l.A)()}`);const{imageId:r,skipCreateBuffer:a,onCacheAdd:o,voxelRepresentation:c}=t,u=m.get("imagePlaneModule",e),d=u.rows*u.columns,{TypedArrayConstructor:g}=(0,s.h)(t.targetBuffer?.type,d),A=new g(a?1:d),f=r,h=m.get("imagePlaneModule",e);i.A.add(f,{type:"imagePlaneModule",metadata:h});const p=m.get("generalSeriesModule",e);i.A.add(f,{type:"generalSeriesModule",metadata:p}),i.A.add(f,{type:"generalImageModule",metadata:{instanceNumber:t.instanceNumber}});const E=m.get("imagePixelModule",e);i.A.add(f,{type:"imagePixelModule",metadata:{...E,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const I=P(r,{scalarData:A,onCacheAdd:o,skipCreateBuffer:a,targetBuffer:{type:A.constructor.name},voxelRepresentation:c,dimensions:[u.columns,u.rows],spacing:[u.columnPixelSpacing,u.rowPixelSpacing],origin:u.imagePositionPatient,direction:u.imageOrientationPatient,frameOfReferenceUID:u.frameOfReferenceUID,referencedImageId:e});return I.referencedImageId=e,n.Ay.getImageLoadObject(r)||n.Ay.putImageSync(r,I),I}function R(e,t={}){if(0===e.length)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");const r=[];return e.map((e,n)=>{const a={imageId:t?.getDerivedImageId?.(e)||`derived:${(0,l.A)()}`,...t};return r.push(a.imageId),T(e,{...a,instanceNumber:n+1})})}function P(e,t){const{scalarData:r,origin:a,direction:o,targetBuffer:c,skipCreateBuffer:l,onCacheAdd:d,frameOfReferenceUID:m,voxelRepresentation:A,referencedImageId:f}=t,h=t.dimensions,p=t.spacing;if(!h||!p)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const E=h[0],I=h[1],y=p[0],T=p[1],R={frameOfReferenceUID:m,rows:I,columns:E,imageOrientationPatient:o??[1,0,0,0,1,0],rowCosines:o?o.slice(0,3):[1,0,0],columnCosines:o?o.slice(3,6):[0,1,0],imagePositionPatient:a??[0,0,0],pixelSpacing:[T,y],rowPixelSpacing:T,columnPixelSpacing:y},P=E*I,w=r.length/P;let S,v,N,C;if(r){if(!(r instanceof Uint8Array||r instanceof Float32Array||r instanceof Uint16Array||r instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");S=r}else if(!l){const{TypedArrayConstructor:e}=(0,s.h)(c?.type,P);S=new e(P)}if(S instanceof Uint8Array)v=8,N=8,C=7;else if(S instanceof Uint16Array)v=16,N=16,C=15;else if(S instanceof Int16Array)v=16,N=16,C=15;else{if(!(S instanceof Float32Array))throw new Error("Unsupported scalarData type");v=32,N=32,C=31}const O={samplesPerPixel:1,photometricInterpretation:S.length>h[0]*h[1]?"RGB":"MONOCHROME2",rows:I,columns:E,bitsAllocated:v,bitsStored:N,highBit:C},b={imagePlaneModule:R,imagePixelModule:O};["imagePlaneModule","imagePixelModule"].forEach(t=>{i.A.add(e,{type:t,metadata:b[t]||{}})});const L=e,M=A===g.A.RLE&&u.A.createRLEImageVoxelManager({dimensions:h,id:L})||u.A.createImageVoxelManager({height:I,width:E,numberOfComponents:w,scalarData:S,id:L});let D=S[0],x=S[0];for(let e=1;e<S.length;e++)S[e]<D&&(D=S[e]),S[e]>x&&(x=S[e]);const _={imageId:e,intercept:0,windowCenter:0,windowWidth:0,color:"RGB"===O.photometricInterpretation,numberOfComponents:O.samplesPerPixel,dataType:c?.type,slope:1,minPixelValue:D,maxPixelValue:x,rows:O.rows,columns:O.columns,getCanvas:void 0,height:O.rows,width:O.columns,rgba:void 0,columnPixelSpacing:R.columnPixelSpacing,rowPixelSpacing:R.rowPixelSpacing,FrameOfReferenceUID:R.frameOfReferenceUID,invert:!1,getPixelData:()=>M.getScalarData(),voxelManager:M,sizeInBytes:r.byteLength,referencedImageId:f};return d?.(_),n.Ay.putImageSync(_.imageId,_),_}function w(e){d.A.filterRequests(({additionalDetails:t})=>!t.imageId||t.imageId!==e);const t=n.Ay.getImageLoadObject(e);t&&t.cancelFn()}function S(e){e.forEach(e=>{w(e)})}function v(){const e=d.A.getRequestPool();Object.keys(e).forEach(t=>{const r=e[t];Object.keys(r).forEach(e=>{const t=r[e].pop();if(!t)return;const a=t.additionalDetails,{imageId:o,volumeId:i}=a;let s;o?s=n.Ay.getImageLoadObject(o):i&&(s=n.Ay.getVolumeLoadObject(i)),s&&s.cancel()}),d.A.clearRequestStack(t)})}function N(e,t){A[e]=t}function C(e){const t=f;return f=e,t}function O(){Object.keys(A).forEach(e=>delete A[e]),f=void 0}function b(e,t={}){return R(e,{...t,targetBuffer:{type:"Uint8Array"}})}function L(e,t={}){return T(e,{...t,targetBuffer:{type:"Uint8Array"}})}},9252:(e,t,r)=>{var n;r.d(t,{A:()=>a}),function(e){e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e[e.FAST_LINEAR=2]="FAST_LINEAR"}(n||(n={}));const a=n},14590:(e,t,r)=>{r.d(t,{A2:()=>o,BX:()=>y,LV:()=>m,p:()=>u});
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
const n=Symbol("Comlink.proxy"),a=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),i=Symbol("Comlink.finalizer"),s=Symbol("Comlink.thrown"),c=e=>"object"==typeof e&&null!==e||"function"==typeof e,l=new Map([["proxy",{canHandle:e=>c(e)&&e[n],serialize(e){const{port1:t,port2:r}=new MessageChannel;return u(e,t),[r,[r]]},deserialize:e=>(e.start(),m(e))}],["throw",{canHandle:e=>c(e)&&s in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function u(e,t=globalThis,r=["*"]){t.addEventListener("message",function n(a){if(!a||!a.data)return;if(!function(e,t){for(const r of e){if(t===r||"*"===r)return!0;if(r instanceof RegExp&&r.test(t))return!0}return!1}(r,a.origin))return void console.warn(`Invalid origin '${a.origin}' for comlink proxy`);const{id:o,type:c,path:l}=Object.assign({path:[]},a.data),m=(a.data.argumentList||[]).map(R);let g;try{const t=l.slice(0,-1).reduce((e,t)=>e[t],e),r=l.reduce((e,t)=>e[t],e);switch(c){case"GET":g=r;break;case"SET":t[l.slice(-1)[0]]=R(a.data.value),g=!0;break;case"APPLY":g=r.apply(t,m);break;case"CONSTRUCT":g=y(new r(...m));break;case"ENDPOINT":{const{port1:t,port2:r}=new MessageChannel;u(e,r),g=function(e,t){return I.set(e,t),e}(t,[t])}break;case"RELEASE":g=void 0;break;default:return}}catch(e){g={value:e,[s]:0}}Promise.resolve(g).catch(e=>({value:e,[s]:0})).then(r=>{const[a,s]=T(r);t.postMessage(Object.assign(Object.assign({},a),{id:o}),s),"RELEASE"===c&&(t.removeEventListener("message",n),d(t),i in e&&"function"==typeof e[i]&&e[i]())}).catch(e=>{const[r,n]=T({value:new TypeError("Unserializable return value"),[s]:0});t.postMessage(Object.assign(Object.assign({},r),{id:o}),n)})}),t.start&&t.start()}function d(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function m(e,t){const r=new Map;return e.addEventListener("message",function(e){const{data:t}=e;if(!t||!t.id)return;const n=r.get(t.id);if(n)try{n(t)}finally{r.delete(t.id)}}),p(e,r,[],t)}function g(e){if(e)throw new Error("Proxy has been released and is not useable")}function A(e){return P(e,new Map,{type:"RELEASE"}).then(()=>{d(e)})}const f=new WeakMap,h="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(f.get(e)||0)-1;f.set(e,t),0===t&&A(e)});function p(e,t,r=[],n=function(){}){let i=!1;const s=new Proxy(n,{get(n,a){if(g(i),a===o)return()=>{!function(e){h&&h.unregister(e)}(s),A(e),t.clear(),i=!0};if("then"===a){if(0===r.length)return{then:()=>s};const n=P(e,t,{type:"GET",path:r.map(e=>e.toString())}).then(R);return n.then.bind(n)}return p(e,t,[...r,a])},set(n,a,o){g(i);const[s,c]=T(o);return P(e,t,{type:"SET",path:[...r,a].map(e=>e.toString()),value:s},c).then(R)},apply(n,o,s){g(i);const c=r[r.length-1];if(c===a)return P(e,t,{type:"ENDPOINT"}).then(R);if("bind"===c)return p(e,t,r.slice(0,-1));const[l,u]=E(s);return P(e,t,{type:"APPLY",path:r.map(e=>e.toString()),argumentList:l},u).then(R)},construct(n,a){g(i);const[o,s]=E(a);return P(e,t,{type:"CONSTRUCT",path:r.map(e=>e.toString()),argumentList:o},s).then(R)}});return function(e,t){const r=(f.get(t)||0)+1;f.set(t,r),h&&h.register(e,t,e)}(s,e),s}function E(e){const t=e.map(T);return[t.map(e=>e[0]),(r=t.map(e=>e[1]),Array.prototype.concat.apply([],r))];var r}const I=new WeakMap;function y(e){return Object.assign(e,{[n]:!0})}function T(e){for(const[t,r]of l)if(r.canHandle(e)){const[n,a]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},a]}return[{type:"RAW",value:e},I.get(e)||[]]}function R(e){switch(e.type){case"HANDLER":return l.get(e.name).deserialize(e.value);case"RAW":return e.value}}function P(e,t,r,n){return new Promise(a=>{const o=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.set(o,a),e.start&&e.start(),e.postMessage(Object.assign({id:o},r),n)})}},21458:(e,t,r)=>{var n;r.d(t,{A:()=>a}),function(e){e.RLE="RLE",e.Volume="Volume"}(n||(n={}));const a=n},32586:(e,t,r)=>{var n;r.d(t,{A:()=>a}),function(e){e.Tiled="tiled",e.ContextPool="contextPool"}(n||(n={}));const a=n},34664:(e,t,r)=>{r.d(t,{lk:()=>C,up:()=>N,D0:()=>L,LH:()=>O,G_:()=>M,Ts:()=>v,Dh:()=>b,a:()=>D});const n=e=>e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e),a=(e,t)=>{return t&&!0===t.clone&&n(e)?i((r=e,Array.isArray(r)?[]:{}),e,t):e;var r},o=(e,t,r)=>{const o=e.slice();return t.forEach(function(t,s){void 0===o[s]?o[s]=a(t,r):n(t)?o[s]=i(e[s],t,r):-1===e.indexOf(t)&&(o[s]=a(t,r))}),o},i=(e={},t={},r=void 0)=>{const s=Array.isArray(t),c=(r||{arrayMerge:o}).arrayMerge||o;return s?Array.isArray(e)?c(e,t,r):a(t,r):((e,t,r)=>{const o={};return n(e)&&Object.keys(e).forEach(function(t){o[t]=a(e[t],r)}),Object.keys(t).forEach(function(s){n(t[s])&&e[s]?o[s]=i(e[s],t[s],r):o[s]=a(t[s],r)}),o})(e,t,r)},s=i;var c=r(14590),l=r(53871),u=r(49313);const d=class{constructor(){this.workerRegistry={},this.workerPoolManager=new u.R("webworker")}registerWorker(e,t,r={}){const{maxWorkerInstances:n=1,overwrite:a=!1,autoTerminateOnIdle:o={enabled:!1,idleTimeThreshold:3e3}}=r;if(this.workerRegistry[e]&&!a)return void console.warn(`Worker type '${e}' is already registered...`);a&&this.workerRegistry[e]?.idleCheckIntervalId&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const i={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:o.enabled,idleCheckIntervalId:null,idleTimeThreshold:o.idleTimeThreshold};i.loadCounters=Array(n).fill(0),i.lastActiveTime=Array(n).fill(null);for(let e=0;e<n;e++){const e=t();i.instances.push(c.LV(e)),i.nativeWorkers.push(e),i.workerFn=t}this.workerRegistry[e]=i}getNextWorkerAPI(e){const t=this.workerRegistry[e];if(!t)return console.error(`Worker type '${e}' is not registered.`),null;const r=t.instances.filter(e=>null!==e);let n=0,a=t.loadCounters[0]||0;for(let e=1;e<r.length;e++){const r=t.loadCounters[e]||0;r<a&&(n=e,a=r)}if(null===t.instances[n]){const e=t.workerFn();t.instances[n]=c.LV(e),t.nativeWorkers[n]=e}return t.loadCounters[n]+=1,{api:t.instances[n],index:n}}executeTask(e,t,r={},{requestType:n=l.A.Compute,priority:a=0,options:o={},callbacks:i=[]}={}){return new Promise((s,l)=>{this.workerPoolManager.addRequest(async()=>{const{api:n,index:a}=this.getNextWorkerAPI(e);if(!n){const t=new Error(`No available worker instance for '${e}'`);return console.error(t),void l(t)}try{let o=[];i.length&&(o=i.map(e=>c.BX(e)));const l=this.workerRegistry[e];l.processing=!0;const u=await n[t](r,...o);l.processing=!1,l.lastActiveTime[a]=Date.now(),l.autoTerminateOnIdle&&!l.idleCheckIntervalId&&l.idleTimeThreshold&&(l.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,l.idleTimeThreshold)},l.idleTimeThreshold)),s(u)}catch(r){console.error(`Error executing method '${t}' on worker '${e}':`,r),l(r)}finally{this.workerRegistry[e].loadCounters[a]--}},n,o,a)})}terminateIdleWorkers(e,t){const r=this.workerRegistry[e];if(r.processing)return;const n=Date.now();r.instances.forEach((a,o)=>{const i=r.lastActiveTime[o];!(null!==i&&r.loadCounters[o]>0)&&n-i>t&&this.terminateWorkerInstance(e,o)})}terminate(e){const t=this.workerRegistry[e];t?t.instances.forEach((t,r)=>{this.terminateWorkerInstance(e,r)}):console.error(`Worker type '${e}' is not registered.`)}terminateWorkerInstance(e,t){const r=this.workerRegistry[e],n=r.instances[t];null!==n&&(n[c.A2](),r.nativeWorkers[t].terminate(),r.instances[t]=null,r.lastActiveTime[t]=null)}},m=4,g=5,A=1,f=[1,1];function h({ext:e,filterType:t,texData:r,internalFormat:n,glDataType:a}){try{const o=document.createElement("canvas");o.width=m,o.height=m;const i=o.getContext("webgl2");if(!i)return!1;const s=`#version 300 es\n    void main() {\n      gl_PointSize = ${m.toFixed(1)};\n      gl_Position = vec4(0, 0, 0, 1);\n    }\n  `,c="#version 300 es\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n\n    uniform sampler2D u_image;\n\n    out vec4 color;\n\n    void main() {\n        vec4 intColor = texture(u_image, gl_PointCoord.xy);\n        color = vec4(vec3(intColor.rrr), 1);\n    }\n    ";let l;if(e&&(l=i.getExtension(e),!l))return!1;const u=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(u,s),i.compileShader(u),!i.getShaderParameter(u,i.COMPILE_STATUS))return!1;const d=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(d,c),i.compileShader(d),!i.getShaderParameter(d,i.COMPILE_STATUS))return!1;const h=i.createProgram();if(i.attachShader(h,u),i.attachShader(h,d),i.linkProgram(h),!i.getProgramParameter(h,i.LINK_STATUS))return!1;const p=i.createTexture();i.bindTexture(i.TEXTURE_2D,p),i.texImage2D(i.TEXTURE_2D,0,n(i,l),g,A,0,i.RED,a(i,l),r);const E="LINEAR"===t?i.LINEAR:i.NEAREST;i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,E),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,E),i.useProgram(h),i.drawArrays(i.POINTS,0,1);const I=new Uint8Array(4);i.readPixels(f[0],f[1],1,1,i.RGBA,i.UNSIGNED_BYTE,I);const[y,T,R]=I,P=i.getExtension("WEBGL_lose_context");return P&&P.loseContext(),y===T&&T===R&&0!==y}catch(e){return!1}}var p=r(32586);let E=!1;const I={gpuTier:{tier:2},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,useLegacyCameraFOV:!1,strictZSpacingForVolumeViewport:!0,renderingEngineMode:p.A.ContextPool,webGlContextCount:7,volumeRendering:{sampleDistanceMultiplier:1}},debug:{statsOverlay:!1},peerImport:e=>null};let y={...I,rendering:{...I.rendering}},T=null,R=!1;function P(){const e=function(){const e=document.createElement("canvas");return e.getContext("webgl2")||e.getContext("webgl")||e.getContext("experimental-webgl")}();return e instanceof WebGLRenderingContext||e instanceof WebGL2RenderingContext}function w(){const e=function(){const e=new Int16Array([32767,2e3,3e3,4e3,5e3,16784,7e3,8e3,9e3,32767]);return{norm16:h({ext:"EXT_texture_norm16",filterType:"NEAREST",texData:e,internalFormat:(e,t)=>t.R16_SNORM_EXT,glDataType:e=>e.SHORT}),norm16Linear:h({ext:"EXT_texture_norm16",filterType:"LINEAR",texData:e,internalFormat:(e,t)=>t.R16_SNORM_EXT,glDataType:e=>e.SHORT})}}();return e.norm16&&e.norm16Linear}function S(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")}function v(e=y){if(E)return E;R=w(),y=s(I,e),y.isMobile&&(y.rendering.webGlContextCount=1),S()&&(e.rendering?.preferSizeOverAccuracy?y.rendering.preferSizeOverAccuracy=!0:console.log("norm16 texture not supported, you can turn on the preferSizeOverAccuracy flag to use native data type, but be aware of the inaccuracy of the rendering in high bits"));return P()?console.log("CornerstoneRender: using GPU rendering"):(console.log("CornerstoneRender: GPU not detected, using CPU rendering"),y.rendering.useCPURendering=!0),E=!0,T||(T=new d),E}function N(){return R}function C(){return!S()}function O(){return y.rendering.useCPURendering}function b(){return E}function L(){return y}function M(){return T||(T=new d),T}async function D(e){return y.peerImport(e)}},40497:(e,t,r)=>{r.d(t,{A:()=>i});var n=r(49313),a=r(53871);const o=new n.R("imageLoadPool");o.grabDelay=0,o.setMaxSimultaneousRequests(a.A.Interaction,1e3),o.setMaxSimultaneousRequests(a.A.Thumbnail,1e3),o.setMaxSimultaneousRequests(a.A.Prefetch,1e3);const i=o},49313:(e,t,r)=>{r.d(t,{R:()=>o});var n=r(53871),a=r(62523);class o{constructor(e){this.numRequests={[n.A.Interaction]:0,[n.A.Thumbnail]:0,[n.A.Prefetch]:0,[n.A.Compute]:0},this.id=e||(0,a.A)(),this.requestPool={[n.A.Interaction]:{0:[]},[n.A.Thumbnail]:{0:[]},[n.A.Prefetch]:{0:[]},[n.A.Compute]:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={[n.A.Interaction]:0,[n.A.Thumbnail]:0,[n.A.Prefetch]:0,[n.A.Compute]:0},this.maxNumRequests={[n.A.Interaction]:6,[n.A.Thumbnail]:6,[n.A.Prefetch]:5,[n.A.Compute]:1e3}}setMaxSimultaneousRequests(e,t){this.maxNumRequests[e]=t}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,t,r,n=0){const a={requestFn:e,type:t,additionalDetails:r};void 0===this.requestPool[t][n]&&(this.requestPool[t][n]=[]),this.requestPool[t][n].push(a),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(t=>{const r=this.requestPool[t];Object.keys(r).forEach(t=>{r[t]=r[t].filter(t=>e(t))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const t=this.maxNumRequests[e]-this.numRequests[e];let r=0;for(let n=0;n<t;n++){const t=this.getNextRequest(e);if(null===t)return!1;if(t){let n;this.numRequests[e]++,this.awake=!0;try{n=t.requestFn()}catch(e){console.warn("sendRequest failed",e)}n?.finally?n.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,r++)}}return r&&this.startAgain(),!0}getNextRequest(e){const t=this.getSortedPriorityGroups(e);for(const r of t)if(this.requestPool[e][r].length)return this.requestPool[e][r].shift();return null}startGrabbing(){const e=this.sendRequests(n.A.Interaction),t=this.sendRequests(n.A.Thumbnail),r=this.sendRequests(n.A.Prefetch),a=this.sendRequests(n.A.Compute);e||t||r||a||(this.awake=!1)}startAgain(){this.awake&&(void 0!==this.grabDelay?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(t=>this.requestPool[e][t].length).sort((e,t)=>e-t)}getRequestPool(){return this.requestPool}}},53871:(e,t,r)=>{var n;r.d(t,{A:()=>a}),function(e){e.Interaction="interaction",e.Thumbnail="thumbnail",e.Prefetch="prefetch",e.Compute="compute"}(n||(n={}));const a=n},56020:(e,t,r)=>{r.r(t),r.d(t,{BlendModes:()=>u,CalibrationTypes:()=>R,ContourType:()=>f,DynamicOperatorType:()=>y,Events:()=>n.A,GenerateImageType:()=>P,GeometryType:()=>g,ImageQualityStatus:()=>S.A,InterpolationType:()=>i.A,MeshType:()=>p,MetadataModules:()=>N.A,OrientationAxis:()=>m.A,RenderingEngineModeEnum:()=>O.A,RequestType:()=>a.A,VOILUTFunctionType:()=>I.A,VideoEnums:()=>v,ViewportStatus:()=>w.A,ViewportType:()=>o.A,VoxelManagerEnum:()=>C.A});var n=r(29845),a=r(53871),o=r(96630),i=r(9252),s=r(87271);const{BlendMode:c}=s.Ay;var l;!function(e){e[e.COMPOSITE=c.COMPOSITE_BLEND]="COMPOSITE",e[e.MAXIMUM_INTENSITY_BLEND=c.MAXIMUM_INTENSITY_BLEND]="MAXIMUM_INTENSITY_BLEND",e[e.MINIMUM_INTENSITY_BLEND=c.MINIMUM_INTENSITY_BLEND]="MINIMUM_INTENSITY_BLEND",e[e.AVERAGE_INTENSITY_BLEND=c.AVERAGE_INTENSITY_BLEND]="AVERAGE_INTENSITY_BLEND",e[e.LABELMAP_EDGE_PROJECTION_BLEND=c.LABELMAP_EDGE_PROJECTION_BLEND]="LABELMAP_EDGE_PROJECTION_BLEND"}(l||(l={}));const u=l;var d,m=r(65705);!function(e){e.CONTOUR="CONTOUR",e.SURFACE="SURFACE",e.MESH="MESH"}(d||(d={}));const g=d;var A;!function(e){e.CLOSED_PLANAR="CLOSED_PLANAR",e.OPEN_PLANAR="OPEN_PLANAR"}(A||(A={}));const f=A;var h;!function(e){e.PLY="PLY",e.STL="STL",e.OBJ="OBJ",e.VTP="VTP"}(h||(h={}));const p=h;var E,I=r(59127);!function(e){e.SUM="SUM",e.AVERAGE="AVERAGE",e.SUBTRACT="SUBTRACT"}(E||(E={}));const y=E;var T;!function(e){e.NOT_APPLICABLE="",e.ERMF="ERMF",e.USER="User",e.PROJECTION="Proj",e.REGION="Region",e.ERROR="Error",e.UNCALIBRATED="Uncalibrated",e.CALIBRATED="Calibrated",e.UNKNOWN="Unknown"}(T||(T={}));const R=T;var P,w=r(69116),S=r(33700),v=r(81231),N=r(14916);!function(e){e.SUM="SUM",e.SUBTRACT="SUBTRACT",e.AVERAGE="AVERAGE"}(P||(P={}));var C=r(21458),O=r(32586)},62523:(e,t,r)=>{function n(){return"function"==typeof crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}r.d(t,{A:()=>n})},65705:(e,t,r)=>{var n;r.d(t,{A:()=>a}),function(e){e.AXIAL="axial",e.CORONAL="coronal",e.SAGITTAL="sagittal",e.ACQUISITION="acquisition",e.AXIAL_REFORMAT="axial_reformat",e.CORONAL_REFORMAT="coronal_reformat",e.SAGITTAL_REFORMAT="sagittal_reformat",e.REFORMAT="reformat"}(n||(n={}));const a=n},69116:(e,t,r)=>{var n;r.d(t,{A:()=>a}),function(e){e.NO_DATA="noData",e.LOADING="loading",e.PRE_RENDER="preRender",e.RESIZE="resize",e.RENDERED="rendered"}(n||(n={}));const a=n},71230:(e,t,r)=>{function n(e,t){switch(e){case"Float32Array":return Float32Array;case"Uint8Array":return Uint8Array;case"Uint32Array":return Uint32Array;case"Uint16Array":case"Int16Array":return t?(console.debug(`${e} is not supported for volume rendering, switching back to Float32Array`),Float32Array):"Uint16Array"===e?Uint16Array:Int16Array;default:if(e)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, Int16Array, or Uint32Array");return Float32Array}}function a(e,t,r={}){const{isVolumeBuffer:a=!1}=r,o=n(e,a);return{numBytes:t*o.BYTES_PER_ELEMENT,TypedArrayConstructor:o}}r.d(t,{h:()=>a,j:()=>n})},81231:(e,t,r)=>{var n;r.r(t),r.d(t,{SpeedUnit:()=>n}),function(e){e.FRAME="f",e.SECOND="s"}(n||(n={}))},87271:(e,t,r)=>{r.d(t,{Ay:()=>a,Nx:()=>n});const n={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6};var a={BlendMode:n,FilterMode:{OFF:0,NORMALIZED:1,RAW:2}}},96630:(e,t,r)=>{var n;r.d(t,{A:()=>a}),function(e){e.STACK="stack",e.ORTHOGRAPHIC="orthographic",e.PERSPECTIVE="perspective",e.VOLUME_3D="volume3d",e.VIDEO="video",e.WHOLE_SLIDE="wholeSlide"}(n||(n={}));const a=n}}]);