(()=>{"use strict";var e,t,n,i,s={},a={};function r(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={id:e,loaded:!1,exports:{}};return s[e].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}r.m=s,r.amdD=function(){throw new Error("define cannot be used indirect")},r.amdO={},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"==typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"==typeof n.then)return n}var s=Object.create(null);r.r(s);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&i&&n;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>a[e]=()=>n[e]));return a.default=()=>n,r.d(s,a),s},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>e+".bundle.js",r.miniCssF=e=>{},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},i="everything-viewer:",r.l=(e,t,s,a)=>{if(n[e])n[e].push(t);else{var o,l;if(void 0!==s)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var h=d[c];if(h.getAttribute("src")==e||h.getAttribute("data-webpack")==i+s){o=h;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,r.nc&&o.setAttribute("nonce",r.nc),o.setAttribute("data-webpack",i+s),o.src=e),n[e]=[t];var u=(t,i)=>{o.onerror=o.onload=null,clearTimeout(m);var s=n[e];if(delete n[e],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach((e=>e(i))),t)return t(i)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=n[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{r.b=document.baseURI||self.location.href;var e={411:0};r.f.j=(t,n)=>{var i=r.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var s=new Promise(((n,s)=>i=e[t]=[n,s]));n.push(i[2]=s);var a=r.p+r.u(t),o=new Error;r.l(a,(n=>{if(r.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var s=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,i[1](o)}}),"chunk-"+t,t)}};var t=(t,n)=>{var i,s,[a,o,l]=n,d=0;if(a.some((t=>0!==e[t]))){for(i in o)r.o(o,i)&&(r.m[i]=o[i]);if(l)l(r)}for(t&&t(n);d<a.length;d++)s=a[d],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0},n=self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();class o{constructor(e){this._events={},e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(e=>{e.preventDefault(),this._handleDropped(e.dataTransfer)}))}_handleDirectory(e){console.log("[DropHandler._handleDirectory] Directory dropped: "+e.name);const t=this._events.directory;Array.isArray(t)&&t.forEach((t=>t(e)))}_handleDropped(e){if(e.items){const t=e.items[0];if(t&&"file"===t.kind)if("function"==typeof t.webkitGetAsEntry){const e=t.webkitGetAsEntry();e.isFile?this._handleFile(t.getAsFile()):e.isDirectory&&this._handleDirectory(e)}else console.warn('[DropHandler._handleDropped] Method "webkitGetAsEntry" not supported by browser. Cannot support directories.'),this._handleFile(t.getAsFile())}else if(e.files){console.warn('[DropHandler._handleDropped] DataTransfer has no attribute "items", using fallback on "files".');const t=e.files[0];t&&this._handleFile(t)}else console.error('[DropHandler._handleDropped] DataTransfer has neither "items" nor "files" attribute.',e)}_handleFile(e){console.log("[DropHandler._handleFile] File dropped: "+e.name);const t=this._events.file;Array.isArray(t)&&t.forEach((t=>t(e)))}on(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}}const l={extToMimeType(e){if(!e)return null;return{csv:"text/csv",ical:"text/calendar",ics:"text/calendar",ifb:"text/calendar",vcf:"text/vcard",vcs:"text/calendar"}[e=e.toLowerCase().trim()]||null},getFileExt:e=>e.name.split(".").pop().toLowerCase(),async getMimeType(e){const t=await e.slice(0,348).arrayBuffer(),n=new Uint8Array(t).reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),""),i=e.type||this.extToMimeType(this.getFileExt(e));let s=this.headerToMimeType(n,i);return"string"==typeof s&&(s=s.toLowerCase()),s},headerToMimeType(e,t=null){let n=null,i=e.substring(0,8);switch(i){case"47494638":n="image/gif";break;case"89504e47":n="image/png";break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":n="image/jpeg"}return!n&&e.length>8&&("4449434d"===e.substring(256,264)?(i="4449434d",n="application/dicom"):"6e2b31"===e.substring(688,694)&&(i="6e2b3100",n="application/octet-stream")),n?console.log(`[FileHandler.headerToMimeType] "${i}" -> ${n}`):t?(n=t,console.log(`[FileHandler.headerToMimeType] Using "${n}" based on extension.`)):(i.startsWith("2321")?n="application/x-shellscript":i.startsWith("efbbbf")||i.startsWith("feff")||i.startsWith("fffe")||i.startsWith("0000feff")||i.startsWith("2b2f7638")||i.startsWith("2b2f7639")||i.startsWith("2b2f762b")||i.startsWith("2b2f762f")?n="text/plain":(i.startsWith("504b34")||i.startsWith("504b0304")||i.startsWith("504b0506"))&&(n="application/zip"),n&&console.log(`[FileHandler.headerToMimeType] Guessing "${i}" -> ${n}`)),n||console.log(`[FileHandler.headerToMimeType] Failed to find MIME type for header "${i}".`),n},isTypeText(e,t,n){if(e=String(e||""),t=String(t||""),n=String(n||""),e.startsWith("text/")||e.startsWith("message/"))return!0;if(["application/json","application/x-javascript","application/x-php","application/x-python","application/x-shellscript","application/x-yaml"].includes(e))return!0;if(["authors","changelog","contributors","copying","install","license","makefile","readme","todo"].includes(n))return!0;return!!["cfg","dart","frag","glsl","in","ini","less","proto","vert"].includes(t)||("bat"===t&&"application/x-msdos-program"===e||!!(n.length>1&&n.startsWith(".")))}};class d{constructor(e,t=!1){this.file=e.file||e.fileList,this.mimeType=e.mimeType,this.isDir=t}destroy(){}detectLanguage(){const e=l.getFileExt(this.file);if(["c","cc","cpp","cmake","css","scss","dart","diff","glsl","htm","html","ini","java","js","json","less","php","sh","tex","vb","xml","yaml","yml","zone"].includes(e))return e;const t={arb:"json",frag:"glsl",gitignore:"ini",h:"cpp",in:"cpp",jshintrc:"json",md:"markdown",py:"python",ts:"typescript",tsx:"typescript",vert:"glsl"};if(t[e])return t[e];const n={"application/x-shellscript":"sh"};if(n[this.mimeType])return n[this.mimeType];const i=this.file.name.toLowerCase();return[".gitconfig",".gitmodules"].includes(i)?"ini":"cmakelists.txt"===i?"cmake":"makefile"===i?"make":null}getArrayBuffer(e){this.file.arrayBuffer().then((t=>e(null,t))).catch((t=>{console.error(t),e(t,null)}))}getText(e){this.file.text().then((t=>e(null,t))).catch((t=>{console.error(t),e(t,null)}))}}class c{constructor(){this._events={}}fire(e,t){const n=this._events[e]||[];for(let e=0;e<n.length;e++){if(!1===(0,n[e])(t))break}}off(e,t){if(t){const n=this._events[e]||[],i=n.indexOf(t);i>-1&&n.splice(i,1)}else this._events[e]=[]}on(e,t){const n=this._events[e]||[];n.push(t),this._events[e]=n}removeAllEvents(){this._events={}}}class h extends c{constructor(){super(),this._node=null}render(){this._node&&this._node.remove()}}const u=1,m=2;class p extends h{static topZindex=9;constructor(e){super(),this._config=e,void 0===this._config.x&&(this._config.x=window.innerWidth/2),void 0===this._config.y&&(this._config.y=60),this._isDragging=!1,this._lastPos={x:null,y:null},this._cbMouseUp=this._onEnd.bind(this),this._cbMouseMove=this._onMove.bind(this),this.state=u}_applyConfig(e=[]){if(this._config){if(this._config.id&&!e.includes("id")&&this._node.setAttribute("id",this._config.id),"string"==typeof this._config.title&&!e.includes("title")){const e=this._node.querySelector("header .title");te.removeAllChildren(e),e.innerHTML=this._config.title}if(this._node.classList.remove("closable"),!1!==this._config.closable&&this._node.classList.add("closable"),Array.isArray(this._config.content)&&!e.includes("content")){const e=this._node.querySelector(".content");te.removeAllChildren(e);for(let t of this._config.content)t instanceof h?e.append(t.render()):e.append(t)}"number"!=typeof this._config.x||e.includes("x")||(this._node.style.left=this._config.x+"px"),"number"!=typeof this._config.y||e.includes("y")||(this._node.style.top=this._config.y+"px"),"number"!=typeof this._config.width||e.includes("width")||(this._node.style.width=this._config.width+"px"),"number"!=typeof this._config.height||e.includes("height")||(this._node.style.height=this._config.height+"px")}}_onEnd(e){this._isDragging=!1,document.body.removeEventListener("mouseup",this._cbMouseUp),document.body.removeEventListener("mousemove",this._cbMouseMove)}_onMove(e){if(!this._isDragging)return;if(null===this._lastPos.x)return this._lastPos.x=e.clientX,void(this._lastPos.y=e.clientY);const t=parseInt(this._node.style.left,10),n=parseInt(this._node.style.top,10),i=e.clientX-this._lastPos.x,s=e.clientY-this._lastPos.y;this._node.style.left=Math.round(t+i)+"px",this._node.style.top=Math.round(n+s)+"px",this._lastPos.x=e.clientX,this._lastPos.y=e.clientY}_onStart(e){String(e.target.className).includes("toggle")||(0===e.button&&(this._isDragging=!0,document.body.addEventListener("mouseup",this._cbMouseUp),document.body.addEventListener("mousemove",this._cbMouseMove)),this._lastPos.x=null,this._lastPos.y=null,this._node.style.zIndex<p.topZindex&&(this._node.style.zIndex=++p.topZindex))}_toggleContent(){let e=this._node.classList;e.contains("window-collapsed")?e.replace("window-collapsed","window-open"):e.replace("window-open","window-collapsed")}center(){if(!this._node)return;const e=this._node.getBoundingClientRect();this.moveTo({x:(window.innerWidth-e.width)/2,y:(window.innerHeight-e.height)/2})}close(){this.state!==u&&(this.state=u,this.fire("close"),this._node?.remove())}moveTo(e){"number"==typeof e.x&&(this._node.style.left=e.x+"px",this._lastPos.x=e.x),"number"==typeof e.y&&(this._node.style.top=e.y+"px",this._lastPos.y=e.y)}_handleResize(e){const t=this._node.querySelector(`.resize-handles .handle-${e}`);let n=!1;const i="top"===e||"bottom"===e?"clientY":"clientX",s={clientX:null,clientY:null,left:0,top:0,height:0,width:0},a=t=>{if(!n)return;const a=t[i]-s[i];"right"===e?this._node.style.width=s.width+a+"px":"left"===e?(this._node.style.width=s.width-a+"px",this._node.style.left=s.left+a+"px"):"top"===e?(this._node.style.height=s.height-a+"px",this._node.style.top=s.top+a+"px"):"bottom"===e&&(this._node.style.height=s.height+a+"px")},r=t=>{document.body.removeEventListener("mousemove",a),document.body.removeEventListener("mouseup",r),n=!1,s.clientX=null,s.clientY=null,this.fire("resized",{dir:e})};t.addEventListener("mousedown",(e=>{document.body.addEventListener("mousemove",a),document.body.addEventListener("mouseup",r);const t=this._node.getBoundingClientRect();n=!0,s.clientX=e.clientX,s.clientY=e.clientY,s.left=t.left,s.top=t.top,s.height=t.height,s.width=t.width}))}render(){super.render(),this._node=te.build('\n\t\t\t<aside class="window window-open">\n\t\t\t\t<div class="resize-handles">\n\t\t\t\t\t<div class="handle handle-top"></div>\n\t\t\t\t\t<div class="handle handle-right"></div>\n\t\t\t\t\t<div class="handle handle-bottom"></div>\n\t\t\t\t\t<div class="handle handle-left"></div>\n\t\t\t\t</div>\n\t\t\t\t<header>\n\t\t\t\t\t<span class="icon toggle"></span>\n\t\t\t\t\t<span class="title"></span>\n\t\t\t\t\t<div class="actions">\n\t\t\t\t\t\t<span class="icon close"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="content"></div>\n\t\t\t</aside>\n\t\t'),this._applyConfig(),this._handleResize("top"),this._handleResize("right"),this._handleResize("bottom"),this._handleResize("left");const e=this._node.querySelector(":scope > header"),t=e.querySelector(".toggle"),n=e.querySelector(".close");return t.addEventListener("click",(e=>this._toggleContent())),e.addEventListener("mousedown",(e=>this._onStart(e))),n.addEventListener("click",(e=>this.close())),this._node.style.maxHeight=window.innerHeight-80+"px",this._node.style.zIndex=++p.topZindex,this.state=m,this._node}update(e){const t=[];for(const n in this._config)void 0!==e[n]&&this._config[n]!==e[n]||t.push(n);for(const t in e)this._config[t]=e[t];this._applyConfig(t)}}class g{constructor(e,t="base"){this.parser=e,this.type=t,this.metaData=[{name:"Filename",value:this.parser.file.name},{name:"Type",value:this.parser.mimeType},{name:"Filesize",value:te.formatSize(this.parser.file.size)}],this.nodeView=document.createElement("div"),this.nodeView.className="view view-"+this.type,this.nodeMeta=null}_buildMetaDataRow(e){const t=document.createElement("tr");if(e.hr){const e=document.createElement("td");e.colSpan=2,t.classList.add("hr"),t.append(e)}else if("string"==typeof e.group){const n=document.createElement("caption");n.textContent=e.group;const i=document.createElement("table");i.classList.add("group-table"),i.append(n),e.items.forEach((e=>{i.append(this._buildMetaDataRow(e))}));const s=document.createElement("td");s.colSpan=2,s.append(i),t.classList.add("group"),t.append(s)}else{const n=e.name,i=e.value,s=document.createElement("th");s.className="name",s.textContent=n+": ";const a=document.createElement("td");a.className="value",a.textContent=i,null!=i&&0!==String(i).length||a.classList.add("empty"),t.classList.add("item"),t.append(s,a)}return t}_openWindow(e){let t=[this.nodeView];if(this.nodeMeta){const e=te.build('<div class="layout"></div>');e.append(this.nodeMeta,this.nodeView),t=[e]}e=e||{},e.title??=te.escapeHTML(this.parser.file.name),e.content??=t;const n=new p(e);return n.on("close",(()=>{this.parser?.destroy(),this.destroy()})),document.body.append(n.render()),setTimeout((()=>n?.center()),0),n}buildMetaNode(e={}){if(0===Object.keys(this.metaData).length)return;if(this.nodeMeta&&te.removeAllChildren(this.nodeMeta),this.nodeMeta=document.createElement("div"),this.nodeMeta.className="meta meta-"+this.type,this.nodeMeta.querySelector(".meta-table")?.remove(),this.nodeMeta.querySelector(".option-toggle-empty")?.remove(),e.toggleForEmpty){const e=te.build('<div class="option option-toggle-empty"><input type="checkbox" id="metadata-toggle-empty" value="1" /><label for="metadata-toggle-empty">Omit empty entries</label></div>'),t=e.querySelector("input");t.addEventListener("change",(e=>this.toggleEmptyMetaData(t.checked))),this.nodeMeta.append(e)}const t=document.createElement("table");t.className="meta-table",this.metaData.forEach((e=>{const n=this._buildMetaDataRow(e);t.append(n)})),this.nodeMeta.append(t)}destroy(){this.nodeView.remove(),this.nodeMeta.remove()}load(e){const t=document.createElement("p");t.className="note",t.textContent=`No parser found for file of type: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),this._openWindow(),e?.()}mdAdd(e,t){this.metaData.push({name:e,value:t})}mdAddGroup(e,t){this.metaData.push({group:e,items:t})}mdHR(){this.metaData.push({hr:1})}toggleEmptyMetaData(e){if(e){const e=t=>{let n=0;const i=t.querySelectorAll(":scope > tr:not([hidden])");i.forEach(((e,t)=>{!e.classList.contains("hr")||0!==t&&t!==i.length-1||(e.setAttribute("hidden",""),n++)})),n>0&&e(t)},t=(t,n)=>{let i=!1;t.forEach((e=>{if(e.classList.contains("hr"))i&&e.setAttribute("hidden",""),i=!0;else{0===e.querySelector("td.value").innerHTML.length?e.setAttribute("hidden",""):i=!1}})),e(n)};this.nodeMeta.querySelectorAll(".meta-table .group-table").forEach((e=>{const n=e.querySelectorAll(":scope > tr.item");t(n,e)}));const n=this.nodeMeta.querySelectorAll(".meta-table > tr.item");t(n,this.nodeMeta)}else{this.nodeMeta.querySelectorAll("tr[hidden]").forEach((e=>e.removeAttribute("hidden")))}}}const f=0,_=1,y=50,v=100;class b{_importData=null;_parser=null;_view=null;canHandleImport(e){return _}getParser(){return this._parser??=new d(this._importData,!!this._importData?.dir),this._parser}getView(){return this._view??=new g(this.getParser()),this._view}setImportData(e){this._parser=null,this._view=null,this._importData=e}}class w extends g{constructor(e){super(e,"audio"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){this._objectURL=URL.createObjectURL(this.parser.file);const t=document.createElement("audio");if(t.setAttribute("controls",""),t.setAttribute("preload","metadata"),t.volume=.5,t.canPlayType(this.parser.mimeType))t.addEventListener("loadedmetadata",(()=>{this.mdAdd("Duration",te.formatDuration(1e3*t.duration)),this.buildMetaNode(),this.nodeView.appendChild(t),this._openWindow(),e?.()})),t.src=this._objectURL;else{const t=document.createElement("p");t.className="note",t.textContent=`Playback for audio format not supported: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),this._openWindow(),e?.()}}}class x extends b{canHandleImport(e){return e.mimeType?.startsWith("audio/")?y:f}getView(){return this._view??=new w(this.getParser()),this._view}}class T extends d{constructor(e){super(e)}parse(e){this.getText((async(t,n)=>{const{parse:i}=await r.e(829).then(r.bind(r,304)),s=i(n);e(null,s)}))}}class D extends g{constructor(e){super(e,"csv")}_build(e){const t=document.createElement("table");for(let n=0;n<e.length;n++){const i=e[n],s=document.createElement("tr"),a=0===n?"th":"td";for(let e=0;e<i.length;e++){const t=document.createElement("span");t.textContent=i[e];const n=document.createElement(a);n.append(t),s.append(n)}t.append(s)}return t}load(e){this.parser.parse(((t,n)=>{this.mdAdd("Columns",n.length>0?n[0].length:0),this.mdAdd("Rows",n.length),this.buildMetaNode();const i=this._build(n);this.nodeView.append(i),this._openWindow(),e?.()}))}}class E extends b{canHandleImport(e){return"csv"===e.ext?v:f}getParser(){return this._parser??=new T(this._importData),this._parser}getView(){return this._view??=new D(this.getParser()),this._view}}class S extends d{static numInstances=0;constructor(e){super(e,!!e.dir),this.file=e.dir||e.file,e.fileList&&(this.entries=e.fileList),this._fileManagerIds=[],S.numInstances++}_loadFromDicomdirFile(e,t){e.arrayBuffer().then((async e=>{const n=(await Promise.all([r.e(915),r.e(995)]).then(r.t.bind(r,5915,23))).parseDicom(new Uint8Array(e),{TransferSyntaxUID:"1.2.840.10008.1.2"}).elements.x00041220;n&&Array.isArray(n.items)?t(null,n):console.error("[DICOMParser._parseHandlerDir] Record is either not set or has no entries.",n)})).catch((e=>console.error(e)))}_parseHandlerDir(e){const t=this.entries,n=t.find((e=>e.isFile&&"dicomdir"===e.name.toLowerCase()));n?n.file((t=>this._loadFromDicomdirFile(t,e)),(t=>{console.error("[DICOMParser._parseHandlerDir]",t),e(t)})):e(null,t)}async addAndLoadFile(e){const t=this.wadouri.fileManager.add(e);return this._fileManagerIds.push(t),await this.wadouri.loadImage(t).promise}destroy(){if(1===S.numInstances){console.log("[DICOMParser.destroy] Purging cornerstone caches.");try{this.cache.purgeCache(),this.wadouri.dataSetCacheManager.purge(),this.wadouri.fileManager.purge()}catch(e){console.error("[DICOMParser.destroy]",e)}}S.numInstances--}static getModalityName(e){if(!e)return e;e=String(e).toUpperCase();let t=S.MODALITY_MAP[e];return t&&(t+=` [${e}]`),t||e}static getPregnancyStatus(e){if(isNaN(Number(e)))return e;return["not pregnant","possibly pregnant","definitely pregnant","unknown"][(e=Number(e))+1]||e}getFilepathsFromRecord(e){const t=[];return e.items.forEach((e=>{let n=e.dataSet.string("x00041500");n&&(n=n.replace(/\\/g,"/"),t.push(n))})),t}loadDICOMDIRFiles(e,t){const n=[];if(Array.isArray(e)){const i=s=>{if(s>=e.length)return void t(null,n);e[s].file((async e=>{const t=await this.addAndLoadFile(e);n.push(t),i(s+1)}))};i(0)}else{const i=this.getFilepathsFromRecord(e),s=e=>{if(e>=i.length)return void t(null,n);const a=i[e];this.file.getFile(a,{},(t=>{t.file((async t=>{const i=await this.addAndLoadFile(t);n.push(i),s(e+1)}))}),(t=>{console.error(`[DICOMParser.loadDICOMDIRFiles] getFile "${a}": `+t.message),s(e+1)}))};s(0)}}async parse(e){const t=await Promise.all([r.e(960),r.e(178),r.e(483)]).then(r.bind(r,6178)),n=await Promise.all([r.e(612),r.e(960),r.e(915),r.e(599),r.e(146)]).then(r.bind(r,6599));if(t.init(),n.init(),this.cache=t.cache,this.wadouri=n.wadouri,this.isDir)this._parseHandlerDir(e);else if("dicomdir"===this.file.name.toLowerCase())this._loadFromDicomdirFile(this.file,((t,n)=>{const i=this.getFilepathsFromRecord(n);e(null,i)}));else{const t=await this.addAndLoadFile(this.file);e(null,t)}}}S.MODALITY_MAP={AR:"Autorefraction",AS:"Angioscopy",ASMT:"Content Assessment Results",AU:"Audio",BDUS:"Bone Densitometry (ultrasound)",BI:"Biomagnetic imaging",BMD:"Bone Densitometry (X-Ray)",CD:"Color flow Doppler",CF:"Cinefluorography",CP:"Colposcopy",CR:"Computed Radiography",CS:"Cystoscopy",CT:"Computed Tomography",DD:"Duplex Doppler",DF:"Digital fluoroscopy",DG:"Diaphanography",DM:"Digital microscopy",DOC:"Document",DS:"Digital Subtraction Angiography",DX:"Digital Radiography",EC:"Echocardiography",ECG:"Electrocardiography",EPS:"Cardiac Electrophysiology",ES:"Endoscopy",FA:"Fluorescein angiography",FID:"Fiducials",FS:"Fundoscopy",GM:"General Microscopy",HC:"Hard Copy",HD:"Hemodynamic Waveform",IO:"Intra-Oral Radiography",IOL:"Intraocular Lens Data",IVOCT:"Intravascular Optical Coherence Tomography",IVUS:"Intravascular Ultrasound",KER:"Keratometry",KO:"Key Object Selection",LEN:"Lensometry",LP:"Laparoscopy",LS:"Laser surface scan",MA:"Magnetic resonance angiography",MG:"Mammography",MR:"Magnetic Resonance",MS:"Magnetic resonance spectroscopy",NM:"Nuclear Medicine",OAM:"Ophthalmic Axial Measurements",OCT:"Optical Coherence Tomography (non-Ophthalmic)",OP:"Ophthalmic Photography",OPM:"Ophthalmic Mapping",OPR:"Ophthalmic Refraction",OPT:"Ophthalmic Tomography",OPV:"Ophthalmic Visual Field",OSS:"Optical Surface Scan",OT:"Other",PLAN:"Plan",PR:"Presentation State",PT:"Positron emission tomography (PET)",PX:"Panoramic X-Ray",REG:"Registration",RESP:"Respiratory Waveform",RF:"Radio Fluoroscopy",RG:"Radiographic imaging (conventional film/screen)",RTDOSE:"Radiotherapy Dose",RTIMAGE:"Radiotherapy Image",RTPLAN:"Radiotherapy Plan",RTRECORD:"RT Treatment Record",RTSTRUCT:"Radiotherapy Structure Set",RWV:"Real World Value Map",SEG:"Segmentation",SM:"Slide Microscopy",SMR:"Stereometric Relationship",SR:"SR Document",SRF:"Subjective Refraction",ST:"Single-photon emission computed tomography (SPECT)",STAIN:"Automated Slide Stainer",TG:"Thermography",US:"Ultrasound",VA:"Visual Acuity",VF:"Videofluorography",XA:"X-Ray Angiography",XC:"External-camera Photography"};class M extends h{constructor(e){super(),this._config=e,"function"==typeof this._config.onClick&&this.on("click",this._config.onClick)}_updateNode(){if(!this._node)return;const e="string"==typeof this._config.icon,t="string"==typeof this._config.text;if(te.removeAllChildren(this._node),this._node.className="",this._node.classList.add("btn"),"string"==typeof this._config.classes&&this._node.classList.add(...this._config.classes.split(" ")),e&&(this._node.innerHTML=`<span class="icon">${this._config.icon}</span>`),t){const e=te.escapeHTML(this._config.text);this._node.innerHTML+=`<span class="text">${e}</span>`}e&&t||!0===this._config.iconWithBorder?(this._node.classList.add("btn-icon-text"),this._config.iconWithBorder&&this._node.classList.add("btn-icon-border")):e?this._node.classList.add("btn-icon"):t&&this._node.classList.add("btn-text"),"string"==typeof this._config.title?this._node.setAttribute("title",this._config.title):this._node.removeAttribute("title")}disable(){this._node?this._node.disabled=!0:window.Logger.warn("[Button.disable] Button has not been rendered yet.")}enable(){this._node?this._node.disabled=!1:window.Logger.warn("[Button.enable] Button has not been rendered yet.")}render(){return super.render(),this._node=document.createElement("button"),this._updateNode(),this._node.addEventListener("click",(e=>{this._node.disabled||this.fire("click",e)})),this._node}update(e){for(const t in e)this._config[t]=e[t];this._updateNode()}}class L extends g{constructor(e){super(e,"dicom"),this._frameDelay=250,this._frameIndex=0,this._frameTime=33.333,this._listenerKeyNav=null,this._timer=0}_addMetaInfo(e){this.mdAddGroup("Patient",[{name:"Patient ID",value:e.string("x00100020")},{name:"Issuer of Patient ID",value:e.string("x00100021")},{name:"Type of Patient ID",value:e.string("x00100022")},{hr:1},{name:"Patient Name",value:e.string("x00100010")},{name:"Other Patient Names",value:e.string("x00101001")},{name:"Patient Birth Date",value:e.string("x00100030")},{name:"Patient Birth Time",value:e.string("x00100032")},{name:"Patient Sex",value:e.string("x00100040")},{name:"Ethnic Group",value:e.string("x00102160")},{name:"Patient Breed Desc.",value:e.string("x00102292")},{name:"Patient Species Desc.",value:e.string("x00102201")},{name:"Patient Comments",value:e.string("x00104000")},{name:"Strain Desc.",value:e.string("x00100212")},{name:"Strain Nomenclature",value:e.string("x00100213")},{name:"Strain Addit. Info.",value:e.string("x00100218")},{hr:1},{name:"Responsible Person",value:e.string("x00102297")},{name:"Resp. Person Role",value:e.string("x00102298")},{name:"Resp. Organization",value:e.string("x00102299")}]),this.mdAddGroup("Patient Study",[{name:"Admitting Diagnoses Desc.",value:e.string("x00081080")},{name:"Patient's Age (years)",value:e.string("x00101010")},{name:"Patient's Size (m)",value:e.string("x00101020")},{name:"Patient's BMI",value:e.string("x00101022")},{name:"Measured AP Dimension (mm)",value:e.string("x00101023")},{name:"Measured Lateral Dimension (mm)",value:e.string("x00101024")},{name:"Patient's Weight (kg)",value:e.string("x00101030")},{name:"Medical Alerts",value:e.string("x00102000")},{name:"Allergies",value:e.string("x00102110")},{name:"Occupation",value:e.string("x00102180")},{name:"Smoking Status",value:e.string("x001021a0")},{name:"Addit. Patient History",value:e.string("x001021b0")},{name:"Pregnancy Status",value:S.getPregnancyStatus(e.string("x001021c0"))},{name:"Last Menstrual Date",value:e.string("x001021d0")},{name:"Patient's Sex Neutered",value:e.string("x00102203")},{name:"Reason for Visit",value:e.string("x00321066")},{name:"Admission ID",value:e.string("x00380010")},{name:"Service Episode ID",value:e.string("x00380060")},{name:"Service Episode Desc.",value:e.string("x00380062")},{name:"Patient State",value:e.string("x00380500")}]),this.mdAddGroup("General Study",[{name:"Study Date",value:e.string("x00080020")},{name:"Study Time",value:e.string("x00080030")},{name:"Accession Number",value:e.string("x00080050")},{name:"Referring Physician Name",value:e.string("x00080090")},{name:"Consulting Physician's Name",value:e.string("x0008109c")},{name:"Study Desc.",value:e.string("x00081030")},{name:"Physician(s) of Record",value:e.string("x00081048")},{name:"Physician(s) Reading Study",value:e.string("x00081060")},{name:"Study ID",value:e.string("x00200010")},{name:"Requesting Service",value:e.string("x00321033")}]),this.mdAddGroup("General Series",[{name:"Series Date",value:e.string("x00080021")},{name:"Series Time",value:e.string("x00080031")},{name:"Modality",value:S.getModalityName(e.string("x00080060"))},{name:"Series Desc.",value:e.string("x0008103e")},{name:"Performing Physician's Name",value:e.string("x00081050")},{name:"Operator's Name",value:e.string("x00081070")},{name:"Anatomical Orientation Type",value:e.string("x00102210")},{name:"Body Part Examined",value:e.string("x00180015")},{name:"Protocol Name",value:e.string("x00181030")},{name:"Patient Position",value:e.string("x00185100")},{name:"Series Number",value:e.string("x00200011")},{name:"Laterality",value:e.string("x00200060")},{name:"Performed Procedure Step Desc.",value:e.string("x00400254")},{name:"Comments on the Procedure Step",value:e.string("x00400280")}]),this.mdAddGroup("General Image",[{name:"Image Type",value:e.string("x00080008")},{name:"Patient Orientation",value:e.string("x00200020")},{name:"Image Laterality",value:e.string("x00200062")},{name:"Image Comments",value:e.string("x00204000")}]),this.mdAddGroup("General Equipment",[{name:"Manufacturer",value:e.string("x00080070")},{name:"Institution Name",value:e.string("x00080080")},{name:"Institution Address",value:e.string("x00080081")},{name:"Station Name",value:e.string("x00081010")},{name:"Institutional Department Name",value:e.string("x00081040")},{name:"Manufacturer's Model Name",value:e.string("x00081090")},{name:"Device Serial Number",value:e.string("x00181000")},{name:"Device UID",value:e.string("x00181002")},{name:"Gantry ID",value:e.string("x00181008")},{name:"Software Versions",value:e.string("x00181020")},{name:"Spatial Resolution",value:e.string("x00181050")},{name:"Date of Last Calibration",value:e.string("x00181200")},{name:"Time of Last Calibration",value:e.string("x00181201")}])}_buildControls(){const e=te.build(`\n\t\t\t<div class="image-container"></div>\n\t\t\t<div class="actions">\n\t\t\t\t<input type="range" min="1" max="${this._numFrames}" value="1" />\n\t\t\t\t<div class="line">\n\t\t\t\t\t<div class="wrap wrap-frame-controls"></div>\n\t\t\t\t\t<div class="wrap wrap-playback">\n\t\t\t\t\t\t<select class="speed">\n\t\t\t\t\t\t\t<option value="${this._frameTime}">Default: ${this._frameTime} ms</option>\n\t\t\t\t\t\t\t<option value="16.7">16.7 ms</option>\n\t\t\t\t\t\t\t<option value="33.3">33.3 ms</option>\n\t\t\t\t\t\t\t<option value="66.7">66.7 ms</option>\n\t\t\t\t\t\t\t<option value="133.3">133.3 ms</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`),t=new M({classes:"frame-prev",text:"←"}),n=new M({classes:"frame-next",text:"→"}),i=new M({classes:"play-pause",text:"▶"});if(e.querySelector(".wrap-frame-controls").append(t.render(),te.build('<span class="counter"></span>'),n.render()),e.querySelector(".wrap-playback").append(i.render()),this._frameIndex=0,this._numFrames<=2)e.querySelector(".actions").remove();else{const s=e.querySelector('input[type="range"]');s.addEventListener("change",(e=>{this._frameIndex=e.target.valueAsNumber-1,this._controlGoto(this._frameIndex)})),t.on("click",(e=>{this._controlGoto(--this._frameIndex),s.value=this._frameIndex+1})),n.on("click",(e=>{this._controlGoto(++this._frameIndex),s.value=this._frameIndex+1}));const a=e.querySelector("select.speed");a.addEventListener("change",(e=>{this._frameTime=Number(a.value)})),i.on("click",(e=>{this._timer?(i.update({text:"▶"}),clearTimeout(this._timer),this._timer=0):(i.update({text:"⏸"}),this._playback(s))})),this._listenerKeyNav=e=>{const t=document.activeElement;t&&"range"===t.type||("ArrowLeft"===e.key?(this._controlGoto(--this._frameIndex),s.value=this._frameIndex+1):"ArrowRight"===e.key&&(this._controlGoto(++this._frameIndex),s.value=this._frameIndex+1))},document.body.addEventListener("keyup",this._listenerKeyNav),this._counter=e.querySelector(".counter")}this.nodeView.append(e)}_buildDICOMDIRFileList(e){const t=document.createElement("ol");e.forEach((e=>{const n=document.createElement("li");n.textContent=e,t.append(n)}));const n=document.createElement("wrap");n.className="dicomdir-list",n.append(t),this.nodeView.append(n)}_controlGoto(e){this._frameIndex=this.showImage(e),this._counter&&(this._counter.textContent=this._frameIndex+1+"/"+this._numFrames)}_handleResize(){}async _initViewport(){const{RenderingEngine:e}=await Promise.all([r.e(960),r.e(178),r.e(483)]).then(r.bind(r,6178)),{OrientationAxis:t,ViewportType:n}=await r.e(136).then(r.bind(r,3286)),i=this.nodeView.querySelector(".image-container");this._renderingEngine=new e,this._renderingEngine.enableElement({viewportId:"ctStack",type:n.STACK,element:i,defaultOptions:{orientation:t.AXIAL}}),this._viewport=this._renderingEngine.getViewport("ctStack")}_playback(e){if(this._timer)return;const t=0===this._frameIndex?this._frameDelay:0;this._timer=setTimeout((()=>{this._controlGoto(++this._frameIndex),e.value=this._frameIndex+1,this._timer=0,this._playback(e)}),this._frameTime+t)}destroy(){super.destroy(),clearTimeout(this._timer),this._images=null,this._imageId=null,document.body.removeEventListener("keyup",this._listenerKeyNav)}load(e){this.parser.parse((async(t,n)=>{if(!t)if(this.parser.isDir)this.parser.loadDICOMDIRFiles(n,(async(t,n)=>{this._images=n,this._numFrames=this._images.length,this._buildControls();this._openWindow().on("resized",(()=>this._handleResize())),e?.(),await this._initViewport(),this._viewport.setStack(this._images.map((e=>e.imageId))),this.showFile(0),this._controlGoto(0)}));else if(Array.isArray(n))this._buildDICOMDIRFileList(n),this.buildMetaNode(),this._openWindow(),e?.();else{const t=n.data;this._numFrames=Number(t.string("x00280008")||1),this._frameDelay=Number(t.string("x00181033")||this._frameDelay),this._frameTime=Number(t.string("x00181063")||this._frameTime),this._addMetaInfo(t),this.buildMetaNode({toggleForEmpty:!0}),this._buildControls();this._openWindow().on("resized",(()=>this._handleResize())),e?.(),this._imageId=n.imageId,await this._initViewport();let i=[];for(let e=0;e<this._numFrames;e++){let t=e>0?this._imageId+"?frame="+e:this._imageId;i.push(t)}this._viewport.setStack(i),this._controlGoto(0)}}))}showFile(e){e>=this._images.length?e=0:e<0&&(e=this._images.length-1);const t=this._images[e],n=t.data;return this._frameDelay=Number(n.string("x00181033")||this._frameDelay),this._frameTime=Number(n.string("x00181063")||this._frameTime),this._addMetaInfo(n),this.buildMetaNode({toggleForEmpty:!0}),this._imageId=t.imageId,e}showImage(e){return e>=this._numFrames?e=0:e<0&&(e=this._numFrames-1),this._viewport.setImageIdIndex(e),e}}class C extends b{canHandleImport(e){return"application/dicom"===e.mimeType?v:f}getParser(){return this._parser??=new S(this._importData),this._parser}getView(){return this._view??=new L(this.getParser()),this._view}static containsDICOMDIRFile(e){return!!e.find((e=>e.isFile&&"dicomdir"===e.name.toLowerCase()))}static async containsDICOMFiles(e){let t=0;for(let n=0;n<e.length;n++){const i=e[n];if(await this.isDICOMFile(i)&&(t++,t>1))return!0}return!1}static isDICOMFile(e){return e?.isFile?e.name.toLocaleLowerCase().endsWith(".dcm")?new Promise(((e,t)=>e(!0))):new Promise(((t,n)=>{e.file((async e=>{const n=await l.getMimeType(e);t("application/dicom"===n)}),(e=>{console.error("[DICOMPlugin.isDICOMFile]",e),t(!1)}))})):new Promise(((e,t)=>e(!1)))}}class A extends d{constructor(e){super(e),this._domParser=new DOMParser,this._lastParsed=null}_decodeContent(e){return e=(e=e.replaceAll(/=[\r]?\n/g,"")).replaceAll(/(=[0-9A-Z]{2})+/g,(e=>{try{return decodeURIComponent(e.replaceAll("=","%"))}catch(t){return console.error(t,e),e}}))}_removeExternal(e){e.querySelectorAll("img").forEach((e=>{(e.getAttribute("src")||"").startsWith("data:")||e.removeAttribute("src")}));e.querySelectorAll(["audio[src]","embed","iframe",'link[rel="stylesheet"]',"object","script","source","video[src]"].join(",")).forEach((e=>e.remove()));e.querySelectorAll("[background]").forEach((e=>{(e.getAttribute("background")||"").includes("//")&&e.removeAttribute("background")}));e.querySelectorAll("style").forEach((e=>{let t=e.textContent;t=t.replaceAll(/url[ \t]*\([ \t]*.+[ \t]*\)/gi,"url()"),e.textContent=t}))}buildBodyDOM(e){return this._domParser.parseFromString(e,"text/html")}buildHeadersHTML(e){const t=document.createElement("table");e.forEach((e=>{const n=document.createElement("th");n.className="header-name",n.textContent=e.name;const i=document.createElement("td");i.className="header-value",i.textContent=e.value;const s=document.createElement("tr");s.append(n,i),t.append(s)}));const n=document.createElement("div");return n.className="headers",n.append(t),n}buildPlainTextDOM(e){return this._domParser.parseFromString(`<pre>${e}</pre>`,"text/html")}getBodyDOM(e,t){if(e||(e={}),"boolean"!=typeof e.remove_external&&(e.remove_external=!0),this._lastParsed){let n=this._decodeContent(this._lastParsed.body),i=null,s=this.getHeader(this._lastParsed.headers,"content-type")||"";s=s.toLowerCase();let a="plaintext";s.startsWith("text/html")?(i=this.buildBodyDOM(n,e),a="html"):i=this.buildPlainTextDOM(n),i&&e.remove_external&&this._removeExternal(i),t(null,i,a)}else this.getText(((n,i)=>{this.parse(i),this._lastParsed?this.getBodyDOM(e,t):t(new Error("Failed to parse"),null,null)}))}getHeader(e,t){e=e||{};for(const n of e)if(n.name.toLowerCase()===t)return n.value;return null}getHeadersHTML(e){if(this._lastParsed){const t=this.buildHeadersHTML(this._lastParsed.headers);e(null,t)}else this.getText(((t,n)=>{const i=this.parse(n),s=this.buildHeadersHTML(i.headers);e(null,s)}))}parse(e){this._lastParsed=null;let t=(e=e.trimStart()).split("\r\n\r\n");if(2!==t.length&&(t=e.split("\n\n")),t.length<2)return null;const n=t.splice(0,1)[0].trim(),i={headers:[],body:t.join("\n\n")};let s=null,a=null,r=!0,o=n.split("\r\n");1===o.length&&(o=n.split("\n"));for(const e of o)if(e.startsWith(" ")||e.startsWith("\t")?(a+=e.trimStart(),r=!1):s&&(i.headers.push({name:s,value:a}),r=!0),r){const t=e.split(": ");s=t[0],a=t.slice(1).join(": ")}return s&&i.headers.push({name:s,value:a}),this._lastParsed=i,i}}class I extends h{constructor(e){super(),this._buttons=e}_toggle(e){this._buttons.forEach((e=>e._node.classList.remove("selected"))),e._node.classList.add("selected")}render(){super.render(),this._node=te.build('<div class="button-group"></div>');for(let e=0;e<this._buttons.length;e++){const t=this._buttons[e];t.on("click",(()=>this._toggle(t))),this._node.append(t.render())}return this._node}}class P extends g{constructor(e){super(e,"eml"),this._window=null}_buildActions(){return new I([new M({text:"Show Headers",onClick:()=>{this.nodeView.querySelector("iframe.content-res ")?.remove();this.nodeView.querySelector("iframe.content-no-res").style.display="none";this.nodeView.querySelector(".headers").style.display=""}}),new M({text:"Content (no external)",classes:"selected",onClick:()=>{this.nodeView.querySelector("iframe.content-res ")?.remove();this.nodeView.querySelector("iframe.content-no-res").style.display="";this.nodeView.querySelector(".headers").style.display="none"}}),new M({text:"Content (with external)",onClick:()=>{if(!window.confirm("Show the content and load its external resources?\nThis could pose a security risk.\n\nOnly agree if you trust the EML file."))return!1;this.nodeView.querySelector("iframe.content-res ")?.remove();this.nodeView.querySelector("iframe.content-no-res").style.display="none";this.nodeView.querySelector(".headers").style.display="none",this.parser.getBodyDOM({remove_external:!1},((e,t,n)=>{const i=document.createElement("iframe");i.className=`content-res eml-type-${n}`,i.setAttribute("sandbox",""),i.setAttribute("srcdoc",t.documentElement.outerHTML),this.nodeView.append(i)}))}})]).render()}load(e){const t=document.createElement("iframe");t.className="content-no-res",t.setAttribute("sandbox",""),this.parser.getBodyDOM({remove_external:!0},((n,i,s)=>{this.parser.getHeadersHTML(((n,a)=>{this.buildMetaNode();const r=this._buildActions();a.style.display="none",t.classList.add(`eml-type-${s}`),t.setAttribute("srcdoc",i.documentElement.outerHTML),this.nodeView.append(r,a,t),this._openWindow(),e?.()}))}))}}class R extends b{canHandleImport(e){return"eml"===e.ext?v:f}getParser(){return this._parser??=new A(this._importData),this._parser}getView(){return this._view??=new P(this.getParser()),this._view}}class N extends d{constructor(e){super(e)}parse(e){this.getArrayBuffer((async(t,n)=>{const{GifReader:i}=await r.e(900).then(r.t.bind(r,4399,19));let s=null;try{s=new i(new Uint8Array(n))}catch(t){return console.error(t),void e(t,null)}e(null,s)}))}}class F extends g{constructor(e){super(e,"gif"),this._currentCanvas=null,this._frameIndex=0,this._frames=[],this._gifReader=null,this._listenerKeyNav=null}_buildSlideshow(e){const t=this._gifReader.numFrames(),n=te.build(`\n\t\t\t<div class="frame-container"></div>\n\t\t\t<div class="actions">\n\t\t\t\t<input type="range" min="1" max="${t}" value="1" />\n\t\t\t\t<div class="line"></div>\n\t\t\t</div>\n\t\t`),i=new M({classes:"frame-prev",text:"←"}),s=new M({classes:"frame-next",text:"→"});n.querySelector(".line").append(i.render(),te.build('<span class="counter"></span>'),s.render()),this._frameIndex=0,this._generateFrames((()=>{const t=n.querySelector('input[type="range"]');t.addEventListener("input",(e=>{this._frameIndex=e.target.valueAsNumber-1,this.showFrame(this._frameIndex)})),i.on("click",(e=>{this.showFrame(--this._frameIndex),t.value=this._frameIndex+1})),s.on("click",(e=>{this.showFrame(++this._frameIndex),t.value=this._frameIndex+1})),this._listenerKeyNav=e=>{const n=document.activeElement;n&&"range"===n.type||("ArrowLeft"===e.key?(this.showFrame(--this._frameIndex),t.value=this._frameIndex+1):"ArrowRight"===e.key&&(this.showFrame(++this._frameIndex),t.value=this._frameIndex+1))},document.body.addEventListener("keyup",this._listenerKeyNav),this._counter=n.querySelector(".counter"),e(n)}))}_generateFrame(e,t){const n=this._gifReader.width,i=this._gifReader.height,s=document.createElement("canvas");s.width=n,s.height=i,s.style.width=n+"px",s.style.height=i+"px";const a=s.getContext("2d");if(0===e){const r=new ImageData(n,i);return this._lastNonDisposedImgData=r,this._gifReader.decodeAndBlitFrameRGBA(e,r.data),a.putImageData(r,0,0),void t(s)}const r=this._gifReader.frameInfo(e-1);let o=null;if(r.disposal<=1||3===r.disposal){const e=Uint8ClampedArray.from(this._lastNonDisposedImgData.data);o=new ImageData(e,n,i)}else o=new ImageData(n,i);this._gifReader.decodeAndBlitFrameRGBA(e,o.data);this._gifReader.frameInfo(e).disposal<=1&&(this._lastNonDisposedImgData=o),a.putImageData(o,0,0),t(s)}_generateFrames(e){const t=this._gifReader.numFrames(),n=i=>{i>=t?e():this._generateFrame(i,(e=>{this._frames.push(e),n(i+1)}))};n(0)}destroy(){super.destroy(),document.body.removeEventListener("keyup",this._listenerKeyNav)}load(e){this.parser.parse(((t,n)=>{this._gifReader=n,this.mdAdd("Dimensions",n.width+"×"+n.height+" px"),this.mdAdd("Frames",n.numFrames()),this.buildMetaNode(),this._buildSlideshow((t=>{this.nodeView.append(t),this.showFrame(this._frameIndex),this._openWindow(),e?.()}))}))}showFrame(e){const t=this._gifReader.numFrames();e>=t?e=0:e<0&&(e=t-1),this._currentCanvas&&this._currentCanvas.remove(),this._frameIndex=e,this._currentCanvas=this._frames[e];this.nodeView.querySelector(".frame-container").append(this._currentCanvas),this._counter.textContent=e+1+"/"+t}}class O extends b{canHandleImport(e){return"image/gif"===e.mimeType?v:f}getParser(){return this._parser??=new N(this._importData),this._parser}getView(){return this._view??=new F(this.getParser()),this._view}}class H extends d{constructor(e,t){super(e,t)}_buildHTMLComponent(e){const t=document.createElement("div");t.className="container";const n=document.createElement("table"),i=e.summary||"(no summary)",s=document.createElement("h2");s.className="summary",s.textContent=i,e.color&&(s.style.backgroundColor=e.color);const a=this._getParameterValue(e,"status");if(a){const e=document.createElement("span");e.className="state",e.textContent=a,s.append(e)}const r=this._getParameterValue(e,"class");if(r){const e=document.createElement("span");e.className="state",e.textContent=r,s.append(e)}if(t.append(s),e.description){const n=document.createElement("div");n.className="description",n.innerHTML=e.description.replaceAll(/\n/g,"<br>"),t.append(n)}if(e.startDate){const t=this._buildHTMLTableRowTime("Start",e.startDate);if(n.append(t),e.endDate){const t=this._buildHTMLTableRowTime("End",e.endDate);n.append(t)}if(e.duration){const t=1e3*e.duration.toSeconds(),i=te.buildTableRow("Duration",te.formatDuration(t));n.append(i)}}const o=e.component.jCal[1].filter((e=>"freebusy"===e[0]));o.length>0&&o.forEach((e=>{const t=e[3],i=this.ICAL.Time.fromDateTimeString(t[0]),s=this._buildTimeSelect(i);let a=null,r="";if(t[1].length>=16){const e=this.ICAL.Time.fromDateTimeString(t[1]);a=this._buildTimeSelect(e),r=" – "}else a=t[1],r=" / ";const o=te.buildTableRow("Period",""),l=o.querySelector("td");l.innerHTML="",l.append(s,r,a),n.append(o)}));const l=this._getParameterValue(e,"due");if(l){const e=this.ICAL.Time.fromDateTimeString(l),t=this._buildHTMLTableRowTime("Due",e);n.append(t)}if(e.location){const t=te.buildTableRow("Location",e.location);t.className="location",n.append(t)}if(e.organizer){const t=e.component.jCal[1].find((e=>"organizer"===e[0]));let i=t?.[1]?.cn||e.organizer.replace(/^mailto:/,"");const s=te.buildTableRow("Organizer",i);if(s.className="organizer",e.organizer.startsWith("mailto:")){const t=document.createElement("a");t.href=e.organizer,t.textContent=i;const n=s.querySelector("td");n.innerHTML="",n.append(t)}n.append(s)}if(Array.isArray(e.attendees)&&e.attendees.length>0){const t=te.buildTableRow("Attendees","");t.className="attendees";const i=document.createElement("ul");e.attendees.forEach((e=>{const t=document.createElement("a");t.href=e.getFirstValue(),t.textContent=e.getParameter("cn")||t.href.replace(/^mailto:/,"");const n=document.createElement("li");if(n.append(t),e.getParameter("partstat")){const t=document.createElement("span");t.className="state",t.textContent=e.getParameter("partstat"),n.append(t)}i.append(n)}));t.querySelector("td").append(i),n.append(t)}const d=this._getParameterValue(e,"comment");if(d){const e=te.buildTableRow("Comment",d);n.append(e)}const c=this._getParameterValue(e,"url");if(c){const e=te.buildTableRow("URL",c),t=document.createElement("a");t.href=c,t.textContent=c;const i=e.querySelector("td");i.innerHTML="",i.append(t),n.append(e)}t.append(n);const h=this._buildHTMLVAlarms(e);return h&&t.append(h),t}_buildHTMLTableRowTime(e,t){const n=this._buildTimeSelect(t),i=te.buildTableRow(e,"");return i.className=e.toLowerCase(),i.querySelector("td").append(n),i}_buildHTMLVAlarm(e){if(!Array.isArray(e))return null;const t=document.createElement("div");t.className="valarm";const n=e.find((e=>"description"===e[0]));if(n&&n[3]){const e=document.createElement("div");e.className="alarm-description",e.textContent=n[3],t.append(e)}const i=document.createElement("table"),s=e.find((e=>"trigger"===e[0]));if(s&&s[3]){const e=te.buildTableRow("Trigger",s[3]);i.append(e)}const a=e.find((e=>"duration"===e[0]));if(a&&a[3]){const e=te.buildTableRow("Duration",a[3]);i.append(e)}const r=e.find((e=>"repeat"===e[0]));if(r&&r[3]){const e=te.buildTableRow("Repeat",r[3]);i.append(e)}const o=e.find((e=>"action"===e[0]));if(o&&o[3]){const e=te.buildTableRow("Action",o[3]);i.append(e)}const l=e.find((e=>"attach"===e[0]));if(l&&l[3]){const e=te.buildTableRow("Attach",l[3]);i.append(e)}return t.append(i),t}_buildHTMLVAlarms(e){const t=e.component.jCal[2];if(!Array.isArray(t))return null;const n=t.filter((e=>"valarm"===e[0]));if(0===n.length)return null;const i=document.createElement("div");return i.className="valarms",n.forEach((e=>{const t=this._buildHTMLVAlarm(e[1]);t&&i.append(t)})),i}_buildTimeSelect(e){const t={UTC:te.formatDateTime(e.toJSDate()),ICAL:e.toString(),Unix:e.toUnixTime()};e.timezone&&(t.ICAL+=` (${e.timezone})`);const n=document.createElement("select");for(const e in t){const i=t[e],s=document.createElement("option");s.value=e,s.textContent=i+` [${e}]`,n.append(s)}return n}_getParameterValue(e,t){const n=e.component.jCal;if(!Array.isArray(n)||!Array.isArray(n[1]))return null;const i=n[1].find((e=>e[0]===t));return Array.isArray(i)?i[3]:null}build(e){const t=document.createElement("div");t.className="ical";const n=new this.ICAL.Component(e),i=n.getAllSubcomponents("vevent"),s=n.getAllSubcomponents("vtodo"),a=n.getAllSubcomponents("vjournal"),r=n.getAllSubcomponents("vfreebusy");return i.concat(s).concat(a).concat(r).forEach((e=>{const n=new this.ICAL.Event(e),i=this._buildHTMLComponent(n);i.className+=" "+e.jCal[0],t.append(i)})),t}getHTML(e){this.getText(((t,n)=>{this.parse(n,(t=>{const n=this.build(t);e(null,n)}))}))}parse(e,t){r.e(859).then(r.bind(r,8202)).then((n=>{this.ICAL=n.default;const i=this.ICAL.parse(e);t(i)}))}}class j extends g{constructor(e){super(e,"ical")}load(e){this.parser.getHTML(((t,n)=>{this.buildMetaNode(),this.nodeView.append(n),this._openWindow(),e?.()}))}}class k extends b{canHandleImport(e){return"text/calendar"===e.mimeType||["ical","ics","ifb","vcs"].includes(e.ext)?v:f}getParser(){return this._parser??=new H(this._importData),this._parser}getView(){return this._view??=new j(this.getParser()),this._view}}class V extends g{constructor(e){super(e,"image"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){let t=!1;const n=new Image;n.onload=()=>{t||(t=!0,n.height=n.naturalHeight,n.width=n.naturalWidth,this.mdAdd("Dimensions",n.naturalWidth+"×"+n.naturalHeight+" px"),this.buildMetaNode(),this.nodeView.append(n),this._openWindow(),e?.())},n.onerror=()=>{const t=document.createElement("p");t.className="note",t.textContent=`Image format not supported: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),this._openWindow(),e?.()},this._objectURL=URL.createObjectURL(this.parser.file),n.src=this._objectURL}}class U extends b{canHandleImport(e){return e.mimeType?.startsWith("image/")?y:f}getView(){return this._view??=new V(this.getParser()),this._view}}class W extends g{constructor(e){super(e,"pdf"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){this._objectURL=URL.createObjectURL(this.parser.file);const t=document.createElement("iframe");t.src=this._objectURL,this.buildMetaNode(),this.nodeView.appendChild(t),this._openWindow(),e?.()}}class q extends b{canHandleImport(e){return"application/pdf"===e.mimeType?v:f}getView(){return this._view??=new W(this.getParser()),this._view}}class B extends g{constructor(e){super(e,"text"),this._originalText="",this._formatted=null}_buildButtonsJson(e){return new I([new M({text:"Original",classes:"selected",onClick:()=>{delete e.dataset.highlighted,e.innerHTML="",e.textContent=this._originalText,B.hljs.highlightElement(e),B.hljs.lineNumbersBlock(e)}}),new M({text:"Formatted",onClick:()=>{let t=this._originalText;if(this._formatted)t=this._formatted;else try{t=JSON.parse(this._originalText),t=JSON.stringify(t,null,2),this._formatted=t}catch(e){console.error("[TextView._buildButtonsJson]",e.message),window.alert(e.message)}delete e.dataset.highlighted,e.innerHTML="",e.textContent=t,B.hljs.highlightElement(e),B.hljs.lineNumbersBlock(e)}})])}static async initHljs(){if(B.hljs)return B.hljs;B.hljs=window.hljs=(await r.e(755).then(r.bind(r,11))).default,await r.e(463).then(r.t.bind(r,5079,23));const e={bash:await r.e(140).then(r.bind(r,9510)),cmake:await r.e(383).then(r.bind(r,7237)),diff:await r.e(255).then(r.bind(r,6551)),dns:await r.e(659).then(r.bind(r,3561)),ini:await r.e(720).then(r.bind(r,6e3)),javascript:await r.e(527).then(r.bind(r,5603)),json:await r.e(792).then(r.bind(r,7402)),makefile:await r.e(974).then(r.bind(r,3308)),markdown:await r.e(617).then(r.bind(r,3265)),powershell:await r.e(265).then(r.bind(r,1569)),typescript:await r.e(311).then(r.bind(r,5387)),xml:await r.e(529).then(r.bind(r,9359)),yaml:await r.e(95).then(r.bind(r,6347))};for(const t in e){const n=e[t].default;B.hljs.registerLanguage(t,n)}return B.hljs.initLineNumbersOnLoad({singleLine:!0}),B.hljs}load(e){const t=this.parser.detectLanguage(),n=document.createElement("div");if(n.className="code","json"===t){const e=this._buildButtonsJson(n);this.nodeView.appendChild(e.render())}this.nodeView.appendChild(n),this.parser.getText((async(i,s)=>{this._originalText=s,n.textContent=s;const a=await B.initHljs();t&&(n.className+=" language-"+t,a.highlightElement(n)),a.lineNumbersBlock(n),this.mdAdd("Lines",(s.match(/\n/g)||[]).length),this.buildMetaNode(),this._openWindow({width:1e3}),e?.()}))}}class z extends b{canHandleImport(e){return l.isTypeText(e.mimeType,e.ext,e.file.name.toLowerCase())?y:f}getView(){return this._view??=new B(this.getParser()),this._view}}class G extends d{constructor(e,t){super(e,t)}_getTypes(e){if(!Array.isArray(e.type)||0===e.type.length)return null;let t=e.type.find((e=>e.startsWith("TYPE#")));return t?(t=t.substring(5),t.split(",")):e.type}build(e,t){const n=document.createElement("div");n.className="vcard";const i=document.createElement("h3");if(i.className="name",i.textContent=e.fn,n.append(i),e.title){const t=document.createElement("h4");t.className="title",t.textContent=e.title.join(", "),n.append(t)}const s=document.createElement("table");if(e.n["honorific-prefix"]){const t=e.n["honorific-prefix"].join(" "),n=te.buildTableRow("Name prefix",t);s.append(n)}if(e.n["given-name"]){const t=e.n["given-name"].join(" "),n=te.buildTableRow("Given name",t);s.append(n)}if(e.n["family-name"]){const t=e.n["family-name"].join(" "),n=te.buildTableRow("Family name",t);s.append(n)}if(e.photo){const n=te.buildTableRow("Photo",e.photo),i=t.match(/\nPHOTO.+[\r]?\n/);let a=null;if(i){let e=i[0];if(e.startsWith("PHOTO:data:")&&e.includes("base64"))a=e.substring(11,e.indexOf(";base64"));else if(e.includes("ENCODING=b")){const t=e.match(/;TYPE=([a-z0-9\/]+)[;:]/i);t&&t.length>=2&&(a=t[0])}else if(e.includes("ENCODING=BASE64")){const t=e.match(/;([a-z0-9\/]+)[;:]/i);t&&t.length>=2&&(a=t[0])}a&&(a=a.toLowerCase(),a.startsWith("image/")||(a="image/"+a))}if(a){n.querySelector("td").innerHTML=`<img src="data:${a};base64,${e.photo}" />`}else if(e.photo.includes("://")){n.querySelector("td").innerHTML=`<a href="${e.photo}">${e.photo}</a>`}s.append(n)}if(e.adr){const t=e=>{let t="Adr.";const n=this._getTypes(e);n&&(t+=` (${n.join(", ")})`);let i=e.value.split(";").filter((e=>e.length>0)).map((e=>e+"<br>")).join("");const a=te.buildTableRow(t,i,{valueAsHTML:!0});s.append(a)};Array.isArray(e.adr)?e.adr.forEach((e=>t(e))):t(e.adr)}return e.org&&e.org.forEach((e=>{let t=e["organization-name"];e["organization-unit"]&&(t+=", "+e["organization-unit"]);const n=te.buildTableRow("Organization",t);s.append(n)})),e.email&&e.email.forEach((e=>{let t="Email";const n=this._getTypes(e);n&&(t+=` (${n.join(", ")})`);const i=te.buildTableRow(t,e.value);if(e.value.includes("@")){i.querySelector("td").innerHTML=`<a href="mailto:${e.value}">${e.value}</a>`}s.append(i)})),e.tel&&e.tel.forEach((e=>{let t="Tel.";const n=this._getTypes(e);n&&(t+=` (${n.join(", ")})`);const i=te.buildTableRow(t,e.value);if(e.value.startsWith("tel:")){const t=e.value.substring(4),n=e.value.replaceAll(/-/g,"");i.querySelector("td").innerHTML=`<a href="${n}">${t}</a>`}s.append(i)})),n.append(s),n}getHTML(e){this.getText(((t,n)=>{const i=(n.match(/BEGIN:VCARD[\r]?\n/g)||[]).length;let s=0;const a=document.createElement("div");a.className="container",this.parse(n,(t=>{s++;const r=this.build(t,n);a.append(r),s===i&&e(null,a)}))}))}parse(e,t){r.e(776).then(r.t.bind(r,7534,23)).then((n=>{n.VCF.parse(e,t)}))}}class $ extends g{constructor(e){super(e,"vcf")}load(e){this.parser.getHTML(((t,n)=>{this.buildMetaNode(),this.nodeView.append(n),this._openWindow(),e?.()}))}}class X extends b{canHandleImport(e){return"vcf"===e.ext||"text/vcard"===e.mimeType?v:f}getParser(){return this._parser??=new G(this._importData),this._parser}getView(){return this._view??=new $(this.getParser()),this._view}}class K extends g{constructor(e){super(e,"video"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){this._objectURL=URL.createObjectURL(this.parser.file);const t=document.createElement("video");if(t.setAttribute("controls",""),t.setAttribute("preload","metadata"),t.volume=.25,t.canPlayType(this.parser.mimeType))t.addEventListener("loadedmetadata",(()=>{t.videoHeight&&(t.height=t.videoHeight),t.width=t.videoWidth||900,this.mdAdd("Dimensions",t.width+"×"+t.height+" px"),this.mdAdd("Duration",te.formatDuration(1e3*t.duration)),this.buildMetaNode(),this.nodeView.append(t),this._openWindow(),e?.()})),t.src=this._objectURL;else{const t=document.createElement("p");t.className="note",t.textContent=`Playback for video format not supported: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),e()}}}class Y extends b{canHandleImport(e){return e.mimeType?.startsWith("video/")?y:f}getView(){return this._view??=new K(this.getParser()),this._view}}class J extends d{constructor(e,t){super(e,t)}build(e){const t=document.createElement("table");t.className="zip";const n=document.createElement("th");n.className="name",n.textContent="Name";const i=document.createElement("th");i.className="size",i.textContent="Size";const s=document.createElement("th");s.className="date",s.textContent="Date";const a=document.createElement("tr");a.className="head",a.append(n,i,s),t.append(a),this.uncompressedSize=0;for(const n in e.files){const i=e.files[n];let s=i.name,a=(i.name.match(/\//g)||[]).length;i.dir?(a--,s=s.split("/").slice(-2,-1)+"/"):s=s.split("/").pop();const r="····".repeat(a),o=document.createElement("span");o.className="indent",o.textContent=r;const l=document.createElement("span");l.className="text",l.textContent=s;const d=document.createElement("td");d.className="name",d.append(o,l);const c=document.createElement("td");c.className="size",c.textContent=i.dir?"":te.formatSize(i._data.uncompressedSize),i.dir||(this.uncompressedSize+=i._data.uncompressedSize);const h=document.createElement("td");h.className="date",h.textContent=te.formatDate(i.date);const u=document.createElement("tr");u.className=i.dir?"zip-dir":"zip-file",u.append(d,c,h),t.append(u)}return t}getHTML(e){this.getArrayBuffer(((t,n)=>{this.parse(n,((t,n)=>{if(t)return void e(t);const i=this.build(n);e(null,i)}))}))}parse(e,t){r.e(211).then(r.t.bind(r,1710,23)).then((n=>{(new(0,n.default)).loadAsync(e).then((e=>t(null,e)),(e=>t(e,null)))}))}}class Z extends g{constructor(e){super(e,"zip")}load(e){this.parser.getHTML(((t,n)=>{t&&((n=document.createElement("p")).className="note",n.textContent=t.message),this.metaData.push({name:"Uncompressed",value:te.formatSize(this.parser.uncompressedSize)}),this.buildMetaNode();const i=document.createElement("div");i.className="wrap",i.append(n),this.nodeView.append(i),this._openWindow(),e?.()}))}}class Q extends b{canHandleImport(e){return"application/zip"===e.mimeType?y:f}getParser(){return this._parser??=new J(this._importData),this._parser}getView(){return this._view??=new Z(this.getParser()),this._view}}const ee={_basePlugin:new b,_plugins:[],init(){this._plugins=[this._basePlugin,new x,new E,new C,new R,new O,new k,new U,new q,new z,new X,new Y,new Q]},_getImportDataForFile:async e=>({file:e,dir:null,fileList:null,ext:l.getFileExt(e),mimeType:await l.getMimeType(e)}),async _getPluginForDirectoryImport(e){const t=e.createReader();return new Promise(((n,i)=>{t.readEntries((async t=>{let i=this._basePlugin,s=null;if(C.containsDICOMDIRFile(t))s=t;else if(await C.containsDICOMFiles(t))s=t.filter((async e=>await C.isDICOMFile(e))).sort(((e,t)=>e.name.localeCompare(t.name,{numeric:!0})));else{const t=new Error(`No fitting parser for directory entries in ${e.name} found.`);console.error(t)}s&&(i=this._plugins.find((e=>e instanceof C))||i,i.setImportData({file:null,dir:e,fileList:s,ext:null,mimeType:"application/dicom"})),n(i)}),(e=>{console.error(e),n(this._basePlugin)}))}))},async getPluginForImport(e){if(e instanceof FileSystemDirectoryEntry)return await this._getPluginForDirectoryImport(e);const t=await this._getImportDataForFile(e),n=[];this._plugins.forEach((e=>{const i=e.canHandleImport(t);i>0&&n.push({priority:i,plugin:e})})),n.sort(((e,t)=>t.priority-e.priority));const i=n[0]?.plugin||this._basePlugin;return i.setImportData(t),i}},te={_domParser:new DOMParser,_updateMetaInfo(e){const t=document.querySelector("#meta-container");e?(t.style.display="block",t.querySelector(".content").append(e.nodeMeta)):t.style.display=""},_updateViewer(e){const t=document.querySelector("main .viewer"),n=t.querySelector(".note-dragdrop");e?(n.style.display="none",t.append(e.nodeView)):n.style.display=""},build(e){const t=this._domParser.parseFromString(e.trim(),"text/html");let n=null;return t.body.childElementCount>1?(n=document.createDocumentFragment(),n.append(...t.body.children)):(n=t.body.firstChild,n.remove()),n},buildTableRow(e,t,n={}){const i=document.createElement("th");i.textContent=e;const s=document.createElement("td");!0===n.valueAsHTML?s.innerHTML=t:s.textContent=t;const a=document.createElement("tr");return a.append(i,s),a},escapeHTML:e=>e=(e=(e=(e=(e=(e=String(e)).replaceAll("&","&amp;")).replaceAll("<","&lt;")).replaceAll(">","&gt;")).replaceAll('"',"&quot;")).replaceAll("'","&#039;"),formatDate(e){if(!e)return"";let t=e.getUTCFullYear(),n=e.getUTCMonth()+1,i=e.getUTCDate();return n=String(n).padStart(2,"0"),i=String(i).padStart(2,"0"),`${t}-${n}-${i}`},formatDateTime(e){if(!e)return"";const t=this.formatDate(e);let n=e.getUTCHours(),i=e.getUTCMinutes(),s=e.getUTCSeconds();return n=String(n).padStart(2,"0"),i=String(i).padStart(2,"0"),s=String(s).padStart(2,"0"),t+` ${n}:${i}:${s}`},formatDuration(e){let t=Number(e);if(isNaN(t))return e;let n=0,i=["ms","sec","min","h"],s=i[n++];for(t>=1e3&&(t/=1e3,s=i[n],n++);t>=60&&n<i.length;)t/=60,s=i[n],n++;let a=Math.floor(t)+s;if(s!==i[0]){let e=t-Math.floor(t);e*=s===i[1]?1e3:60,e>0&&(a+=" "+Math.floor(e)+i[n-2])}return a},formatSize(e,t=!1){let n=Number(e);if(isNaN(n))return e;let i=t?1024:1e3,s=t?["KiB","MiB","GiB","TiB","PiB"]:["kB","MB","GB","TB","PB"],a="B",r=0;for(;n>=i&&r<s.length;)n/=i,a=s[r],r++;return n.toFixed(1)+" "+a},async open(e){if(!e)return;(await ee.getPluginForImport(e)).getView().load()},removeAllChildren(e){for(;e.firstChild;)e.removeChild(e.lastChild)},update(e){}};ee.init();const ne=new class extends h{render(){super.render();const e=new M({classes:"file-open",text:"Open…"});e.on("click",(e=>{const t=document.createElement("input");t.type="file",t.addEventListener("change",(e=>{te.open(t.files[0])})),t.click()}));const t=new p({title:"Everything Viewer",closable:!1,x:20,y:20,content:[e,te.build('<a href="https://github.com/sebadorn/everything-viewer" id="github">GitHub</a>')]}),n=te.build('\n\t\t\t<main>\n\t\t\t\t<div class="viewer">\n\t\t\t\t\t<div class="note-dragdrop">\n\t\t\t\t\t\t<h1>Everything Viewer</h1>\n\t\t\t\t\t\t<span>Just drag &amp; drop your file here</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</main>\n\t\t'),i=n.querySelector(".viewer"),s=new o(i);return s.on("file",(e=>te.open(e))),s.on("directory",((e,t)=>te.open(e))),this._node=document.createDocumentFragment(),this._node.append(t.render(),n),this._node}};document.body.append(ne.render())})();