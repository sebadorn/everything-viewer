(()=>{"use strict";var e,t,n,a,i={9730:(e,t,n)=>{n.d(t,{n:()=>I});var a=n(7490);class i extends a.V{constructor(e,t){super(e,t)}parse(e){this.getText((async(t,a)=>{const{parse:i}=await n.e(829).then(n.bind(n,304)),s=i(a);e(null,s)}))}}var s=n(3305);class r extends a.V{constructor(e,t){super(e,t),this._domParser=new DOMParser,this._lastParsed=null}_decodeContent(e){return e=(e=e.replaceAll(/=[\r]?\n/g,"")).replaceAll(/(=[0-9A-Z]{2})+/g,(e=>{try{return decodeURIComponent(e.replaceAll("=","%"))}catch(t){return console.error(t,e),e}}))}_removeExternal(e){e.querySelectorAll("img").forEach((e=>{(e.getAttribute("src")||"").startsWith("data:")||e.removeAttribute("src")}));e.querySelectorAll(["audio[src]","embed","iframe",'link[rel="stylesheet"]',"object","script","source","video[src]"].join(",")).forEach((e=>e.remove()));e.querySelectorAll("[background]").forEach((e=>{(e.getAttribute("background")||"").includes("//")&&e.removeAttribute("background")}));e.querySelectorAll("style").forEach((e=>{let t=e.textContent;t=t.replaceAll(/url[ \t]*\([ \t]*.+[ \t]*\)/gi,"url()"),e.textContent=t}))}buildBodyDOM(e){return this._domParser.parseFromString(e,"text/html")}buildHeadersHTML(e){const t=document.createElement("table");e.forEach((e=>{const n=document.createElement("th");n.className="header-name",n.textContent=e.name;const a=document.createElement("td");a.className="header-value",a.textContent=e.value;const i=document.createElement("tr");i.append(n,a),t.append(i)}));const n=document.createElement("div");return n.className="headers",n.append(t),n}buildPlainTextDOM(e){return this._domParser.parseFromString(`<pre>${e}</pre>`,"text/html")}getBodyDOM(e,t){if(e||(e={}),"boolean"!=typeof e.remove_external&&(e.remove_external=!0),this._lastParsed){let n=this._decodeContent(this._lastParsed.body),a=null,i=this.getHeader(this._lastParsed.headers,"content-type")||"";i=i.toLowerCase();let s="plaintext";i.startsWith("text/html")?(a=this.buildBodyDOM(n,e),s="html"):a=this.buildPlainTextDOM(n),a&&e.remove_external&&this._removeExternal(a),t(null,a,s)}else this.getText(((n,a)=>{this.parse(a),this._lastParsed?this.getBodyDOM(e,t):t(new Error("Failed to parse"),null,null)}))}getHeader(e,t){e=e||{};for(const n of e)if(n.name.toLowerCase()===t)return n.value;return null}getHeadersHTML(e){if(this._lastParsed){const t=this.buildHeadersHTML(this._lastParsed.headers);e(null,t)}else this.getText(((t,n)=>{const a=this.parse(n),i=this.buildHeadersHTML(a.headers);e(null,i)}))}parse(e){this._lastParsed=null;let t=(e=e.trimStart()).split("\r\n\r\n");if(2!==t.length&&(t=e.split("\n\n")),t.length<2)return null;const n=t.splice(0,1)[0].trim(),a={headers:[],body:t.join("\n\n")};let i=null,s=null,r=!0,o=n.split("\r\n");1===o.length&&(o=n.split("\n"));for(const e of o)if(e.startsWith(" ")||e.startsWith("\t")?(s+=e.trimStart(),r=!1):i&&(a.headers.push({name:i,value:s}),r=!0),r){const t=e.split(": ");i=t[0],s=t.slice(1).join(": ")}return i&&a.headers.push({name:i,value:s}),this._lastParsed=a,a}}class o extends a.V{constructor(e,t){super(e,t)}parse(e){this.getArrayBuffer((async(t,a)=>{const{GifReader:i}=await n.e(900).then(n.t.bind(n,4399,19));let s=null;try{s=new i(new Uint8Array(a))}catch(t){return console.error(t),void e(t,null)}e(null,s)}))}}var l=n(2798);class c extends a.V{constructor(e,t){super(e,t)}_buildHTMLComponent(e){const t=document.createElement("div");t.className="container";const n=document.createElement("table"),a=e.summary||"(no summary)",i=document.createElement("h2");i.className="summary",i.textContent=a,e.color&&(i.style.backgroundColor=e.color);const s=this._getParameterValue(e,"status");if(s){const e=document.createElement("span");e.className="state",e.textContent=s,i.append(e)}const r=this._getParameterValue(e,"class");if(r){const e=document.createElement("span");e.className="state",e.textContent=r,i.append(e)}if(t.append(i),e.description){const n=document.createElement("div");n.className="description",n.innerHTML=e.description.replaceAll(/\n/g,"<br>"),t.append(n)}if(e.startDate){const t=this._buildHTMLTableRowTime("Start",e.startDate);if(n.append(t),e.endDate){const t=this._buildHTMLTableRowTime("End",e.endDate);n.append(t)}if(e.duration){const t=1e3*e.duration.toSeconds(),a=l.UI.buildTableRow("Duration",l.UI.formatDuration(t));n.append(a)}}const o=e.component.jCal[1].filter((e=>"freebusy"===e[0]));o.length>0&&o.forEach((e=>{const t=e[3],a=ICAL.Time.fromDateTimeString(t[0]),i=this._buildTimeSelect(a);let s=null,r="";if(t[1].length>=16){const e=ICAL.Time.fromDateTimeString(t[1]);s=this._buildTimeSelect(e),r=" – "}else s=t[1],r=" / ";const o=l.UI.buildTableRow("Period",""),c=o.querySelector("td");c.innerHTML="",c.append(i,r,s),n.append(o)}));const c=this._getParameterValue(e,"due");if(c){const e=ICAL.Time.fromDateTimeString(c),t=this._buildHTMLTableRowTime("Due",e);n.append(t)}if(e.location){const t=l.UI.buildTableRow("Location",e.location);t.className="location",n.append(t)}if(e.organizer){const t=e.component.jCal[1].find((e=>"organizer"===e[0]));let a=t?.[1]?.cn||e.organizer.replace(/^mailto:/,"");const i=l.UI.buildTableRow("Organizer",a);if(i.className="organizer",e.organizer.startsWith("mailto:")){const t=document.createElement("a");t.href=e.organizer,t.textContent=a;const n=i.querySelector("td");n.innerHTML="",n.append(t)}n.append(i)}if(Array.isArray(e.attendees)&&e.attendees.length>0){const t=l.UI.buildTableRow("Attendees","");t.className="attendees";const a=document.createElement("ul");e.attendees.forEach((e=>{const t=document.createElement("a");t.href=e.getFirstValue(),t.textContent=e.getParameter("cn")||t.href.replace(/^mailto:/,"");const n=document.createElement("li");if(n.append(t),e.getParameter("partstat")){const t=document.createElement("span");t.className="state",t.textContent=e.getParameter("partstat"),n.append(t)}a.append(n)}));t.querySelector("td").append(a),n.append(t)}const d=this._getParameterValue(e,"comment");if(d){const e=l.UI.buildTableRow("Comment",d);n.append(e)}const u=this._getParameterValue(e,"url");if(u){const e=l.UI.buildTableRow("URL",u),t=document.createElement("a");t.href=u,t.textContent=u;const a=e.querySelector("td");a.innerHTML="",a.append(t),n.append(e)}t.append(n);const m=this._buildHTMLVAlarms(e);return m&&t.append(m),t}_buildHTMLTableRowTime(e,t){const n=this._buildTimeSelect(t),a=l.UI.buildTableRow(e,"");return a.className=e.toLowerCase(),a.querySelector("td").append(n),a}_buildHTMLVAlarm(e){if(!Array.isArray(e))return null;const t=document.createElement("div");t.className="valarm";const n=e.find((e=>"description"===e[0]));if(n&&n[3]){const e=document.createElement("div");e.className="alarm-description",e.textContent=n[3],t.append(e)}const a=document.createElement("table"),i=e.find((e=>"trigger"===e[0]));if(i&&i[3]){const e=l.UI.buildTableRow("Trigger",i[3]);a.append(e)}const s=e.find((e=>"duration"===e[0]));if(s&&s[3]){const e=l.UI.buildTableRow("Duration",s[3]);a.append(e)}const r=e.find((e=>"repeat"===e[0]));if(r&&r[3]){const e=l.UI.buildTableRow("Repeat",r[3]);a.append(e)}const o=e.find((e=>"action"===e[0]));if(o&&o[3]){const e=l.UI.buildTableRow("Action",o[3]);a.append(e)}const c=e.find((e=>"attach"===e[0]));if(c&&c[3]){const e=l.UI.buildTableRow("Attach",c[3]);a.append(e)}return t.append(a),t}_buildHTMLVAlarms(e){const t=e.component.jCal[2];if(!Array.isArray(t))return null;const n=t.filter((e=>"valarm"===e[0]));if(0===n.length)return null;const a=document.createElement("div");return a.className="valarms",n.forEach((e=>{const t=this._buildHTMLVAlarm(e[1]);t&&a.append(t)})),a}_buildTimeSelect(e){const t={UTC:l.UI.formatDateTime(e.toJSDate()),ICAL:e.toString(),Unix:e.toUnixTime()};e.timezone&&(t.ICAL+=` (${e.timezone})`);const n=document.createElement("select");for(const e in t){const a=t[e],i=document.createElement("option");i.value=e,i.textContent=a+` [${e}]`,n.append(i)}return n}_getParameterValue(e,t){const n=e.component.jCal;if(!Array.isArray(n)||!Array.isArray(n[1]))return null;const a=n[1].find((e=>e[0]===t));return Array.isArray(a)?a[3]:null}build(e){const t=document.createElement("div");t.className="ical";const n=new this.ICAL.Component(e),a=n.getAllSubcomponents("vevent"),i=n.getAllSubcomponents("vtodo"),s=n.getAllSubcomponents("vjournal"),r=n.getAllSubcomponents("vfreebusy");return a.concat(i).concat(s).concat(r).forEach((e=>{const n=new this.ICAL.Event(e),a=this._buildHTMLComponent(n);a.className+=" "+e.jCal[0],t.append(a)})),t}getHTML(e){this.getText(((t,n)=>{this.parse(n,(t=>{const n=this.build(t);e(null,n)}))}))}parse(e,t){n.e(859).then(n.bind(n,8202)).then((n=>{this.ICAL=n.default;const a=this.ICAL.parse(e);t(a)}))}}class d extends a.V{constructor(e,t){super(e,t)}_getTypes(e){if(!Array.isArray(e.type)||0===e.type.length)return null;let t=e.type.find((e=>e.startsWith("TYPE#")));return t?(t=t.substring(5),t.split(",")):e.type}build(e,t){const n=document.createElement("div");n.className="vcard";const a=document.createElement("h3");if(a.className="name",a.textContent=e.fn,n.append(a),e.title){const t=document.createElement("h4");t.className="title",t.textContent=e.title.join(", "),n.append(t)}const i=document.createElement("table");if(e.n["honorific-prefix"]){const t=e.n["honorific-prefix"].join(" "),n=l.UI.buildTableRow("Name prefix",t);i.append(n)}if(e.n["given-name"]){const t=e.n["given-name"].join(" "),n=l.UI.buildTableRow("Given name",t);i.append(n)}if(e.n["family-name"]){const t=e.n["family-name"].join(" "),n=l.UI.buildTableRow("Family name",t);i.append(n)}if(e.photo){const n=l.UI.buildTableRow("Photo",e.photo),a=t.match(/\nPHOTO.+[\r]?\n/);let s=null;if(a){let e=a[0];if(e.startsWith("PHOTO:data:")&&e.includes("base64"))s=e.substring(11,e.indexOf(";base64"));else if(e.includes("ENCODING=b")){const t=e.match(/;TYPE=([a-z0-9\/]+)[;:]/i);t&&t.length>=2&&(s=t[0])}else if(e.includes("ENCODING=BASE64")){const t=e.match(/;([a-z0-9\/]+)[;:]/i);t&&t.length>=2&&(s=t[0])}s&&(s=s.toLowerCase(),s.startsWith("image/")||(s="image/"+s))}if(s){n.querySelector("td").innerHTML=`<img src="data:${s};base64,${e.photo}" />`}else if(e.photo.includes("://")){n.querySelector("td").innerHTML=`<a href="${e.photo}">${e.photo}</a>`}i.append(n)}if(e.adr){const t=e=>{let t="Adr.";const n=this._getTypes(e);n&&(t+=` (${n.join(", ")})`);let a=e.value.split(";").filter((e=>e.length>0)).map((e=>e+"<br>")).join("");const s=l.UI.buildTableRow(t,a,{valueAsHTML:!0});i.append(s)};Array.isArray(e.adr)?e.adr.forEach((e=>t(e))):t(e.adr)}return e.org&&e.org.forEach((e=>{let t=e["organization-name"];e["organization-unit"]&&(t+=", "+e["organization-unit"]);const n=l.UI.buildTableRow("Organization",t);i.append(n)})),e.email&&e.email.forEach((e=>{let t="Email";const n=this._getTypes(e);n&&(t+=` (${n.join(", ")})`);const a=l.UI.buildTableRow(t,e.value);if(e.value.includes("@")){a.querySelector("td").innerHTML=`<a href="mailto:${e.value}">${e.value}</a>`}i.append(a)})),e.tel&&e.tel.forEach((e=>{let t="Tel.";const n=this._getTypes(e);n&&(t+=` (${n.join(", ")})`);const a=l.UI.buildTableRow(t,e.value);if(e.value.startsWith("tel:")){const t=e.value.substring(4),n=e.value.replaceAll(/-/g,"");a.querySelector("td").innerHTML=`<a href="${n}">${t}</a>`}i.append(a)})),n.append(i),n}getHTML(e){this.getText(((t,n)=>{const a=(n.match(/BEGIN:VCARD[\r]?\n/g)||[]).length;let i=0;const s=document.createElement("div");s.className="container",this.parse(n,(t=>{i++;const r=this.build(t,n);s.append(r),i===a&&e(null,s)}))}))}parse(e,t){n.e(776).then(n.t.bind(n,7534,23)).then((n=>{n.VCF.parse(e,t)}))}}class u extends a.V{constructor(e,t){super(e,t)}build(e){const t=document.createElement("table");t.className="zip";const n=document.createElement("th");n.className="name",n.textContent="Name";const a=document.createElement("th");a.className="size",a.textContent="Size";const i=document.createElement("th");i.className="date",i.textContent="Date";const s=document.createElement("tr");s.className="head",s.append(n,a,i),t.append(s),this.uncompressedSize=0;for(const n in e.files){const a=e.files[n];let i=a.name,s=(a.name.match(/\//g)||[]).length;a.dir?(s--,i=i.split("/").slice(-2,-1)+"/"):i=i.split("/").pop();const r="····".repeat(s),o=document.createElement("span");o.className="indent",o.textContent=r;const c=document.createElement("span");c.className="text",c.textContent=i;const d=document.createElement("td");d.className="name",d.append(o,c);const u=document.createElement("td");u.className="size",u.textContent=a.dir?"":l.UI.formatSize(a._data.uncompressedSize),a.dir||(this.uncompressedSize+=a._data.uncompressedSize);const m=document.createElement("td");m.className="date",m.textContent=l.UI.formatDate(a.date);const h=document.createElement("tr");h.className=a.dir?"zip-dir":"zip-file",h.append(d,u,m),t.append(h)}return t}getHTML(e){this.getArrayBuffer(((t,n)=>{this.parse(n,((t,n)=>{if(t)return void e(t);const a=this.build(n);e(null,a)}))}))}parse(e,t){n.e(211).then(n.t.bind(n,1710,23)).then((n=>{(new(0,n.default)).loadAsync(e).then((e=>t(null,e)),(e=>t(e,null)))}))}}class m{constructor(e,t="base"){this.parser=e,this.type=t,this.metaData=[{name:"Filename",value:this.parser.file.name},{name:"Type",value:this.parser.mimeType},{name:"Filesize",value:l.UI.formatSize(this.parser.file.size)}],this.nodeView=document.createElement("div"),this.nodeView.className="view view-"+this.type,this.nodeMeta=document.createElement("div"),this.nodeMeta.className="meta meta-"+this.type}_buildMetaDataRow(e){const t=document.createElement("tr");if(e.hr){const e=document.createElement("td");e.colSpan=2,t.classList.add("hr"),t.append(e)}else if("string"==typeof e.group){const n=document.createElement("caption");n.textContent=e.group;const a=document.createElement("table");a.classList.add("group-table"),a.append(n),e.items.forEach((e=>{a.append(this._buildMetaDataRow(e))}));const i=document.createElement("td");i.colSpan=2,i.append(a),t.classList.add("group"),t.append(i)}else{const n=e.name,a=e.value,i=document.createElement("th");i.className="name",i.textContent=n+": ";const s=document.createElement("td");s.className="value",s.textContent=a,t.classList.add("item"),t.append(i,s)}return t}buildMetaNode(e={}){if(0===Object.keys(this.metaData).length)return;if(this.nodeMeta&&(this.nodeMeta.querySelector(".meta-table")?.remove(),this.nodeMeta.querySelector(".option-toggle-empty")?.remove()),e.toggleForEmpty){const e=l.UI.build('<div class="option option-toggle-empty"><input type="checkbox" id="metadata-toggle-empty" value="1" /><label for="metadata-toggle-empty">Omit empty entries</label></div>'),t=e.querySelector("input");t.addEventListener("change",(e=>this.toggleEmptyMetaData(t.checked))),this.nodeMeta.append(e)}const t=document.createElement("table");t.className="meta-table",this.metaData.forEach((e=>{const n=this._buildMetaDataRow(e);t.append(n)})),this.nodeMeta.append(t)}destroy(){this.nodeView.remove(),this.nodeMeta.remove()}load(e){const t=document.createElement("p");t.className="note",t.textContent=`No parser found for file of type: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),e()}mdAdd(e,t){this.metaData.push({name:e,value:t})}mdAddGroup(e,t){this.metaData.push({group:e,items:t})}mdHR(){this.metaData.push({hr:1})}toggleEmptyMetaData(e){if(e){const e=t=>{let n=0;const a=t.querySelectorAll(":scope > tr:not([hidden])");a.forEach(((e,t)=>{!e.classList.contains("hr")||0!==t&&t!==a.length-1||(e.setAttribute("hidden",""),n++)})),n>0&&e(t)},t=(t,n)=>{let a=!1;t.forEach((e=>{if(e.classList.contains("hr"))a&&e.setAttribute("hidden",""),a=!0;else{0===e.querySelector("td.value").innerHTML.length?e.setAttribute("hidden",""):a=!1}})),e(n)};this.nodeMeta.querySelectorAll(".meta-table .group-table").forEach((e=>{const n=e.querySelectorAll(":scope > tr.item");t(n,e)}));const n=this.nodeMeta.querySelectorAll(".meta-table > tr.item");t(n,this.nodeMeta)}else{this.nodeMeta.querySelectorAll("tr[hidden]").forEach((e=>e.removeAttribute("hidden")))}}}class h extends m{constructor(e){super(e,"audio"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){this._objectURL=URL.createObjectURL(this.parser.file);const t=document.createElement("audio");if(t.setAttribute("controls",""),t.setAttribute("preload","metadata"),t.volume=.5,t.canPlayType(this.parser.mimeType))t.addEventListener("loadedmetadata",(()=>{this.mdAdd("Duration",Evy.UI.formatDuration(1e3*t.duration)),this.buildMetaNode(),this.nodeView.appendChild(t),e()})),t.src=this._objectURL;else{const t=document.createElement("p");t.className="note",t.textContent=`Playback for audio format not supported: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),e()}}}class p extends m{constructor(e){super(e,"csv")}_build(e){const t=document.createElement("table");for(let n=0;n<e.length;n++){const a=e[n],i=document.createElement("tr"),s=0===n?"th":"td";for(let e=0;e<a.length;e++){const t=document.createElement("span");t.textContent=a[e];const n=document.createElement(s);n.append(t),i.append(n)}t.append(i)}return t}load(e){this.parser.parse(((t,n)=>{this.mdAdd("Columns",n.length>0?n[0].length:0),this.mdAdd("Rows",n.length),this.buildMetaNode();const a=this._build(n);this.nodeView.append(a),e()}))}}class g extends m{constructor(e){super(e,"dicom"),this._frameDelay=250,this._frameIndex=0,this._frameTime=33.333,this._listenerKeyNav=null,this._timer=0}_addMetaInfo(e){this.mdAddGroup("Patient",[{name:"Patient ID",value:e.string("x00100020")},{name:"Issuer of Patient ID",value:e.string("x00100021")},{name:"Type of Patient ID",value:e.string("x00100022")},{hr:1},{name:"Patient Name",value:e.string("x00100010")},{name:"Other Patient Names",value:e.string("x00101001")},{name:"Patient Birth Date",value:e.string("x00100030")},{name:"Patient Birth Time",value:e.string("x00100032")},{name:"Patient Sex",value:e.string("x00100040")},{name:"Ethnic Group",value:e.string("x00102160")},{name:"Patient Breed Desc.",value:e.string("x00102292")},{name:"Patient Species Desc.",value:e.string("x00102201")},{name:"Patient Comments",value:e.string("x00104000")},{name:"Strain Desc.",value:e.string("x00100212")},{name:"Strain Nomenclature",value:e.string("x00100213")},{name:"Strain Addit. Info.",value:e.string("x00100218")},{hr:1},{name:"Responsible Person",value:e.string("x00102297")},{name:"Resp. Person Role",value:e.string("x00102298")},{name:"Resp. Organization",value:e.string("x00102299")}]),this.mdAddGroup("Patient Study",[{name:"Admitting Diagnoses Desc.",value:e.string("x00081080")},{name:"Patient's Age (years)",value:e.string("x00101010")},{name:"Patient's Size (m)",value:e.string("x00101020")},{name:"Patient's BMI",value:e.string("x00101022")},{name:"Measured AP Dimension (mm)",value:e.string("x00101023")},{name:"Measured Lateral Dimension (mm)",value:e.string("x00101024")},{name:"Patient's Weight (kg)",value:e.string("x00101030")},{name:"Medical Alerts",value:e.string("x00102000")},{name:"Allergies",value:e.string("x00102110")},{name:"Occupation",value:e.string("x00102180")},{name:"Smoking Status",value:e.string("x001021a0")},{name:"Addit. Patient History",value:e.string("x001021b0")},{name:"Pregnancy Status",value:s.DICOMParser.getPregnancyStatus(e.string("x001021c0"))},{name:"Last Menstrual Date",value:e.string("x001021d0")},{name:"Patient's Sex Neutered",value:e.string("x00102203")},{name:"Reason for Visit",value:e.string("x00321066")},{name:"Admission ID",value:e.string("x00380010")},{name:"Service Episode ID",value:e.string("x00380060")},{name:"Service Episode Desc.",value:e.string("x00380062")},{name:"Patient State",value:e.string("x00380500")}]),this.mdAddGroup("General Study",[{name:"Study Date",value:e.string("x00080020")},{name:"Study Time",value:e.string("x00080030")},{name:"Accession Number",value:e.string("x00080050")},{name:"Referring Physician Name",value:e.string("x00080090")},{name:"Consulting Physician's Name",value:e.string("x0008109c")},{name:"Study Desc.",value:e.string("x00081030")},{name:"Physician(s) of Record",value:e.string("x00081048")},{name:"Physician(s) Reading Study",value:e.string("x00081060")},{name:"Study ID",value:e.string("x00200010")},{name:"Requesting Service",value:e.string("x00321033")}]),this.mdAddGroup("General Series",[{name:"Series Date",value:e.string("x00080021")},{name:"Series Time",value:e.string("x00080031")},{name:"Modality",value:s.DICOMParser.getModalityName(e.string("x00080060"))},{name:"Series Desc.",value:e.string("x0008103e")},{name:"Performing Physician's Name",value:e.string("x00081050")},{name:"Operator's Name",value:e.string("x00081070")},{name:"Anatomical Orientation Type",value:e.string("x00102210")},{name:"Body Part Examined",value:e.string("x00180015")},{name:"Protocol Name",value:e.string("x00181030")},{name:"Patient Position",value:e.string("x00185100")},{name:"Series Number",value:e.string("x00200011")},{name:"Laterality",value:e.string("x00200060")},{name:"Performed Procedure Step Desc.",value:e.string("x00400254")},{name:"Comments on the Procedure Step",value:e.string("x00400280")}]),this.mdAddGroup("General Image",[{name:"Image Type",value:e.string("x00080008")},{name:"Patient Orientation",value:e.string("x00200020")},{name:"Image Laterality",value:e.string("x00200062")},{name:"Image Comments",value:e.string("x00204000")}]),this.mdAddGroup("General Equipment",[{name:"Manufacturer",value:e.string("x00080070")},{name:"Institution Name",value:e.string("x00080080")},{name:"Institution Address",value:e.string("x00080081")},{name:"Station Name",value:e.string("x00081010")},{name:"Institutional Department Name",value:e.string("x00081040")},{name:"Manufacturer's Model Name",value:e.string("x00081090")},{name:"Device Serial Number",value:e.string("x00181000")},{name:"Device UID",value:e.string("x00181002")},{name:"Gantry ID",value:e.string("x00181008")},{name:"Software Versions",value:e.string("x00181020")},{name:"Spatial Resolution",value:e.string("x00181050")},{name:"Date of Last Calibration",value:e.string("x00181200")},{name:"Time of Last Calibration",value:e.string("x00181201")}])}_buildControls(){const e=l.UI.build(`\n\t\t\t<div class="image-container"></div>\n\t\t\t<div class="actions">\n\t\t\t\t<input type="range" min="1" max="${this._numFrames}" value="1" />\n\t\t\t\t<div class="line">\n\t\t\t\t\t<div class="wrap wrap-frame-controls">\n\t\t\t\t\t\t<button class="frame-prev">&larr;</button>\n\t\t\t\t\t\t<span class="counter"></span>\n\t\t\t\t\t\t<button class="frame-next">&rarr;</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="wrap wrap-playback">\n\t\t\t\t\t\t<button class="play-pause">▶</button>\n\t\t\t\t\t\t<select class="speed">\n\t\t\t\t\t\t\t<option value="${this._frameTime}">Default: ${this._frameTime} ms</option>\n\t\t\t\t\t\t\t<option value="16.7">16.7 ms</option>\n\t\t\t\t\t\t\t<option value="33.3">33.3 ms</option>\n\t\t\t\t\t\t\t<option value="66.7">66.7 ms</option>\n\t\t\t\t\t\t\t<option value="133.3">133.3 ms</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);if(this._frameIndex=0,this._numFrames<=2)e.querySelector(".actions").remove();else{const t=e.querySelector('input[type="range"]');t.addEventListener("change",(e=>{this._frameIndex=e.target.valueAsNumber-1,this._controlGoto(this._frameIndex)}));e.querySelector("button.frame-prev").addEventListener("click",(e=>{this._controlGoto(--this._frameIndex),t.value=this._frameIndex+1}));e.querySelector("button.frame-next").addEventListener("click",(e=>{this._controlGoto(++this._frameIndex),t.value=this._frameIndex+1}));const n=e.querySelector("select.speed");n.addEventListener("change",(e=>{this._frameTime=Number(n.value)}));const a=e.querySelector("button.play-pause");a.addEventListener("click",(e=>{this._timer?(a.textContent="▶",clearTimeout(this._timer),this._timer=0):(a.textContent="⏸",this._playback(t))})),this._listenerKeyNav=e=>{const n=document.activeElement;n&&"range"===n.type||("ArrowLeft"===e.key?(this._controlGoto(--this._frameIndex),t.value=this._frameIndex+1):"ArrowRight"===e.key&&(this._controlGoto(++this._frameIndex),t.value=this._frameIndex+1))},document.body.addEventListener("keyup",this._listenerKeyNav),this._counter=e.querySelector(".counter")}this.nodeView.append(e)}_buildDICOMDIRFileList(e){const t=document.createElement("ol");e.forEach((e=>{const n=document.createElement("li");n.textContent=e,t.append(n)}));const n=document.createElement("wrap");n.className="dicomdir-list",n.append(t),this.nodeView.append(n)}_controlGoto(e){this._frameIndex=this.showImage(e),this._counter&&(this._counter.textContent=this._frameIndex+1+"/"+this._numFrames)}async _initViewport(){const{RenderingEngine:e}=await Promise.all([n.e(960),n.e(178),n.e(483)]).then(n.bind(n,6178)),{OrientationAxis:t,ViewportType:a}=await n.e(136).then(n.bind(n,3286)),i=this.nodeView.querySelector(".image-container");this._renderingEnginge=new e,this._renderingEnginge.enableElement({viewportId:"ctStack",type:a.STACK,element:i,defaultOptions:{orientation:t.AXIAL}}),this._viewport=this._renderingEnginge.getViewport("ctStack")}_playback(e){if(this._timer)return;const t=0===this._frameIndex?this._frameDelay:0;this._timer=setTimeout((()=>{this._controlGoto(++this._frameIndex),e.value=this._frameIndex+1,this._timer=0,this._playback(e)}),this._frameTime+t)}destroy(){super.destroy(),clearTimeout(this._timer),this.parser.destroy(),this._images=null,this._imageId=null,document.body.removeEventListener("keyup",this._listenerKeyNav)}load(e){this.parser.parse((async(t,n)=>{if(!t)if(this.parser.isDir)this.parser.loadDICOMDIRFiles(n,(async(t,n)=>{this._images=n,this._numFrames=this._images.length,this._buildControls(),e(),await this._initViewport(),this._viewport.setStack(this._images.map((e=>e.imageId))),this.showFile(0),this._controlGoto(0)}));else if(Array.isArray(n))this._buildDICOMDIRFileList(n),this.buildMetaNode(),e();else{const t=n.data;this._numFrames=Number(t.string("x00280008")||1),this._frameDelay=Number(t.string("x00181033")||this._frameDelay),this._frameTime=Number(t.string("x00181063")||this._frameTime),this._addMetaInfo(t),this.buildMetaNode({toggleForEmpty:!0}),this._buildControls(),e(),this._imageId=n.imageId,await this._initViewport();let a=[];for(let e=0;e<this._numFrames;e++){let t=e>0?this._imageId+"?frame="+e:this._imageId;a.push(t)}this._viewport.setStack(a),this._controlGoto(0)}}))}showFile(e){e>=this._images.length?e=0:e<0&&(e=this._images.length-1);const t=this._images[e],n=t.data;return this._frameDelay=Number(n.string("x00181033")||this._frameDelay),this._frameTime=Number(n.string("x00181063")||this._frameTime),this._addMetaInfo(n),this.buildMetaNode({toggleForEmpty:!0}),this._imageId=t.imageId,e}showImage(e){return e>=this._numFrames?e=0:e<0&&(e=this._numFrames-1),this._viewport.setImageIdIndex(e),e}}var f=n(1094),y=n(9108);class b extends y.u{constructor(e){super(),this._buttons=e}_toggle(e){this._buttons.forEach((e=>e._node.classList.remove("selected"))),e._node.classList.add("selected")}render(){super.render(),this._node=l.UI.build('<div class="button-group"></div>');for(let e=0;e<this._buttons.length;e++){const t=this._buttons[e];t.on("click",(()=>this._toggle(t))),this._node.append(t.render())}return this._node}}class v extends m{constructor(e){super(e,"eml")}_buildActions(){return new b([new f.$({text:"Show Headers",onClick:()=>{this.nodeView.querySelector("iframe.content-res ")?.remove();this.nodeView.querySelector("iframe.content-no-res").style.display="none";this.nodeView.querySelector(".headers").style.display=""}}),new f.$({text:"Content (no external)",classes:"selected",onClick:()=>{this.nodeView.querySelector("iframe.content-res ")?.remove();this.nodeView.querySelector("iframe.content-no-res").style.display="";this.nodeView.querySelector(".headers").style.display="none"}}),new f.$({text:"Content (with external)",onClick:()=>{if(!window.confirm("Show the content and load its external resources?\nThis could pose a security risk.\n\nOnly agree if you trust the EML file."))return!1;this.nodeView.querySelector("iframe.content-res ")?.remove();this.nodeView.querySelector("iframe.content-no-res").style.display="none";this.nodeView.querySelector(".headers").style.display="none",this.parser.getBodyDOM({remove_external:!1},((e,t,n)=>{const a=document.createElement("iframe");a.className=`content-res eml-type-${n}`,a.setAttribute("sandbox",""),a.setAttribute("srcdoc",t.documentElement.outerHTML),this.nodeView.append(a)}))}})]).render()}load(e){const t=document.createElement("iframe");t.className="content-no-res",t.setAttribute("sandbox",""),this.parser.getBodyDOM({remove_external:!0},((n,a,i)=>{this.parser.getHeadersHTML(((n,s)=>{this.buildMetaNode();const r=this._buildActions();s.style.display="none",t.classList.add(`eml-type-${i}`),t.setAttribute("srcdoc",a.documentElement.outerHTML),this.nodeView.append(r,s,t),e()}))}))}}class _ extends m{constructor(e){super(e,"gif"),this._currentCanvas=null,this._frameIndex=0,this._frames=[],this._gifReader=null,this._listenerKeyNav=null}_buildSlideshow(e){const t=this._gifReader.numFrames(),n=l.UI.build(`\n\t\t\t<div class="frame-container"></div>\n\t\t\t<div class="actions">\n\t\t\t\t<input type="range" min="1" max="${t}" value="1" />\n\t\t\t\t<div class="line">\n\t\t\t\t\t<button class="frame-prev">&larr;</button>\n\t\t\t\t\t<span class="counter"></span>\n\t\t\t\t\t<button class="frame-next">&rarr;</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);this._frameIndex=0,this._generateFrames((()=>{const t=n.querySelector('input[type="range"]');t.addEventListener("change",(e=>{this._frameIndex=e.target.valueAsNumber-1,this.showFrame(this._frameIndex)}));n.querySelector("button.frame-prev").addEventListener("click",(e=>{this.showFrame(--this._frameIndex),t.value=this._frameIndex+1}));n.querySelector("button.frame-next").addEventListener("click",(e=>{this.showFrame(++this._frameIndex),t.value=this._frameIndex+1})),this._listenerKeyNav=e=>{const n=document.activeElement;n&&"range"===n.type||("ArrowLeft"===e.key?(this.showFrame(--this._frameIndex),t.value=this._frameIndex+1):"ArrowRight"===e.key&&(this.showFrame(++this._frameIndex),t.value=this._frameIndex+1))},document.body.addEventListener("keyup",this._listenerKeyNav),this._counter=n.querySelector(".counter"),e(n)}))}_generateFrame(e,t){const n=this._gifReader.width,a=this._gifReader.height,i=document.createElement("canvas");i.width=n,i.height=a,i.style.width=n+"px",i.style.height=a+"px";const s=i.getContext("2d");if(0===e){const r=new ImageData(n,a);return this._lastNonDisposedImgData=r,this._gifReader.decodeAndBlitFrameRGBA(e,r.data),s.putImageData(r,0,0),void t(i)}const r=this._gifReader.frameInfo(e-1);let o=null;if(r.disposal<=1||3===r.disposal){const e=Uint8ClampedArray.from(this._lastNonDisposedImgData.data);o=new ImageData(e,n,a)}else o=new ImageData(n,a);this._gifReader.decodeAndBlitFrameRGBA(e,o.data);this._gifReader.frameInfo(e).disposal<=1&&(this._lastNonDisposedImgData=o),s.putImageData(o,0,0),t(i)}_generateFrames(e){const t=this._gifReader.numFrames(),n=a=>{a>=t?e():this._generateFrame(a,(e=>{this._frames.push(e),n(a+1)}))};n(0)}destroy(){super.destroy(),document.body.removeEventListener("keyup",this._listenerKeyNav)}load(e){this.parser.parse(((t,n)=>{this._gifReader=n,this.mdAdd("Dimensions",n.width+"×"+n.height+" px"),this.mdAdd("Frames",n.numFrames()),this.buildMetaNode(),this._buildSlideshow((t=>{this.nodeView.append(t),this.showFrame(this._frameIndex),e()}))}))}showFrame(e){const t=this._gifReader.numFrames();e>=t?e=0:e<0&&(e=t-1),this._currentCanvas&&this._currentCanvas.remove(),this._frameIndex=e,this._currentCanvas=this._frames[e];this.nodeView.querySelector(".frame-container").append(this._currentCanvas),this._counter.textContent=e+1+"/"+t}}class x extends m{constructor(e){super(e,"ical")}load(e){this.parser.getHTML(((t,n)=>{this.buildMetaNode(),this.nodeView.append(n),e()}))}}class w extends m{constructor(e){super(e,"image"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){const t=new Image;t.onload=()=>{t.height=t.naturalHeight,t.width=t.naturalWidth,this.mdAdd("Dimensions",t.naturalWidth+"×"+t.naturalHeight+" px"),this.buildMetaNode(),this.nodeView.append(t),e()},t.onerror=()=>{const t=document.createElement("p");t.className="note",t.textContent=`Image format not supported: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),e()},this._objectURL=URL.createObjectURL(this.parser.file),t.src=this._objectURL}}class T extends m{constructor(e){super(e,"pdf"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){this._objectURL=URL.createObjectURL(this.parser.file);const t=document.createElement("iframe");t.src=this._objectURL,this.buildMetaNode(),this.nodeView.appendChild(t),e()}}class E extends m{constructor(e){super(e,"text")}static async initHljs(){if(E.hljs)return E.hljs;E.hljs=(await n.e(755).then(n.bind(n,11))).default;const e={bash:await n.e(140).then(n.bind(n,9510)),cmake:await n.e(383).then(n.bind(n,7237)),diff:await n.e(255).then(n.bind(n,6551)),dns:await n.e(659).then(n.bind(n,3561)),ini:await n.e(720).then(n.bind(n,6e3)),javascript:await n.e(527).then(n.bind(n,5603)),json:await n.e(792).then(n.bind(n,7402)),makefile:await n.e(974).then(n.bind(n,3308)),markdown:await n.e(617).then(n.bind(n,3265)),powershell:await n.e(265).then(n.bind(n,1569)),typescript:await n.e(311).then(n.bind(n,5387)),xml:await n.e(529).then(n.bind(n,9359)),yaml:await n.e(95).then(n.bind(n,6347))};for(const t in e){const n=e[t].default;E.hljs.registerLanguage(t,n)}return E.hljs}load(e){const t=document.createElement("div");t.className="code",this.nodeView.appendChild(t),this.parser.getText((async(n,a)=>{t.textContent=a;const i=this.parser.detectLanguage();if(i){const e=await E.initHljs();t.className+=" language-"+i,e.highlightElement(t)}this.mdAdd("Lines",(a.match(/\n/g)||[]).length),this.buildMetaNode(),e()}))}}class D extends m{constructor(e){super(e,"vcf")}load(e){this.parser.getHTML(((t,n)=>{this.buildMetaNode(),this.nodeView.append(n),e()}))}}class S extends m{constructor(e){super(e,"video"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){this._objectURL=URL.createObjectURL(this.parser.file);const t=document.createElement("video");if(t.setAttribute("controls",""),t.setAttribute("preload","metadata"),t.volume=.25,t.canPlayType(this.parser.mimeType))t.addEventListener("loadedmetadata",(()=>{t.videoHeight&&(t.height=t.videoHeight),t.width=t.videoWidth||900,this.mdAdd("Dimensions",t.width+"×"+t.height+" px"),this.mdAdd("Duration",Evy.UI.formatDuration(1e3*t.duration)),this.buildMetaNode(),this.nodeView.append(t),e()})),t.src=this._objectURL;else{const t=document.createElement("p");t.className="note",t.textContent=`Playback for video format not supported: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),e()}}}class M extends m{constructor(e){super(e,"zip")}load(e){this.parser.getHTML(((t,n)=>{t&&((n=document.createElement("p")).className="note",n.textContent=t.message),this.metaData.push({name:"Uncompressed",value:l.UI.formatSize(this.parser.uncompressedSize)}),this.buildMetaNode();const a=document.createElement("div");a.className="wrap",a.append(n),this.nodeView.append(a),e()}))}}const I={extToMimeType(e){if(!e)return null;return{csv:"text/csv",ical:"text/calendar",ics:"text/calendar",ifb:"text/calendar",vcf:"text/vcard",vcs:"text/calendar"}[e=e.toLowerCase().trim()]||null},getFileExt:e=>e.name.split(".").pop().toLowerCase(),async getMimeType(e){const t=await e.slice(0,348).arrayBuffer(),n=new Uint8Array(t).reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),""),a=e.type||this.extToMimeType(this.getFileExt(e));return this.headerToMimeType(n,a)},async getParser(e,t){const n=this.getFileExt(e),l=await this.getMimeType(e);let m=null;m="csv"===n?new i(e,l):"application/dicom"===l?new s.DICOMParser({file:e,mimeType:l}):"eml"===n?new r(e,l):"text/calendar"===l||["ical","ics","ifb","vcs"].includes(n)?new c(e,l):"vcf"===n||"text/vcard"===l?new d(e,l):"application/zip"===l?new u(e,l):"image/gif"===l?new o(e,l):new a.V(e,l),t(null,m)},getView(e){if(e.isDir){if(e instanceof s.DICOMParser)return new g(e)}else if(e.mimeType||e.file.size>0){const t=this.getFileExt(e.file),n=String(e.mimeType).toLowerCase(),a=e.file.name.toLowerCase();if("application/pdf"===n)return new T(e);if(n.startsWith("audio/"))return new h(e);if(e instanceof i)return new p(e);if(e instanceof s.DICOMParser)return new g(e);if(e instanceof r)return new v(e);if(e instanceof c)return new x(e);if(e instanceof u)return new M(e);if(e instanceof o)return new _(e);if(n.startsWith("image/"))return new w(e);if(e instanceof d)return new D(e);if(n.startsWith("video/"))return new S(e);if(this.isTypeText(n,t,a))return new E(e)}return new m(e)},headerToMimeType(e,t=null){let n=null,a=e.substring(0,8);switch(a){case"47494638":n="image/gif";break;case"89504e47":n="image/png";break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":n="image/jpeg"}return!n&&e.length>8&&("4449434d"===e.substring(256,264)?(a="4449434d",n="application/dicom"):"6e2b31"===e.substring(688,694)&&(a="6e2b3100",n="application/octet-stream")),n?console.log(`[FileHandler.headerToMimeType] "${a}" -> ${n}`):t?(n=t,console.log(`[FileHandler.headerToMimeType] Using "${n}" based on extension.`)):(a.startsWith("2321")?n="application/x-shellscript":a.startsWith("efbbbf")||a.startsWith("feff")||a.startsWith("fffe")||a.startsWith("0000feff")||a.startsWith("2b2f7638")||a.startsWith("2b2f7639")||a.startsWith("2b2f762b")||a.startsWith("2b2f762f")?n="text/plain":(a.startsWith("504b34")||a.startsWith("504b0304")||a.startsWith("504b0506"))&&(n="application/zip"),n&&console.log(`[FileHandler.headerToMimeType] Guessing "${a}" -> ${n}`)),n||console.log(`[FileHandler.headerToMimeType] Failed to find MIME type for header "${a}".`),n},isDICOMFile:e=>e?.isFile?e.name.toLocaleLowerCase().endsWith(".dcm")?new Promise(((e,t)=>e(!0))):new Promise(((t,n)=>{e.file((async e=>{const n=await I.getMimeType(e);t("application/dicom"===n)}),(e=>{console.error("[FileHandler.isDICOMFile]",e),t(!1)}))})):new Promise(((e,t)=>e(!1))),isTypeText(e,t,n){if(e.startsWith("text/")||e.startsWith("message/"))return!0;if(["application/json","application/x-javascript","application/x-php","application/x-python","application/x-shellscript","application/x-yaml"].includes(e))return!0;if(["authors","changelog","contributors","copying","install","license","makefile","readme","todo"].includes(n))return!0;return!!["cfg","dart","frag","glsl","in","ini","less","proto","vert"].includes(t)||("bat"===t&&"application/x-msdos-program"===e||!!(n.length>1&&n.startsWith(".")))}}},7490:(e,t,n)=>{n.d(t,{V:()=>i});var a=n(9730);class i{constructor(e,t,n=!1){this.file=e,this.mimeType=t,this.isDir=n}detectLanguage(){const e=a.n.getFileExt(this.file);if(["c","cc","cpp","cmake","css","scss","dart","diff","glsl","htm","html","ini","java","js","json","less","php","sh","tex","vb","xml","yaml","yml","zone"].includes(e))return e;const t={arb:"json",frag:"glsl",gitignore:"ini",h:"cpp",in:"cpp",jshintrc:"json",md:"markdown",py:"python",ts:"typescript",tsx:"typescript",vert:"glsl"};if(t[e])return t[e];const n={"application/x-shellscript":"sh"};if(n[this.mimeType])return n[this.mimeType];const i=this.file.name.toLowerCase();return".gitmodules"===i?"ini":"cmakelists.txt"===i?"cmake":"makefile"===i?"make":null}getArrayBuffer(e){this.file.arrayBuffer().then((t=>e(null,t))).catch((t=>{console.error(t),e(t,null)}))}getText(e){this.file.text().then((t=>e(null,t))).catch((t=>{console.error(t),e(t,null)}))}}},3305:(e,t,n)=>{n.d(t,{DICOMParser:()=>i});var a=n(7490);class i extends a.V{constructor(e){super(e.dir||e.file,e.mimeType,!!e.dir),e.entries&&(this.entries=e.entries)}_loadFromDicomdirFile(e,t){e.arrayBuffer().then((async e=>{const a=(await Promise.all([n.e(915),n.e(995)]).then(n.t.bind(n,5915,23))).parseDicom(new Uint8Array(e),{TransferSyntaxUID:"1.2.840.10008.1.2"}).elements.x00041220;a&&Array.isArray(a.items)?t(null,a):console.error("[DICOMParser._parseHandlerDir] Record is either not set or has no entries.",a)})).catch((e=>console.error(e)))}_parseHandlerDir(e){const t=this.entries,n=t.find((e=>e.isFile&&"dicomdir"===e.name.toLowerCase()));n?n.file((t=>this._loadFromDicomdirFile(t,e)),(t=>{console.error("[DICOMParser._parseHandlerDir]",t),e(t)})):e(null,t)}async addAndLoadFile(e){const t=this.wadouri.fileManager.add(e);return await this.wadouri.loadImage(t).promise}destroy(){try{this.cache.purgeCache(),this.wadouri.dataSetCacheManager.purge(),this.wadouri.fileManager.purge()}catch(e){console.error("[DICOMParser.destroy]",e)}}static getModalityName(e){if(!e)return e;e=String(e).toUpperCase();let t=i.MODALITY_MAP[e];return t&&(t+=` [${e}]`),t||e}static getPregnancyStatus(e){if(isNaN(Number(e)))return e;return["not pregnant","possibly pregnant","definitely pregnant","unknown"][(e=Number(e))+1]||e}getFilepathsFromRecord(e){const t=[];return e.items.forEach((e=>{let n=e.dataSet.string("x00041500");n&&(n=n.replace(/\\/g,"/"),t.push(n))})),t}loadDICOMDIRFiles(e,t){const n=[];if(Array.isArray(e)){const a=i=>{if(i>=e.length)return void t(null,n);e[i].file((async e=>{const t=await this.addAndLoadFile(e);n.push(t),a(i+1)}))};a(0)}else{const a=this.getFilepathsFromRecord(e),i=e=>{if(e>=a.length)return void t(null,n);const s=a[e];this.file.getFile(s,{},(t=>{t.file((async t=>{const a=await this.addAndLoadFile(t);n.push(a),i(e+1)}))}),(t=>{console.error(`[DICOMParser.loadDICOMDIRFiles] getFile "${s}": `+t.message),i(e+1)}))};i(0)}}async parse(e){const t=await Promise.all([n.e(960),n.e(178),n.e(483)]).then(n.bind(n,6178)),a=await Promise.all([n.e(612),n.e(960),n.e(915),n.e(320),n.e(146)]).then(n.bind(n,5320));if(t.init(),a.init(),this.cache=t.cache,this.wadouri=a.wadouri,this.isDir)this._parseHandlerDir(e);else if("dicomdir"===this.file.name.toLowerCase())this._loadFromDicomdirFile(this.file,((t,n)=>{const a=this.getFilepathsFromRecord(n);e(null,a)}));else{const t=await this.addAndLoadFile(this.file);e(null,t)}}}i.MODALITY_MAP={AR:"Autorefraction",AS:"Angioscopy",ASMT:"Content Assessment Results",AU:"Audio",BDUS:"Bone Densitometry (ultrasound)",BI:"Biomagnetic imaging",BMD:"Bone Densitometry (X-Ray)",CD:"Color flow Doppler",CF:"Cinefluorography",CP:"Colposcopy",CR:"Computed Radiography",CS:"Cystoscopy",CT:"Computed Tomography",DD:"Duplex Doppler",DF:"Digital fluoroscopy",DG:"Diaphanography",DM:"Digital microscopy",DOC:"Document",DS:"Digital Subtraction Angiography",DX:"Digital Radiography",EC:"Echocardiography",ECG:"Electrocardiography",EPS:"Cardiac Electrophysiology",ES:"Endoscopy",FA:"Fluorescein angiography",FID:"Fiducials",FS:"Fundoscopy",GM:"General Microscopy",HC:"Hard Copy",HD:"Hemodynamic Waveform",IO:"Intra-Oral Radiography",IOL:"Intraocular Lens Data",IVOCT:"Intravascular Optical Coherence Tomography",IVUS:"Intravascular Ultrasound",KER:"Keratometry",KO:"Key Object Selection",LEN:"Lensometry",LP:"Laparoscopy",LS:"Laser surface scan",MA:"Magnetic resonance angiography",MG:"Mammography",MR:"Magnetic Resonance",MS:"Magnetic resonance spectroscopy",NM:"Nuclear Medicine",OAM:"Ophthalmic Axial Measurements",OCT:"Optical Coherence Tomography (non-Ophthalmic)",OP:"Ophthalmic Photography",OPM:"Ophthalmic Mapping",OPR:"Ophthalmic Refraction",OPT:"Ophthalmic Tomography",OPV:"Ophthalmic Visual Field",OSS:"Optical Surface Scan",OT:"Other",PLAN:"Plan",PR:"Presentation State",PT:"Positron emission tomography (PET)",PX:"Panoramic X-Ray",REG:"Registration",RESP:"Respiratory Waveform",RF:"Radio Fluoroscopy",RG:"Radiographic imaging (conventional film/screen)",RTDOSE:"Radiotherapy Dose",RTIMAGE:"Radiotherapy Image",RTPLAN:"Radiotherapy Plan",RTRECORD:"RT Treatment Record",RTSTRUCT:"Radiotherapy Structure Set",RWV:"Real World Value Map",SEG:"Segmentation",SM:"Slide Microscopy",SMR:"Stereometric Relationship",SR:"SR Document",SRF:"Subjective Refraction",ST:"Single-photon emission computed tomography (SPECT)",STAIN:"Automated Slide Stainer",TG:"Thermography",US:"Ultrasound",VA:"Visual Acuity",VF:"Videofluorography",XA:"X-Ray Angiography",XC:"External-camera Photography"}},2798:(e,t,n)=>{n.d(t,{UI:()=>s});var a=n(9730);const i={_containsDICOMDIRFile:e=>!!e.find((e=>e.isFile&&"dicomdir"===e.name.toLowerCase())),async _containsDICOMFiles(e){let t=0;for(let n=0;n<e.length;n++){const i=e[n];if(await a.n.isDICOMFile(i)&&(t++,t>1))return!0}return!1},getParser(e,t){e.createReader().readEntries((async i=>{if(this._containsDICOMDIRFile(i)){const{DICOMParser:a}=await Promise.resolve().then(n.bind(n,3305)),s=new a({dir:e,entries:i,mimeType:"application/dicom"});t(null,s)}else if(await this._containsDICOMFiles(i)){const{DICOMParser:s}=await Promise.resolve().then(n.bind(n,3305)),r=i.filter((async e=>await a.n.isDICOMFile(e))).sort(((e,t)=>e.name.localeCompare(t.name,{numeric:!0}))),o=new s({dir:e,entries:r,mimeType:"application/dicom"});t(null,o)}else{const n=new Error(`No fitting parser for directory entries in ${e.name} found.`);console.error(n),t(n)}}),(e=>{console.error(e),t(e)}))}},s={_currentView:null,_domParser:new DOMParser,openDirectory(e){e&&i.getParser(e,((e,t)=>{this._currentView&&this._currentView.destroy();const n=a.n.getView(t);n.load((()=>this.update(n)))}))},openFile(e){e&&a.n.getParser(e,((e,t)=>{this._currentView&&this._currentView.destroy();const n=a.n.getView(t);n.load((()=>this.update(n)))}))},_updateMetaInfo(e){const t=document.querySelector("#meta-container");e?(t.style.display="block",t.querySelector(".content").append(e.nodeMeta)):t.style.display=""},_updateViewer(e){const t=document.querySelector("main .viewer"),n=t.querySelector(".note-dragdrop");e?(n.style.display="none",t.append(e.nodeView)):n.style.display=""},build(e){const t=this._domParser.parseFromString(e.trim(),"text/html");let n=null;return t.body.childElementCount>1?(n=document.createDocumentFragment(),n.append(...t.body.children)):(n=t.body.firstChild,n.remove()),n},buildTableRow(e,t,n={}){const a=document.createElement("th");a.textContent=e;const i=document.createElement("td");!0===n.valueAsHTML?i.innerHTML=t:i.textContent=t;const s=document.createElement("tr");return s.append(a,i),s},escapeHTML:e=>e=(e=(e=(e=(e=(e=String(e)).replaceAll("&","&amp;")).replaceAll("<","&lt;")).replaceAll(">","&gt;")).replaceAll('"',"&quot;")).replaceAll("'","&#039;"),formatDate(e){if(!e)return"";let t=e.getUTCFullYear(),n=e.getUTCMonth()+1,a=e.getUTCDate();return n=String(n).padStart(2,"0"),a=String(a).padStart(2,"0"),`${t}-${n}-${a}`},formatDateTime(e){if(!e)return"";const t=this.formatDate(e);let n=e.getUTCHours(),a=e.getUTCMinutes(),i=e.getUTCSeconds();return n=String(n).padStart(2,"0"),a=String(a).padStart(2,"0"),i=String(i).padStart(2,"0"),t+` ${n}:${a}:${i}`},formatDuration(e){let t=Number(e);if(isNaN(t))return e;let n=0,a=["ms","sec","min","h"],i=a[n++];for(t>=1e3&&(t/=1e3,i=a[n],n++);t>=60&&n<a.length;)t/=60,i=a[n],n++;let s=Math.floor(t)+i;if(i!==a[0]){let e=t-Math.floor(t);e*=i===a[1]?1e3:60,e>0&&(s+=" "+Math.floor(e)+a[n-2])}return s},formatSize(e,t=!1){let n=Number(e);if(isNaN(n))return e;let a=t?1024:1e3,i=t?["KiB","MiB","GiB","TiB","PiB"]:["kB","MB","GB","TB","PB"],s="B",r=0;for(;n>=a&&r<i.length;)n/=a,s=i[r],r++;return n.toFixed(1)+" "+s},update(e){this._currentView=e,this._updateMetaInfo(e),this._updateViewer(e)}}},1094:(e,t,n)=>{n.d(t,{$:()=>s});var a=n(2798),i=n(9108);class s extends i.u{constructor(e){super(),this._config=e,"function"==typeof this._config.onClick&&this.on("click",this._config.onClick)}disable(){this._node?this._node.disabled=!0:window.Logger.warn("[Button.disable] Button has not been rendered yet.")}enable(){this._node?this._node.disabled=!1:window.Logger.warn("[Button.enable] Button has not been rendered yet.")}render(){super.render();const e="string"==typeof this._config.icon,t="string"==typeof this._config.text;if(this._node=document.createElement("button"),this._node.classList.add("btn"),"string"==typeof this._config.classes&&this._node.classList.add(...this._config.classes.split(" ")),e&&(this._node.innerHTML=`<span class="icon">${this._config.icon}</span>`),t){const e=a.UI.escapeHTML(this._config.text);this._node.innerHTML+=`<span class="text">${e}</span>`}return e&&t||!0===this._config.iconWithBorder?(this._node.classList.add("btn-icon-text"),this._config.iconWithBorder&&this._node.classList.add("btn-icon-border")):e?this._node.classList.add("btn-icon"):t&&this._node.classList.add("btn-text"),"string"==typeof this._config.title&&this._node.setAttribute("title",this._config.title),this._node.addEventListener("click",(e=>{this._node.disabled||this.fire("click",e)})),this._node}}},9108:(e,t,n)=>{n.d(t,{u:()=>i});class a{constructor(){this._events={}}fire(e,t){const n=this._events[e]||[];for(let e=0;e<n.length;e++){if(!1===(0,n[e])(t))break}}off(e,t){if(t){const n=this._events[e]||[],a=n.indexOf(t);a>-1&&n.splice(a,1)}else this._events[e]=[]}on(e,t){const n=this._events[e]||[];n.push(t),this._events[e]=n}removeAllEvents(){this._events={}}}class i extends a{constructor(){super(),this._node=null}render(){this._node&&this._node.remove()}}}},s={};function r(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={id:e,loaded:!1,exports:{}};return i[e].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}r.m=i,r.amdD=function(){throw new Error("define cannot be used indirect")},r.amdO={},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(n,a){if(1&a&&(n=this(n)),8&a)return n;if("object"==typeof n&&n){if(4&a&&n.__esModule)return n;if(16&a&&"function"==typeof n.then)return n}var i=Object.create(null);r.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&a&&n;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>s[e]=()=>n[e]));return s.default=()=>n,r.d(i,s),i},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>e+".bundle.js",r.miniCssF=e=>{},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},a="everything-viewer:",r.l=(e,t,i,s)=>{if(n[e])n[e].push(t);else{var o,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==a+i){o=u;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,r.nc&&o.setAttribute("nonce",r.nc),o.setAttribute("data-webpack",a+i),o.src=e),n[e]=[t];var m=(t,a)=>{o.onerror=o.onload=null,clearTimeout(h);var i=n[e];if(delete n[e],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach((e=>e(a))),t)return t(a)},h=setTimeout(m.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=m.bind(null,o.onerror),o.onload=m.bind(null,o.onload),l&&document.head.appendChild(o)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var a=n.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=n[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{r.b=document.baseURI||self.location.href;var e={411:0};r.f.j=(t,n)=>{var a=r.o(e,t)?e[t]:void 0;if(0!==a)if(a)n.push(a[2]);else{var i=new Promise(((n,i)=>a=e[t]=[n,i]));n.push(a[2]=i);var s=r.p+r.u(t),o=new Error;r.l(s,(n=>{if(r.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var i=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",o.name="ChunkLoadError",o.type=i,o.request=s,a[1](o)}}),"chunk-"+t,t)}};var t=(t,n)=>{var a,i,[s,o,l]=n,c=0;if(s.some((t=>0!==e[t]))){for(a in o)r.o(o,a)&&(r.m[a]=o[a]);if(l)l(r)}for(t&&t(n);c<s.length;c++)i=s[c],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();class o{constructor(e){this._events={},e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(e=>{e.preventDefault(),this._handleDropped(e.dataTransfer)}))}_handleDirectory(e){console.log("[DropHandler._handleDirectory] Directory dropped: "+e.name);const t=this._events.directory;Array.isArray(t)&&t.forEach((t=>t(e)))}_handleDropped(e){if(e.items){const t=e.items[0];if(t&&"file"===t.kind)if("function"==typeof t.webkitGetAsEntry){const e=t.webkitGetAsEntry();e.isFile?this._handleFile(t.getAsFile()):e.isDirectory&&this._handleDirectory(e)}else console.warn('[DropHandler._handleDropped] Method "webkitGetAsEntry" not supported by browser. Cannot support directories.'),this._handleFile(t.getAsFile())}else if(e.files){console.warn('[DropHandler._handleDropped] DataTransfer has no attribute "items", using fallback on "files".');const t=e.files[0];t&&this._handleFile(t)}else console.error('[DropHandler._handleDropped] DataTransfer has neither "items" nor "files" attribute.',e)}_handleFile(e){console.log("[DropHandler._handleFile] File dropped: "+e.name);const t=this._events.file;Array.isArray(t)&&t.forEach((t=>t(e)))}on(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}}var l=r(2798),c=r(1094),d=r(9108);class u extends d.u{constructor(e){super(),this._config=e,this._isDragging=!1,this._lastPos={x:null,y:null},this._cbMouseUp=this._onEnd.bind(this),this._cbMouseMove=this._onMove.bind(this)}_applyConfig(){if(this._config){if(this._config.id&&this._node.setAttribute("id",this._config.id),Array.isArray(this._config.content)){const e=this._node.querySelector(".content");for(let t of this._config.content)t instanceof d.u?e.append(t.render()):e.append(t)}this._config.x&&(this._node.style.left=this._config.x+"px"),this._config.y&&(this._node.style.top=this._config.y+"px")}}_onEnd(e){this._isDragging=!1,document.body.removeEventListener("mouseup",this._cbMouseUp),document.body.removeEventListener("mousemove",this._cbMouseMove),this._node.style.zIndex=1}_onMove(e){if(!this._isDragging)return;if(null===this._lastPos.x)return this._lastPos.x=e.clientX,void(this._lastPos.y=e.clientY);const t=parseInt(this._node.style.left,10),n=parseInt(this._node.style.top,10),a=e.clientX-this._lastPos.x,i=e.clientY-this._lastPos.y;this._node.style.left=Math.round(t+a)+"px",this._node.style.top=Math.round(n+i)+"px",this._lastPos.x=e.clientX,this._lastPos.y=e.clientY}_onStart(e){String(e.target.className).includes("toggle")||(0===e.button&&(this._isDragging=!0,document.body.addEventListener("mouseup",this._cbMouseUp),document.body.addEventListener("mousemove",this._cbMouseMove)),this._lastPos.x=null,this._lastPos.y=null,this._node.style.zIndex=100)}_toggleContent(){let e=this._node.className;e=e.includes("window-closed")?e.replace("window-closed","window-open"):e.replace("window-open","window-closed"),this._node.className=e}render(){super.render(),this._node=l.UI.build(`\n\t\t\t<aside class="window window-open">\n\t\t\t\t<header>\n\t\t\t\t\t<span class="toggle"></span>\n\t\t\t\t\t${this._config.title||""}\n\t\t\t\t</header>\n\t\t\t\t<div class="content"></div>\n\t\t\t</aside>\n\t\t`),this._applyConfig(),delete this._config;const e=this._node.querySelector(":scope > header");return e.querySelector(".toggle").addEventListener("click",(e=>this._toggleContent())),e.addEventListener("mousedown",(e=>this._onStart(e))),this._node}}class m extends d.u{render(){super.render();const e=new c.$({classes:"file-open",text:"Open…"});e.on("click",(e=>{const t=document.createElement("input");t.type="file",t.addEventListener("change",(e=>{l.UI.openFile(t.files[0])})),t.click()}));const t=new u({title:"Everything Viewer",x:20,y:20,content:[e,l.UI.build('<a href="https://github.com/sebadorn/everything-viewer" id="github">GitHub</a>')]}),n=new u({title:"Information",id:"meta-container",x:20,y:116}),a=l.UI.build('\n\t\t\t<main>\n\t\t\t\t<div class="viewer">\n\t\t\t\t\t<div class="note-dragdrop">\n\t\t\t\t\t\t<h1>Everything Viewer</h1>\n\t\t\t\t\t\t<span>Just drag &amp; drop your file here</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</main>\n\t\t'),i=a.querySelector(".viewer"),s=new o(i);return s.on("file",(e=>l.UI.openFile(e))),s.on("directory",((e,t)=>l.UI.openDirectory(e,t))),this._node=document.createDocumentFragment(),this._node.append(t.render(),n.render(),a),this._node}}const h=new m;document.body.append(h.render())})();