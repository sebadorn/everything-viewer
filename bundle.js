(()=>{var e,t,i,n,s={251:(e,t)=>{
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,i,n,s){var a,r,o=8*s-n-1,c=(1<<o)-1,l=c>>1,d=-7,h=i?s-1:0,m=i?-1:1,p=e[t+h];for(h+=m,a=p&(1<<-d)-1,p>>=-d,d+=o;d>0;a=256*a+e[t+h],h+=m,d-=8);for(r=a&(1<<-d)-1,a>>=-d,d+=n;d>0;r=256*r+e[t+h],h+=m,d-=8);if(0===a)a=1-l;else{if(a===c)return r?NaN:1/0*(p?-1:1);r+=Math.pow(2,n),a-=l}return(p?-1:1)*r*Math.pow(2,a-n)},t.write=function(e,t,i,n,s,a){var r,o,c,l=8*a-s-1,d=(1<<l)-1,h=d>>1,m=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:a-1,u=n?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,r=d):(r=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-r))<1&&(r--,c*=2),(t+=r+h>=1?m/c:m*Math.pow(2,1-h))*c>=2&&(r++,c/=2),r+h>=d?(o=0,r=d):r+h>=1?(o=(t*c-1)*Math.pow(2,s),r+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,s),r=0));s>=8;e[i+p]=255&o,p+=u,o/=256,s-=8);for(r=r<<s|o,l+=s;l>0;e[i+p]=255&r,p+=u,r/=256,l-=8);e[i+p-u]|=128*f}},6585:e=>{var t=1e3,i=60*t,n=60*i,s=24*n,a=7*s,r=365.25*s;function o(e,t,i,n){var s=t>=1.5*i;return Math.round(e/i)+" "+n+(s?"s":"")}e.exports=function(e,c){c=c||{};var l=typeof e;if("string"===l&&e.length>0)return function(e){if((e=String(e)).length>100)return;var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!o)return;var c=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*r;case"weeks":case"week":case"w":return c*a;case"days":case"day":case"d":return c*s;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===l&&isFinite(e))return c.long?function(e){var a=Math.abs(e);if(a>=s)return o(e,a,s,"day");if(a>=n)return o(e,a,n,"hour");if(a>=i)return o(e,a,i,"minute");if(a>=t)return o(e,a,t,"second");return e+" ms"}(e):function(e){var a=Math.abs(e);if(a>=s)return Math.round(e/s)+"d";if(a>=n)return Math.round(e/n)+"h";if(a>=i)return Math.round(e/i)+"m";if(a>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},17833:(e,t,i)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;t.splice(1,0,i,"color: inherit");let n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(s=n))}),t.splice(s,0,i)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=i(40736)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},19108:(e,t,i)=>{"use strict";i.d(t,{u:()=>s});class n{constructor(){this._events={}}fire(e,t){const i=this._events[e]||[];for(let e=0;e<i.length;e++){if(!1===(0,i[e])(t))break}}off(e,t){if(t){const i=this._events[e]||[],n=i.indexOf(t);n>-1&&i.splice(n,1)}else this._events[e]=[]}on(e,t){const i=this._events[e]||[];i.push(t),this._events[e]=i}removeAllEvents(){this._events={}}}class s extends n{constructor(){super(),this._node=null}render(){this._node&&this._node.remove()}}},26042:(e,t,i)=>{"use strict";i.d(t,{p:()=>c});var n=i(91625),s=i(42109),a=i(19108);const r=1,o=2;class c extends a.u{static topZindex=9;constructor(e){super(),this._config=e,void 0===this._config.x&&(this._config.x=window.innerWidth/2),void 0===this._config.y&&(this._config.y=60),this._isDragging=!1,this._lastPos={x:null,y:null},this._cbMouseUp=this._onEnd.bind(this),this._cbMouseMove=this._onMove.bind(this),this.state=r}_applyConfig(e=[]){if(this._config){if(this._config.id&&!e.includes("id")&&this._node.setAttribute("id",this._config.id),"string"==typeof this._config.title&&!e.includes("title")){const e=this._node.querySelector("header .title");s.UI.removeAllChildren(e),e.innerHTML=this._config.title}if(this._node.classList.remove("closable"),!1!==this._config.closable&&this._node.classList.add("closable"),Array.isArray(this._config.content)&&!e.includes("content")){const e=this._node.querySelector(".content");s.UI.removeAllChildren(e);for(let t of this._config.content)t instanceof a.u?e.append(t.render()):e.append(t)}"number"!=typeof this._config.x||e.includes("x")||(this._node.style.left=this._config.x+"px"),"number"!=typeof this._config.y||e.includes("y")||(this._node.style.top=this._config.y+"px"),"number"!=typeof this._config.width||e.includes("width")||(this._node.style.width=this._config.width+"px"),"number"!=typeof this._config.height||e.includes("height")||(this._node.style.height=this._config.height+"px")}}_onEnd(e){this._isDragging=!1,document.body.removeEventListener("mouseup",this._cbMouseUp),document.body.removeEventListener("mousemove",this._cbMouseMove)}_onMove(e){if(!this._isDragging)return;if(null===this._lastPos.x)return this._lastPos.x=e.clientX,void(this._lastPos.y=e.clientY);const t=parseInt(this._node.style.left,10),i=parseInt(this._node.style.top,10),n=e.clientX-this._lastPos.x,s=e.clientY-this._lastPos.y;this._node.style.left=Math.round(t+n)+"px",this._node.style.top=Math.round(i+s)+"px",this._lastPos.x=e.clientX,this._lastPos.y=e.clientY}_onStart(e){String(e.target.className).includes("toggle")||(0===e.button&&(this._isDragging=!0,document.body.addEventListener("mouseup",this._cbMouseUp),document.body.addEventListener("mousemove",this._cbMouseMove)),this._lastPos.x=null,this._lastPos.y=null,this._node.style.zIndex<c.topZindex&&(this._node.style.zIndex=++c.topZindex))}_toggleContent(){const e=this._node.querySelector("header .icon.toggle");let t=this._node.classList;t.contains("window-collapsed")?(t.replace("window-collapsed","window-open"),e.textContent=n.F.extended):(t.replace("window-open","window-collapsed"),e.textContent=n.F.collapsed)}center(){if(!this._node)return;const e=this._node.getBoundingClientRect();this.moveTo({x:(window.innerWidth-e.width)/2,y:(window.innerHeight-e.height)/2})}close(){this.state!==r&&(this.state=r,this.fire("close"),this._node?.remove())}moveTo(e){"number"==typeof e.x&&(this._node.style.left=e.x+"px",this._lastPos.x=e.x),"number"==typeof e.y&&(this._node.style.top=e.y+"px",this._lastPos.y=e.y)}_handleResize(e){const t=this._node.querySelector(`.resize-handles .handle-${e}`);let i=!1;const n="top"===e||"bottom"===e?"clientY":"clientX",s={clientX:null,clientY:null,left:0,top:0,height:0,width:0},a=t=>{if(!i)return;const a=t[n]-s[n];"right"===e?this._node.style.width=s.width+a+"px":"left"===e?(this._node.style.width=s.width-a+"px",this._node.style.left=s.left+a+"px"):"top"===e?(this._node.style.height=s.height-a+"px",this._node.style.top=s.top+a+"px"):"bottom"===e&&(this._node.style.height=s.height+a+"px")},r=t=>{document.body.removeEventListener("mousemove",a),document.body.removeEventListener("mouseup",r),i=!1,s.clientX=null,s.clientY=null,this.fire("resized",{dir:e})};t.addEventListener("mousedown",e=>{document.body.addEventListener("mousemove",a),document.body.addEventListener("mouseup",r);const t=this._node.getBoundingClientRect();i=!0,s.clientX=e.clientX,s.clientY=e.clientY,s.left=t.left,s.top=t.top,s.height=t.height,s.width=t.width})}render(){super.render(),this._node=s.UI.build(`\n\t\t\t<aside class="window window-open">\n\t\t\t\t<div class="resize-handles">\n\t\t\t\t\t<div class="handle handle-top"></div>\n\t\t\t\t\t<div class="handle handle-right"></div>\n\t\t\t\t\t<div class="handle handle-bottom"></div>\n\t\t\t\t\t<div class="handle handle-left"></div>\n\t\t\t\t</div>\n\t\t\t\t<header>\n\t\t\t\t\t<span class="icon toggle">${n.F.extended}</span>\n\t\t\t\t\t<span class="title"></span>\n\t\t\t\t\t<div class="actions">\n\t\t\t\t\t\t<span class="icon close">${n.F.close}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="content"></div>\n\t\t\t</aside>\n\t\t`),this._applyConfig(),this._handleResize("top"),this._handleResize("right"),this._handleResize("bottom"),this._handleResize("left");const e=this._node.querySelector(":scope > header"),t=e.querySelector(".toggle"),i=e.querySelector(".close");return t.addEventListener("click",e=>this._toggleContent()),e.addEventListener("mousedown",e=>this._onStart(e)),i.addEventListener("click",e=>this.close()),this._node.style.maxHeight=window.innerHeight-80+"px",this._node.style.zIndex=++c.topZindex,this.state=o,this._node}update(e){const t=[];for(const i in this._config)void 0!==e[i]&&this._config[i]!==e[i]||t.push(i);for(const t in e)this._config[t]=e[t];this._applyConfig(t)}}},38518:(e,t,i)=>{"use strict";i.d(t,{D:()=>n});const n={_domParser:"undefined"!=typeof DOMParser?new DOMParser:null,get domParser(){return this._domParser},buildDocument(e,t="text/html"){return this._domParser.parseFromString(e,t)},decodeContent:e=>e=(e=e.replaceAll(/=[\r]?\n/g,"")).replaceAll(/(=[0-9A-Z]{2})+/g,e=>{try{return decodeURIComponent(e.replaceAll("=","%"))}catch(t){return console.error("[DocumentUtils.decodeContent]",t,e),e}}),getBuildNumber:()=>document.head.dataset.build||"?",removeExternalResources(e){e.querySelectorAll("img").forEach(e=>{(e.getAttribute("src")||"").startsWith("data:")||e.removeAttribute("src")});e.querySelectorAll(["audio[src]","embed","iframe",'link[rel="stylesheet"]',"object","script","source","video[src]"].join(",")).forEach(e=>e.remove());e.querySelectorAll("[background]").forEach(e=>{(e.getAttribute("background")||"").includes("//")&&e.removeAttribute("background")});e.querySelectorAll("style").forEach(e=>{let t=e.textContent;t=t.replaceAll(/url[ \t]*\([ \t]*.+[ \t]*\)/gi,"url()"),e.textContent=t})}}},40736:(e,t,i)=>{e.exports=function(e){function t(e){let i,s,a,r=null;function o(...e){if(!o.enabled)return;const n=o,s=Number(new Date),a=s-(i||s);n.diff=a,n.prev=i,n.curr=s,i=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let r=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(i,s)=>{if("%%"===i)return"%";r++;const a=t.formatters[s];if("function"==typeof a){const t=e[r];i=a.call(n,t),e.splice(r,1),r--}return i}),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=n,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==r?r:(s!==t.namespaces&&(s=t.namespaces,a=t.enabled(e)),a),set:e=>{r=e}}),"function"==typeof t.init&&t.init(o),o}function n(e,i){const n=t(this.namespace+(void 0===i?":":i)+e);return n.log=this.log,n}function s(e,t){let i=0,n=0,s=-1,a=0;for(;i<e.length;)if(n<t.length&&(t[n]===e[i]||"*"===t[n]))"*"===t[n]?(s=n,a=i,n++):(i++,n++);else{if(-1===s)return!1;n=s+1,a++,i=a}for(;n<t.length&&"*"===t[n];)n++;return n===t.length}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const e of i)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const i of t.skips)if(s(e,i))return!1;for(const i of t.names)if(s(e,i))return!0;return!1},t.humanize=i(6585),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(i=>{t[i]=e[i]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let i=0;for(let t=0;t<e.length;t++)i=(i<<5)-i+e.charCodeAt(t),i|=0;return t.colors[Math.abs(i)%t.colors.length]},t.enable(t.load()),t}},42109:(e,t,i)=>{"use strict";i.d(t,{UI:()=>s});var n=i(38518);const s={_updateMetaInfo(e){const t=document.querySelector("#meta-container");e?(t.style.display="block",t.querySelector(".content").append(e.nodeMeta)):t.style.display=""},_updateViewer(e){const t=document.querySelector("main .viewer"),i=t.querySelector(".note-dragdrop");e?(i.style.display="none",t.append(e.nodeView)):i.style.display=""},build(e){const t=n.D.buildDocument(e.trim());let i=null;return t.body.childElementCount>1?(i=document.createDocumentFragment(),i.append(...t.body.children)):(i=t.body.firstChild,i.remove()),i},buildListOrdered(e){const t=document.createElement("ol");return e.forEach(e=>{const i=document.createElement("li");i.textContent=e,t.append(i)}),t},buildTableRow(e,t,i={}){const n=document.createElement("th");n.textContent=e;const s=document.createElement("td");t instanceof HTMLElement?s.append(t):!0===i.valueAsHTML?s.innerHTML=t:s.textContent=t;const a=document.createElement("tr");return a.append(n,s),a},escapeHTML:e=>e=(e=(e=(e=(e=(e=String(e)).replaceAll("&","&amp;")).replaceAll("<","&lt;")).replaceAll(">","&gt;")).replaceAll('"',"&quot;")).replaceAll("'","&#039;"),formatDate(e){if(!e)return"";let t=e.getUTCFullYear(),i=e.getUTCMonth()+1,n=e.getUTCDate();return i=String(i).padStart(2,"0"),n=String(n).padStart(2,"0"),`${t}-${i}-${n}`},formatDateTime(e){if(!e)return"";const t=this.formatDate(e);let i=e.getUTCHours(),n=e.getUTCMinutes(),s=e.getUTCSeconds();return i=String(i).padStart(2,"0"),n=String(n).padStart(2,"0"),s=String(s).padStart(2,"0"),t+` ${i}:${n}:${s}`},formatDuration(e,t={}){let i=Number(e);if(isNaN(i))return e;if(t.formatWithColon){const e=[1e3,60,60,24];let t=[];for(let n=0;n<e.length-1;n++){const s=e[n];if(i<s)break;t.push(i%s),i=Math.floor(i/s)}for(t.push(i),t=t.reverse(),t.pop();t.length<2;)t.unshift(0);return t.map(e=>Math.floor(e).toString().padStart(2,"0")).join(":")}let n=0,s=["ms","sec","min","h"],a=s[n++];for(i>=1e3&&(i/=1e3,a=s[n],n++);i>=60&&n<s.length;)i/=60,a=s[n],n++;let r=Math.floor(i)+a;if(a!==s[0]){let e=i-Math.floor(i);e*=a===s[1]?1e3:60,e>0&&(r+=" "+Math.floor(e)+s[n-2])}return r},formatSize(e,t={}){let i=Number(e);if(isNaN(i))return e;("number"!=typeof t.decimalPlaces||isNaN(t.decimalPlaces))&&(t.decimalPlaces=1),"boolean"!=typeof t.omitDecimalZero&&(t.omitDecimalZero=!0);let n=t.useBinary?1024:1e3,s=t.useBinary?["KiB","MiB","GiB","TiB","PiB"]:["kB","MB","GB","TB","PB"],a="B",r=0;for(;i>=n&&r<s.length;)i/=n,a=s[r],r++;let o=i.toFixed(t.decimalPlaces);if(t.decimalPlaces>0&&t.omitDecimalZero){const e=new RegExp(".?0+$");o=o.replace(e,"")}return o+" "+a},onImageComplete(e,t){e.complete?t():e.onload=t},async open(e){if(!e)return;const{Registry:t}=await Promise.resolve().then(i.bind(i,79802));(await t.getPluginForImport(e)).getView().load()},removeAllChildren(e){for(;e.firstChild;)e.removeChild(e.lastChild)}}},79802:(e,t,i)=>{"use strict";i.d(t,{Registry:()=>Ot});i(251);function n(e){return new DataView(e.buffer,e.byteOffset)}const s={len:1,get:(e,t)=>n(e).getUint8(t),put:(e,t,i)=>(n(e).setUint8(t,i),t+1)},a={len:2,get:(e,t)=>n(e).getUint16(t,!0),put:(e,t,i)=>(n(e).setUint16(t,i,!0),t+2)},r={len:2,get:(e,t)=>n(e).getUint16(t),put:(e,t,i)=>(n(e).setUint16(t,i),t+2)},o={len:4,get:(e,t)=>n(e).getUint32(t,!0),put:(e,t,i)=>(n(e).setUint32(t,i,!0),t+4)},c={len:4,get:(e,t)=>n(e).getUint32(t),put:(e,t,i)=>(n(e).setUint32(t,i),t+4)},l={len:4,get:(e,t)=>n(e).getInt32(t),put:(e,t,i)=>(n(e).setInt32(t,i),t+4)},d={len:8,get:(e,t)=>n(e).getBigUint64(t,!0),put:(e,t,i)=>(n(e).setBigUint64(t,i,!0),t+8)};class h{constructor(e,t){if(this.len=e,t&&"windows-1252"===t.toLowerCase())this.decoder=h.decodeWindows1252;else{const e=new TextDecoder(t);this.decoder=t=>e.decode(t)}}get(e,t=0){const i=e.subarray(t,t+this.len);return this.decoder(i)}static decodeWindows1252(e){let t="";for(let i=0;i<e.length;i++){const n=e[i];t+=n<128||n>=160?String.fromCharCode(n):h.win1252Map[n-128]}return t}}h.win1252Map="€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ";class m extends Error{constructor(){super("End-Of-Stream"),this.name="EndOfStreamError"}}class p extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}class u{constructor(){this.endOfStream=!1,this.interrupted=!1,this.peekQueue=[]}async peek(e,t=!1){const i=await this.read(e,t);return this.peekQueue.push(e.subarray(0,i)),i}async read(e,t=!1){if(0===e.length)return 0;let i=this.readFromPeekBuffer(e);if(this.endOfStream||(i+=await this.readRemainderFromStream(e.subarray(i),t)),0===i&&!t)throw new m;return i}readFromPeekBuffer(e){let t=e.length,i=0;for(;this.peekQueue.length>0&&t>0;){const n=this.peekQueue.pop();if(!n)throw new Error("peekData should be defined");const s=Math.min(n.length,t);e.set(n.subarray(0,s),i),i+=s,t-=s,s<n.length&&this.peekQueue.push(n.subarray(s))}return i}async readRemainderFromStream(e,t){let i=0;for(;i<e.length&&!this.endOfStream;){if(this.interrupted)throw new p;const n=await this.readFromStream(e.subarray(i),t);if(0===n)break;i+=n}if(!t&&i<e.length)throw new m;return i}}class f extends u{constructor(e){super(),this.reader=e}async abort(){return this.close()}async close(){this.reader.releaseLock()}}class g extends f{async readFromStream(e,t){if(0===e.length)return 0;const i=await this.reader.read(new Uint8Array(e.length),{min:t?void 0:e.length});return i.done&&(this.endOfStream=i.done),i.value?(e.set(i.value),i.value.length):0}}class y extends u{constructor(e){super(),this.reader=e,this.buffer=null}writeChunk(e,t){const i=Math.min(t.length,e.length);return e.set(t.subarray(0,i)),i<t.length?this.buffer=t.subarray(i):this.buffer=null,i}async readFromStream(e,t){if(0===e.length)return 0;let i=0;for(this.buffer&&(i+=this.writeChunk(e,this.buffer));i<e.length&&!this.endOfStream;){const t=await this.reader.read();if(t.done){this.endOfStream=!0;break}t.value&&(i+=this.writeChunk(e.subarray(i),t.value))}if(!t&&0===i&&this.endOfStream)throw new m;return i}abort(){return this.interrupted=!0,this.reader.cancel()}async close(){await this.abort(),this.reader.releaseLock()}}class w{constructor(e){this.numBuffer=new Uint8Array(8),this.position=0,this.onClose=e?.onClose,e?.abortSignal&&e.abortSignal.addEventListener("abort",()=>{this.abort()})}async readToken(e,t=this.position){const i=new Uint8Array(e.len);if(await this.readBuffer(i,{position:t})<e.len)throw new m;return e.get(i,0)}async peekToken(e,t=this.position){const i=new Uint8Array(e.len);if(await this.peekBuffer(i,{position:t})<e.len)throw new m;return e.get(i,0)}async readNumber(e){if(await this.readBuffer(this.numBuffer,{length:e.len})<e.len)throw new m;return e.get(this.numBuffer,0)}async peekNumber(e){if(await this.peekBuffer(this.numBuffer,{length:e.len})<e.len)throw new m;return e.get(this.numBuffer,0)}async ignore(e){if(void 0!==this.fileInfo.size){const t=this.fileInfo.size-this.position;if(e>t)return this.position+=t,t}return this.position+=e,e}async close(){await this.abort(),await(this.onClose?.())}normalizeOptions(e,t){if(!this.supportsRandomAccess()&&t&&void 0!==t.position&&t.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return{mayBeLess:!1,offset:0,length:e.length,position:this.position,...t}}abort(){return Promise.resolve()}}class v extends w{constructor(e,t){super(t),this.streamReader=e,this.fileInfo=t?.fileInfo??{}}async readBuffer(e,t){const i=this.normalizeOptions(e,t),n=i.position-this.position;if(n>0)return await this.ignore(n),this.readBuffer(e,t);if(n<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(0===i.length)return 0;const s=await this.streamReader.read(e.subarray(0,i.length),i.mayBeLess);if(this.position+=s,(!t||!t.mayBeLess)&&s<i.length)throw new m;return s}async peekBuffer(e,t){const i=this.normalizeOptions(e,t);let n=0;if(i.position){const t=i.position-this.position;if(t>0){const s=new Uint8Array(i.length+t);return n=await this.peekBuffer(s,{mayBeLess:i.mayBeLess}),e.set(s.subarray(t)),n-t}if(t<0)throw new Error("Cannot peek from a negative offset in a stream")}if(i.length>0){try{n=await this.streamReader.peek(e.subarray(0,i.length),i.mayBeLess)}catch(e){if(t?.mayBeLess&&e instanceof m)return 0;throw e}if(!i.mayBeLess&&n<i.length)throw new m}return n}async ignore(e){const t=Math.min(256e3,e),i=new Uint8Array(t);let n=0;for(;n<e;){const s=e-n,a=await this.readBuffer(i,{length:Math.min(t,s)});if(a<0)return a;n+=a}return n}abort(){return this.streamReader.abort()}async close(){return this.streamReader.close()}supportsRandomAccess(){return!1}}class x extends w{constructor(e,t){super(t),this.uint8Array=e,this.fileInfo={...t?.fileInfo??{},size:e.length}}async readBuffer(e,t){t?.position&&(this.position=t.position);const i=await this.peekBuffer(e,t);return this.position+=i,i}async peekBuffer(e,t){const i=this.normalizeOptions(e,t),n=Math.min(this.uint8Array.length-i.position,i.length);if(!i.mayBeLess&&n<i.length)throw new m;return e.set(this.uint8Array.subarray(i.position,i.position+n)),n}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(e){this.position=e}}function _(e,t){const i=function(e){try{const t=e.getReader({mode:"byob"});return t instanceof ReadableStreamDefaultReader?new y(t):new g(t)}catch(t){if(t instanceof TypeError)return new y(e.getReader());throw t}}(e),n=t??{},s=n.onClose;return n.onClose=async()=>{if(await i.close(),s)return s()},new v(i,n)}var b=Uint8Array,k=Uint16Array,C=Int32Array,S=new b([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),T=new b([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),I=new b([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),E=function(e,t){for(var i=new k(31),n=0;n<31;++n)i[n]=t+=1<<e[n-1];var s=new C(i[30]);for(n=1;n<30;++n)for(var a=i[n];a<i[n+1];++a)s[a]=a-i[n]<<5|n;return{b:i,r:s}},M=E(S,2),L=M.b,A=M.r;L[28]=258,A[258]=28;for(var D=E(T,0),F=D.b,P=(D.r,new k(32768)),R=0;R<32768;++R){var U=(43690&R)>>1|(21845&R)<<1;U=(61680&(U=(52428&U)>>2|(13107&U)<<2))>>4|(3855&U)<<4,P[R]=((65280&U)>>8|(255&U)<<8)>>1}var z=function(e,t,i){for(var n=e.length,s=0,a=new k(t);s<n;++s)e[s]&&++a[e[s]-1];var r,o=new k(t);for(s=1;s<t;++s)o[s]=o[s-1]+a[s-1]<<1;if(i){r=new k(1<<t);var c=15-t;for(s=0;s<n;++s)if(e[s])for(var l=s<<4|e[s],d=t-e[s],h=o[e[s]-1]++<<d,m=h|(1<<d)-1;h<=m;++h)r[P[h]>>c]=l}else for(r=new k(n),s=0;s<n;++s)e[s]&&(r[s]=P[o[e[s]-1]++]>>15-e[s]);return r},N=new b(288);for(R=0;R<144;++R)N[R]=8;for(R=144;R<256;++R)N[R]=9;for(R=256;R<280;++R)N[R]=7;for(R=280;R<288;++R)N[R]=8;var O=new b(32);for(R=0;R<32;++R)O[R]=5;var j=z(N,9,1),V=z(O,5,1),B=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},H=function(e,t,i){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&i},q=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},$=function(e){return(e+7)/8|0},G=function(e,t,i){return(null==t||t<0)&&(t=0),(null==i||i>e.length)&&(i=e.length),new b(e.subarray(t,i))},W=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],X=function(e,t,i){var n=new Error(t||W[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,X),!i)throw n;return n},K=function(e,t,i,n){var s=e.length,a=n?n.length:0;if(!s||t.f&&!t.l)return i||new b(0);var r=!i,o=r||2!=t.i,c=t.i;r&&(i=new b(3*s));var l=function(e){var t=i.length;if(e>t){var n=new b(Math.max(2*t,e));n.set(i),i=n}},d=t.f||0,h=t.p||0,m=t.b||0,p=t.l,u=t.d,f=t.m,g=t.n,y=8*s;do{if(!p){d=H(e,h,1);var w=H(e,h+1,3);if(h+=3,!w){var v=e[(U=$(h)+4)-4]|e[U-3]<<8,x=U+v;if(x>s){c&&X(0);break}o&&l(m+v),i.set(e.subarray(U,x),m),t.b=m+=v,t.p=h=8*x,t.f=d;continue}if(1==w)p=j,u=V,f=9,g=5;else if(2==w){var _=H(e,h,31)+257,k=H(e,h+10,15)+4,C=_+H(e,h+5,31)+1;h+=14;for(var E=new b(C),M=new b(19),A=0;A<k;++A)M[I[A]]=H(e,h+3*A,7);h+=3*k;var D=B(M),P=(1<<D)-1,R=z(M,D,1);for(A=0;A<C;){var U,N=R[H(e,h,P)];if(h+=15&N,(U=N>>4)<16)E[A++]=U;else{var O=0,W=0;for(16==U?(W=3+H(e,h,3),h+=2,O=E[A-1]):17==U?(W=3+H(e,h,7),h+=3):18==U&&(W=11+H(e,h,127),h+=7);W--;)E[A++]=O}}var K=E.subarray(0,_),Z=E.subarray(_);f=B(K),g=B(Z),p=z(K,f,1),u=z(Z,g,1)}else X(1);if(h>y){c&&X(0);break}}o&&l(m+131072);for(var Y=(1<<f)-1,J=(1<<g)-1,Q=h;;Q=h){var ee=(O=p[q(e,h)&Y])>>4;if((h+=15&O)>y){c&&X(0);break}if(O||X(2),ee<256)i[m++]=ee;else{if(256==ee){Q=h,p=null;break}var te=ee-254;if(ee>264){var ie=S[A=ee-257];te=H(e,h,(1<<ie)-1)+L[A],h+=ie}var ne=u[q(e,h)&J],se=ne>>4;ne||X(3),h+=15&ne;Z=F[se];if(se>3){ie=T[se];Z+=q(e,h)&(1<<ie)-1,h+=ie}if(h>y){c&&X(0);break}o&&l(m+131072);var ae=m+te;if(m<Z){var re=a-Z,oe=Math.min(Z,ae);for(re+m<0&&X(3);m<oe;++m)i[m]=n[re+m]}for(;m<ae;++m)i[m]=i[m-Z]}}t.l=p,t.p=Q,t.b=m,t.f=d,p&&(d=1,t.m=f,t.d=u,t.n=g)}while(!d);return m!=i.length&&r?G(i,0,m):i.subarray(0,m)},Z=new b(0),Y=function(e){31==e[0]&&139==e[1]&&8==e[2]||X(6,"invalid gzip data");var t=e[3],i=10;4&t&&(i+=2+(e[10]|e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[i++]);return i+(2&t)},J=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Q=function(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&X(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&X(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function ee(e,t){return K(e,{i:2},t&&t.out,t&&t.dictionary)}function te(e,t){var i=Y(e);return i+8>e.length&&X(6,"invalid gzip data"),K(e.subarray(i,-8),{i:2},t&&t.out||new b(J(e)),t&&t.dictionary)}function ie(e,t){return K(e.subarray(Q(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}var ne="undefined"!=typeof TextDecoder&&new TextDecoder;try{ne.decode(Z,{stream:!0})}catch(e){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;var se=i(17833);const ae=67324752,re=134695760,oe=33639248,ce=101010256,le={get(e){a.get(e,6);return{signature:o.get(e,0),compressedSize:o.get(e,8),uncompressedSize:o.get(e,12)}},len:16},de={get(e){const t=a.get(e,6);return{signature:o.get(e,0),minVersion:a.get(e,4),dataDescriptor:!!(8&t),compressedMethod:a.get(e,8),compressedSize:o.get(e,18),uncompressedSize:o.get(e,22),filenameLength:a.get(e,26),extraFieldLength:a.get(e,28),filename:null}},len:30},he={get:e=>({signature:o.get(e,0),nrOfThisDisk:a.get(e,4),nrOfThisDiskWithTheStart:a.get(e,6),nrOfEntriesOnThisDisk:a.get(e,8),nrOfEntriesOfSize:a.get(e,10),sizeOfCd:o.get(e,12),offsetOfStartOfCd:o.get(e,16),zipFileCommentLength:a.get(e,20)}),len:22},me={get(e){const t=a.get(e,8);return{signature:o.get(e,0),minVersion:a.get(e,6),dataDescriptor:!!(8&t),compressedMethod:a.get(e,10),compressedSize:o.get(e,20),uncompressedSize:o.get(e,24),filenameLength:a.get(e,28),extraFieldLength:a.get(e,30),fileCommentLength:a.get(e,32),relativeOffsetOfLocalHeader:o.get(e,42),filename:null}},len:46};function pe(e){const t=new Uint8Array(o.len);return o.put(t,0,e),t}const ue=se("tokenizer:inflate"),fe=262144,ge=pe(re),ye=pe(ce);class we{constructor(e){this.tokenizer=e,this.syncBuffer=new Uint8Array(fe)}async isZip(){return await this.peekSignature()===ae}peekSignature(){return this.tokenizer.peekToken(o)}async findEndOfCentralDirectoryLocator(){const e=this.tokenizer,t=Math.min(16384,e.fileInfo.size),i=this.syncBuffer.subarray(0,t);await this.tokenizer.readBuffer(i,{position:e.fileInfo.size-t});for(let n=i.length-4;n>=0;n--)if(i[n]===ye[0]&&i[n+1]===ye[1]&&i[n+2]===ye[2]&&i[n+3]===ye[3])return e.fileInfo.size-t+n;return-1}async readCentralDirectory(){if(!this.tokenizer.supportsRandomAccess())return void ue("Cannot reading central-directory without random-read support");ue("Reading central-directory...");const e=this.tokenizer.position,t=await this.findEndOfCentralDirectoryLocator();if(t>0){ue("Central-directory 32-bit signature found");const i=await this.tokenizer.readToken(he,t),n=[];this.tokenizer.setPosition(i.offsetOfStartOfCd);for(let e=0;e<i.nrOfEntriesOfSize;++e){const t=await this.tokenizer.readToken(me);if(t.signature!==oe)throw new Error("Expected Central-File-Header signature");t.filename=await this.tokenizer.readToken(new h(t.filenameLength,"utf-8")),await this.tokenizer.ignore(t.extraFieldLength),await this.tokenizer.ignore(t.fileCommentLength),n.push(t),ue(`Add central-directory file-entry: n=${e+1}/${n.length}: filename=${n[e].filename}`)}return this.tokenizer.setPosition(e),n}this.tokenizer.setPosition(e)}async unzip(e){const t=await this.readCentralDirectory();if(t)return this.iterateOverCentralDirectory(t,e);let i=!1;do{const t=await this.readLocalFileHeader();if(!t)break;const n=e(t);let s;if(i=!!n.stop,await this.tokenizer.ignore(t.extraFieldLength),t.dataDescriptor&&0===t.compressedSize){const e=[];let i=fe;ue("Compressed-file-size unknown, scanning for next data-descriptor-signature....");let s=-1;for(;s<0&&i===fe;){i=await this.tokenizer.peekBuffer(this.syncBuffer,{mayBeLess:!0}),s=ve(this.syncBuffer.subarray(0,i),ge);const t=s>=0?s:i;if(n.handler){const i=new Uint8Array(t);await this.tokenizer.readBuffer(i),e.push(i)}else await this.tokenizer.ignore(t)}ue(`Found data-descriptor-signature at pos=${this.tokenizer.position}`),n.handler&&await this.inflate(t,xe(e),n.handler)}else n.handler?(ue(`Reading compressed-file-data: ${t.compressedSize} bytes`),s=new Uint8Array(t.compressedSize),await this.tokenizer.readBuffer(s),await this.inflate(t,s,n.handler)):(ue(`Ignoring compressed-file-data: ${t.compressedSize} bytes`),await this.tokenizer.ignore(t.compressedSize));if(ue(`Reading data-descriptor at pos=${this.tokenizer.position}`),t.dataDescriptor){if(134695760!==(await this.tokenizer.readToken(le)).signature)throw new Error("Expected data-descriptor-signature at position "+(this.tokenizer.position-le.len))}}while(!i)}async iterateOverCentralDirectory(e,t){for(const i of e){const e=t(i);if(e.handler){this.tokenizer.setPosition(i.relativeOffsetOfLocalHeader);const t=await this.readLocalFileHeader();if(t){await this.tokenizer.ignore(t.extraFieldLength);const n=new Uint8Array(i.compressedSize);await this.tokenizer.readBuffer(n),await this.inflate(t,n,e.handler)}}if(e.stop)break}}inflate(e,t,i){if(0===e.compressedMethod)return i(t);ue(`Decompress filename=${e.filename}, compressed-size=${t.length}`);var n,s;return i(31==(n=t)[0]&&139==n[1]&&8==n[2]?te(n,s):8!=(15&n[0])||n[0]>>4>7||(n[0]<<8|n[1])%31?ee(n,s):ie(n,s))}async readLocalFileHeader(){const e=await this.tokenizer.peekToken(o);if(e===ae){const e=await this.tokenizer.readToken(de);return e.filename=await this.tokenizer.readToken(new h(e.filenameLength,"utf-8")),e}if(e===oe)return!1;if(3759263696===e)throw new Error("Encrypted ZIP");throw new Error("Unexpected signature")}}function ve(e,t){const i=e.length,n=t.length;if(n>i)return-1;for(let s=0;s<=i-n;s++){let i=!0;for(let a=0;a<n;a++)if(e[s+a]!==t[a]){i=!1;break}if(i)return s}return-1}function xe(e){const t=e.reduce((e,t)=>e+t.length,0),i=new Uint8Array(t);let n=0;for(const t of e)i.set(t,n),n+=t.length;return i}Object.prototype.toString;new globalThis.TextDecoder("utf8");new globalThis.TextEncoder;Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function _e(e){const{byteLength:t}=e;return 6===t?e.getUint16(0)*2**32+e.getUint32(2):5===t?e.getUint8(0)*2**32+e.getUint32(1):4===t?e.getUint32(0):3===t?65536*e.getUint8(0)+e.getUint16(1):2===t?e.getUint16(0):1===t?e.getUint8(0):void 0}const be={get:(e,t)=>127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4},ke=4100;function Ce(e){switch(e=e.toLowerCase()){case"application/epub+zip":return{ext:"epub",mime:e};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:e};case"application/vnd.oasis.opendocument.text-template":return{ext:"ott",mime:e};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:e};case"application/vnd.oasis.opendocument.spreadsheet-template":return{ext:"ots",mime:e};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:e};case"application/vnd.oasis.opendocument.presentation-template":return{ext:"otp",mime:e};case"application/vnd.oasis.opendocument.graphics":return{ext:"odg",mime:e};case"application/vnd.oasis.opendocument.graphics-template":return{ext:"otg",mime:e};case"application/vnd.openxmlformats-officedocument.presentationml.slideshow":return{ext:"ppsx",mime:e};case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return{ext:"xlsx",mime:e};case"application/vnd.ms-excel.sheet.macroenabled":return{ext:"xlsm",mime:"application/vnd.ms-excel.sheet.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.spreadsheetml.template":return{ext:"xltx",mime:e};case"application/vnd.ms-excel.template.macroenabled":return{ext:"xltm",mime:"application/vnd.ms-excel.template.macroenabled.12"};case"application/vnd.ms-powerpoint.slideshow.macroenabled":return{ext:"ppsm",mime:"application/vnd.ms-powerpoint.slideshow.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return{ext:"docx",mime:e};case"application/vnd.ms-word.document.macroenabled":return{ext:"docm",mime:"application/vnd.ms-word.document.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.template":return{ext:"dotx",mime:e};case"application/vnd.ms-word.template.macroenabledtemplate":return{ext:"dotm",mime:"application/vnd.ms-word.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.template":return{ext:"potx",mime:e};case"application/vnd.ms-powerpoint.template.macroenabled":return{ext:"potm",mime:"application/vnd.ms-powerpoint.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.presentation":return{ext:"pptx",mime:e};case"application/vnd.ms-powerpoint.presentation.macroenabled":return{ext:"pptm",mime:"application/vnd.ms-powerpoint.presentation.macroenabled.12"};case"application/vnd.ms-visio.drawing":return{ext:"vsdx",mime:"application/vnd.visio"};case"application/vnd.ms-package.3dmanufacturing-3dmodel+xml":return{ext:"3mf",mime:"model/3mf"}}}function Se(e,t,i){i={offset:0,...i};for(const[n,s]of t.entries())if(i.mask){if(s!==(i.mask[n]&e[n+i.offset]))return!1}else if(s!==e[n+i.offset])return!1;return!0}class Te{constructor(e){this.options={mpegOffsetTolerance:0,...e},this.detectors=[...e?.customDetectors??[],{id:"core",detect:this.detectConfident},{id:"core.imprecise",detect:this.detectImprecise}],this.tokenizerOptions={abortSignal:e?.signal}}async fromTokenizer(e){const t=e.position;for(const i of this.detectors){const n=await i.detect(e);if(n)return n;if(t!==e.position)return}}async fromBuffer(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);var i,n;if(t?.length>1)return this.fromTokenizer((i=t,n=this.tokenizerOptions,new x(i,n)))}async fromBlob(e){return this.fromStream(e.stream())}async fromStream(e){const t=await _(e,this.tokenizerOptions);try{return await this.fromTokenizer(t)}finally{await t.close()}}async toDetectionStream(e,t){const{sampleSize:i=ke}=t;let n,s;const a=e.getReader({mode:"byob"});try{const{value:e,done:t}=await a.read(new Uint8Array(i));if(s=e,!t&&e)try{n=await this.fromBuffer(e.subarray(0,i))}catch(e){if(!(e instanceof m))throw e;n=void 0}s=e}finally{a.releaseLock()}const r=new TransformStream({async start(e){e.enqueue(s)},transform(e,t){t.enqueue(e)}}),o=e.pipeThrough(r);return o.fileType=n,o}check(e,t){return Se(this.buffer,e,t)}checkString(e,t){return this.check((i=e,[...i].map(e=>e.charCodeAt(0))),t);var i}detectConfident=async e=>{if(this.buffer=new Uint8Array(ke),void 0===e.fileInfo.size&&(e.fileInfo.size=Number.MAX_SAFE_INTEGER),this.tokenizer=e,await e.peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await e.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.detectConfident(e);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await e.ignore(6);const t=await e.readToken(be);return e.position+t>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(t),this.fromTokenizer(e))}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((67===this.buffer[0]||70===this.buffer[0])&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255]))return this.check([247],{offset:3})?{ext:"jls",mime:"image/jls"}:{ext:"jpg",mime:"image/jpeg"};if(this.check([79,98,106,1]))return{ext:"avro",mime:"application/avro"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){let i;return await new we(e).unzip(e=>{switch(e.filename){case"META-INF/mozilla.rsa":return i={ext:"xpi",mime:"application/x-xpinstall"},{stop:!0};case"META-INF/MANIFEST.MF":return i={ext:"jar",mime:"application/java-archive"},{stop:!0};case"mimetype":return{async handler(e){const t=new TextDecoder("utf-8").decode(e).trim();i=Ce(t)},stop:!0};case"[Content_Types].xml":return{async handler(e){let t=new TextDecoder("utf-8").decode(e);const n=t.indexOf('.main+xml"');if(-1===n){const e="application/vnd.ms-package.3dmanufacturing-3dmodel+xml";t.includes(`ContentType="${e}"`)&&(i=Ce(e))}else{t=t.slice(0,Math.max(0,n));const e=t.lastIndexOf('"'),s=t.slice(Math.max(0,e+1));i=Ce(s)}},stop:!0};default:return/classes\d*\.dex/.test(e.filename)?(i={ext:"apk",mime:"application/vnd.android.package-archive"},{stop:!0}):{}}}),i??{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await e.ignore(28);const n=new Uint8Array(8);return await e.readBuffer(n),Se(n,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/ogg; codecs=opus"}:Se(n,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:Se(n,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:Se(n,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:Se(n,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:Se(n,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(3===this.buffer[2]||5===this.buffer[2]||7===this.buffer[2])&&(4===this.buffer[3]||6===this.buffer[3]||8===this.buffer[3]))return{ext:"zip",mime:"application/zip"};if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF"))return{ext:"pdf",mime:"application/pdf"};if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){const a=await this.readTiffHeader(!1);if(a)return a}if(this.check([77,77])){const r=await this.readTiffHeader(!0);if(r)return r}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function o(){const t=await e.peekNumber(s);let i=128,n=0;for(;0===(t&i)&&0!==i;)++n,i>>=1;const a=new Uint8Array(n+1);return await e.readBuffer(a),a}async function c(){const e=await o(),t=await o();t[0]^=128>>t.length-1;const i=Math.min(6,t.length),n=new DataView(e.buffer),s=new DataView(t.buffer,t.length-i,i);return{id:_e(n),len:_e(s)}}async function m(t){for(;t>0;){const i=await c();if(17026===i.id){return(await e.readToken(new h(i.len))).replaceAll(/\00.*$/g,"")}await e.ignore(i.len),--t}}const p=await c();switch(await m(p.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/matroska"};default:return}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1")||this.checkString("PARE"))return{ext:"parquet",mime:"application/vnd.apache.parquet"};if(this.checkString("ttcf"))return{ext:"ttc",mime:"font/collection"};if(this.check([207,250,237,254]))return{ext:"macho",mime:"application/x-mach-binary"};if(this.check([4,34,77,24]))return{ext:"lz4",mime:"application/x-lz4"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.checkString(".RMF"))return{ext:"rm",mime:"application/vnd.rn-realmedia"};if(this.checkString("DRACO"))return{ext:"drc",mime:"application/vnd.google.draco"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(0===this.buffer[6]||1===this.buffer[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){const u=new h(4,"latin1").get(this.buffer,2);if(u.match("^d*")&&u>=1e3&&u<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>")){await e.ignore(8);return"debian-binary"===await e.readToken(new h(13,"ascii"))?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"}}if(this.checkString("WEBVTT")&&["\n","\r","\t"," ","\0"].some(e=>this.checkString(e,{offset:6})))return{ext:"vtt",mime:"text/vtt"};if(this.check([137,80,78,71,13,10,26,10])){async function f(){return{length:await e.readToken(l),type:await e.readToken(new h(4,"latin1"))}}await e.ignore(8);do{const g=await f();if(g.length<0)return;switch(g.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(g.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/vnd.apache.arrow.file"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.checkString("ftyp",{offset:4})&&96&this.buffer[8]){const y=new h(4,"latin1").get(this.buffer,8).replace("\0"," ").trim();switch(y){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return y.startsWith("3g")?y.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.check([82,73,70,70])){if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/wav"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function w(){const t=new Uint8Array(16);return await e.readBuffer(t),{id:t,size:Number(await e.readToken(d))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const v=await w();let x=v.size-24;if(Se(v.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const _=new Uint8Array(16);if(x-=await e.readBuffer(_),Se(_,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(Se(_,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(x)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10])){await e.ignore(20);switch(await e.readToken(new h(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255]))return this.check([0,60,0,63,0,120,0,109,0,108],{offset:2})?{ext:"xml",mime:"application/xml"}:void 0;if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(this.buffer,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),this.check([97,99,115,112],{offset:36}))return{ext:"icc",mime:"application/vnd.iccprofile"};if(this.checkString("**ACE",{offset:7})&&this.checkString("**",{offset:12}))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){const b=new DataView(this.buffer.buffer).getUint32(12,!0);if(b>12&&this.buffer.length>=b+16)try{const k=(new TextDecoder).decode(this.buffer.subarray(16,b+16));if(JSON.parse(k).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}return this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2])?{ext:"mxf",mime:"application/mxf"}:this.checkString("SCRM",{offset:44})?{ext:"s3m",mime:"audio/x-s3m"}:this.check([71])&&this.check([71],{offset:188})||this.check([71],{offset:4})&&this.check([71],{offset:196})?{ext:"mts",mime:"video/mp2t"}:this.check([66,79,79,75,77,79,66,73],{offset:60})?{ext:"mobi",mime:"application/x-mobipocket-ebook"}:this.check([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70])?{ext:"lnk",mime:"application/x.ms.shortcut"}:this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0])?{ext:"alias",mime:"application/x.apple.alias"}:this.checkString("Kaydara FBX Binary  \0")?{ext:"fbx",mime:"application/x.autodesk.fbx"}:this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8}))?{ext:"eot",mime:"application/vnd.ms-fontobject"}:this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29])?{ext:"indd",mime:"application/x-indesign"}:(await e.peekBuffer(this.buffer,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),this.checkString("ustar",{offset:257})&&(this.checkString("\0",{offset:262})||this.checkString(" ",{offset:262}))||this.check([0,0,0,0,0,0],{offset:257})&&function(e,t=0){const i=Number.parseInt(new h(6).get(e,148).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(i))return!1;let n=256;for(let i=t;i<t+148;i++)n+=e[i];for(let i=t+156;i<t+512;i++)n+=e[i];return i===n}(this.buffer)?{ext:"tar",mime:"application/x-tar"}:this.check([255,254])?this.check([60,0,63,0,120,0,109,0,108,0],{offset:2})?{ext:"xml",mime:"application/xml"}:this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2})?{ext:"skp",mime:"application/vnd.sketchup.skp"}:void 0:this.checkString("-----BEGIN PGP MESSAGE-----")?{ext:"pgp",mime:"application/pgp-encrypted"}:void 0)};detectImprecise=async e=>{if(this.buffer=new Uint8Array(ke),await e.peekBuffer(this.buffer,{length:Math.min(8,e.fileInfo.size),mayBeLess:!0}),this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(await e.peekBuffer(this.buffer,{length:Math.min(2+this.options.mpegOffsetTolerance,e.fileInfo.size),mayBeLess:!0}),this.buffer.length>=2+this.options.mpegOffsetTolerance)for(let e=0;e<=this.options.mpegOffsetTolerance;++e){const t=this.scanMpeg(e);if(t)return t}};async readTiffTag(e){const t=await this.tokenizer.readToken(e?r:a);switch(this.tokenizer.ignore(10),t){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"}}}async readTiffIFD(e){const t=await this.tokenizer.readToken(e?r:a);for(let i=0;i<t;++i){const t=await this.readTiffTag(e);if(t)return t}}async readTiffHeader(e){const t=(e?r:a).get(this.buffer,2),i=(e?c:o).get(this.buffer,4);if(42===t){if(i>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(i>=8){const t=(e?r:a).get(this.buffer,8),i=(e?r:a).get(this.buffer,10);if(28===t&&254===i||31===t&&11===i)return{ext:"nef",mime:"image/x-nikon-nef"}}}await this.tokenizer.ignore(i);return await this.readTiffIFD(e)??{ext:"tif",mime:"image/tiff"}}if(43===t)return{ext:"tif",mime:"image/tiff"}}scanMpeg(e){if(this.check([255,224],{offset:e,mask:[255,224]})){if(this.check([16],{offset:e+1,mask:[22]}))return this.check([8],{offset:e+1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:e+1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:e+1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:e+1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}}new Set(["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","macho","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ttc","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace","avro","icc","fbx","vsdx","vtt","apk","drc","lz4","potx","xltx","dotx","xltm","ott","ots","otp","odg","otg","xlsm","docm","dotm","potm","pptm","jar","rm","ppsm","ppsx"]),new Set(["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.ms-powerpoint.slideshow.macroenabled.12","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/vnd.apache.arrow.file","video/mp4","audio/midi","video/matroska","video/webm","video/quicktime","video/vnd.avi","audio/wav","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","video/ogg","audio/ogg","audio/ogg; codecs=opus","application/ogg","audio/flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-mach-binary","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","font/collection","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","text/vtt","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/vnd.apache.parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed","application/avro","application/vnd.iccprofile","application/x.autodesk.fbx","application/vnd.visio","application/vnd.android.package-archive","application/vnd.google.draco","application/x-lz4","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-excel.template.macroenabled.12","application/vnd.oasis.opendocument.text-template","application/vnd.oasis.opendocument.spreadsheet-template","application/vnd.oasis.opendocument.presentation-template","application/vnd.oasis.opendocument.graphics","application/vnd.oasis.opendocument.graphics-template","application/vnd.ms-excel.sheet.macroenabled.12","application/vnd.ms-word.document.macroenabled.12","application/vnd.ms-word.template.macroenabled.12","application/vnd.ms-powerpoint.template.macroenabled.12","application/vnd.ms-powerpoint.presentation.macroenabled.12","application/java-archive","application/vnd.rn-realmedia"]);const Ie={extensionMap:{apache:["htaccess"],bash:["bash","bash_history","bash_logout","bashrc","profile","sh","zsh","zshenv","zshrc"],c:["c","h"],cmake:["cmake"],cpp:["c++","cc","cp","cpp","cxx","hpp","in","m"],csharp:["cs"],css:["css"],d:["d"],dart:["dart"],diff:["diff"],dns:["dns","zone"],doxygen:["dox"],glsl:["frag","glsl","vert"],ini:["gitconfig","gitignore","gitmodules","gni","godot","hgignore","ini","toml","tres","tscn"],java:["java","jsp"],javascript:["cjs","js","jsx","mjs"],json:["arb","jshintrc","json","flutter","gltf"],latex:["tex"],less:["less"],lua:["lua","pluto"],makefile:["mak","make","mk","ninja"],markdown:["md"],php:["php"],plaintext:["cfg","conf"],powershell:["ps","ps1","pwsh"],properties:["npmrc","properties","vimrc"],python:["gyp","py"],ruby:["gemspec","podspec","rb"],rust:["rs"],sass:["sass"],scss:["scss"],sql:["sql"],typescript:["ts","tsx"],xml:["htm","html","plist","ui","xhtml","xml"],yaml:["yaml","yml"]},detectLanguage(e,t){const i=this.getFileExt(e);for(const e in this.extensionMap){if(this.extensionMap[e].includes(i))return e}const n={"application/x-shellscript":"sh"};if(n[t])return n[t];const s=e.name.toLowerCase();return"httpd.conf"===s?"apache":"cmakelists.txt"===s?"cmake":s.endsWith(".css.map")?"json":["gnumakefile","makefile"].includes(s)?"makefile":null},extToMimeType(e){if(!e)return null;return{csv:"text/csv",gd:"application/x-gdscript",ical:"text/calendar",ics:"text/calendar",ifb:"text/calendar",vcf:"text/vcard",vcs:"text/calendar"}[e=e.toLowerCase().trim()]||null},getFileExt:e=>e.name.split(".").pop().toLowerCase(),async getMimeType(e){const t=await e.slice(0,4100).arrayBuffer();let i=null;try{i=await async function(e,t){return new Te(t).fromBuffer(e)}(t),console.debug("[getMimeType] file-type:",i)}catch(e){console.error("[getMimeType] file-type failed:",e)}if(i?.mime)i=i.mime;else{const n=new Uint8Array(t).reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),s=e.type||this.extToMimeType(this.getFileExt(e));i=this.headerToMimeType(n,s)}return"string"==typeof i&&(i=i.toLowerCase()),i},headerToMimeType(e,t=null){let i=null,n=e.substring(0,8);switch(n){case"47494638":i="image/gif";break;case"89504e47":i="image/png";break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":i="image/jpeg"}return!i&&e.length>8&&("4449434d"===e.substring(256,264)?(n="4449434d",i="application/dicom"):"6e2b31"===e.substring(688,694)&&(n="6e2b3100",i="application/x-nifti")),i?console.log(`[FileHandler.headerToMimeType] "${n}" -> ${i}`):t?(i=t,console.log(`[FileHandler.headerToMimeType] Using "${i}" based on extension.`)):(n.startsWith("2321")?i="application/x-shellscript":n.startsWith("efbbbf")||n.startsWith("feff")||n.startsWith("fffe")||n.startsWith("0000feff")||n.startsWith("2b2f7638")||n.startsWith("2b2f7639")||n.startsWith("2b2f762b")||n.startsWith("2b2f762f")?i="text/plain":(n.startsWith("504b34")||n.startsWith("504b0304")||n.startsWith("504b0506"))&&(i="application/zip"),i&&console.log(`[FileHandler.headerToMimeType] Guessing "${n}" -> ${i}`)),i||console.log(`[FileHandler.headerToMimeType] Failed to find MIME type for header "${n}".`),i},isTypeText(e,t,i){if(e=String(e||""),t=String(t||""),i=String(i||""),e.startsWith("text/")||e.startsWith("message/"))return!0;if(["application/json","application/sql","application/toml","application/x-designer","application/x-gdscript","application/x-javascript","application/x-php","application/x-python","application/x-ruby","application/x-shellscript","application/x-yaml"].includes(e))return!0;if(["authors","changelog","code_of_conduct","contributing","contributors","copying","install","license","makefile","meson.build","readme","todo"].includes(i))return!0;if("bat"===t&&["application/x-bat","application/x-msdos-program"].includes(e))return!0;if(i.endsWith(".css.map"))return!0;if(i.length>1&&i.startsWith("."))return!0;for(const e in this.extensionMap){if(this.extensionMap[e].includes(t))return!0}return!1},audioExtensions:["3gp","aac","aiff","flac","m4a","mid","midi","mp2","mp3","oga","ogg","opus","wav","wma"],executableExtensions:["bat","cmd","com","ex","exe","jse","msi","out","ps1","run","sh"],imageExtensions:["avif","bmp","gif","heif","ico","jpeg","jpg","jxl","pbm","pgm","png","pnm","ppm","psd","svg","tif","tiff","webp","xcf"],videoExtensions:["3gp","avi","flv","m4v","mkv","mov","mp4","mpeg","mpg","ogg","ogv","qt","webm","wmv"]};class Ee{constructor(e,t=!1){this.file=e.file||e.fileList,this.mimeType=e.mimeType,this.isDir=t}destroy(){}getArrayBuffer(e){const t=this.file.arrayBuffer();return"function"==typeof e&&t.then(t=>e(null,t)).catch(t=>{console.error(t),e(t,null)}),t}getBase64(e){const t=new FileReader;t.onload=()=>e(null,t.result),t.onerror=t=>{console.error("[BaseParser.getBase64]",t),e(t,null)},t.readAsDataURL(this.file)}getText(e){const t=this.file.text();return"function"==typeof e&&t.then(t=>e(null,t)).catch(t=>{console.error(t),e(t,null)}),t}}var Me=i(26042),Le=i(42109);class Ae{constructor(e,t="base"){this.parser=e,this.type=t,this.metaData=[{name:"Filename",value:this.parser.file.name},{name:"Type",value:this.parser.mimeType},{name:"Filesize",value:Le.UI.formatSize(this.parser.file.size)}],this.nodeView=document.createElement("div"),this.nodeView.className="view view-"+this.type,this.nodeMeta=null}_buildMetaDataRow(e){const t=document.createElement("tr");if(e.hr){const e=document.createElement("td");e.colSpan=2,t.classList.add("hr"),t.append(e)}else if("string"==typeof e.group){const i=document.createElement("caption");i.textContent=e.group;const n=document.createElement("table");n.classList.add("group-table"),n.append(i),e.items.forEach(e=>{n.append(this._buildMetaDataRow(e))});const s=document.createElement("td");s.colSpan=2,s.append(n),t.classList.add("group"),t.append(s)}else{const i=e.name,n=e.value,s=document.createElement("th");s.className="name",s.textContent=i+": ";const a=document.createElement("td");a.className="value",!0===e.options?.valueAsHTML?a.innerHTML=n:a.textContent=n,null!=n&&0!==String(n).length||a.classList.add("empty"),t.classList.add("item"),t.append(s,a)}return t}_openWindow(e){let t=[this.nodeView];if(this.nodeMeta){const e=Le.UI.build('<div class="layout"></div>');e.append(this.nodeMeta,this.nodeView),t=[e]}return e=e||{},e.title??=Le.UI.escapeHTML(this.parser.file.name),e.content??=t,this.window=new Me.p(e),this.window.on("close",()=>{e.destroyOrder?e.destroyOrder.forEach(e=>e.destroy()):(this.parser?.destroy(),this.destroy())}),document.body.append(this.window.render()),setTimeout(()=>this.window?.center(),0),this.window}buildMetaNode(e={}){if(0===Object.keys(this.metaData).length)return;let t=!1;if(this.nodeMeta?(t=!!this.nodeMeta.querySelector("#metadata-toggle-empty")?.checked,Le.UI.removeAllChildren(this.nodeMeta)):this.nodeMeta=document.createElement("div"),this.nodeMeta.className="meta meta-"+this.type,this.nodeMeta.querySelector(".meta-table")?.remove(),this.nodeMeta.querySelector(".option-toggle-empty")?.remove(),e.toggleForEmpty){const e=Le.UI.build('<div class="option option-toggle-empty"><input type="checkbox" id="metadata-toggle-empty" value="1" /><label for="metadata-toggle-empty">Omit empty entries</label></div>'),i=e.querySelector("input");i.checked=t,i.addEventListener("change",e=>this.toggleEmptyMetaData(i.checked)),t&&setTimeout(()=>this.toggleEmptyMetaData(t),0),this.nodeMeta.append(e)}const i=document.createElement("table");i.className="meta-table",this.metaData.forEach(e=>{const t=this._buildMetaDataRow(e);i.append(t)}),this.nodeMeta.append(i)}destroy(){this.nodeView.remove(),this.nodeMeta.remove()}load(e){const t=document.createElement("p");t.className="note",t.textContent=`No parser found for file of type: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),this._openWindow(),e?.()}mdAdd(e,t,i){this.metaData.push({name:e,value:t,options:i})}mdAddGroup(e,t){this.metaData.push({group:e,items:t})}mdHR(){this.metaData.push({hr:1})}toggleEmptyMetaData(e){if(e){const e=t=>{let i=0;const n=t.querySelectorAll(":scope > tr:not([hidden])");n.forEach((e,t)=>{!e.classList.contains("hr")||0!==t&&t!==n.length-1||(e.setAttribute("hidden",""),i++)}),i>0&&e(t)},t=(t,i)=>{let n=!1;t.forEach(e=>{if(e.classList.contains("hr"))n&&e.setAttribute("hidden",""),n=!0;else{0===e.querySelector("td.value").innerHTML.length?e.setAttribute("hidden",""):n=!1}}),e(i)};this.nodeMeta.querySelectorAll(".meta-table .group-table").forEach(e=>{const i=e.querySelectorAll(":scope > tr.item");t(i,e)});const i=this.nodeMeta.querySelectorAll(".meta-table > tr.item");t(i,this.nodeMeta)}else{this.nodeMeta.querySelectorAll("tr[hidden]").forEach(e=>e.removeAttribute("hidden"))}}}const De=0,Fe=1,Pe=50,Re=100;class Ue{_importData=null;_parser=null;_view=null;canHandleImport(e){return Fe}getParser(){return this._parser??=new Ee(this._importData,!!this._importData?.dir),this._parser}getView(){return this._view??=new Ae(this.getParser()),this._view}setImportData(e){this._parser=null,this._view=null,this._importData=e}}class ze extends Ae{constructor(e){super(e,"audio"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){this._objectURL=URL.createObjectURL(this.parser.file);const t=document.createElement("audio");if(t.setAttribute("controls",""),t.setAttribute("preload","metadata"),t.volume=.5,t.canPlayType(this.parser.mimeType))t.addEventListener("loadedmetadata",()=>{this.mdAdd("Duration",Le.UI.formatDuration(1e3*t.duration)),this.buildMetaNode(),this.nodeView.appendChild(t),this._openWindow(),e?.()}),t.src=this._objectURL;else{const t=document.createElement("p");t.className="note",t.textContent=`Playback for audio format not supported: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),this._openWindow(),e?.()}}}class Ne extends Ue{canHandleImport(e){return e.mimeType?.startsWith("audio/")?Pe:De}getView(){return this._view??=new ze(this.getParser()),this._view}}class Oe extends Ee{constructor(e){super(e),this._msg=null,this._objectURLs={}}destroy(){for(const e in this._objectURLs)URL.revokeObjectURL(this._objectURLs[e]);this._objectURLs={}}getImage(e){if(!e||!String(e.attachMimeTag).startsWith("image/"))return null;const t=new Image;return t.loading="lazy",t.onerror=e=>console.error("[CFBParser.getImage]",e),t.src=this.getObjectURL(e),t}getObjectURL(e){const t=e.dataId;if(this._objectURLs[t])return this._objectURLs[t];const i=this._msg.getAttachment(e);return this._objectURLs[t]=URL.createObjectURL(new Blob([i.content],{type:e.attachMimeTag}))}async parse(e){const t=(await Promise.all([i.e(2047),i.e(9831)]).then(i.t.bind(i,2047,23))).default;this.getArrayBuffer((i,n)=>{this._msg=new t(n),e(null,this._msg)})}}var je=i(38518),Ve=i(81094),Be=i(19108);class He extends Be.u{constructor(e){super(),this._buttons=e}_toggle(e){this._buttons.forEach(e=>e._node.classList.remove("selected")),e._node.classList.add("selected")}render(){super.render(),this._node=Le.UI.build('<div class="button-group"></div>');for(let e=0;e<this._buttons.length;e++){const t=this._buttons[e];t.on("click",()=>this._toggle(t)),this._node.append(t.render())}return this._node}}var qe=i(91625);class $e extends Ae{constructor(e){super(e,"cfb")}_addMetaInfo(e){if(e.senderEmail||e.senderName){let t=null;e.senderName?(t=e.senderName,e.senderEmail&&(t+=` <${e.senderEmail}>`)):t=`<${e.senderEmail}>`,this.mdAdd("Sender",t)}Array.isArray(e.recipients)&&e.recipients.forEach(e=>{let t="Recipient";e.recipType&&(t+=" "+String(e.recipType).toUpperCase());let i=null;e.name?(i=e.name,e.email&&(i+=` <${e.email}>`)):i=`<${e.email}>`,this.mdAdd(t,i)}),Array.isArray(e.attachments)&&this.mdAdd("Attachments",e.attachments.length),e.creationTime&&this.mdAdd("Creation time",e.creationTime),e.lastModificationTime&&this.mdAdd("Last modification",e.lastModificationTime),e.messageDeliveryTime&&this.mdAdd("Delivery time",e.messageDeliveryTime)}_buildActions(){return new He([new Ve.$({text:"Content",classes:"selected",onClick:()=>{this.nodeView.querySelector(".content-body").style.display="";this.nodeView.querySelector(".content-attachments").style.display="none"}}),new Ve.$({text:"Attachments",onClick:()=>{this.nodeView.querySelector(".content-body").style.display="none";this.nodeView.querySelector(".content-attachments").style.display=""}})]).render()}_buildAttachmentItem(e,t){const i=Le.UI.build(`\n\t\t\t<li class="attachment" data-id="${e.dataId}">\n\t\t\t\t<div class="image"></div>\n\t\t\t\t<table class="info"></table>\n\t\t\t</li>\n\t\t`),n=this.parser.getObjectURL(e),s=Le.UI.escapeHTML(e.fileName||e.name),a=t?"":` download="${e.fileNameShort||e.fileName}"`,r=i.querySelector(".info");if(r.append(Le.UI.buildTableRow("Filename:",`<a href="${n}" target="_blank"${a}>${s}</a>`,{valueAsHTML:!0}),Le.UI.buildTableRow("Filesize:",Le.UI.formatSize(e.contentLength||0))),"string"==typeof e.attachMimeTag&&r.append(Le.UI.buildTableRow("Type:",e.attachMimeTag)),t)Le.UI.onImageComplete(t,()=>{const e=`${t.naturalWidth}×${t.naturalHeight} px`;r.append(Le.UI.buildTableRow("Dimensions:",e)),t.width=t.naturalWidth,t.height=t.naturalHeight}),i.querySelector(".image").append(t);else{const t=i.querySelector(".image");t.classList.add("symbol");const n=this._getAttachmentIcon(e);t.append(Le.UI.build(`<span class="icon">${n}</span>`))}return i}_buildContent(e){const t=e.getFileData();let i="";if("string"==typeof t.bodyHtml)i=je.D.buildDocument(t.bodyHtml);else if("string"==typeof t.body){let e=je.D.decodeContent(t.body);i=je.D.buildDocument(`<pre style="white-space: pre-wrap; word-break: break-word;">${e}</pre>`)}const n=Le.UI.build('\n\t\t\t<div class="content-body">\n\t\t\t\t<iframe class="content-no-res" sandbox></iframe>\n\t\t\t</div>\n\t\t\t<div class="content-attachments" style="display: none;">\n\t\t\t\t<ol class="list"></ol>\n\t\t\t</div>\n\t\t');if(t.subject){const e=Le.UI.build(`<div class="subject">${Le.UI.escapeHTML(t.subject)}</div>`);n.querySelector(".content-body").prepend(e)}n.querySelector(".content-body iframe").setAttribute("srcdoc",i.documentElement.outerHTML);const s=n.querySelector(".content-attachments .list");(t.attachments||[]).forEach(e=>{if("attachment"!==e.dataType)return;const t=this.parser.getImage(e),i=this._buildAttachmentItem(e,t);s.append(i)}),this.nodeView.append(this._buildActions(),n)}_getAttachmentIcon(e){let t=qe.F.attachment;return".zip"===e.extension&&(t=qe.F.format_zip),t}load(e){this.parser.parse((t,i)=>{console.log("[CFBView.load] MsgReader:",i),this._addMetaInfo(i.getFileData()),this.buildMetaNode(),this._buildContent(i),this._openWindow({height:800,width:Math.min(1e3,window.innerWidth)}),e?.()})}}class Ge extends Ue{canHandleImport(e){return"application/x-cfb"===e.mimeType?Re:De}getParser(){return this._parser??=new Oe(this._importData),this._parser}getView(){return this._view??=new $e(this.getParser()),this._view}}class We extends Ee{constructor(e){super(e)}parse(e){this.getText(async(t,n)=>{const{parse:s}=await i.e(829).then(i.bind(i,40304)),a=s(n);e(null,a)})}}class Xe extends Ae{constructor(e){super(e,"csv")}_build(e){const t=document.createElement("table");for(let i=0;i<e.length;i++){const n=e[i],s=document.createElement("tr"),a=0===i?"th":"td";for(let e=0;e<n.length;e++){const t=document.createElement("span");t.textContent=n[e];const i=document.createElement(a);i.append(t),s.append(i)}t.append(s)}return t}load(e){this.parser.parse((t,i)=>{this.mdAdd("Columns",i.length>0?i[0].length:0),this.mdAdd("Rows",i.length),this.buildMetaNode();const n=this._build(i);this.nodeView.append(n),this._openWindow(),e?.()})}}class Ke extends Ue{canHandleImport(e){return"csv"===e.ext?Re:De}getParser(){return this._parser??=new We(this._importData),this._parser}getView(){return this._view??=new Xe(this.getParser()),this._view}}class Ze extends Ee{static numInstances=0;constructor(e){super(e,!!e.dir),this.file=e.dir||e.file,Ze.numInstances++}destroy(){if(URL.revokeObjectURL(this._objectURL),Ze.numInstances+Ye.numInstances===1){console.log("[NIFTIParser.destroy] Purging cornerstone caches.");try{this.cache.purgeCache()}catch(e){console.error("[NIFTIParser.destroy]",e)}}Ze.numInstances--}async parse(e){const t=await Promise.all([i.e(3387),i.e(7784),i.e(8483)]).then(i.bind(i,97784)),n=await Promise.all([i.e(3387),i.e(3758),i.e(5693)]).then(i.bind(i,83758));t.init(),n.init(),t.imageLoader.registerImageLoader("nifti",n.cornerstoneNiftiImageLoader),this.cache=t.cache,this._objectURL=URL.createObjectURL(this.file),e(null,await n.createNiftiImageIdsAndCacheMetadata({url:this._objectURL}))}}class Ye extends Ee{static numInstances=0;constructor(e){super(e,!!e.dir),this.file=e.dir||e.file,e.fileList&&(this.entries=e.fileList),this._fileManagerIds=[],Ye.numInstances++}_loadFromDicomdirFile(e,t){e.arrayBuffer().then(async e=>{const n=(await Promise.all([i.e(5915),i.e(4995)]).then(i.t.bind(i,35915,23))).parseDicom(new Uint8Array(e),{TransferSyntaxUID:"1.2.840.10008.1.2"}).elements.x00041220;n&&Array.isArray(n.items)?t(null,n):console.error("[DICOMParser._parseHandlerDir] Record is either not set or has no entries.",n)}).catch(e=>console.error(e))}_parseHandlerDir(e){const t=this.entries,i=t.find(e=>e.isFile&&"dicomdir"===e.name.toLowerCase());i?i.file(t=>this._loadFromDicomdirFile(t,e),t=>{console.error("[DICOMParser._parseHandlerDir]",t),e(t)}):e(null,t)}async addAndLoadFile(e){const t=this.wadouri.fileManager.add(e);return this._fileManagerIds.push(t),await this.wadouri.loadImage(t).promise}destroy(){if(1===Ye.numInstances){console.log("[DICOMParser.destroy] Purging cornerstone caches.");try{0===Ze.numInstances&&this.cache.purgeCache(),this.wadouri.dataSetCacheManager.purge(),this.wadouri.fileManager.purge()}catch(e){console.error("[DICOMParser.destroy]",e)}}Ye.numInstances--}static getModalityName(e){if(!e)return e;e=String(e).toUpperCase();let t=Ye.MODALITY_MAP[e];return t&&(t+=` [${e}]`),t||e}static getPregnancyStatus(e){if(isNaN(Number(e)))return e;return["not pregnant","possibly pregnant","definitely pregnant","unknown"][(e=Number(e))+1]||e}getFilepathsFromRecord(e){const t=[];return e.items.forEach(e=>{let i=e.dataSet.string("x00041500");i&&(i=i.replace(/\\/g,"/"),t.push(i))}),t}loadDICOMDIRFiles(e,t){const i=[];if(Array.isArray(e)){const n=s=>{if(s>=e.length)return void t(null,i);e[s].file(async e=>{const t=await this.addAndLoadFile(e);i.push(t),n(s+1)})};n(0)}else{const n=this.getFilepathsFromRecord(e),s=e=>{if(e>=n.length)return void t(null,i);const a=n[e];this.file.getFile(a,{},t=>{t.file(async t=>{const n=await this.addAndLoadFile(t);i.push(n),s(e+1)})},t=>{console.error(`[DICOMParser.loadDICOMDIRFiles] getFile "${a}": `+t.message),s(e+1)})};s(0)}}async parse(e){const t=await Promise.all([i.e(3387),i.e(7784),i.e(8483)]).then(i.bind(i,97784)),n=await Promise.all([i.e(3387),i.e(1612),i.e(5915),i.e(6599),i.e(8146)]).then(i.bind(i,66599));if(t.init(),n.init(),this.cache=t.cache,this.wadouri=n.wadouri,this.isDir)this._parseHandlerDir(e);else if("dicomdir"===this.file.name.toLowerCase())this._loadFromDicomdirFile(this.file,(t,i)=>{const n=this.getFilepathsFromRecord(i);e(null,n)});else{const t=await this.addAndLoadFile(this.file);e(null,t)}}}Ye.MODALITY_MAP={AR:"Autorefraction",AS:"Angioscopy",ASMT:"Content Assessment Results",AU:"Audio",BDUS:"Bone Densitometry (ultrasound)",BI:"Biomagnetic imaging",BMD:"Bone Densitometry (X-Ray)",CD:"Color flow Doppler",CF:"Cinefluorography",CP:"Colposcopy",CR:"Computed Radiography",CS:"Cystoscopy",CT:"Computed Tomography",DD:"Duplex Doppler",DF:"Digital fluoroscopy",DG:"Diaphanography",DM:"Digital microscopy",DOC:"Document",DS:"Digital Subtraction Angiography",DX:"Digital Radiography",EC:"Echocardiography",ECG:"Electrocardiography",EPS:"Cardiac Electrophysiology",ES:"Endoscopy",FA:"Fluorescein angiography",FID:"Fiducials",FS:"Fundoscopy",GM:"General Microscopy",HC:"Hard Copy",HD:"Hemodynamic Waveform",IO:"Intra-Oral Radiography",IOL:"Intraocular Lens Data",IVOCT:"Intravascular Optical Coherence Tomography",IVUS:"Intravascular Ultrasound",KER:"Keratometry",KO:"Key Object Selection",LEN:"Lensometry",LP:"Laparoscopy",LS:"Laser surface scan",MA:"Magnetic resonance angiography",MG:"Mammography",MR:"Magnetic Resonance",MS:"Magnetic resonance spectroscopy",NM:"Nuclear Medicine",OAM:"Ophthalmic Axial Measurements",OCT:"Optical Coherence Tomography (non-Ophthalmic)",OP:"Ophthalmic Photography",OPM:"Ophthalmic Mapping",OPR:"Ophthalmic Refraction",OPT:"Ophthalmic Tomography",OPV:"Ophthalmic Visual Field",OSS:"Optical Surface Scan",OT:"Other",PLAN:"Plan",PR:"Presentation State",PT:"Positron emission tomography (PET)",PX:"Panoramic X-Ray",REG:"Registration",RESP:"Respiratory Waveform",RF:"Radio Fluoroscopy",RG:"Radiographic imaging (conventional film/screen)",RTDOSE:"Radiotherapy Dose",RTIMAGE:"Radiotherapy Image",RTPLAN:"Radiotherapy Plan",RTRECORD:"RT Treatment Record",RTSTRUCT:"Radiotherapy Structure Set",RWV:"Real World Value Map",SEG:"Segmentation",SM:"Slide Microscopy",SMR:"Stereometric Relationship",SR:"SR Document",SRF:"Subjective Refraction",ST:"Single-photon emission computed tomography (SPECT)",STAIN:"Automated Slide Stainer",TG:"Thermography",US:"Ultrasound",VA:"Visual Acuity",VF:"Videofluorography",XA:"X-Ray Angiography",XC:"External-camera Photography"};class Je extends Ae{constructor(e){super(e,"dicom"),this._frameDelay=250,this._frameIndex=0,this._frameTime=33.333,this._listenerKeyNav=null,this._metaGroups=null,this._timer=0}_addMetaInfo(e){const t=!this._metaGroups;this._metaGroups=this._metaGroups||{};["patient","patientStudy","generalStudy","generalSeries","generalImage","generalEquipment"].forEach(e=>{this._metaGroups[e]=this._metaGroups[e]||[],this._metaGroups[e].length=0}),this._metaGroups.patient.push({name:"Patient ID",value:e.string("x00100020")},{name:"Issuer of Patient ID",value:e.string("x00100021")},{name:"Type of Patient ID",value:e.string("x00100022")},{hr:1},{name:"Patient Name",value:e.string("x00100010")},{name:"Other Patient Names",value:e.string("x00101001")},{name:"Patient Birth Date",value:e.string("x00100030")},{name:"Patient Birth Time",value:e.string("x00100032")},{name:"Patient Sex",value:e.string("x00100040")},{name:"Ethnic Group",value:e.string("x00102160")},{name:"Patient Breed Desc.",value:e.string("x00102292")},{name:"Patient Species Desc.",value:e.string("x00102201")},{name:"Patient Comments",value:e.string("x00104000")},{name:"Strain Desc.",value:e.string("x00100212")},{name:"Strain Nomenclature",value:e.string("x00100213")},{name:"Strain Addit. Info.",value:e.string("x00100218")},{hr:1},{name:"Responsible Person",value:e.string("x00102297")},{name:"Resp. Person Role",value:e.string("x00102298")},{name:"Resp. Organization",value:e.string("x00102299")}),this._metaGroups.patientStudy.push({name:"Admitting Diagnoses Desc.",value:e.string("x00081080")},{name:"Patient's Age (years)",value:e.string("x00101010")},{name:"Patient's Size (m)",value:e.string("x00101020")},{name:"Patient's BMI",value:e.string("x00101022")},{name:"Measured AP Dimension (mm)",value:e.string("x00101023")},{name:"Measured Lateral Dimension (mm)",value:e.string("x00101024")},{name:"Patient's Weight (kg)",value:e.string("x00101030")},{name:"Medical Alerts",value:e.string("x00102000")},{name:"Allergies",value:e.string("x00102110")},{name:"Occupation",value:e.string("x00102180")},{name:"Smoking Status",value:e.string("x001021a0")},{name:"Addit. Patient History",value:e.string("x001021b0")},{name:"Pregnancy Status",value:Ye.getPregnancyStatus(e.string("x001021c0"))},{name:"Last Menstrual Date",value:e.string("x001021d0")},{name:"Patient's Sex Neutered",value:e.string("x00102203")},{name:"Reason for Visit",value:e.string("x00321066")},{name:"Admission ID",value:e.string("x00380010")},{name:"Service Episode ID",value:e.string("x00380060")},{name:"Service Episode Desc.",value:e.string("x00380062")},{name:"Patient State",value:e.string("x00380500")}),this._metaGroups.generalStudy.push({name:"Study Date",value:e.string("x00080020")},{name:"Study Time",value:e.string("x00080030")},{name:"Accession Number",value:e.string("x00080050")},{name:"Referring Physician Name",value:e.string("x00080090")},{name:"Consulting Physician's Name",value:e.string("x0008109c")},{name:"Study Desc.",value:e.string("x00081030")},{name:"Physician(s) of Record",value:e.string("x00081048")},{name:"Physician(s) Reading Study",value:e.string("x00081060")},{name:"Study ID",value:e.string("x00200010")},{name:"Requesting Service",value:e.string("x00321033")}),this._metaGroups.generalSeries.push({name:"Series Date",value:e.string("x00080021")},{name:"Series Time",value:e.string("x00080031")},{name:"Modality",value:Ye.getModalityName(e.string("x00080060"))},{name:"Series Desc.",value:e.string("x0008103e")},{name:"Performing Physician's Name",value:e.string("x00081050")},{name:"Operator's Name",value:e.string("x00081070")},{name:"Anatomical Orientation Type",value:e.string("x00102210")},{name:"Body Part Examined",value:e.string("x00180015")},{name:"Protocol Name",value:e.string("x00181030")},{name:"Patient Position",value:e.string("x00185100")},{name:"Series Number",value:e.string("x00200011")},{name:"Laterality",value:e.string("x00200060")},{name:"Performed Procedure Step Desc.",value:e.string("x00400254")},{name:"Comments on the Procedure Step",value:e.string("x00400280")}),this._metaGroups.generalImage.push({name:"Image Type",value:e.string("x00080008")},{name:"Patient Orientation",value:e.string("x00200020")},{name:"Image Laterality",value:e.string("x00200062")},{name:"Image Comments",value:e.string("x00204000")}),this._metaGroups.generalEquipment.push({name:"Manufacturer",value:e.string("x00080070")},{name:"Institution Name",value:e.string("x00080080")},{name:"Institution Address",value:e.string("x00080081")},{name:"Station Name",value:e.string("x00081010")},{name:"Institutional Department Name",value:e.string("x00081040")},{name:"Manufacturer's Model Name",value:e.string("x00081090")},{name:"Device Serial Number",value:e.string("x00181000")},{name:"Device UID",value:e.string("x00181002")},{name:"Gantry ID",value:e.string("x00181008")},{name:"Software Versions",value:e.string("x00181020")},{name:"Spatial Resolution",value:e.string("x00181050")},{name:"Date of Last Calibration",value:e.string("x00181200")},{name:"Time of Last Calibration",value:e.string("x00181201")}),t&&(this.mdAddGroup("Patient",this._metaGroups.patient),this.mdAddGroup("Patient Study",this._metaGroups.patientStudy),this.mdAddGroup("General Study",this._metaGroups.generalStudy),this.mdAddGroup("General Series",this._metaGroups.generalSeries),this.mdAddGroup("General Image",this._metaGroups.generalImage),this.mdAddGroup("General Equipment",this._metaGroups.generalEquipment))}_buildControls(){const e=Le.UI.build(`\n\t\t\t<div class="image-container"></div>\n\t\t\t<div class="actions">\n\t\t\t\t<input type="range" min="1" max="${this._numFrames}" value="1" />\n\t\t\t\t<div class="line">\n\t\t\t\t\t<div class="wrap wrap-frame-controls"></div>\n\t\t\t\t\t<div class="wrap wrap-playback">\n\t\t\t\t\t\t<select class="speed">\n\t\t\t\t\t\t\t<option value="${this._frameTime}">Default: ${this._frameTime} ms</option>\n\t\t\t\t\t\t\t<option value="16.7">16.7 ms</option>\n\t\t\t\t\t\t\t<option value="33.3">33.3 ms</option>\n\t\t\t\t\t\t\t<option value="66.7">66.7 ms</option>\n\t\t\t\t\t\t\t<option value="133.3">133.3 ms</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`),t=new Ve.$({classes:"frame-prev",icon:qe.F.arrow_prev}),i=new Ve.$({classes:"frame-next",icon:qe.F.arrow_next}),n=new Ve.$({classes:"play-pause",icon:qe.F.play});if(e.querySelector(".wrap-frame-controls").append(t.render(),Le.UI.build('<span class="counter"></span>'),i.render()),e.querySelector(".wrap-playback").append(n.render()),this._frameIndex=0,this._numFrames<=2)e.querySelector(".actions").remove();else{const s=e.querySelector('input[type="range"]');s.addEventListener("change",e=>{this._frameIndex=e.target.valueAsNumber-1,this._controlGoto(this._frameIndex)}),t.on("click",e=>{this._controlGoto(--this._frameIndex),s.value=this._frameIndex+1}),i.on("click",e=>{this._controlGoto(++this._frameIndex),s.value=this._frameIndex+1});const a=e.querySelector("select.speed");a.addEventListener("change",e=>{this._frameTime=Number(a.value)}),n.on("click",e=>{this._timer?(n.update({icon:qe.F.play}),clearTimeout(this._timer),this._timer=0,this._updateMeta()):(n.update({icon:qe.F.pause}),this._playback(s))}),this._listenerKeyNav=e=>{const t=document.activeElement;t&&"range"===t.type||("ArrowLeft"===e.key?(this._controlGoto(--this._frameIndex),s.value=this._frameIndex+1):"ArrowRight"===e.key&&(this._controlGoto(++this._frameIndex),s.value=this._frameIndex+1))},document.body.addEventListener("keyup",this._listenerKeyNav),this._counter=e.querySelector(".counter")}this.nodeView.append(e)}_buildDICOMDIRFileList(e){const t=document.createElement("ol");e.forEach(e=>{const i=document.createElement("li");i.textContent=e,t.append(i)});const i=document.createElement("wrap");i.className="dicomdir-list",i.append(t),this.nodeView.append(i)}_controlGoto(e,t=!0){this._frameIndex=this.showImage(e,t),this._counter&&(this._counter.textContent=this._frameIndex+1+"/"+this._numFrames)}_handleResize(){}async _initViewport(){const{Enums:e,RenderingEngine:t}=await Promise.all([i.e(3387),i.e(7784),i.e(8483)]).then(i.bind(i,97784)),n=this.nodeView.querySelector(".image-container");this._renderingEngine=new t,this._renderingEngine.enableElement({viewportId:"ctStack",type:e.ViewportType.STACK,element:n,defaultOptions:{orientation:e.OrientationAxis.AXIAL}}),this._viewport=this._renderingEngine.getViewport("ctStack")}_playback(e){if(this._timer)return;const t=0===this._frameIndex?this._frameDelay:0;this._timer=setTimeout(()=>{this._controlGoto(++this._frameIndex,!1),e.value=this._frameIndex+1,this._timer=0,this._playback(e)},this._frameTime+t)}_updateMeta(){this._images?.length&&(clearTimeout(this._metaUpdateTimeout),this._metaUpdateTimeout=setTimeout(()=>{const e=this._images[this._frameIndex]?.data;e&&(this._addMetaInfo(e),this.buildMetaNode({toggleForEmpty:!0}))},200))}destroy(){super.destroy(),clearTimeout(this._timer),this._renderingEngine?.destroy(),this._renderingEngine=null,this._viewport=null,this._images=null,this._imageId=null,document.body.removeEventListener("keyup",this._listenerKeyNav)}load(e){this.parser.parse(async(t,i)=>{if(!t)if(this.parser.isDir)this.parser.loadDICOMDIRFiles(i,async(t,i)=>{this._images=i,this._numFrames=this._images.length,this.buildMetaNode(),this._buildControls();this._openWindow().on("resized",()=>this._handleResize()),e?.(),await this._initViewport(),this._viewport.setStack(this._images.map(e=>e.imageId)),this.showFile(0),this._controlGoto(0)});else if(Array.isArray(i))this._buildDICOMDIRFileList(i),this.buildMetaNode(),this._openWindow(),e?.();else{const t=i.data;this._numFrames=Number(t.string("x00280008")||1),this._frameDelay=Number(t.string("x00181033")||this._frameDelay),this._frameTime=Number(t.string("x00181063")||this._frameTime),this._addMetaInfo(t),this.buildMetaNode({toggleForEmpty:!0}),this._buildControls();this._openWindow().on("resized",()=>this._handleResize()),e?.(),this._imageId=i.imageId,await this._initViewport();let n=[];for(let e=0;e<this._numFrames;e++){let t=e>0?this._imageId+"?frame="+e:this._imageId;n.push(t)}this._viewport.setStack(n),this._controlGoto(0)}})}showFile(e){e>=this._images.length?e=0:e<0&&(e=this._images.length-1);const t=this._images[e],i=t.data;return this._frameDelay=Number(i.string("x00181033")||this._frameDelay),this._frameTime=Number(i.string("x00181063")||this._frameTime),this._addMetaInfo(i),this.buildMetaNode({toggleForEmpty:!0}),this._imageId=t.imageId,e}showImage(e,t=!0){return e>=this._numFrames?e=0:e<0&&(e=this._numFrames-1),this._viewport.setImageIdIndex(e),t&&this._updateMeta(),e}}class Qe extends Ue{canHandleImport(e){return"application/dicom"===e.mimeType?Re:De}getParser(){return this._parser??=new Ye(this._importData),this._parser}getView(){return this._view??=new Je(this.getParser()),this._view}static containsDICOMDIRFile(e){return!!e.find(e=>e.isFile&&"dicomdir"===e.name.toLowerCase())}static async containsDICOMFiles(e){let t=0;for(let i=0;i<e.length;i++){const n=e[i];if(await this.isDICOMFile(n)&&(t++,t>1))return!0}return!1}static isDICOMFile(e){return e?.isFile?e.name.toLocaleLowerCase().endsWith(".dcm")?new Promise((e,t)=>e(!0)):new Promise((t,i)=>{e.file(async e=>{const i=await Ie.getMimeType(e);t("application/dicom"===i)},e=>{console.error("[DICOMPlugin.isDICOMFile]",e),t(!1)})}):new Promise((e,t)=>e(!1))}}class et extends Ee{constructor(e){super(e),this._lastParsed=null}buildHeadersHTML(e){const t=document.createElement("table");e.forEach(e=>{const i=document.createElement("th");i.className="header-name",i.textContent=e.name;const n=document.createElement("td");n.className="header-value",n.textContent=e.value;const s=document.createElement("tr");s.append(i,n),t.append(s)});const i=document.createElement("div");return i.className="headers",i.append(t),i}getBodyDOM(e,t){if(e||(e={}),"boolean"!=typeof e.remove_external&&(e.remove_external=!0),this._lastParsed){let i=je.D.decodeContent(this._lastParsed.body),n=null,s=this.getHeader(this._lastParsed.headers,"content-type")||"";s=s.toLowerCase();let a="plaintext";s.startsWith("text/html")?(n=je.D.buildDocument(i),a="html"):n=je.D.buildDocument(`<pre>${i}</pre>`),n&&e.remove_external&&je.D.removeExternalResources(n),t(null,n,a)}else this.getText((i,n)=>{this.parse(n),this._lastParsed?this.getBodyDOM(e,t):t(new Error("Failed to parse"),null,null)})}getHeader(e,t){e=e||{};for(const i of e)if(i.name.toLowerCase()===t)return i.value;return null}getHeadersHTML(e){if(this._lastParsed){const t=this.buildHeadersHTML(this._lastParsed.headers);e(null,t)}else this.getText((t,i)=>{const n=this.parse(i),s=this.buildHeadersHTML(n.headers);e(null,s)})}parse(e){this._lastParsed=null;let t=(e=e.trimStart()).split("\r\n\r\n");if(2!==t.length&&(t=e.split("\n\n")),t.length<2)return null;const i=t.splice(0,1)[0].trim(),n={headers:[],body:t.join("\n\n")};let s=null,a=null,r=!0,o=i.split("\r\n");1===o.length&&(o=i.split("\n"));for(const e of o)if(e.startsWith(" ")||e.startsWith("\t")?(a+=e.trimStart(),r=!1):s&&(n.headers.push({name:s,value:a}),r=!0),r){const t=e.split(": ");s=t[0],a=t.slice(1).join(": ")}return s&&n.headers.push({name:s,value:a}),this._lastParsed=n,n}}class tt extends Ae{constructor(e){super(e,"eml")}_buildActions(){return new He([new Ve.$({text:"Show Headers",onClick:()=>{this.nodeView.querySelector("iframe.content-res ")?.remove();this.nodeView.querySelector("iframe.content-no-res").style.display="none";this.nodeView.querySelector(".headers").style.display=""}}),new Ve.$({text:"Content (no external)",classes:"selected",onClick:()=>{this.nodeView.querySelector("iframe.content-res ")?.remove();this.nodeView.querySelector("iframe.content-no-res").style.display="";this.nodeView.querySelector(".headers").style.display="none"}}),new Ve.$({text:"Content (with external)",onClick:()=>{if(!window.confirm("Show the content and load its external resources?\nThis could pose a security risk.\n\nOnly agree if you trust the EML file."))return!1;this.nodeView.querySelector("iframe.content-res ")?.remove();this.nodeView.querySelector("iframe.content-no-res").style.display="none";this.nodeView.querySelector(".headers").style.display="none",this.parser.getBodyDOM({remove_external:!1},(e,t,i)=>{const n=document.createElement("iframe");n.className=`content-res eml-type-${i}`,n.setAttribute("sandbox",""),n.setAttribute("srcdoc",t.documentElement.outerHTML),this.nodeView.append(n)})}})]).render()}load(e){const t=document.createElement("iframe");t.className="content-no-res",t.setAttribute("sandbox",""),this.parser.getBodyDOM({remove_external:!0},(i,n,s)=>{this.parser.getHeadersHTML((i,a)=>{this.buildMetaNode();const r=this._buildActions();a.style.display="none",t.classList.add(`eml-type-${s}`),t.setAttribute("srcdoc",n.documentElement.outerHTML),this.nodeView.append(r,a,t),this._openWindow(),e?.()})})}}class it extends Ue{canHandleImport(e){return"eml"===e.ext?Re:De}getParser(){return this._parser??=new et(this._importData),this._parser}getView(){return this._view??=new tt(this.getParser()),this._view}}class nt extends Ee{constructor(e){super(e)}parse(e){this.getArrayBuffer(async(t,n)=>{const{GifReader:s}=await i.e(5900).then(i.t.bind(i,34399,19));let a=null;try{a=new s(new Uint8Array(n))}catch(t){return console.error(t),void e(t,null)}e(null,a)})}}class st extends Ae{constructor(e){super(e,"gif"),this._currentCanvas=null,this._frameIndex=0,this._frames=[],this._gifReader=null,this._listenerKeyNav=null}_buildActions(){return new He([new Ve.$({text:"Image",onClick:()=>{this.nodeView.querySelector(".content-frames").style.display="none";this.nodeView.querySelector(".content-image").style.display=""}}),new Ve.$({text:"Frames",classes:"selected",onClick:()=>{this.nodeView.querySelector(".content-frames").style.display="";this.nodeView.querySelector(".content-image").style.display="none"}})]).render()}_buildImage(){const e=new Image;e.onerror=e=>{console.error("[GIFView._buildImage]",e)},this.parser.getBase64((t,i)=>{e.src=i});const t=Le.UI.build('<div class="content-image"></div>');return t.style.display="none",t.append(e),t}_buildSlideshow(e){const t=this._gifReader.numFrames(),i=Le.UI.build(`\n\t\t\t<div class="content-frames">\n\t\t\t\t<div class="frame-container"></div>\n\t\t\t\t<div class="actions">\n\t\t\t\t\t<input type="range" min="1" max="${t}" value="1" />\n\t\t\t\t\t<div class="line"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`),n=new Ve.$({classes:"frame-prev",icon:qe.F.arrow_prev}),s=new Ve.$({classes:"frame-next",icon:qe.F.arrow_next});i.querySelector(".line").append(n.render(),Le.UI.build('<span class="counter"></span>'),s.render()),this._frameIndex=0,this._generateFrames(()=>{const t=i.querySelector('input[type="range"]');t.addEventListener("input",e=>{this._frameIndex=e.target.valueAsNumber-1,this.showFrame(this._frameIndex)}),n.on("click",e=>{this.showFrame(--this._frameIndex),t.value=this._frameIndex+1}),s.on("click",e=>{this.showFrame(++this._frameIndex),t.value=this._frameIndex+1}),this._listenerKeyNav=e=>{const i=document.activeElement;i&&"range"===i.type||("ArrowLeft"===e.key?(this.showFrame(--this._frameIndex),t.value=this._frameIndex+1):"ArrowRight"===e.key&&(this.showFrame(++this._frameIndex),t.value=this._frameIndex+1))},document.body.addEventListener("keyup",this._listenerKeyNav),this._counter=i.querySelector(".counter"),e(i)})}_generateFrame(e,t){const i=this._gifReader.width,n=this._gifReader.height,s=document.createElement("canvas");s.width=i,s.height=n,s.style.width=i+"px",s.style.height=n+"px";const a=s.getContext("2d");if(0===e){const r=new ImageData(i,n);return this._lastNonDisposedImgData=r,this._gifReader.decodeAndBlitFrameRGBA(e,r.data),a.putImageData(r,0,0),void t(s)}const r=this._gifReader.frameInfo(e-1);let o=null;if(r.disposal<=1||3===r.disposal){const e=Uint8ClampedArray.from(this._lastNonDisposedImgData.data);o=new ImageData(e,i,n)}else o=new ImageData(i,n);this._gifReader.decodeAndBlitFrameRGBA(e,o.data);this._gifReader.frameInfo(e).disposal<=1&&(this._lastNonDisposedImgData=o),a.putImageData(o,0,0),t(s)}_generateFrames(e){const t=this._gifReader.numFrames(),i=n=>{n>=t?e():this._generateFrame(n,e=>{this._frames.push(e),i(n+1)})};i(0)}destroy(){super.destroy(),document.body.removeEventListener("keyup",this._listenerKeyNav)}load(e){this.parser.parse((t,i)=>{this._gifReader=i,this.mdAdd("Dimensions",i.width+"×"+i.height+" px"),this.mdAdd("Frames",i.numFrames()),this.buildMetaNode(),this._buildSlideshow(t=>{this.nodeView.append(this._buildActions(),this._buildImage(),t),this.showFrame(this._frameIndex),this._openWindow(),e?.()})})}showFrame(e){const t=this._gifReader.numFrames();e>=t?e=0:e<0&&(e=t-1),this._currentCanvas&&this._currentCanvas.remove(),this._frameIndex=e,this._currentCanvas=this._frames[e];this.nodeView.querySelector(".frame-container").append(this._currentCanvas),this._counter.textContent=e+1+"/"+t}}class at extends Ue{canHandleImport(e){return"image/gif"===e.mimeType?Re:De}getParser(){return this._parser??=new nt(this._importData),this._parser}getView(){return this._view??=new st(this.getParser()),this._view}}class rt extends Ee{constructor(e,t){super(e,t)}_buildHTMLComponent(e){const t=document.createElement("div");t.className="container";const i=document.createElement("table"),n=e.summary||"(no summary)",s=document.createElement("h2");s.className="summary",s.textContent=n,e.color&&(s.style.backgroundColor=e.color);const a=this._getParameterValue(e,"status");if(a){const e=document.createElement("span");e.className="state",e.textContent=a,s.append(e)}const r=this._getParameterValue(e,"class");if(r){const e=document.createElement("span");e.className="state",e.textContent=r,s.append(e)}if(t.append(s),e.description){const i=document.createElement("div");i.className="description",i.innerHTML=e.description.replaceAll(/\n/g,"<br>"),t.append(i)}if(e.startDate){const t=this._buildHTMLTableRowTime("Start",e.startDate);if(i.append(t),e.endDate){const t=this._buildHTMLTableRowTime("End",e.endDate);i.append(t)}if(e.duration){const t=1e3*e.duration.toSeconds(),n=Le.UI.buildTableRow("Duration",Le.UI.formatDuration(t));i.append(n)}}const o=e.component.jCal[1].filter(e=>"freebusy"===e[0]);o.length>0&&o.forEach(e=>{const t=e[3],n=this.ICAL.Time.fromDateTimeString(t[0]),s=this._buildTimeSelect(n);let a=null,r="";if(t[1].length>=16){const e=this.ICAL.Time.fromDateTimeString(t[1]);a=this._buildTimeSelect(e),r=" – "}else a=t[1],r=" / ";const o=Le.UI.buildTableRow("Period",""),c=o.querySelector("td");c.innerHTML="",c.append(s,r,a),i.append(o)});const c=this._getParameterValue(e,"due");if(c){const e=this.ICAL.Time.fromDateTimeString(c),t=this._buildHTMLTableRowTime("Due",e);i.append(t)}if(e.location){const t=Le.UI.buildTableRow("Location",e.location);t.className="location",i.append(t)}if(e.organizer){const t=e.component.jCal[1].find(e=>"organizer"===e[0]);let n=t?.[1]?.cn||e.organizer.replace(/^mailto:/,"");const s=Le.UI.buildTableRow("Organizer",n);if(s.className="organizer",e.organizer.startsWith("mailto:")){const t=document.createElement("a");t.href=e.organizer,t.textContent=n;const i=s.querySelector("td");i.innerHTML="",i.append(t)}i.append(s)}if(Array.isArray(e.attendees)&&e.attendees.length>0){const t=Le.UI.buildTableRow("Attendees","");t.className="attendees";const n=document.createElement("ul");e.attendees.forEach(e=>{const t=document.createElement("a");t.href=e.getFirstValue(),t.textContent=e.getParameter("cn")||t.href.replace(/^mailto:/,"");const i=document.createElement("li");if(i.append(t),e.getParameter("partstat")){const t=document.createElement("span");t.className="state",t.textContent=e.getParameter("partstat"),i.append(t)}n.append(i)});t.querySelector("td").append(n),i.append(t)}const l=this._getParameterValue(e,"comment");if(l){const e=Le.UI.buildTableRow("Comment",l);i.append(e)}const d=this._getParameterValue(e,"url");if(d){const e=Le.UI.buildTableRow("URL",d),t=document.createElement("a");t.href=d,t.textContent=d;const n=e.querySelector("td");n.innerHTML="",n.append(t),i.append(e)}t.append(i);const h=this._buildHTMLVAlarms(e);return h&&t.append(h),t}_buildHTMLTableRowTime(e,t){const i=this._buildTimeSelect(t),n=Le.UI.buildTableRow(e,"");return n.className=e.toLowerCase(),n.querySelector("td").append(i),n}_buildHTMLVAlarm(e){if(!Array.isArray(e))return null;const t=document.createElement("div");t.className="valarm";const i=e.find(e=>"description"===e[0]);if(i&&i[3]){const e=document.createElement("div");e.className="alarm-description",e.textContent=i[3],t.append(e)}const n=document.createElement("table"),s=e.find(e=>"trigger"===e[0]);if(s&&s[3]){const e=Le.UI.buildTableRow("Trigger",s[3]);n.append(e)}const a=e.find(e=>"duration"===e[0]);if(a&&a[3]){const e=Le.UI.buildTableRow("Duration",a[3]);n.append(e)}const r=e.find(e=>"repeat"===e[0]);if(r&&r[3]){const e=Le.UI.buildTableRow("Repeat",r[3]);n.append(e)}const o=e.find(e=>"action"===e[0]);if(o&&o[3]){const e=Le.UI.buildTableRow("Action",o[3]);n.append(e)}const c=e.find(e=>"attach"===e[0]);if(c&&c[3]){const e=Le.UI.buildTableRow("Attach",c[3]);n.append(e)}return t.append(n),t}_buildHTMLVAlarms(e){const t=e.component.jCal[2];if(!Array.isArray(t))return null;const i=t.filter(e=>"valarm"===e[0]);if(0===i.length)return null;const n=document.createElement("div");return n.className="valarms",i.forEach(e=>{const t=this._buildHTMLVAlarm(e[1]);t&&n.append(t)}),n}_buildTimeSelect(e){const t={ICAL:e.toString(),UTC:Le.UI.formatDateTime(e.toJSDate()),Unix:e.toUnixTime()};e.zone?.tzid&&(t.ICAL+=` (${e.zone.tzid})`);const i=document.createElement("select");for(const e in t){let n=String(t[e]);n=n.replace("T"," "),n=n.replace(/(:[0-9]{2})Z/,"$1"),n=n.replace(/( [0-9]{2}:[0-9]{2}):00/,"$1"),"ICAL"!==e&&(n+=` [${e}]`);const s=document.createElement("option");s.value=e,s.textContent=n,i.append(s)}return i}_getParameterValue(e,t){const i=e.component.jCal;if(!Array.isArray(i)||!Array.isArray(i[1]))return null;const n=i[1].find(e=>e[0]===t);return Array.isArray(n)?n[3]:null}build(e){const t=document.createElement("div");t.className="ical";const i=new this.ICAL.Component(e),n=i.getAllSubcomponents("vevent"),s=i.getAllSubcomponents("vtodo"),a=i.getAllSubcomponents("vjournal"),r=i.getAllSubcomponents("vfreebusy");return n.concat(s).concat(a).concat(r).forEach(e=>{const i=new this.ICAL.Event(e),n=this._buildHTMLComponent(i);n.className+=" "+e.jCal[0],t.append(n)}),t}getHTML(e){this.getText((t,i)=>{this.parse(i,t=>{const i=this.build(t);e(null,i)})})}parse(e,t){i.e(2859).then(i.bind(i,68202)).then(i=>{this.ICAL=i.default;const n=this.ICAL.parse(e);t(n)})}}class ot extends Ae{constructor(e){super(e,"ical")}load(e){this.parser.getHTML((t,i)=>{this.buildMetaNode(),this.nodeView.append(i),this._openWindow(),e?.()})}}class ct extends Ue{canHandleImport(e){return"text/calendar"===e.mimeType||["ical","ics","ifb","vcs"].includes(e.ext)?Re:De}getParser(){return this._parser??=new rt(this._importData),this._parser}getView(){return this._view??=new ot(this.getParser()),this._view}}class lt extends Ae{constructor(e){super(e,"image"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){let t=!1;const i=new Image;i.onload=()=>{t||(t=!0,i.height=i.naturalHeight,i.width=i.naturalWidth,this.mdAdd("Dimensions",i.naturalWidth+"×"+i.naturalHeight+" px"),this.buildMetaNode(),this.nodeView.append(i),this._openWindow(),e?.())},i.onerror=()=>{const t=document.createElement("p");t.className="note",t.textContent=`Image format not supported: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),this._openWindow(),e?.()},this._objectURL=URL.createObjectURL(this.parser.file),i.src=this._objectURL}}class dt extends Ue{canHandleImport(e){return e.mimeType?.startsWith("image/")?Pe:De}getView(){return this._view??=new lt(this.getParser()),this._view}}class ht extends Be.u{constructor(e){super(),this._config=e||{}}destroy(){this._node?.remove()}hide(){this._node.style.display="none"}moveTo(e,t){const i=this._node.getBoundingClientRect();this._node.style.left=Math.round(e-i.width/2)+"px",this._node.style.top=t-i.height+"px"}render(){return super.render(),this._node=Le.UI.build('<div class="info-overlay"></div>'),"string"==typeof this._config?.classes&&this._node.classList.add(...this._config.classes.split(" ")),this._node}show(){this._node.style.display="block"}set value(e){this._node.textContent=e}}class mt extends Be.u{_currentValue=0;_innerBar=null;_overlay=null;_valueDisplay=null;constructor(e){super(),this._config=e,"number"!=typeof this._config.min&&(this._config.min=0),"number"!=typeof this._config.max&&(this._config.max=100),"boolean"!=typeof this._config.showValue&&(this._config.showValue=!0),"boolean"!=typeof this._config.canInteract&&(this._config.canInteract=!0),this._currentValue=this._config.initialValue??this._config.min}_absToRel(e){return(e-this._config.min)/(this._config.max-this._config.min)}_hideOverlayValue(){this._overlay?.hide(),this._barMarker.style.display="none"}_relToAbs(e){return this._config.min+e*(this._config.max-this._config.min)}_showOverlayValue(e){this._overlay||(this._overlay=new ht,document.body.append(this._overlay.render()));const t=this._node.getBoundingClientRect(),i=e.offsetX/t.width,n=this._relToAbs(i);this._overlay.value=this._config.formatValue?.(n)??n,this._overlay.moveTo(e.clientX,t.top-4),this._overlay.show(),this._barMarker.style.display="block",this._barMarker.style.left=e.offsetX+"px"}destroy(){this._overlay?.destroy(),this._overlay=null,this._node?.remove()}render(){return super.render(),this._node=Le.UI.build('<div class="linear-slider"></div>'),this._innerBar=Le.UI.build('<div class="inner-bar"></div>'),this._barMarker=Le.UI.build('<div class="bar-marker"></div>'),this._node.append(this._innerBar,this._barMarker),this._config.showValue&&(this._valueDisplay=Le.UI.build('<div class="value-display"></div>'),this._node.append(this._valueDisplay)),"string"==typeof this._config.classes&&this._node.classList.add(...this._config.classes.split(" ")),this._config.canInteract&&(this._node.addEventListener("click",e=>{const t=this._node.getBoundingClientRect(),i=e.offsetX/t.width;this._config.onChange?.(i,this._relToAbs(i))}),this._node.classList.add("interactive")),this._node.addEventListener("mouseover",e=>this._showOverlayValue(e)),this._node.addEventListener("mousemove",e=>this._showOverlayValue(e)),this._node.addEventListener("mouseleave",e=>this._hideOverlayValue()),this.value=this._currentValue,this._node}get value(){return this._currentValue}set value(e){let t=Math.min(this._config.max,Math.max(this._config.min,e));isNaN(t)||(this._currentValue=t,this._innerBar.style.width=Math.round(100*this.valueProgress)+"%")}get valueProgress(){return this._absToRel(this._currentValue)}set valueProgress(e){e=Math.min(1,Math.max(0,e)),e=this._config.min+e*(this._config.max-this._config.min),this.value=e}}const pt="playing",ut="paused";class ft extends Be.u{_seekbar=null;_state=ut;_volume=0;_volumeControl=null;constructor(e){super(),this._config=e||{},void 0===this._config.hasSeekbar&&(this._config.hasSeekbar=!0),void 0===this._config.hasVolume&&(this._config.hasVolume=!0)}_buildPlayPauseButton(){return new Ve.$({classes:"play-pause",icon:qe.F.play,onClick:()=>{this._state===pt?this._config.onPause():this._config.onPlay()}})}_buildSeekbar(){return new mt({classes:"seekbar",max:this._config.duration,showValue:!1,formatValue:e=>Le.UI.formatDuration(1e3*e,{formatWithColon:!0}),onChange:(e,t)=>{this._seekbar.value=t,this._config.onSeek?.(e,t)}})}_buildVolume(){return new mt({classes:"volume",showValue:!1,formatValue:e=>Math.round(e)+"%",onChange:(e,t)=>{this._volumeControl.value=t,this._config.onVolume?.(e)}})}destroy(){this._seekbar?.destroy(),this._seekbar=null,this._volumeControl?.destroy(),this._volumeControl=null,this._node?.remove()}render(){super.render(),this._btnPlayPause=this._buildPlayPauseButton(),this._time=Le.UI.build('<span class="time">00:00</span>');const e=Le.UI.build('<div class="bottom-row"></div>');return e.append(this._btnPlayPause.render(),this._time),this._node=Le.UI.build('<div class="player-controls"></div>'),this._config.hasSeekbar&&(this._seekbar=this._buildSeekbar(),this._node.append(this._seekbar.render())),this._config.hasVolume&&(this._volumeControl=this._buildVolume(),e.append(Le.UI.build('<span class="icon volume">volume_up</span>'),this._volumeControl.render()),"number"==typeof this._config.volume&&(this.volume=this._config.volume)),this._node.append(e),this._node}get progress(){return this._seekbar?.valueProgress??0}set progress(e){this._seekbar&&(this._seekbar.valueProgress=e),this.time=e*this._config.duration}get progressInSeconds(){return this._seekbar?.value??0}set progressInSeconds(e){this._seekbar&&(this._seekbar.value=e),this.time=e}get state(){return this._state}set state(e){if(this._state===e)return;this._state=e;const t=e===pt?qe.F.pause:qe.F.play;this._btnPlayPause?.update({icon:t})}set time(e){this._time.textContent=Le.UI.formatDuration(1e3*e,{formatWithColon:!0})}get volume(){return this._volume}set volume(e){this._config.hasVolume&&(e=Number(e),isNaN(e)||(this._volume=Math.min(1,Math.max(0,e)),this._volumeControl&&(this._volumeControl.value=100*this._volume)))}}class gt extends Ae{_scheduleId=null;Tone=null;synths=[];constructor(e){super(e,"midi")}_addMetaData(e){e.name&&this.mdAdd("Name",e.name),this.mdAdd("Tracks",e.tracks.length),this.mdAdd("Duration",Le.UI.formatDuration(1e3*e.duration))}_buildPlayer(e){const t=this.Tone.getTransport();t.loop=!1;const i=this.Tone.getDestination();i.volume.value=this.Tone.gainToDb(.3),this._player=new ft({duration:e.duration,volume:this.Tone.dbToGain(i.volume.value),onPause:()=>this.pause(),onPlay:()=>this.play(),onSeek:(e,i)=>t.seconds=i,onVolume:e=>i.volume.value=this.Tone.gainToDb(e)}),t.on("start",()=>this._player.state=pt),t.on("pause",()=>this._player.state=ut),t.on("stop",()=>this._player.state=ut),this._scheduleId=t.scheduleRepeat(i=>{this._player.progressInSeconds=Math.min(e.duration,t.seconds),t.seconds>e.duration&&this.stop()},.5,0,e.duration+1);const n=Le.UI.build('<div class="midi-player"></div>');n.append(this._player.render()),this.nodeView.append(n)}destroy(){const e=this.Tone.getTransport();for(e.stop(),e.clear(this._scheduleId);this.synths.length>0;){const e=this.synths.shift();e.releaseAll(),e.dispose()}e.off("start"),e.off("pause"),e.off("stop"),e.position=0,e.cancel(),this.Tone.setContext(new this.Tone.Context,!0),this._player?.destroy(),super.destroy()}load(e){this.parser.parse((t,i,n,s)=>{this.Tone=i,this.synths=s,this._addMetaData(n),this.buildMetaNode(),this._buildPlayer(n),this._openWindow(),e?.()})}pause(){this.Tone.getTransport().pause()}play(){0!==this.synths.length&&this.Tone.getTransport().start()}stop(){this.Tone.getTransport().stop()}}class yt extends Ee{constructor(e){super(e)}async parse(e){const{Midi:t}=await i.e(8518).then(i.t.bind(i,3748,23)),n=await i.e(3218).then(i.bind(i,79606));this.getArrayBuffer((i,s)=>{this.midiData=new t(s),console.debug(this.midiData);const a=[],r=n.now()+.5;this.midiData.tracks.forEach(t=>{const i=new n.PolySynth(n.Synth,{envelope:{attack:.02,decay:.1,sustain:.3,release:1}}).toDestination();i.sync(),a.push(i),t.notes.forEach(e=>{i.triggerAttackRelease(e.name,e.duration,e.time+r,e.velocity)}),e(null,n,this.midiData,a)})})}}class wt extends Ue{canHandleImport(e){return"audio/midi"===e.mimeType?Re:De}getParser(){return this._parser??=new yt(this._importData),this._parser}getView(){return this._view??=new gt(this.getParser()),this._view}setImportData(e){this._parser?.destroy(),this._view?.window?.close(),this._view?.destroy(),this._parser=null,this._view=null,this._importData=e}}class vt extends Ee{constructor(e){super(e),this.ext="."+e.ext}}class xt extends Ae{constructor(e){super(e,"model3d"),this._objectURL=null,this._viewer=null}destroy(){super.destroy(),this._viewer?.source&&URL.revokeObjectURL(this._viewer.source),this._viewer?.remove()}async load(e){const t=await i.e(6808).then(i.bind(i,4710));this._viewer=new t.HTML3DElement,this._viewer.extension=this.parser.ext,this._viewer.addEventListener("environmenterror",e=>console.error("environmenterror",e)),this._viewer.addEventListener("modelerror",e=>console.error("modelerror",e)),this._viewer.addEventListener("viewerready",e=>{console.debug("viewerready",e);const t=this._viewer.viewerDetails.scene;t.cameras[0].onViewMatrixChangedObservable.add((e,i)=>{const n=e.position,s=t.lights[0]?.direction;s?.set(n.x,n.y,n.z)})}),this.buildMetaNode(),this.nodeView.append(this._viewer),this._openWindow({height:600,width:760}),setTimeout(()=>{this._viewer.source=URL.createObjectURL(this.parser.file)},100),e?.()}}class _t extends Ue{canHandleImport(e){return["glb","obj","ply","splat","stl"].includes(e.ext)?Re:De}getParser(){return this._parser??=new vt(this._importData),this._parser}getView(){return this._view??=new xt(this.getParser()),this._view}}class bt extends Ae{constructor(e){super(e,"nifti"),this._imageIds=null,this._volume=null,this._viewports={axial:null,sagittal:null,coronal:null},this._frameDelay=250,this._frameIndex=0,this._frameTime=33.333,this._listenerKeyNav=null,this._timer=0}_buildControls(){const e=Le.UI.build(`\n\t\t\t<div class="viewports">\n\t\t\t\t<div class="image-container image-container-axial"></div>\n\t\t\t\t<div class="image-container image-container-sagittal"></div>\n\t\t\t\t<div class="image-container image-container-coronal"></div>\n\t\t\t</div>\n\t\t\t<div class="actions">\n\t\t\t\t<input type="range" min="1" max="${this._numFrames}" value="1" />\n\t\t\t\t<div class="line">\n\t\t\t\t\t<div class="wrap wrap-frame-controls"></div>\n\t\t\t\t\t<div class="wrap wrap-playback">\n\t\t\t\t\t\t<select class="speed">\n\t\t\t\t\t\t\t<option value="${this._frameTime}">Default: ${this._frameTime} ms</option>\n\t\t\t\t\t\t\t<option value="16.7">16.7 ms</option>\n\t\t\t\t\t\t\t<option value="33.3">33.3 ms</option>\n\t\t\t\t\t\t\t<option value="66.7">66.7 ms</option>\n\t\t\t\t\t\t\t<option value="133.3">133.3 ms</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`),t=new Ve.$({classes:"frame-prev",icon:qe.F.arrow_prev}),i=new Ve.$({classes:"frame-next",icon:qe.F.arrow_next}),n=new Ve.$({classes:"play-pause",icon:qe.F.play});if(e.querySelector(".wrap-frame-controls").append(t.render(),Le.UI.build('<span class="counter"></span>'),i.render()),e.querySelector(".wrap-playback").append(n.render()),this._frameIndex=0,this._numFrames<=2)e.querySelector(".actions").remove();else{this._slider=e.querySelector('input[type="range"]'),this._slider.addEventListener("change",e=>{let t=e.target.valueAsNumber-1-this._frameIndex;this._controlGoto(t)}),t.on("click",e=>{this._controlGoto(-1)}),i.on("click",e=>{this._controlGoto(1)});const s=e.querySelector("select.speed");s.addEventListener("change",e=>{this._frameTime=Number(s.value)}),n.on("click",e=>{this._timer?(n.update({icon:qe.F.play}),clearTimeout(this._timer),this._timer=0):(n.update({icon:qe.F.pause}),this._playback(this._slider))}),this._listenerKeyNav=e=>{const t=document.activeElement;t&&"range"===t.type||("ArrowLeft"===e.key?this._controlGoto(-1):"ArrowRight"===e.key&&this._controlGoto(1))},document.body.addEventListener("keyup",this._listenerKeyNav),this._counter=e.querySelector(".counter")}this.nodeView.append(e)}_controlGoto(e){this._frameIndex=this.showImage(e),this._updateControls()}async _initViewport(e){const{Enums:t,RenderingEngine:n,setVolumesForViewports:s,volumeLoader:a}=await Promise.all([i.e(3387),i.e(7784),i.e(8483)]).then(i.bind(i,97784)),r=this.nodeView.querySelector(".image-container-axial"),o=this.nodeView.querySelector(".image-container-sagittal"),c=this.nodeView.querySelector(".image-container-coronal"),l=[{viewportId:"nifti_ortho_axial",type:t.ViewportType.ORTHOGRAPHIC,element:r,defaultOptions:{orientation:t.OrientationAxis.AXIAL}},{viewportId:"nifti_ortho_sagittal",type:t.ViewportType.ORTHOGRAPHIC,element:o,defaultOptions:{orientation:t.OrientationAxis.SAGITTAL}},{viewportId:"nifti_ortho_coronal",type:t.ViewportType.ORTHOGRAPHIC,element:c,defaultOptions:{orientation:t.OrientationAxis.CORONAL}}];this._renderingEngine=new n,this._renderingEngine.setViewports(l);let d="cornerstoneStreamingImageVolume:"+this.parser._objectURL;this._volume=await a.createAndCacheVolumeFromImages(d,this._imageIds),this._volume.load(async()=>{await s(this._renderingEngine,[{volumeId:d}],l.map(e=>e.viewportId)),this._viewports={axial:this._renderingEngine.getViewport("nifti_ortho_axial"),sagittal:this._renderingEngine.getViewport("nifti_ortho_sagittal"),coronal:this._renderingEngine.getViewport("nifti_ortho_coronal")},this._renderingEngine.render(),e()})}_playback(e){if(this._timer)return;const t=0===this._frameIndex?this._frameDelay:0;this._timer=setTimeout(()=>{this._controlGoto(1),e.value=this._frameIndex+1,this._timer=0,this._playback(e)},this._frameTime+t)}_updateControls(){this._counter&&(this._counter.textContent=this._frameIndex+1+"/"+this._numFrames),this._slider&&(this._slider.value=this._frameIndex+1)}destroy(){super.destroy(),this._renderingEngine?.destroy(),this._volume?.destroy(),this._renderingEngine=null,this._volume=null,this._viewports=null,clearTimeout(this._timer),document.body.removeEventListener("keyup",this._listenerKeyNav)}load(e){this.parser.parse(async(t,i)=>{t||(this._imageIds=i,this._numFrames=i.length,this.buildMetaNode(),this._buildControls(),this._openWindow({destroyOrder:[this,this.parser]}),e?.(),this._initViewport(()=>{this._frameIndex=this._viewports.axial.getCurrentImageIdIndex(),this.mdAdd("Photometric Interpretation",this._volume.metadata.PhotometricInterpretation||""),this.buildMetaNode(),this._updateControls()}))})}showImage(e){let t=this._frameIndex+e;t>=this._numFrames?(t-=this._numFrames,e-=this._numFrames):t<0&&(t+=this._numFrames,e+=this._numFrames);for(const t in this._viewports){const i=this._viewports[t];i.scroll(e),i.render()}return t}}class kt extends Ue{canHandleImport(e){return"application/x-nifti"===e.mimeType?Re:De}getParser(){return this._parser??=new Ze(this._importData),this._parser}getView(){return this._view??=new bt(this.getParser()),this._view}}class Ct extends Ae{constructor(e){super(e,"pdf"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){this._objectURL=URL.createObjectURL(this.parser.file);const t=document.createElement("iframe");t.src=this._objectURL,this.buildMetaNode(),this.nodeView.appendChild(t),this._openWindow(),e?.()}}class St extends Ue{canHandleImport(e){return"application/pdf"===e.mimeType?Re:De}getView(){return this._view??=new Ct(this.getParser()),this._view}}class Tt extends Ae{static _imports={};constructor(e){super(e,"text"),this._originalText="",this._formatted=null}_buildButtonsJson(e){return new He([new Ve.$({text:"Original",classes:"selected",onClick:()=>{delete e.dataset.highlighted,e.innerHTML="",e.textContent=this._originalText,Tt.hljs.highlightElement(e),Tt.hljs.lineNumbersBlock(e)}}),new Ve.$({text:"Formatted",onClick:()=>{let t=this._originalText;if(this._formatted)t=this._formatted;else try{t=JSON.parse(this._originalText),t=JSON.stringify(t,null,2),this._formatted=t}catch(e){console.error("[TextView._buildButtonsJson]",e.message),window.alert(e.message)}delete e.dataset.highlighted,e.innerHTML="",e.textContent=t,Tt.hljs.highlightElement(e),Tt.hljs.lineNumbersBlock(e)}})])}static async initHljs(e){if(Tt.hljs||(Tt.hljs=window.hljs=(await i.e(3136).then(i.bind(i,50011))).default,await i.e(3463).then(i.t.bind(i,85079,23)),Tt.hljs.initLineNumbersOnLoad({singleLine:!0})),e&&!Tt._imports[e]){let t=null;switch(e){case"apache":t=await i.e(7652).then(i.bind(i,50302));break;case"bash":t=await i.e(8140).then(i.bind(i,69510));break;case"c":t=await i.e(1957).then(i.bind(i,52711));break;case"cmake":t=await i.e(2383).then(i.bind(i,67237));break;case"cpp":t=await i.e(7437).then(i.bind(i,34887));break;case"csharp":t=await i.e(3879).then(i.bind(i,77435));break;case"css":t=await i.e(9223).then(i.bind(i,92753));break;case"d":t=await i.e(5754).then(i.bind(i,33030));break;case"dart":t=await i.e(1089).then(i.bind(i,8605));break;case"diff":t=await i.e(9255).then(i.bind(i,76551));break;case"dns":case"zone":t=await i.e(3659).then(i.bind(i,73561));break;case"glsl":t=await i.e(5614).then(i.bind(i,19476));break;case"ini":t=await i.e(5720).then(i.bind(i,56e3));break;case"java":t=await i.e(9762).then(i.bind(i,83736));break;case"javascript":t=await i.e(6527).then(i.bind(i,15603));break;case"json":t=await i.e(792).then(i.bind(i,27402));break;case"latex":t=await i.e(8794).then(i.bind(i,4598));break;case"less":t=await i.e(9077).then(i.bind(i,74145));break;case"lua":t=await i.e(9656).then(i.bind(i,22328));break;case"makefile":t=await i.e(1974).then(i.bind(i,83308));break;case"markdown":t=await i.e(1617).then(i.bind(i,33265));break;case"php":t=await i.e(1910).then(i.bind(i,95130));break;case"powershell":t=await i.e(8265).then(i.bind(i,71569));break;case"properties":t=await i.e(4209).then(i.bind(i,82829));break;case"python":t=await i.e(2232).then(i.bind(i,85262));break;case"ruby":t=await i.e(1418).then(i.bind(i,99928));break;case"rust":t=await i.e(4228).then(i.bind(i,67206));break;case"scss":t=await i.e(9486).then(i.bind(i,12068));break;case"sql":t=await i.e(3038).then(i.bind(i,57470));break;case"typescript":t=await i.e(8311).then(i.bind(i,95387));break;case"xml":t=await i.e(5529).then(i.bind(i,69359));break;case"yaml":t=await i.e(9095).then(i.bind(i,36347));break;default:console.warn("[TextView.initHljs] Language not found: "+e)}t&&(Tt._imports[e]=!0,Tt.hljs.registerLanguage(e,t.default))}return Tt.hljs}load(e){const t=Ie.detectLanguage(this.parser.file,this.parser.mimeType),i=document.createElement("div");if(i.className="code","json"===t){const e=this._buildButtonsJson(i);this.nodeView.appendChild(e.render())}this.nodeView.appendChild(i),this.parser.getText(async(n,s)=>{this._originalText=s,i.textContent=s;const a=await Tt.initHljs(t);t&&(i.className+=" language-"+t,a.highlightElement(i),this.mdAdd("Language",t)),a.lineNumbersBlock(i),this.mdAdd("Lines",(s.match(/\n/g)||[]).length),this.buildMetaNode(),this._openWindow({width:1e3}),e?.()})}}class It extends Ue{canHandleImport(e){return Ie.isTypeText(e.mimeType,e.ext,e.file.name.toLowerCase())?Pe:De}getView(){return this._view??=new Tt(this.getParser()),this._view}}class Et extends Ee{constructor(e,t){super(e,t)}async parse(){const e=(await Promise.all([i.e(2146),i.e(7149)]).then(i.bind(i,92146))).default;let t=null;try{t=await this.getArrayBuffer()}catch(e){throw console.error("[TorrentParser.parse]",e),e}return e(new Uint8Array(t))}}class Mt extends Ae{constructor(e){super(e,"torrent")}_build(e){const t=["info","infoBuffer","infoHashBuffer","lastPieceLength","pieceLength"],i=document.createElement("ul");i.classList.add("torrent-info");for(const n in e){if(t.includes(n))continue;let s=e[n],a={};if("length"===n){s=`${s} B <span class="icon">arrow_right_alt</span> ${Le.UI.formatSize(s)}`,a.asHTML=!0}else"infoHash"===n&&(s="SHA1: "+s);if(Array.isArray(s)){if(0===s.length)continue;if("files"===n)s=this._buildFileTable(s);else if("pieces"===n){const e=document.createElement("textarea");e.setAttribute("readonly","readonly"),e.value=s.join("\n"),s=e}else s=Le.UI.buildListOrdered(s)}else if("string"==typeof s&&0===s.length)continue;const r=this._buildItem(n,s,a);i.append(r)}return i}_buildFileTable(e){const t=Le.UI.build('\n\t\t\t<table class="files">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th class="file-name">Name</th>\n\t\t\t\t\t\t<th class="file-path">Path</th>\n\t\t\t\t\t\t<th class="file-size">Size</th>\n\t\t\t\t\t\t<th class="file-offset">Offset</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t</table>\n\t\t'),i=document.createElement("tbody");for(let t=0;t<e.length;t++){const n=e[t],s=document.createElement("td");s.classList.add("file-name"),s.textContent=n.name;const a=document.createElement("td");a.classList.add("file-path"),a.textContent=n.path;const r=document.createElement("td");r.classList.add("file-size"),r.textContent=Le.UI.formatSize(n.length),r.setAttribute("title",n.length+" B");const o=document.createElement("td");o.classList.add("file-offset"),o.textContent=Le.UI.formatSize(n.offset),o.setAttribute("title",n.offset+" B");const c=document.createElement("tr");c.append(s,a,r,o),i.append(c)}return t.append(i),t}_buildItem(e,t,i){const n=document.createElement("div");n.classList.add("name"),n.textContent=this._getTitle(e);const s=document.createElement("div");s.classList.add("value"),t instanceof HTMLElement?s.append(t):i.asHTML?s.innerHTML=t:s.textContent=t;const a=document.createElement("li");return a.classList.add("torrent-info-item",`key-${e}`),a.append(n,s),a}_getTitle(e){return{announce:"Announce / Tracker URLs",comment:"Comment",created:"Created",createdBy:"Created By",files:"Files",infoHash:"Info Hash",length:"Size",name:"Name",pieces:"Pieces"}[e]||e}async load(e){const t=await this.parser.parse();console.debug("[TorrentView.load]",t),this.buildMetaNode(),this.nodeView.append(this._build(t)),this._openWindow(),e?.()}}class Lt extends Ue{canHandleImport(e){return"torrent"===e.ext||"application/x-bittorrent"===e.mimeType?Re:De}getParser(){return this._parser??=new Et(this._importData),this._parser}getView(){return this._view??=new Mt(this.getParser()),this._view}}class At extends Ee{constructor(e,t){super(e,t)}_getTypes(e){if(!Array.isArray(e.type)||0===e.type.length)return null;let t=e.type.find(e=>e.startsWith("TYPE#"));return t?(t=t.substring(5),t.split(",")):e.type}build(e,t){const i=document.createElement("div");i.className="vcard";const n=document.createElement("h3");if(n.className="name",n.textContent=e.fn,i.append(n),e.title){const t=document.createElement("h4");t.className="title",t.textContent=e.title.join(", "),i.append(t)}const s=document.createElement("table");if(e.n["honorific-prefix"]){const t=e.n["honorific-prefix"].join(" "),i=Le.UI.buildTableRow("Name prefix",t);s.append(i)}if(e.n["given-name"]){const t=e.n["given-name"].join(" "),i=Le.UI.buildTableRow("Given name",t);s.append(i)}if(e.n["family-name"]){const t=e.n["family-name"].join(" "),i=Le.UI.buildTableRow("Family name",t);s.append(i)}if(e.photo){const i=Le.UI.buildTableRow("Photo",e.photo),n=t.match(/\nPHOTO.+[\r]?\n/);let a=null;if(n){let e=n[0];if(e.startsWith("PHOTO:data:")&&e.includes("base64"))a=e.substring(11,e.indexOf(";base64"));else if(e.includes("ENCODING=b")){const t=e.match(/;TYPE=([a-z0-9\/]+)[;:]/i);t&&t.length>=2&&(a=t[0])}else if(e.includes("ENCODING=BASE64")){const t=e.match(/;([a-z0-9\/]+)[;:]/i);t&&t.length>=2&&(a=t[0])}a&&(a=a.toLowerCase(),a.startsWith("image/")||(a="image/"+a))}if(a){i.querySelector("td").innerHTML=`<img src="data:${a};base64,${e.photo}" />`}else if(e.photo.includes("://")){i.querySelector("td").innerHTML=`<a href="${e.photo}">${e.photo}</a>`}s.append(i)}if(e.adr){const t=e=>{let t="Adr.";const i=this._getTypes(e);i&&(t+=` (${i.join(", ")})`);let n=e.value.split(";").filter(e=>e.length>0).map(e=>e+"<br>").join("");const a=Le.UI.buildTableRow(t,n,{valueAsHTML:!0});s.append(a)};Array.isArray(e.adr)?e.adr.forEach(e=>t(e)):t(e.adr)}return e.org&&e.org.forEach(e=>{let t=e["organization-name"];e["organization-unit"]&&(t+=", "+e["organization-unit"]);const i=Le.UI.buildTableRow("Organization",t);s.append(i)}),e.email&&e.email.forEach(e=>{let t="Email";const i=this._getTypes(e);i&&(t+=` (${i.join(", ")})`);const n=Le.UI.buildTableRow(t,e.value);if(e.value.includes("@")){n.querySelector("td").innerHTML=`<a href="mailto:${e.value}">${e.value}</a>`}s.append(n)}),e.tel&&e.tel.forEach(e=>{let t="Tel.";const i=this._getTypes(e);i&&(t+=` (${i.join(", ")})`);const n=Le.UI.buildTableRow(t,e.value);if(e.value.startsWith("tel:")){const t=e.value.substring(4),i=e.value.replaceAll(/-/g,"");n.querySelector("td").innerHTML=`<a href="${i}">${t}</a>`}s.append(n)}),i.append(s),i}getHTML(e){this.getText((t,i)=>{const n=(i.match(/BEGIN:VCARD[\r]?\n/g)||[]).length;let s=0;const a=document.createElement("div");a.className="container",this.parse(i,t=>{s++;const r=this.build(t,i);a.append(r),s===n&&e(null,a)})})}parse(e,t){i.e(5776).then(i.t.bind(i,27534,23)).then(i=>{i.VCF.parse(e,t)})}}class Dt extends Ae{constructor(e){super(e,"vcf")}load(e){this.parser.getHTML((t,i)=>{this.buildMetaNode(),this.nodeView.append(i),this._openWindow(),e?.()})}}class Ft extends Ue{canHandleImport(e){return"vcf"===e.ext||"text/vcard"===e.mimeType?Re:De}getParser(){return this._parser??=new At(this._importData),this._parser}getView(){return this._view??=new Dt(this.getParser()),this._view}}class Pt extends Ae{constructor(e){super(e,"video"),this._objectURL=null}destroy(){super.destroy(),this._objectURL&&URL.revokeObjectURL(this._objectURL)}load(e){this._objectURL=URL.createObjectURL(this.parser.file);const t=document.createElement("video");if(t.setAttribute("controls",""),t.setAttribute("preload","metadata"),t.volume=.25,t.canPlayType(this.parser.mimeType))t.addEventListener("loadedmetadata",()=>{t.videoHeight&&(t.height=t.videoHeight),t.width=t.videoWidth||900,this.mdAdd("Dimensions",t.width+"×"+t.height+" px"),this.mdAdd("Duration",Le.UI.formatDuration(1e3*t.duration)),this.buildMetaNode(),this.nodeView.append(t),this._openWindow(),e?.()}),t.src=this._objectURL;else{const t=document.createElement("p");t.className="note",t.textContent=`Playback for video format not supported: "${this.parser.mimeType}"`,this.buildMetaNode(),this.nodeView.append(t),e()}}}class Rt extends Ue{canHandleImport(e){return e.mimeType?.startsWith("video/")?Pe:De}getView(){return this._view??=new Pt(this.getParser()),this._view}}class Ut extends Ee{constructor(e,t){super(e,t)}build(e){const t=document.createElement("table");t.className="zip";const i=document.createElement("th");i.className="name",i.textContent="Name";const n=document.createElement("th");n.className="size",n.textContent="Size";const s=document.createElement("th");s.className="date",s.textContent="Date";const a=document.createElement("tr");a.className="head",a.append(i,n,s),t.append(a),this.uncompressedSize=0;for(const i in e.files){const n=e.files[i];let s=n.name,a=(n.name.match(/\//g)||[]).length;n.dir?(a--,s=s.split("/").slice(-2,-1)+"/"):s=s.split("/").pop();const r="··".repeat(a),o=document.createElement("span");o.className="indent",o.textContent=r;const c=document.createElement("span");c.className="text",c.textContent=s;const l=document.createElement("td");l.className="name",l.append(o,this.getIconElement(n),c);const d=document.createElement("td");d.className="size",d.textContent=n.dir?"":Le.UI.formatSize(n._data.uncompressedSize),n.dir||isNaN(Number(n._data.uncompressedSize))||(this.uncompressedSize+=n._data.uncompressedSize);const h=document.createElement("td");h.className="date",h.textContent=Le.UI.formatDate(n.date);const m=document.createElement("tr");m.className=n.dir?"zip-dir":"zip-file",m.append(l,d,h),t.append(m)}return t}getHTML(e){this.getArrayBuffer((t,i)=>{this.parse(i,(t,i)=>{if(t)return void e(t);const n=this.build(i);e(null,n)})})}getIconElement(e){const t=document.createElement("span");if(t.className="icon",e.dir)t.textContent="folder_open";else{t.textContent="description";const i=Ie.getFileExt(e);Ie.executableExtensions.includes(i)?t.textContent="terminal":null!==Ie.detectLanguage(e)?t.textContent="code":Ie.imageExtensions.includes(i)?t.textContent="image":Ie.videoExtensions.includes(i)?t.textContent="movie":Ie.audioExtensions.includes(i)&&(t.textContent="music_note"),t.classList.add(t.textContent)}return t}parse(e,t){i.e(211).then(i.t.bind(i,71710,23)).then(i=>{(new(0,i.default)).loadAsync(e).then(e=>t(null,e),e=>t(e,null))})}}class zt extends Ae{constructor(e){super(e,"zip")}load(e){this.parser.getHTML((t,i)=>{t&&((i=document.createElement("p")).className="note",i.textContent=t.message),this.metaData.push({name:"Uncompressed",value:Le.UI.formatSize(this.parser.uncompressedSize)}),this.buildMetaNode();const n=document.createElement("div");n.className="wrap",n.append(i),this.nodeView.append(n),this._openWindow(),e?.()})}}class Nt extends Ue{canHandleImport(e){return"application/zip"===e.mimeType||["apk","xapk","zip"].includes(e.ext)?Pe:De}getParser(){return this._parser??=new Ut(this._importData),this._parser}getView(){return this._view??=new zt(this.getParser()),this._view}}const Ot={_basePlugin:new Ue,_plugins:[],init(){this._plugins=[this._basePlugin,new Ne,new Ge,new Ke,new Qe,new it,new at,new ct,new dt,new wt,new _t,new kt,new St,new It,new Lt,new Ft,new Rt,new Nt]},_getImportDataForFile:async e=>({file:e,dir:null,fileList:null,ext:Ie.getFileExt(e),mimeType:await Ie.getMimeType(e)}),async _getPluginForDirectoryImport(e){const t=e.createReader();return new Promise((i,n)=>{t.readEntries(async t=>{let n=this._basePlugin,s=null;if(Qe.containsDICOMDIRFile(t))s=t;else if(await Qe.containsDICOMFiles(t))s=t.filter(async e=>await Qe.isDICOMFile(e)).sort((e,t)=>e.name.localeCompare(t.name,{numeric:!0}));else{const t=new Error(`No fitting parser for directory entries in ${e.name} found.`);console.error(t)}s&&(n=this._plugins.find(e=>e instanceof Qe)||n,n.setImportData({file:null,dir:e,fileList:s,ext:null,mimeType:"application/dicom"})),i(n)},e=>{console.error(e),i(this._basePlugin)})})},async getPluginForImport(e){if(e instanceof FileSystemDirectoryEntry)return await this._getPluginForDirectoryImport(e);const t=await this._getImportDataForFile(e),i=[];this._plugins.forEach(e=>{const n=e.canHandleImport(t);n>0&&i.push({priority:n,plugin:e})}),i.sort((e,t)=>t.priority-e.priority);const n=i[0]?.plugin||this._basePlugin;return n.setImportData(t),n}}},81094:(e,t,i)=>{"use strict";i.d(t,{$:()=>a});var n=i(42109),s=i(19108);class a extends s.u{constructor(e){super(),this._config=e,"function"==typeof this._config.onClick&&this.on("click",this._config.onClick)}_updateNode(){if(!this._node)return;const e="string"==typeof this._config.icon,t="string"==typeof this._config.text;if(n.UI.removeAllChildren(this._node),this._node.className="",this._node.classList.add("btn"),"string"==typeof this._config.classes&&this._node.classList.add(...this._config.classes.split(" ")),e&&(this._node.innerHTML=`<span class="icon">${this._config.icon}</span>`),t){const e=n.UI.escapeHTML(this._config.text);this._node.innerHTML+=`<span class="text">${e}</span>`}e&&t||!0===this._config.iconWithBorder?(this._node.classList.add("btn-icon-text"),this._config.iconWithBorder&&this._node.classList.add("btn-icon-border")):e?this._node.classList.add("btn-icon"):t&&this._node.classList.add("btn-text"),"string"==typeof this._config.title?this._node.setAttribute("title",this._config.title):this._node.removeAttribute("title")}disable(){this._node?this._node.disabled=!0:window.Logger.warn("[Button.disable] Button has not been rendered yet.")}enable(){this._node?this._node.disabled=!1:window.Logger.warn("[Button.enable] Button has not been rendered yet.")}render(){return super.render(),this._node=document.createElement("button"),this._updateNode(),this._node.addEventListener("click",e=>{this._node.disabled||this.fire("click",e)}),this._node}update(e){for(const t in e)this._config[t]=e[t];this._updateNode()}}},91625:(e,t,i)=>{"use strict";i.d(t,{F:()=>n});const n={arrow_next:"arrow_right_alt",arrow_prev:"arrow_left_alt",attachment:"attach_file",close:"close",collapsed:"arrow_right",extended:"arrow_drop_down",pause:"pause",play:"play_arrow",stop:"stop",format_zip:"folder_zip"}}},a={};function r(e){var t=a[e];if(void 0!==t)return t.exports;var i=a[e]={id:e,loaded:!1,exports:{}};return s[e].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.m=s,r.amdD=function(){throw new Error("define cannot be used indirect")},r.amdO={},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(i,n){if(1&n&&(i=this(i)),8&n)return i;if("object"==typeof i&&i){if(4&n&&i.__esModule)return i;if(16&n&&"function"==typeof i.then)return i}var s=Object.create(null);r.r(s);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&n&&i;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>i[e]);return a.default=()=>i,r.d(s,a),s},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce((t,i)=>(r.f[i](e,t),t),[])),r.u=e=>e+".bundle.js",r.miniCssF=e=>{},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i={},n="everything-viewer:",r.l=(e,t,s,a)=>{if(i[e])i[e].push(t);else{var o,c;if(void 0!==s)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var h=l[d];if(h.getAttribute("src")==e||h.getAttribute("data-webpack")==n+s){o=h;break}}o||(c=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,r.nc&&o.setAttribute("nonce",r.nc),o.setAttribute("data-webpack",n+s),o.src=e),i[e]=[t];var m=(t,n)=>{o.onerror=o.onload=null,clearTimeout(p);var s=i[e];if(delete i[e],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach(e=>e(n)),t)return t(n)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=m.bind(null,o.onerror),o.onload=m.bind(null,o.onload),c&&document.head.appendChild(o)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=i[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{r.b=document.baseURI||self.location.href;var e={8792:0};r.f.j=(t,i)=>{var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var s=new Promise((i,s)=>n=e[t]=[i,s]);i.push(n[2]=s);var a=r.p+r.u(t),o=new Error;r.l(a,i=>{if(r.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,n[1](o)}},"chunk-"+t,t)}};var t=(t,i)=>{var n,s,[a,o,c]=i,l=0;if(a.some(t=>0!==e[t])){for(n in o)r.o(o,n)&&(r.m[n]=o[n]);if(c)c(r)}for(t&&t(i);l<a.length;l++)s=a[l],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0},i=self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e=r(38518);class t{constructor(e){this._events={},e.addEventListener("dragover",e=>{e.preventDefault()}),e.addEventListener("drop",e=>{e.preventDefault(),this._handleDropped(e.dataTransfer)})}_handleDirectory(e){console.log("[DropHandler._handleDirectory] Directory dropped: "+e.name);const t=this._events.directory;Array.isArray(t)&&t.forEach(t=>t(e))}_handleDropped(e){if(e.items){const t=e.items[0];if(t&&"file"===t.kind)if("function"==typeof t.webkitGetAsEntry){const e=t.webkitGetAsEntry();e.isFile?this._handleFile(t.getAsFile()):e.isDirectory&&this._handleDirectory(e)}else console.warn('[DropHandler._handleDropped] Method "webkitGetAsEntry" not supported by browser. Cannot support directories.'),this._handleFile(t.getAsFile())}else if(e.files){console.warn('[DropHandler._handleDropped] DataTransfer has no attribute "items", using fallback on "files".');const t=e.files[0];t&&this._handleFile(t)}else console.error('[DropHandler._handleDropped] DataTransfer has neither "items" nor "files" attribute.',e)}_handleFile(e){console.log("[DropHandler._handleFile] File dropped: "+e.name);const t=this._events.file;Array.isArray(t)&&t.forEach(t=>t(e))}on(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}}var i=r(42109),n=r(81094),s=r(19108),a=r(26042);class o extends s.u{render(){super.render();const s=new n.$({classes:"file-open",text:"Open…"});s.on("click",e=>{const t=document.createElement("input");t.type="file",t.addEventListener("change",e=>{i.UI.open(t.files[0])}),t.click()});const r=new a.p({title:"Everything Viewer",closable:!1,x:20,y:20,content:[s,i.UI.build('<a href="https://github.com/sebadorn/everything-viewer" id="github">GitHub</a>')]}),o=i.UI.build(`\n\t\t\t<main>\n\t\t\t\t<a href="https://github.com/sebadorn/everything-viewer/blob/main/CHANGELOG.md" target="_blank" class="build">BUILD ${e.D.getBuildNumber()}</a>\n\t\t\t\t<div class="viewer">\n\t\t\t\t\t<div class="note-dragdrop">\n\t\t\t\t\t\t<h1>Everything Viewer</h1>\n\t\t\t\t\t\t<span>Just drag &amp; drop your file here</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</main>\n\t\t`),c=o.querySelector(".viewer"),l=new t(c);return l.on("file",e=>i.UI.open(e)),l.on("directory",(e,t)=>i.UI.open(e)),this._node=document.createDocumentFragment(),this._node.append(r.render(),o),this._node}}r(79802).Registry.init();const c=new o;document.body.append(c.render())})()})();