"use strict";(self.webpackChunkeverything_viewer=self.webpackChunkeverything_viewer||[]).push([[262],{11912:(t,e,s)=>{s.d(e,{MHTMLParser:()=>i});var n=s(38518);const r={getValueForKey(t,e){e=String(e).toLowerCase();const s=Object.keys(t);for(let n=0;n<s.length;n++){const r=s[n];if(r.toLowerCase()===e)return t[r]}}};var o=s(62845);class i extends o.V{constructor(t){super(t),this.blobs={}}_parseBodySection(t,e){let s=r.getValueForKey(t,"Content-Transfer-Encoding");if("string"!=typeof s)return e;if(s=s.toLowerCase(),"quoted-printable"===s)return n.D.decodeContent(e);if("base64"===s){const t=window.atob(e.replaceAll("\r\n",""));return Uint8Array.from(t,t=>t.charCodeAt(0))}return e}_parseHeader(t){const e='boundary="',s=t.indexOf(e);let n=t.substring(s+10);const r=n.indexOf('"\r\n');n=n.substring(0,r);const o=t.substring(0,s+10+r+1).split("\r\n"),i=this._parseMetaSection(o);return i._boundary=n,i}_parseMetaSection(t){const e={};let s=null;for(let n=0;n<t.length;n++){const r=t[n];if(0===r.trim().length)continue;if(r.startsWith("  ")||r.startsWith("\t")){s&&(e[s]+=" "+r.trim());continue}const o=r.split(": "),i=o[0],a=o.slice(1).join(": ");e[i]=a,s=i}return e}destroy(){for(const t in this.blobs)URL.revokeObjectURL(this.blobs[t]);this.blobs={}}async parse(){const t=await this.file.text(),e=this._parseHeader(t),s=t.split(`--${e._boundary}`),n=[];let o="";for(let t=1;t<s.length-1;t++){const e=s[t],i=e.indexOf("\r\n\r\n"),a=e.substring(0,i),l=e.substring(i+4),c={meta:this._parseMetaSection(a.split("\r\n"))};if(c.body=this._parseBodySection(c.meta,l),1===t&&(o=c.body),t>1){const t=r.getValueForKey(c.meta,"Content-Location");if(t){const e=r.getValueForKey(c.meta,"Content-Type"),s=new Blob([c.body],e?{type:e}:null);c.blob=URL.createObjectURL(s),this.blobs[t]=c.blob}}n.push(c)}for(const t in this.blobs){const e=this.blobs[t];o=o.replaceAll(t,e)}const i={meta:e,data:n,html:o};return console.debug("[MHTMLParser.parse]",i),i}}}}]);